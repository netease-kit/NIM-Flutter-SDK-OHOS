!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).FlutterWeb={})}(this,(function(e){"use strict";var t=function(){return t=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},t.apply(this,arguments)};function r(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a}function n(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))}function i(e,t){var r,n,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}"function"==typeof SuppressedError&&SuppressedError;var o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function a(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function s(e){var t={exports:{}};return e(t,t.exports),t.exports}var c,u=function(e,t){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return e.apply(t,r)}},d=Object.prototype.toString,l=(c=Object.create(null),function(e){var t=d.call(e);return c[t]||(c[t]=t.slice(8,-1).toLowerCase())});function p(e){return e=e.toLowerCase(),function(t){return l(t)===e}}function m(e){return Array.isArray(e)}function h(e){return void 0===e}var f=p("ArrayBuffer");function g(e){return null!==e&&"object"==typeof e}function v(e){if("object"!==l(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}var y=p("Date"),M=p("File"),I=p("Blob"),S=p("FileList");function T(e){return"[object Function]"===d.call(e)}var b=p("URLSearchParams");function C(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),m(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}var _,E=(_="undefined"!=typeof Uint8Array&&Object.getPrototypeOf(Uint8Array),function(e){return _&&e instanceof _}),w={isArray:m,isArrayBuffer:f,isBuffer:function(e){return null!==e&&!h(e)&&null!==e.constructor&&!h(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){var t="[object FormData]";return e&&("function"==typeof FormData&&e instanceof FormData||d.call(e)===t||T(e.toString)&&e.toString()===t)},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&f(e.buffer)},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:g,isPlainObject:v,isUndefined:h,isDate:y,isFile:M,isBlob:I,isFunction:T,isStream:function(e){return g(e)&&T(e.pipe)},isURLSearchParams:b,isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:C,merge:function e(){var t={};function r(r,n){v(t[n])&&v(r)?t[n]=e(t[n],r):v(r)?t[n]=e({},r):m(r)?t[n]=r.slice():t[n]=r}for(var n=0,i=arguments.length;n<i;n++)C(arguments[n],r);return t},extend:function(e,t,r){return C(t,(function(t,n){e[n]=r&&"function"==typeof t?u(t,r):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e},inherits:function(e,t,r,n){e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,r&&Object.assign(e.prototype,r)},toFlatObject:function(e,t,r){var n,i,o,a={};t=t||{};do{for(i=(n=Object.getOwnPropertyNames(e)).length;i-- >0;)a[o=n[i]]||(t[o]=e[o],a[o]=!0);e=Object.getPrototypeOf(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},kindOf:l,kindOfTest:p,endsWith:function(e,t,r){e=String(e),(void 0===r||r>e.length)&&(r=e.length),r-=t.length;var n=e.indexOf(t,r);return-1!==n&&n===r},toArray:function(e){if(!e)return null;var t=e.length;if(h(t))return null;for(var r=new Array(t);t-- >0;)r[t]=e[t];return r},isTypedArray:E,isFileList:S};function R(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var k=function(e,t,r){if(!t)return e;var n;if(r)n=r(t);else if(w.isURLSearchParams(t))n=t.toString();else{var i=[];w.forEach(t,(function(e,t){null!=e&&(w.isArray(e)?t+="[]":e=[e],w.forEach(e,(function(e){w.isDate(e)?e=e.toISOString():w.isObject(e)&&(e=JSON.stringify(e)),i.push(R(t)+"="+R(e))})))})),n=i.join("&")}if(n){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e};function A(){this.handlers=[]}A.prototype.use=function(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1},A.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},A.prototype.forEach=function(e){w.forEach(this.handlers,(function(t){null!==t&&e(t)}))};var N=A,x=function(e,t){w.forEach(e,(function(r,n){n!==t&&n.toUpperCase()===t.toUpperCase()&&(e[t]=r,delete e[n])}))};function O(e,t,r,n,i){Error.call(this),this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i)}w.inherits(O,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var P=O.prototype,L={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach((function(e){L[e]={value:e}})),Object.defineProperties(O,L),Object.defineProperty(P,"isAxiosError",{value:!0}),O.from=function(e,t,r,n,i,o){var a=Object.create(P);return w.toFlatObject(e,a,(function(e){return e!==Error.prototype})),O.call(a,e.message,t,r,n,i),a.name=e.name,o&&Object.assign(a,o),a};var V=O,U={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};var D=function(e,t){t=t||new FormData;var r=[];function n(e){return null===e?"":w.isDate(e)?e.toISOString():w.isArrayBuffer(e)||w.isTypedArray(e)?"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}return function e(i,o){if(w.isPlainObject(i)||w.isArray(i)){if(-1!==r.indexOf(i))throw Error("Circular reference detected in "+o);r.push(i),w.forEach(i,(function(r,i){if(!w.isUndefined(r)){var a,s=o?o+"."+i:i;if(r&&!o&&"object"==typeof r)if(w.endsWith(i,"{}"))r=JSON.stringify(r);else if(w.endsWith(i,"[]")&&(a=w.toArray(r)))return void a.forEach((function(e){!w.isUndefined(e)&&t.append(s,n(e))}));e(r,s)}})),r.pop()}else t.append(o,n(i))}(e),t},q=w.isStandardBrowserEnv()?{write:function(e,t,r,n,i,o){var a=[];a.push(e+"="+encodeURIComponent(t)),w.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),w.isString(n)&&a.push("path="+n),w.isString(i)&&a.push("domain="+i),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},B=function(e,t){return e&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)?function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t},F=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],G=w.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function n(e){var n=e;return t&&(r.setAttribute("href",n),n=r.href),r.setAttribute("href",n),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return e=n(window.location.href),function(t){var r=w.isString(t)?n(t):t;return r.protocol===e.protocol&&r.host===e.host}}():function(){return!0};function j(e){V.call(this,null==e?"canceled":e,V.ERR_CANCELED),this.name="CanceledError"}w.inherits(j,V,{__CANCEL__:!0});var H=j,W=function(e){return new Promise((function(t,r){var n,i=e.data,o=e.headers,a=e.responseType;function s(){e.cancelToken&&e.cancelToken.unsubscribe(n),e.signal&&e.signal.removeEventListener("abort",n)}w.isFormData(i)&&w.isStandardBrowserEnv()&&delete o["Content-Type"];var c=new XMLHttpRequest;if(e.auth){var u=e.auth.username||"",d=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";o.Authorization="Basic "+btoa(u+":"+d)}var l=B(e.baseURL,e.url);function p(){if(c){var n,i,o,u,d,l="getAllResponseHeaders"in c?(n=c.getAllResponseHeaders(),d={},n?(w.forEach(n.split("\n"),(function(e){if(u=e.indexOf(":"),i=w.trim(e.substr(0,u)).toLowerCase(),o=w.trim(e.substr(u+1)),i){if(d[i]&&F.indexOf(i)>=0)return;d[i]="set-cookie"===i?(d[i]?d[i]:[]).concat([o]):d[i]?d[i]+", "+o:o}})),d):d):null;!function(e,t,r){var n=r.config.validateStatus;r.status&&n&&!n(r.status)?t(new V("Request failed with status code "+r.status,[V.ERR_BAD_REQUEST,V.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):e(r)}((function(e){t(e),s()}),(function(e){r(e),s()}),{data:a&&"text"!==a&&"json"!==a?c.response:c.responseText,status:c.status,statusText:c.statusText,headers:l,config:e,request:c}),c=null}}if(c.open(e.method.toUpperCase(),k(l,e.params,e.paramsSerializer),!0),c.timeout=e.timeout,"onloadend"in c?c.onloadend=p:c.onreadystatechange=function(){c&&4===c.readyState&&(0!==c.status||c.responseURL&&0===c.responseURL.indexOf("file:"))&&setTimeout(p)},c.onabort=function(){c&&(r(new V("Request aborted",V.ECONNABORTED,e,c)),c=null)},c.onerror=function(){r(new V("Network Error",V.ERR_NETWORK,e,c,c)),c=null},c.ontimeout=function(){var t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",n=e.transitional||U;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),r(new V(t,n.clarifyTimeoutError?V.ETIMEDOUT:V.ECONNABORTED,e,c)),c=null},w.isStandardBrowserEnv()){var m=(e.withCredentials||G(l))&&e.xsrfCookieName?q.read(e.xsrfCookieName):void 0;m&&(o[e.xsrfHeaderName]=m)}"setRequestHeader"in c&&w.forEach(o,(function(e,t){void 0===i&&"content-type"===t.toLowerCase()?delete o[t]:c.setRequestHeader(t,e)})),w.isUndefined(e.withCredentials)||(c.withCredentials=!!e.withCredentials),a&&"json"!==a&&(c.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&c.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&c.upload&&c.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(n=function(e){c&&(r(!e||e&&e.type?new H:e),c.abort(),c=null)},e.cancelToken&&e.cancelToken.subscribe(n),e.signal&&(e.signal.aborted?n():e.signal.addEventListener("abort",n))),i||(i=null);var h,f=(h=/^([-+\w]{1,25})(:?\/\/|:)/.exec(l))&&h[1]||"";f&&-1===["http","https","file"].indexOf(f)?r(new V("Unsupported protocol "+f+":",V.ERR_BAD_REQUEST,e)):c.send(i)}))},K={"Content-Type":"application/x-www-form-urlencoded"};function Y(e,t){!w.isUndefined(e)&&w.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var Q,J={transitional:U,adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(Q=W),Q),transformRequest:[function(e,t){if(x(t,"Accept"),x(t,"Content-Type"),w.isFormData(e)||w.isArrayBuffer(e)||w.isBuffer(e)||w.isStream(e)||w.isFile(e)||w.isBlob(e))return e;if(w.isArrayBufferView(e))return e.buffer;if(w.isURLSearchParams(e))return Y(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var r,n=w.isObject(e),i=t&&t["Content-Type"];if((r=w.isFileList(e))||n&&"multipart/form-data"===i){var o=this.env&&this.env.FormData;return D(r?{"files[]":e}:e,o&&new o)}return n||"application/json"===i?(Y(t,"application/json"),function(e,t,r){if(w.isString(e))try{return(t||JSON.parse)(e),w.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(r||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional||J.transitional,r=t&&t.silentJSONParsing,n=t&&t.forcedJSONParsing,i=!r&&"json"===this.responseType;if(i||n&&w.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(i){if("SyntaxError"===e.name)throw V.from(e,V.ERR_BAD_RESPONSE,this,null,this.response);throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:null},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};w.forEach(["delete","get","head"],(function(e){J.headers[e]={}})),w.forEach(["post","put","patch"],(function(e){J.headers[e]=w.merge(K)}));var z=J,X=function(e,t,r){var n=this||z;return w.forEach(r,(function(r){e=r.call(n,e,t)})),e},$=function(e){return!(!e||!e.__CANCEL__)};function Z(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new H}var ee=function(e){return Z(e),e.headers=e.headers||{},e.data=X.call(e,e.data,e.headers,e.transformRequest),e.headers=w.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),w.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||z.adapter)(e).then((function(t){return Z(e),t.data=X.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return $(t)||(Z(e),t&&t.response&&(t.response.data=X.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))},te=function(e,t){t=t||{};var r={};function n(e,t){return w.isPlainObject(e)&&w.isPlainObject(t)?w.merge(e,t):w.isPlainObject(t)?w.merge({},t):w.isArray(t)?t.slice():t}function i(r){return w.isUndefined(t[r])?w.isUndefined(e[r])?void 0:n(void 0,e[r]):n(e[r],t[r])}function o(e){if(!w.isUndefined(t[e]))return n(void 0,t[e])}function a(r){return w.isUndefined(t[r])?w.isUndefined(e[r])?void 0:n(void 0,e[r]):n(void 0,t[r])}function s(r){return r in t?n(e[r],t[r]):r in e?n(void 0,e[r]):void 0}var c={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:s};return w.forEach(Object.keys(e).concat(Object.keys(t)),(function(e){var t=c[e]||i,n=t(e);w.isUndefined(n)&&t!==s||(r[e]=n)})),r},re="0.27.2",ne=re,ie={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){ie[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}}));var oe={};ie.transitional=function(e,t,r){function n(e,t){return"[Axios v"+ne+"] Transitional option '"+e+"'"+t+(r?". "+r:"")}return function(r,i,o){if(!1===e)throw new V(n(i," has been removed"+(t?" in "+t:"")),V.ERR_DEPRECATED);return t&&!oe[i]&&(oe[i]=!0,console.warn(n(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,i,o)}};var ae={assertOptions:function(e,t,r){if("object"!=typeof e)throw new V("options must be an object",V.ERR_BAD_OPTION_VALUE);for(var n=Object.keys(e),i=n.length;i-- >0;){var o=n[i],a=t[o];if(a){var s=e[o],c=void 0===s||a(s,o,e);if(!0!==c)throw new V("option "+o+" must be "+c,V.ERR_BAD_OPTION_VALUE)}else if(!0!==r)throw new V("Unknown option "+o,V.ERR_BAD_OPTION)}},validators:ie},se=ae.validators;function ce(e){this.defaults=e,this.interceptors={request:new N,response:new N}}ce.prototype.request=function(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},(t=te(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var r=t.transitional;void 0!==r&&ae.assertOptions(r,{silentJSONParsing:se.transitional(se.boolean),forcedJSONParsing:se.transitional(se.boolean),clarifyTimeoutError:se.transitional(se.boolean)},!1);var n=[],i=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(i=i&&e.synchronous,n.unshift(e.fulfilled,e.rejected))}));var o,a=[];if(this.interceptors.response.forEach((function(e){a.push(e.fulfilled,e.rejected)})),!i){var s=[ee,void 0];for(Array.prototype.unshift.apply(s,n),s=s.concat(a),o=Promise.resolve(t);s.length;)o=o.then(s.shift(),s.shift());return o}for(var c=t;n.length;){var u=n.shift(),d=n.shift();try{c=u(c)}catch(e){d(e);break}}try{o=ee(c)}catch(e){return Promise.reject(e)}for(;a.length;)o=o.then(a.shift(),a.shift());return o},ce.prototype.getUri=function(e){e=te(this.defaults,e);var t=B(e.baseURL,e.url);return k(t,e.params,e.paramsSerializer)},w.forEach(["delete","get","head","options"],(function(e){ce.prototype[e]=function(t,r){return this.request(te(r||{},{method:e,url:t,data:(r||{}).data}))}})),w.forEach(["post","put","patch"],(function(e){function t(t){return function(r,n,i){return this.request(te(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:r,data:n}))}}ce.prototype[e]=t(),ce.prototype[e+"Form"]=t(!0)}));var ue=ce;function de(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var r=this;this.promise.then((function(e){if(r._listeners){var t,n=r._listeners.length;for(t=0;t<n;t++)r._listeners[t](e);r._listeners=null}})),this.promise.then=function(e){var t,n=new Promise((function(e){r.subscribe(e),t=e})).then(e);return n.cancel=function(){r.unsubscribe(t)},n},e((function(e){r.reason||(r.reason=new H(e),t(r.reason))}))}de.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},de.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},de.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},de.source=function(){var e;return{token:new de((function(t){e=t})),cancel:e}};var le=de;var pe=function e(t){var r=new ue(t),n=u(ue.prototype.request,r);return w.extend(n,ue.prototype,r),w.extend(n,r),n.create=function(r){return e(te(t,r))},n}(z);pe.Axios=ue,pe.CanceledError=H,pe.CancelToken=le,pe.isCancel=$,pe.VERSION=re,pe.toFormData=D,pe.AxiosError=V,pe.Cancel=pe.CanceledError,pe.all=function(e){return Promise.all(e)},pe.spread=function(e){return function(t){return e.apply(null,t)}},pe.isAxiosError=function(e){return w.isObject(e)&&!0===e.isAxiosError};var me=pe,he=pe;me.default=he;var fe=me,ge=s((function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,n,o,a){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new i(n,o||e,a),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function a(e,t){0===--e._eventsCount?e._events=new n:delete e._events[t]}function s(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),s.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,o=n.length,a=new Array(o);i<o;i++)a[i]=n[i].fn;return a},s.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},s.prototype.emit=function(e,t,n,i,o,a){var s=r?r+e:e;if(!this._events[s])return!1;var c,u,d=this._events[s],l=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),l){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,n),!0;case 4:return d.fn.call(d.context,t,n,i),!0;case 5:return d.fn.call(d.context,t,n,i,o),!0;case 6:return d.fn.call(d.context,t,n,i,o,a),!0}for(u=1,c=new Array(l-1);u<l;u++)c[u-1]=arguments[u];d.fn.apply(d.context,c)}else{var p,m=d.length;for(u=0;u<m;u++)switch(d[u].once&&this.removeListener(e,d[u].fn,void 0,!0),l){case 1:d[u].fn.call(d[u].context);break;case 2:d[u].fn.call(d[u].context,t);break;case 3:d[u].fn.call(d[u].context,t,n);break;case 4:d[u].fn.call(d[u].context,t,n,i);break;default:if(!c)for(p=1,c=new Array(l-1);p<l;p++)c[p-1]=arguments[p];d[u].fn.apply(d[u].context,c)}}return!0},s.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},s.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},s.prototype.removeListener=function(e,t,n,i){var o=r?r+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||n&&s.context!==n||a(this,o);else{for(var c=0,u=[],d=s.length;c<d;c++)(s[c].fn!==t||i&&!s[c].once||n&&s[c].context!==n)&&u.push(s[c]);u.length?this._events[o]=1===u.length?u[0]:u:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&a(this,t)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s})),ve=s((function(e,t){function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=r(fe),i=r(ge),a=function(e,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},a(e,t)};function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var c=function(){return c=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},c.apply(this,arguments)};function u(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))}function d(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}function l(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function p(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a}function m(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var h=function(e){var t=e.method,r=void 0===t?"POST":t,i=e.url,o=e.data,a=e.headers;return u(void 0,void 0,void 0,(function(){var e,t;return d(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,n.default({method:r,url:i,data:o,headers:a})];case 1:return 200!==(e=s.sent()).data.code?[2,Promise.reject(e.data)]:[2,e.data];case 2:return t=s.sent(),[2,Promise.reject(t)];case 3:return[2]}}))}))},f=h,g=function(){function e(e,t){this.store=new Map,this.type="memory",this.salt="__salt__",e&&(this.type=e),t&&(this.salt=t)}return e.prototype.get=function(e){var t;switch(this.type){case"memory":return this.store.get(e);case"localStorage":return(t=localStorage.getItem("".concat(this.salt).concat(e)))?JSON.parse(t):t;case"sessionStorage":return(t=sessionStorage.getItem("".concat(this.salt).concat(e)))?JSON.parse(t):t}},e.prototype.set=function(e,t){switch(this.type){case"memory":this.store.set(e,t);break;case"localStorage":localStorage.setItem("".concat(this.salt).concat(e),JSON.stringify(t));break;case"sessionStorage":sessionStorage.setItem("".concat(this.salt).concat(e),JSON.stringify(t))}},e.prototype.remove=function(e){switch(this.type){case"memory":this.store.delete(e);break;case"localStorage":localStorage.removeItem("".concat(this.salt).concat(e));break;case"sessionStorage":sessionStorage.removeItem("".concat(this.salt).concat(e))}},e}(),v=function(){function e(e){var t=e.appKey,r=e.version,n=e.component,i=e.nertcVersion,o=e.imVersion,a=e.platform,s=void 0===a?"Web":a,c=e.channel,u=void 0===c?"netease":c;this.platform=s,this.appKey=t,this.version=r,this.component=n,this.nertcVersion=i,this.imVersion=o,this.channel=u}return e.prototype.track=function(e,t){return u(this,void 0,void 0,(function(){var r,n,i,o,a,s,c,u,l;return d(this,(function(d){switch(d.label){case 0:n=(r=this).appKey,i=r.version,o=r.component,a=r.nertcVersion,s=r.imVersion,c=r.platform,u=r.channel,l=Date.now(),d.label=1;case 1:return d.trys.push([1,3,,4]),[4,f({method:"POST",url:"https://statistic.live.126.net/statics/report/xkit/action",data:{appKey:n,version:i,component:o,timeStamp:l,nertcVersion:a,imVersion:s,platform:c,reportType:e,data:t,channel:u}})];case 2:case 3:return d.sent(),[3,4];case 4:return[2]}}))}))},e}(),y=v,M=function(e){function t(t){var r=e.call(this)||this;return r.visibilityState=document.visibilityState,r.entries=[],r._visibilitychange=function(){r.visibilityState=document.visibilityState,r._trigger()},r.intersectionObserver=new IntersectionObserver(r._intersectionObserverHandler.bind(r),t),document.addEventListener("visibilitychange",r._visibilitychange),r}return s(t,e),t.prototype.observe=function(e){return this.intersectionObserver.observe(e)},t.prototype.unobserve=function(e){return this.intersectionObserver.unobserve(e)},t.prototype.destroy=function(){this.intersectionObserver.disconnect(),document.removeEventListener("visibilitychange",this._visibilitychange),this.entries=[]},t.prototype._intersectionObserverHandler=function(e){this.entries=e,this._trigger()},t.prototype._trigger=function(){var e=this;this.entries.forEach((function(t){"visible"!==e.visibilityState||t.intersectionRatio<=0?e.emit("visibleChange",{visible:!1,target:t.target}):e.emit("visibleChange",{visible:!0,target:t.target})}))},t}(i.default),I="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==o?o:"undefined"!=typeof self?self:{};var S=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e){var t,r;t=I,r=function(){var e=function(){},t="undefined",r=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"],i={},o=null;function a(e,t){var r=e[t];if("function"==typeof r.bind)return r.bind(e);try{return Function.prototype.bind.call(r,e)}catch(t){return function(){return Function.prototype.apply.apply(r,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(){for(var r=this.getLevel(),i=0;i<n.length;i++){var o=n[i];this[o]=i<r?e:this.methodFactory(o,r,this.name)}if(this.log=this.debug,typeof console===t&&r<this.levels.SILENT)return"No console available for logging"}function u(e){return function(){typeof console!==t&&(c.call(this),this[e].apply(this,arguments))}}function d(n,i,o){return function(n){return"debug"===n&&(n="log"),typeof console!==t&&("trace"===n&&r?s:void 0!==console[n]?a(console,n):void 0!==console.log?a(console,"log"):e)}(n)||u.apply(this,arguments)}function l(e,r){var a,s,u,l=this,p="loglevel";function m(){var e;if(typeof window!==t&&p){try{e=window.localStorage[p]}catch(e){}if(typeof e===t)try{var r=window.document.cookie,n=encodeURIComponent(p),i=r.indexOf(n+"=");-1!==i&&(e=/^([^;]+)/.exec(r.slice(i+n.length+1))[1])}catch(e){}return void 0===l.levels[e]&&(e=void 0),e}}function h(e){var t=e;if("string"==typeof t&&void 0!==l.levels[t.toUpperCase()]&&(t=l.levels[t.toUpperCase()]),"number"==typeof t&&t>=0&&t<=l.levels.SILENT)return t;throw new TypeError("log.setLevel() called with invalid level: "+e)}"string"==typeof e?p+=":"+e:"symbol"==typeof e&&(p=void 0),l.name=e,l.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},l.methodFactory=r||d,l.getLevel=function(){return null!=u?u:null!=s?s:a},l.setLevel=function(e,r){return u=h(e),!1!==r&&function(e){var r=(n[e]||"silent").toUpperCase();if(typeof window!==t&&p){try{return void(window.localStorage[p]=r)}catch(e){}try{window.document.cookie=encodeURIComponent(p)+"="+r+";"}catch(e){}}}(u),c.call(l)},l.setDefaultLevel=function(e){s=h(e),m()||l.setLevel(e,!1)},l.resetLevel=function(){u=null,function(){if(typeof window!==t&&p){try{window.localStorage.removeItem(p)}catch(e){}try{window.document.cookie=encodeURIComponent(p)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}(),c.call(l)},l.enableAll=function(e){l.setLevel(l.levels.TRACE,e)},l.disableAll=function(e){l.setLevel(l.levels.SILENT,e)},l.rebuild=function(){if(o!==l&&(a=h(o.getLevel())),c.call(l),o===l)for(var e in i)i[e].rebuild()},a=h(o?o.getLevel():"WARN");var f=m();null!=f&&(u=h(f)),c.call(l)}(o=new l).getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=i[e];return t||(t=i[e]=new l(e,o.methodFactory)),t};var p=typeof window!==t?window.log:void 0;return o.noConflict=function(){return typeof window!==t&&window.log===o&&(window.log=p),o},o.getLoggers=function(){return i},o.default=o,o},e.exports?e.exports=r():t.log=r()})),T=S;function b(e){var t=["scene/apps/***/",'"rtcKey":"***"','"imKey":"***"','"appkey":"***"','"appkey": "***"','appkey:"***"','appkey: "***"','"appkey":***','"appkey": ***',"appkey:***","appkey: ***"];return["scene/apps/[a-z0-9]{32}/",'"rtcKey":"[a-z0-9]{32}"','"imKey":"[a-z0-9]{32}"','"appkey":"[a-z0-9]{32}"','"appkey": "[a-z0-9]{32}"','appkey:"[a-z0-9]{32}"','appkey: "[a-z0-9]{32}"','"appkey":[a-z0-9]{32}','"appkey": [a-z0-9]{32}',"appkey:[a-z0-9]{32}","appkey: [a-z0-9]{32}"].forEach((function(r,n){var i=new RegExp(r,"gi");e=e.replace(i,t[n])})),e}var C,_=function(e){var t,r=void 0===e?{appName:"",version:"",storeWindow:!1,needStringify:!0}:e,n=r.level,i=r.appName,o=void 0===i?"":i,a=r.storeWindow,s=void 0!==a&&a,c=r.needStringify,u=void 0===c||c,d=function(){try{var e=navigator.userAgent.toLocaleLowerCase(),t=e.match(/(msie|firefox|chrome|opera|version).*?([\d.]+)/)||[];return{browser:t[1].replace(/version/,"safari"),ver:t[2]}}catch(e){return null}},l=(t=new Proxy(T,{get:function(e,t){var r,n;if(t in e){var i=e[t];if(!["log","info","warn","error","trace","debug"].includes(t))return i;var a,s,c,l,h,f,g,v=(a=new Date,s=a.getFullYear(),c=a.getMonth()+1,l=a.getDate(),h=a.getHours()<10?"0".concat(a.getHours()):a.getHours(),f=a.getMinutes()<10?"0".concat(a.getMinutes()):a.getMinutes(),g=a.getSeconds()<10?"0".concat(a.getSeconds()):a.getSeconds(),"".concat(s,"-").concat(c,"-").concat(l," ").concat(h,":").concat(f,":").concat(g));d()&&(v+="[".concat(null===(r=d())||void 0===r?void 0:r.browser," ").concat(null===(n=d())||void 0===n?void 0:n.ver,"]")),v+="[".concat({log:"L",info:"I",warn:"W",error:"E",trace:"E",debug:"D"}[t],"]")+"[".concat(o,"]")+":";var y=this;return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(u)for(var r=0;r<e.length;r++){if("object"==typeof e[r])try{e[r]=JSON.stringify(e[r])}catch(t){console.warn("[日志打印对象无法序列化]",e[r])}"string"==typeof e[r]&&(e[r]=b(e[r]))}return i.apply(y,m([v],p(e),!1))}}}}),t);return n&&l.setLevel(n),s&&(window.__LOGGER__=l),l};t.EventPriority=void 0,(C=t.EventPriority||(t.EventPriority={}))[C.LOW=0]="LOW",C[C.NORMAL=1]="NORMAL",C[C.HIGH=2]="HIGH";var E=function(){function e(e){this.appKey="",this.component="",this.data={},this.framework="",this.version="",this.startTime=0,this.endTime=0,this.duration=0,this.data.startTime=(new Date).getTime(),this.data.timeStamp=this.data.startTime,this.eventId=e.eventId,this.priority=e.priority}return e.prototype.end=function(){this.data.endTime&&this.data.duration||(this.data.endTime=this.data.endTime||(new Date).getTime(),this.data.duration=this.data.duration||this.data.endTime-this.data.startTime)},e.prototype.setAppInfo=function(e){this.appKey=e.appKey,this.component=e.component,this.version=e.version,e.framework&&(this.framework=e.framework)},e.prototype.endWith=function(e){var t=e.code,r=e.msg,n=e.requestId,i=e.serverCost;this.data.code="number"!=typeof t?-2:t,this.data.message=r,this.data.requestId=n,this.data.serverCost=i,this.end()},e.prototype.endWithSuccess=function(e){if(e){var t=e.requestId,r=e.serverCost;this.data.requestId=t,this.data.serverCost=r}this.data.code=0,this.data.message="success",this.end()},e.prototype.endWithFailure=function(e){if(e){var t=e.requestId,r=e.serverCost;this.data.requestId=t,this.data.serverCost=r}this.data.code=-1,this.data.message="failure",this.end()},e.prototype.setParams=function(e){return this.data.params=c({},e),this},e.prototype.addParams=function(e){return this.data.params=c(c({},this.data.params),e),this},e.prototype.setData=function(e){this.data=c(c({},this.data),e)},e.prototype.setUserId=function(e){this.data.userId=e},e}(),w=function(e){function t(t){return e.call(this,t)||this}return s(t,e),t}(E),R=function(e){function t(t){var r=e.call(this,t)||this;return r._stepMap=new Map,r}return s(t,e),t.prototype.beginStep=function(e){if(this._stepMap.has(e))return this._stepMap[e];var t=new w({eventId:e,priority:this.priority});return t.setData({step:e}),this._stepMap.set(e,t),t},t.prototype.addStep=function(e){this._stepMap.set(e.eventId,e)},t.prototype.removeStep=function(e){this._stepMap.delete(e)},t.prototype.endWith=function(t){e.prototype.endWith.call(this,t),this.end()},t.prototype.endWithSuccess=function(t){e.prototype.endWithSuccess.call(this,t),this.end()},t.prototype.endWithFailure=function(t){e.prototype.endWithFailure.call(this,t),this.end()},t.prototype.end=function(){var t,r,n=[];e.prototype.end.call(this);try{for(var i=l(this._stepMap.values()),o=i.next();!o.done;o=i.next()){var a=o.value;a.data.index=n.length,n.push(a.data)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}n.length>0&&(this.data.steps=n)},t}(w);function k(){var e="Unknown",t="";try{var r=navigator.userAgent;if(-1!==r.indexOf("Chrome")){e="Chrome";var n=r.indexOf("Chrome")+7,i=r.indexOf(" ",n);t=r.substring(n,i)}else if(-1!==r.indexOf("Firefox")){e="Firefox";n=r.indexOf("Firefox")+8;t=r.substring(n)}else if(-1!==r.indexOf("Safari")){e="Safari";n=r.indexOf("Version")+8,i=r.indexOf(" ",n);t=r.substring(n,i)}else if(-1!==r.indexOf("Edg")){e="Edge";n=r.indexOf("Edg")+4;t=r.substring(n)}else if(-1!==r.indexOf("MSIE")){e="Internet Explorer";n=r.indexOf("MSIE")+5,i=r.indexOf(";",n);t=r.substring(n,i)}}catch(e){console.error("getBrowserInfo error:",e)}return{name:e,version:t}}var A=function(){function e(e){this._eventsCache=[],this._noReport=!1,this._configMap=new Map,this._retryCount=0;var t=k(),r=window.__XKitReporter__,n="";try{n=navigator.userAgent}catch(e){console.log("navigator is not defined")}this.common={imVersion:e.imVersion,nertcVersion:e.nertcVersion,platform:"Web",osVer:t.version,userAgent:n,manufacturer:"",model:t.name,packageId:(null==r?void 0:r.packageId)||"",appVer:(null==r?void 0:r.appVer)||"",appName:(null==r?void 0:r.appName)||"",deviceId:e.deviceId},this._logger=_({level:"debug",appName:"XKitReporter",version:"2.0.0"})}return e.prototype.getConfig=function(e){return u(this,void 0,void 0,(function(){var t=this;return d(this,(function(r){return[2,n.default({method:"GET",url:"https://yiyong.netease.im/report_conf",headers:{platform:"web",appKey:e}}).then((function(r){t._configMap.set(e,r.data)})).catch((function(){t._retryCount+=1,t._retryCount>3?t._retryCount=0:t.getConfig(e)}))]}))}))},e.prototype.setNoReport=function(e){this._noReport=e},e.prototype.reportEvent=function(e,t){this._noReport||(this._eventsCache.length>=100?this._evictEvent(e):this._eventsCache.push(e),this._scheduleReportEventsTask(null==t?void 0:t.immediate))},e.prototype._evictEvent=function(e){var t=this._eventsCache.findIndex((function(t){return t.priority<e.priority}));this._eventsCache.push(e),-1!==t?this._evictEvent(this._eventsCache[t]):(this._logger.debug("Full event cache, evict event:",e),this._eventsCache=this._eventsCache.filter((function(t){return t!==e})))},e.prototype._scheduleReportEventsTask=function(e){var t=this;void 0===e&&(e=!1);var r=function(){return u(t,void 0,void 0,(function(){var e,t,r,n,i,o,a;return d(this,(function(s){switch(s.label){case 0:for(n in e=this._eventsCache.reduce((function(e,t){var r=t.appKey;return e[r]||(e[r]=[]),e[r].push(t),e}),{}),r=[],t=e)r.push(n);i=0,s.label=1;case 1:return i<r.length?(n=r[i])in t?(o=n,this._configMap.has(o)?[3,3]:[4,this.getConfig(o)]):[3,4]:[3,5];case 2:s.sent(),s.label=3;case 3:if(this._configMap.has(o)&&!(null==(a=this._configMap.get(o))?void 0:a.enabled))return[2];this._reportEventsToServer(o,e[o]),s.label=4;case 4:return i++,[3,1];case 5:return this._eventsCache=[],[2]}}))}))};e&&r(),this._queueTimer||(this._queueTimer=setInterval((function(){if(0===t._eventsCache.length)return t._queueTimer&&clearInterval(t._queueTimer),void(t._queueTimer=void 0);r()}),5e3))},e.prototype._determineMaxRetry=function(e){var r,n,i=0;try{for(var o=l(e),a=o.next();!a.done;a=o.next()){var s=a.value;if(s.priority===t.EventPriority.HIGH){i=5;break}s.priority===t.EventPriority.NORMAL&&(i=2)}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return i},e.prototype._reportEventsToServer=function(e,t){return u(this,void 0,void 0,(function(){var r,n,i,o,a,s,u=this;return d(this,(function(d){return this._configMap.has(e)?(r=this._configMap.get(e),n=t.reduce((function(e,t){var n,i,o,a;if((null===(n=null==r?void 0:r.blacklist)||void 0===n?void 0:n.length)>0&&(null===(i=null==r?void 0:r.blacklist)||void 0===i?void 0:i.includes(t.component)))return e;if((null===(o=null==r?void 0:r.whitelist)||void 0===o?void 0:o.length)>0&&!(null===(a=null==r?void 0:r.whitelist)||void 0===a?void 0:a.includes(t.component)))return e;var s=t.eventId;return e[s]||(e[s]=[]),e[s].push(c(c({},t.data),{appKey:t.appKey,component:t.component,version:t.version,framework:t.framework})),e}),{}),i=this._determineMaxRetry(t),o=0,a={common:this.common,event:n},(s=function(){f({method:"POST",url:"https://statistic.live.126.net/statics/report/common/form",headers:{appkey:e,sdktype:"NEXKitStatistics",ver:"1.0.0","Content-Type":"application/json;charset=utf-8"},data:a}).catch((function(){o<=i?setTimeout(s,2e3*o):u._logger.debug("Failed to report events to server after ".concat(o," retries."),a),o++}))})(),[2]):[2]}))}))},e.setAppInfo=function(e){window.__XKitReporter__={packageId:null==e?void 0:e.packageId,appName:null==e?void 0:e.appName,appVer:null==e?void 0:e.appVer}},e.getInstance=function(t){if(!t){if(!this.instance)throw new Error("XKitReporter not initialized");return this.instance}return this.instance||(this.instance=new e(t)),this.instance},e}(),N=A;t.EventStep=w,t.EventTracking=y,t.IntervalEvent=R,t.ReportEvent=E,t.Storage=g,t.VisibilityObserver=M,t.XKitReporter=N,t.addUrlSearch=function(e,t){var r=new URL(e);return r.search+=(r.search.startsWith("?")?"&":"?")+t,r.href},t.createLoggerDecorator=function(e,t){return function(r,n,i){var o=i.value;i.value=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return u(this,void 0,void 0,(function(){var i,a,s;return d(this,(function(c){switch(c.label){case 0:t||(t=this.logger),["log","error"].some((function(e){return!t[e]}))&&console.warn("loggerDecorator warning: your logger is not complete"),i=o.name||n||"",c.label=1;case 1:return c.trys.push([1,3,,4]),null==t||t.log.apply(t,m([e,i],p(r),!1)),[4,o.apply(this,r)];case 2:return a=c.sent(),null==t||t.log(e,"".concat(i," success: "),a),[2,a];case 3:throw s=c.sent(),null==t||t.error(e,"".concat(i," failed: "),s),s;case 4:return[2]}}))}))}}},t.debounce=function(e,t){var r=null;return function(){for(var n=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];r&&(clearTimeout(r),r=null),r=setTimeout((function(){e.apply(n,i)}),t)}},t.frequencyControl=function(e,t){var r,n=[],i=0;return function(){for(var o=this,a=[],s=0;s<arguments.length;s++)a[s]=arguments[s];return new Promise((function(s,c){n.push({resolve:s,reject:c});var u=Date.now(),d=function(e,t){for(;n.length;){var r=n.shift(),i=r.resolve,o=r.reject;e?i(t):o(t)}},l=function(){i=u,n.length&&e.apply(o,a).then((function(e){d(!0,e)}),(function(e){d(!1,e)}))};u-i>t?l():(clearTimeout(r),r=setTimeout((function(){l()}),t))}))}},t.getBrowserInfo=k,t.getFileType=function(e){var t={img:/(png|gif|jpg)/i,pdf:/pdf$/i,word:/(doc|docx)$/i,excel:/(xls|xlsx)$/i,ppt:/(ppt|pptx)$/i,zip:/(zip|rar|7z)$/i,audio:/(mp3|wav|wmv)$/i,video:/(mp4|mkv|rmvb|wmv|avi|flv|mov)$/i};return Object.keys(t).find((function(r){return t[r].test(e)}))||""},t.getOperatingSystem=function(){try{var e=navigator.userAgent;return e.includes("Windows")?"Windows":e.includes("Mac OS")?"Mac OS":e.includes("Linux")?"Linux":e.includes("Android")?"Android":e.includes("iOS")?"iOS":"Unknown"}catch(e){return"Unknown"}},t.logDebug=_,t.parseFileSize=function(e,t){void 0===t&&(t=0);var r={0:"B",1:"KB",2:"MB",3:"GB",4:"TB"},n=function(e,t){return t>=Object.keys(r).length?"the file is too big":e<1024?"".concat(e).concat(r[t]):n(Math.round(e/1024),t+1)};return n(e,t)},t.request=f})),ye="@xkit-yx/im-flutter-kit",Me="0.0.1",Ie=ve.logDebug({level:"debug",version:Me,appName:ye}),Se=s((function(e,t){!function(e){var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==o?o:"undefined"!=typeof self?self:{};function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function n(e){var t={exports:{}};return e(t,t.exports),t.exports}var i,a,s=function(e){return e&&e.Math==Math&&e},c=s("object"==typeof globalThis&&globalThis)||s("object"==typeof window&&window)||s("object"==typeof self&&self)||s("object"==typeof t&&t)||function(){return this}()||Function("return this")(),u=function(e){try{return!!e()}catch(e){return!0}},d=!u((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),l=Function.prototype,p=l.apply,m=l.call,h="object"==typeof Reflect&&Reflect.apply||(d?m.bind(p):function(){return m.apply(p,arguments)}),f=Function.prototype,g=f.bind,v=f.call,y=d&&g.bind(v,v),M=d?function(e){return e&&y(e)}:function(e){return e&&function(){return v.apply(e,arguments)}},I=function(e){return"function"==typeof e},S=!u((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),T=Function.prototype.call,b=d?T.bind(T):function(){return T.apply(T,arguments)},C={}.propertyIsEnumerable,_=Object.getOwnPropertyDescriptor,E={f:_&&!C.call({1:2},1)?function(e){var t=_(this,e);return!!t&&t.enumerable}:C},w=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},R=M({}.toString),k=M("".slice),A=function(e){return k(R(e),8,-1)},N=Object,x=M("".split),O=u((function(){return!N("z").propertyIsEnumerable(0)}))?function(e){return"String"==A(e)?x(e,""):N(e)}:N,P=function(e){return null==e},L=TypeError,V=function(e){if(P(e))throw L("Can't call method on "+e);return e},U=function(e){return O(V(e))},D="object"==typeof document&&document.all,q=void 0===D&&void 0!==D?function(e){return"object"==typeof e?null!==e:I(e)||e===D}:function(e){return"object"==typeof e?null!==e:I(e)},B={},F=function(e){return I(e)?e:void 0},G=function(e,t){return arguments.length<2?F(B[e])||F(c[e]):B[e]&&B[e][t]||c[e]&&c[e][t]},j=M({}.isPrototypeOf),H=G("navigator","userAgent")||"",W=c.process,K=c.Deno,Y=W&&W.versions||K&&K.version,Q=Y&&Y.v8;Q&&(a=(i=Q.split("."))[0]>0&&i[0]<4?1:+(i[0]+i[1])),!a&&H&&(!(i=H.match(/Edge\/(\d+)/))||i[1]>=74)&&(i=H.match(/Chrome\/(\d+)/))&&(a=+i[1]);var J=a,z=!!Object.getOwnPropertySymbols&&!u((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&J&&J<41})),X=z&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,$=Object,Z=X?function(e){return"symbol"==typeof e}:function(e){var t=G("Symbol");return I(t)&&j(t.prototype,$(e))},ee=String,te=function(e){try{return ee(e)}catch(e){return"Object"}},re=TypeError,ne=function(e){if(I(e))return e;throw re(te(e)+" is not a function")},ie=function(e,t){var r=e[t];return P(r)?void 0:ne(r)},oe=TypeError,ae=Object.defineProperty,se="__core-js_shared__",ce=c[se]||function(e,t){try{ae(c,e,{value:t,configurable:!0,writable:!0})}catch(r){c[e]=t}return t}(se,{}),ue=n((function(e){(e.exports=function(e,t){return ce[e]||(ce[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.25.0",mode:"pure",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.0/LICENSE",source:"https://github.com/zloirock/core-js"})})),de=Object,le=function(e){return de(V(e))},pe=M({}.hasOwnProperty),me=Object.hasOwn||function(e,t){return pe(le(e),t)},he=0,fe=Math.random(),ge=M(1..toString),ve=function(e){return"Symbol("+(void 0===e?"":e)+")_"+ge(++he+fe,36)},ye=ue("wks"),Me=c.Symbol,Ie=Me&&Me.for,Se=X?Me:Me&&Me.withoutSetter||ve,Te=function(e){if(!me(ye,e)||!z&&"string"!=typeof ye[e]){var t="Symbol."+e;z&&me(Me,e)?ye[e]=Me[e]:ye[e]=X&&Ie?Ie(t):Se(t)}return ye[e]},be=TypeError,Ce=Te("toPrimitive"),_e=function(e,t){if(!q(e)||Z(e))return e;var r,n=ie(e,Ce);if(n){if(void 0===t&&(t="default"),r=b(n,e,t),!q(r)||Z(r))return r;throw be("Can't convert object to primitive value")}return void 0===t&&(t="number"),function(e,t){var r,n;if("string"===t&&I(r=e.toString)&&!q(n=b(r,e)))return n;if(I(r=e.valueOf)&&!q(n=b(r,e)))return n;if("string"!==t&&I(r=e.toString)&&!q(n=b(r,e)))return n;throw oe("Can't convert object to primitive value")}(e,t)},Ee=function(e){var t=_e(e,"string");return Z(t)?t:t+""},we=c.document,Re=q(we)&&q(we.createElement),ke=function(e){return Re?we.createElement(e):{}},Ae=!S&&!u((function(){return 7!=Object.defineProperty(ke("div"),"a",{get:function(){return 7}}).a})),Ne=Object.getOwnPropertyDescriptor,xe={f:S?Ne:function(e,t){if(e=U(e),t=Ee(t),Ae)try{return Ne(e,t)}catch(e){}if(me(e,t))return w(!b(E.f,e,t),e[t])}},Oe=/#|\.prototype\./,Pe=function(e,t){var r=Ve[Le(e)];return r==De||r!=Ue&&(I(t)?u(t):!!t)},Le=Pe.normalize=function(e){return String(e).replace(Oe,".").toLowerCase()},Ve=Pe.data={},Ue=Pe.NATIVE="N",De=Pe.POLYFILL="P",qe=Pe,Be=M(M.bind),Fe=function(e,t){return ne(e),void 0===t?e:d?Be(e,t):function(){return e.apply(t,arguments)}},Ge=S&&u((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),je=String,He=TypeError,We=function(e){if(q(e))return e;throw He(je(e)+" is not an object")},Ke=TypeError,Ye=Object.defineProperty,Qe=Object.getOwnPropertyDescriptor,Je="enumerable",ze="configurable",Xe="writable",$e={f:S?Ge?function(e,t,r){if(We(e),t=Ee(t),We(r),"function"==typeof e&&"prototype"===t&&"value"in r&&Xe in r&&!r.writable){var n=Qe(e,t);n&&n.writable&&(e[t]=r.value,r={configurable:ze in r?r.configurable:n.configurable,enumerable:Je in r?r.enumerable:n.enumerable,writable:!1})}return Ye(e,t,r)}:Ye:function(e,t,r){if(We(e),t=Ee(t),We(r),Ae)try{return Ye(e,t,r)}catch(e){}if("get"in r||"set"in r)throw Ke("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},Ze=S?function(e,t,r){return $e.f(e,t,w(1,r))}:function(e,t,r){return e[t]=r,e},et=xe.f,rt=function(e){var t=function(r,n,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,n)}return new e(r,n,i)}return h(e,this,arguments)};return t.prototype=e.prototype,t},nt=function(e,t){var r,n,i,o,a,s,u,d,l=e.target,p=e.global,m=e.stat,h=e.proto,f=p?c:m?c[l]:(c[l]||{}).prototype,g=p?B:B[l]||Ze(B,l,{})[l],v=g.prototype;for(i in t)r=!qe(p?i:l+(m?".":"#")+i,e.forced)&&f&&me(f,i),a=g[i],r&&(s=e.dontCallGetSet?(d=et(f,i))&&d.value:f[i]),o=r&&s?s:t[i],r&&typeof a==typeof o||(u=e.bind&&r?Fe(o,c):e.wrap&&r?rt(o):h&&I(o)?M(o):o,(e.sham||o&&o.sham||a&&a.sham)&&Ze(u,"sham",!0),Ze(g,i,u),h&&(me(B,n=l+"Prototype")||Ze(B,n,{}),Ze(B[n],i,o),e.real&&v&&!v[i]&&Ze(v,i,o)))},it=$e.f;nt({target:"Object",stat:!0,forced:Object.defineProperty!==it,sham:!S},{defineProperty:it});var ot,at=n((function(e){var t=B.Object,r=e.exports=function(e,r,n){return t.defineProperty(e,r,n)};t.defineProperty.sham&&(r.sham=!0)})),st=at,ct=r(n((function(e){function t(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),st(e,n.key,n)}}e.exports=function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),st(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports}))),ut=r(n((function(e){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports}))),dt=Math.ceil,lt=Math.floor,pt=Math.trunc||function(e){var t=+e;return(t>0?lt:dt)(t)},mt=function(e){var t=+e;return t!=t||0===t?0:pt(t)},ht=Math.max,ft=Math.min,gt=function(e,t){var r=mt(e);return r<0?ht(r+t,0):ft(r,t)},vt=Math.min,yt=function(e){return e>0?vt(mt(e),9007199254740991):0},Mt=function(e){return yt(e.length)},It=function(e){return function(t,r,n){var i,o=U(t),a=Mt(o),s=gt(n,a);if(e&&r!=r){for(;a>s;)if((i=o[s++])!=i)return!0}else for(;a>s;s++)if((e||s in o)&&o[s]===r)return e||s||0;return!e&&-1}},St={includes:It(!0),indexOf:It(!1)},Tt={},bt=St.indexOf,Ct=M([].push),_t=function(e,t){var r,n=U(e),i=0,o=[];for(r in n)!me(Tt,r)&&me(n,r)&&Ct(o,r);for(;t.length>i;)me(n,r=t[i++])&&(~bt(o,r)||Ct(o,r));return o},Et=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],wt=Object.keys||function(e){return _t(e,Et)},Rt=S&&!Ge?Object.defineProperties:function(e,t){We(e);for(var r,n=U(t),i=wt(t),o=i.length,a=0;o>a;)$e.f(e,r=i[a++],n[r]);return e},kt={f:Rt},At=G("document","documentElement"),Nt=ue("keys"),xt=function(e){return Nt[e]||(Nt[e]=ve(e))},Ot=xt("IE_PROTO"),Pt=function(){},Lt=function(e){return"<script>"+e+"<\/script>"},Vt=function(e){e.write(Lt("")),e.close();var t=e.parentWindow.Object;return e=null,t},Ut=function(){try{ot=new ActiveXObject("htmlfile")}catch(e){}var e,t;Ut="undefined"!=typeof document?document.domain&&ot?Vt(ot):((t=ke("iframe")).style.display="none",At.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(Lt("document.F=Object")),e.close(),e.F):Vt(ot);for(var r=Et.length;r--;)delete Ut.prototype[Et[r]];return Ut()};Tt[Ot]=!0;var Dt=Object.create||function(e,t){var r;return null!==e?(Pt.prototype=We(e),r=new Pt,Pt.prototype=null,r[Ot]=e):r=Ut(),void 0===t?r:kt.f(r,t)};nt({target:"Object",stat:!0,sham:!S},{create:Dt});var qt=B.Object,Bt=function(e,t){return qt.create(e,t)},Ft=String,Gt=TypeError,jt=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=M(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),t=r instanceof Array}catch(e){}return function(r,n){return We(r),function(e){if("object"==typeof e||I(e))return e;throw Gt("Can't set "+Ft(e)+" as a prototype")}(n),t?e(r,n):r.__proto__=n,r}}():void 0);nt({target:"Object",stat:!0},{setPrototypeOf:jt});var Ht=B.Object.setPrototypeOf,Wt=M([].slice),Kt=Function,Yt=M([].concat),Qt=M([].join),Jt={},zt=function(e,t,r){if(!me(Jt,t)){for(var n=[],i=0;i<t;i++)n[i]="a["+i+"]";Jt[t]=Kt("C,a","return new C("+Qt(n,",")+")")}return Jt[t](e,r)},Xt=d?Kt.bind:function(e){var t=ne(this),r=t.prototype,n=Wt(arguments,1),i=function(){var r=Yt(n,Wt(arguments));return this instanceof i?zt(t,r.length,r):t.apply(e,r)};return q(r)&&(i.prototype=r),i};nt({target:"Function",proto:!0,forced:Function.bind!==Xt},{bind:Xt});var $t=function(e){return B[e+"Prototype"]},Zt=$t("Function").bind,er=Function.prototype,tr=function(e){var t=e.bind;return e===er||j(er,e)&&t===er.bind?Zt:t},rr=n((function(e){function t(r,n){var i;return e.exports=t=Ht?tr(i=Ht).call(i):function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r,n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})),nr=r(n((function(e){e.exports=function(e,t){e.prototype=Bt(t.prototype),e.prototype.constructor=e,rr(e,t)},e.exports.__esModule=!0,e.exports.default=e.exports})));nt({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{MAX_SAFE_INTEGER:9007199254740991});var ir=9007199254740991,or={f:Object.getOwnPropertySymbols},ar=Object.assign,sr=Object.defineProperty,cr=M([].concat),ur=!ar||u((function(){if(S&&1!==ar({b:1},ar(sr({},"a",{enumerable:!0,get:function(){sr(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach((function(e){t[e]=e})),7!=ar({},e)[r]||wt(ar({},t)).join("")!=n}))?function(e,t){for(var r=le(e),n=arguments.length,i=1,o=or.f,a=E.f;n>i;)for(var s,c=O(arguments[i++]),u=o?cr(wt(c),o(c)):wt(c),d=u.length,l=0;d>l;)s=u[l++],S&&!b(a,c,s)||(r[s]=c[s]);return r}:ar;nt({target:"Object",stat:!0,arity:2,forced:Object.assign!==ur},{assign:ur});var dr=B.Object.assign,lr=u((function(){wt(1)}));nt({target:"Object",stat:!0,forced:lr},{keys:function(e){return wt(le(e))}});var pr,mr,hr,fr=B.Object.keys,gr={},vr=c.WeakMap,yr=I(vr)&&/native code/.test(String(vr)),Mr="Object already initialized",Ir=c.TypeError,Sr=c.WeakMap;if(yr||ce.state){var Tr=ce.state||(ce.state=new Sr),br=M(Tr.get),Cr=M(Tr.has),_r=M(Tr.set);pr=function(e,t){if(Cr(Tr,e))throw Ir(Mr);return t.facade=e,_r(Tr,e,t),t},mr=function(e){return br(Tr,e)||{}},hr=function(e){return Cr(Tr,e)}}else{var Er=xt("state");Tt[Er]=!0,pr=function(e,t){if(me(e,Er))throw Ir(Mr);return t.facade=e,Ze(e,Er,t),t},mr=function(e){return me(e,Er)?e[Er]:{}},hr=function(e){return me(e,Er)}}var wr,Rr,kr,Ar={set:pr,get:mr,has:hr,enforce:function(e){return hr(e)?mr(e):pr(e,{})},getterFor:function(e){return function(t){var r;if(!q(t)||(r=mr(t)).type!==e)throw Ir("Incompatible receiver, "+e+" required");return r}}},Nr=Function.prototype,xr=S&&Object.getOwnPropertyDescriptor,Or=me(Nr,"name"),Pr={EXISTS:Or,PROPER:Or&&"something"===function(){}.name,CONFIGURABLE:Or&&(!S||S&&xr(Nr,"name").configurable)},Lr=!u((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),Vr=xt("IE_PROTO"),Ur=Object,Dr=Ur.prototype,qr=Lr?Ur.getPrototypeOf:function(e){var t=le(e);if(me(t,Vr))return t[Vr];var r=t.constructor;return I(r)&&t instanceof r?r.prototype:t instanceof Ur?Dr:null},Br=function(e,t,r,n){return n&&n.enumerable?e[t]=r:Ze(e,t,r),e},Fr=Te("iterator"),Gr=!1;[].keys&&("next"in(kr=[].keys())?(Rr=qr(qr(kr)))!==Object.prototype&&(wr=Rr):Gr=!0);var jr=!q(wr)||u((function(){var e={};return wr[Fr].call(e)!==e}));wr=jr?{}:Dt(wr),I(wr[Fr])||Br(wr,Fr,(function(){return this}));var Hr={IteratorPrototype:wr,BUGGY_SAFARI_ITERATORS:Gr},Wr={};Wr[Te("toStringTag")]="z";var Kr="[object z]"===String(Wr),Yr=Te("toStringTag"),Qr=Object,Jr="Arguments"==A(function(){return arguments}()),zr=Kr?A:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Qr(e),Yr))?r:Jr?A(t):"Object"==(n=A(t))&&I(t.callee)?"Arguments":n},Xr=Kr?{}.toString:function(){return"[object "+zr(this)+"]"},$r=$e.f,Zr=Te("toStringTag"),en=function(e,t,r,n){if(e){var i=r?e:e.prototype;me(i,Zr)||$r(i,Zr,{configurable:!0,value:t}),n&&!Kr&&Ze(i,"toString",Xr)}},tn=Hr.IteratorPrototype,rn=function(){return this},nn=Pr.PROPER,on=Hr.BUGGY_SAFARI_ITERATORS,an=Te("iterator"),sn="keys",cn="values",un="entries",dn=function(){return this},ln=function(e,t,r,n,i,o,a){!function(e,t,r,n){var i=t+" Iterator";e.prototype=Dt(tn,{next:w(+!n,r)}),en(e,i,!1,!0),gr[i]=rn}(r,t,n);var s,c,u,d=function(e){if(e===i&&f)return f;if(!on&&e in m)return m[e];switch(e){case sn:case cn:case un:return function(){return new r(this,e)}}return function(){return new r(this)}},l=t+" Iterator",p=!1,m=e.prototype,h=m[an]||m["@@iterator"]||i&&m[i],f=!on&&h||d(i),g="Array"==t&&m.entries||h;if(g&&(s=qr(g.call(new e)))!==Object.prototype&&s.next&&(en(s,l,!0,!0),gr[l]=dn),nn&&i==cn&&h&&h.name!==cn&&(p=!0,f=function(){return b(h,this)}),i)if(c={values:d(cn),keys:o?f:d(sn),entries:d(un)},a)for(u in c)(on||p||!(u in m))&&Br(m,u,c[u]);else nt({target:t,proto:!0,forced:on||p},c);return a&&m[an]!==f&&Br(m,an,f,{name:i}),gr[t]=f,c};$e.f;var pn="Array Iterator",mn=Ar.set,hn=Ar.getterFor(pn);ln(Array,"Array",(function(e,t){mn(this,{type:pn,target:U(e),index:0,kind:t})}),(function(){var e=hn(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:n,done:!1}:"values"==r?{value:t[n],done:!1}:{value:[n,t[n]],done:!1}}),"values"),gr.Arguments=gr.Array;var fn=Te("toStringTag");for(var gn in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var vn=c[gn],yn=vn&&vn.prototype;yn&&zr(yn)!==fn&&Ze(yn,fn,gn),gr[gn]=gr.Array}var Mn=Array.isArray||function(e){return"Array"==A(e)},In=M(Function.toString);I(ce.inspectSource)||(ce.inspectSource=function(e){return In(e)});var Sn=ce.inspectSource,Tn=function(){},bn=[],Cn=G("Reflect","construct"),_n=/^\s*(?:class|function)\b/,En=M(_n.exec),wn=!_n.exec(Tn),Rn=function(e){if(!I(e))return!1;try{return Cn(Tn,bn,e),!0}catch(e){return!1}},kn=function(e){if(!I(e))return!1;switch(zr(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return wn||!!En(_n,Sn(e))}catch(e){return!0}};kn.sham=!0;var An=!Cn||u((function(){var e;return Rn(Rn.call)||!Rn(Object)||!Rn((function(){e=!0}))||e}))?kn:Rn,Nn=Te("species"),xn=Array,On=function(e,t){return new(function(e){var t;return Mn(e)&&(t=e.constructor,(An(t)&&(t===xn||Mn(t.prototype))||q(t)&&null===(t=t[Nn]))&&(t=void 0)),void 0===t?xn:t}(e))(0===t?0:t)},Pn=M([].push),Ln=function(e){var t=1==e,r=2==e,n=3==e,i=4==e,o=6==e,a=7==e,s=5==e||o;return function(c,u,d,l){for(var p,m,h=le(c),f=O(h),g=Fe(u,d),v=Mt(f),y=0,M=l||On,I=t?M(c,v):r||a?M(c,0):void 0;v>y;y++)if((s||y in f)&&(m=g(p=f[y],y,h),e))if(t)I[y]=m;else if(m)switch(e){case 3:return!0;case 5:return p;case 6:return y;case 2:Pn(I,p)}else switch(e){case 4:return!1;case 7:Pn(I,p)}return o?-1:n||i?i:I}},Vn={forEach:Ln(0),map:Ln(1),filter:Ln(2),some:Ln(3),every:Ln(4),find:Ln(5),findIndex:Ln(6),filterReject:Ln(7)},Un=function(e,t){var r=[][e];return!!r&&u((function(){r.call(null,t||function(){return 1},1)}))},Dn=Vn.forEach,qn=Un("forEach")?[].forEach:function(e){return Dn(this,e,arguments.length>1?arguments[1]:void 0)};nt({target:"Array",proto:!0,forced:[].forEach!=qn},{forEach:qn});var Bn=$t("Array").forEach,Fn=Array.prototype,Gn={DOMTokenList:!0,NodeList:!0},jn=function(e){var t=e.forEach;return e===Fn||j(Fn,e)&&t===Fn.forEach||me(Gn,zr(e))?Bn:t},Hn=Vn.findIndex,Wn=!0;"findIndex"in[]&&Array(1).findIndex((function(){Wn=!1})),nt({target:"Array",proto:!0,forced:Wn},{findIndex:function(e){return Hn(this,e,arguments.length>1?arguments[1]:void 0)}});var Kn=$t("Array").findIndex,Yn=Array.prototype,Qn=function(e){var t=e.findIndex;return e===Yn||j(Yn,e)&&t===Yn.findIndex?Kn:t},Jn=TypeError,zn=Object.getOwnPropertyDescriptor,Xn=S&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}()?function(e,t){if(Mn(e)&&!zn(e,"length").writable)throw Jn("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t},$n=TypeError,Zn=function(e){if(e>9007199254740991)throw $n("Maximum allowed index exceeded");return e},ei=function(e,t,r){var n=Ee(t);n in e?$e.f(e,n,w(0,r)):e[n]=r},ti=TypeError,ri=function(e,t){if(!delete e[t])throw ti("Cannot delete property "+te(t)+" of "+te(e))},ni=Te("species"),ii=function(e){return J>=51||!u((function(){var t=[];return(t.constructor={})[ni]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},oi=ii("splice"),ai=Math.max,si=Math.min;nt({target:"Array",proto:!0,forced:!oi},{splice:function(e,t){var r,n,i,o,a,s,c=le(this),u=Mt(c),d=gt(e,u),l=arguments.length;for(0===l?r=n=0:1===l?(r=0,n=u-d):(r=l-2,n=si(ai(mt(t),0),u-d)),Zn(u+r-n),i=On(c,n),o=0;o<n;o++)(a=d+o)in c&&ei(i,o,c[a]);if(i.length=n,r<n){for(o=d;o<u-n;o++)s=o+r,(a=o+n)in c?c[s]=c[a]:ri(c,s);for(o=u;o>u-n+r;o--)ri(c,o-1)}else if(r>n)for(o=u-n;o>d;o--)s=o+r-1,(a=o+n-1)in c?c[s]=c[a]:ri(c,s);for(o=0;o<r;o++)c[o+d]=arguments[o+2];return Xn(c,u-n+r),i}});var ci=$t("Array").splice,ui=Array.prototype,di=function(e){var t=e.splice;return e===ui||j(ui,e)&&t===ui.splice?ci:t},li=G("JSON","stringify"),pi=M(/./.exec),mi=M("".charAt),hi=M("".charCodeAt),fi=M("".replace),gi=M(1..toString),vi=/[\uD800-\uDFFF]/g,yi=/^[\uD800-\uDBFF]$/,Mi=/^[\uDC00-\uDFFF]$/,Ii=!z||u((function(){var e=G("Symbol")();return"[null]"!=li([e])||"{}"!=li({a:e})||"{}"!=li(Object(e))})),Si=u((function(){return'"\\udf06\\ud834"'!==li("\udf06\ud834")||'"\\udead"'!==li("\udead")})),Ti=function(e,t){var r=Wt(arguments),n=t;if((q(t)||void 0!==e)&&!Z(e))return Mn(t)||(t=function(e,t){if(I(n)&&(t=b(n,this,e,t)),!Z(t))return t}),r[1]=t,h(li,null,r)},bi=function(e,t,r){var n=mi(r,t-1),i=mi(r,t+1);return pi(yi,e)&&!pi(Mi,i)||pi(Mi,e)&&!pi(yi,n)?"\\u"+gi(hi(e,0),16):e};li&&nt({target:"JSON",stat:!0,arity:3,forced:Ii||Si},{stringify:function(e,t,r){var n=Wt(arguments),i=h(Ii?Ti:li,null,n);return Si&&"string"==typeof i?fi(i,vi,bi):i}}),B.JSON||(B.JSON={stringify:JSON.stringify});var Ci=function(e,t,r){return h(B.JSON.stringify,null,arguments)},_i=Ci;nt({target:"Array",stat:!0},{isArray:Mn});var Ei=B.Array.isArray,wi=Et.concat("length","prototype"),Ri={f:Object.getOwnPropertyNames||function(e){return _t(e,wi)}},ki=M([].concat),Ai=G("Reflect","ownKeys")||function(e){var t=Ri.f(We(e)),r=or.f;return r?ki(t,r(e)):t},Ni=Error,xi=M("".replace),Oi=String(Ni("zxcasd").stack),Pi=/\n\s*at [^:]*:[^\n]*/,Li=Pi.test(Oi),Vi=function(e,t){if(Li&&"string"==typeof e&&!Ni.prepareStackTrace)for(;t--;)e=xi(e,Pi,"");return e},Ui=function(e,t){q(t)&&"cause"in t&&Ze(e,"cause",t.cause)},Di=Te("iterator"),qi=Array.prototype,Bi=function(e){return void 0!==e&&(gr.Array===e||qi[Di]===e)},Fi=Te("iterator"),Gi=function(e){if(!P(e))return ie(e,Fi)||ie(e,"@@iterator")||gr[zr(e)]},ji=TypeError,Hi=function(e,t){var r=arguments.length<2?Gi(e):t;if(ne(r))return We(b(r,e));throw ji(te(e)+" is not iterable")},Wi=function(e,t,r){var n,i;We(e);try{if(!(n=ie(e,"return"))){if("throw"===t)throw r;return r}n=b(n,e)}catch(e){i=!0,n=e}if("throw"===t)throw r;if(i)throw n;return We(n),r},Ki=TypeError,Yi=function(e,t){this.stopped=e,this.result=t},Qi=Yi.prototype,Ji=function(e,t,r){var n,i,o,a,s,c,u,d=r&&r.that,l=!(!r||!r.AS_ENTRIES),p=!(!r||!r.IS_RECORD),m=!(!r||!r.IS_ITERATOR),h=!(!r||!r.INTERRUPTED),f=Fe(t,d),g=function(e){return n&&Wi(n,"normal",e),new Yi(!0,e)},v=function(e){return l?(We(e),h?f(e[0],e[1],g):f(e[0],e[1])):h?f(e,g):f(e)};if(p)n=e.iterator;else if(m)n=e;else{if(!(i=Gi(e)))throw Ki(te(e)+" is not iterable");if(Bi(i)){for(o=0,a=Mt(e);a>o;o++)if((s=v(e[o]))&&j(Qi,s))return s;return new Yi(!1)}n=Hi(e,i)}for(c=p?e.next:n.next;!(u=b(c,n)).done;){try{s=v(u.value)}catch(e){Wi(n,"throw",e)}if("object"==typeof s&&s&&j(Qi,s))return s}return new Yi(!1)},zi=String,Xi=function(e){if("Symbol"===zr(e))throw TypeError("Cannot convert a Symbol value to a string");return zi(e)},$i=function(e,t){return void 0===e?arguments.length<2?"":t:Xi(e)},Zi=!u((function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",w(1,7)),7!==e.stack)})),eo=Te("toStringTag"),to=Error,ro=[].push,no=function(e,t){var r,n=arguments.length>2?arguments[2]:void 0,i=j(io,this);jt?r=jt(to(),i?qr(this):io):(r=i?this:Dt(io),Ze(r,eo,"Error")),void 0!==t&&Ze(r,"message",$i(t)),Zi&&Ze(r,"stack",Vi(r.stack,1)),Ui(r,n);var o=[];return Ji(e,ro,{that:o}),Ze(r,"errors",o),r};jt?jt(no,to):function(e,t,r){for(var n=Ai(t),i=$e.f,o=xe.f,a=0;a<n.length;a++){var s=n[a];me(e,s)||r&&me(r,s)||i(e,s,o(t,s))}}(no,to,{name:!0});var io=no.prototype=Dt(to.prototype,{constructor:w(1,no),message:w(1,""),name:w(1,"AggregateError")});nt({global:!0,constructor:!0,arity:2},{AggregateError:no});var oo,ao,so,co,uo="process"==A(c.process),lo=Te("species"),po=function(e){var t=G(e),r=$e.f;S&&t&&!t[lo]&&r(t,lo,{configurable:!0,get:function(){return this}})},mo=TypeError,ho=function(e,t){if(j(t,e))return e;throw mo("Incorrect invocation")},fo=TypeError,go=function(e){if(An(e))return e;throw fo(te(e)+" is not a constructor")},vo=Te("species"),yo=function(e,t){var r,n=We(e).constructor;return void 0===n||P(r=We(n)[vo])?t:go(r)},Mo=TypeError,Io=function(e,t){if(e<t)throw Mo("Not enough arguments");return e},So=/(?:ipad|iphone|ipod).*applewebkit/i.test(H),To=c.setImmediate,bo=c.clearImmediate,Co=c.process,_o=c.Dispatch,Eo=c.Function,wo=c.MessageChannel,Ro=c.String,ko=0,Ao={},No="onreadystatechange";try{oo=c.location}catch(e){}var xo=function(e){if(me(Ao,e)){var t=Ao[e];delete Ao[e],t()}},Oo=function(e){return function(){xo(e)}},Po=function(e){xo(e.data)},Lo=function(e){c.postMessage(Ro(e),oo.protocol+"//"+oo.host)};To&&bo||(To=function(e){Io(arguments.length,1);var t=I(e)?e:Eo(e),r=Wt(arguments,1);return Ao[++ko]=function(){h(t,void 0,r)},ao(ko),ko},bo=function(e){delete Ao[e]},uo?ao=function(e){Co.nextTick(Oo(e))}:_o&&_o.now?ao=function(e){_o.now(Oo(e))}:wo&&!So?(co=(so=new wo).port2,so.port1.onmessage=Po,ao=Fe(co.postMessage,co)):c.addEventListener&&I(c.postMessage)&&!c.importScripts&&oo&&"file:"!==oo.protocol&&!u(Lo)?(ao=Lo,c.addEventListener("message",Po,!1)):ao=No in ke("script")?function(e){At.appendChild(ke("script")).onreadystatechange=function(){At.removeChild(this),xo(e)}}:function(e){setTimeout(Oo(e),0)});var Vo,Uo,Do,qo,Bo,Fo,Go,jo,Ho={set:To,clear:bo},Wo=/ipad|iphone|ipod/i.test(H)&&void 0!==c.Pebble,Ko=/web0s(?!.*chrome)/i.test(H),Yo=xe.f,Qo=Ho.set,Jo=c.MutationObserver||c.WebKitMutationObserver,zo=c.document,Xo=c.process,$o=c.Promise,Zo=Yo(c,"queueMicrotask"),ea=Zo&&Zo.value;ea||(Vo=function(){var e,t;for(uo&&(e=Xo.domain)&&e.exit();Uo;){t=Uo.fn,Uo=Uo.next;try{t()}catch(e){throw Uo?qo():Do=void 0,e}}Do=void 0,e&&e.enter()},So||uo||Ko||!Jo||!zo?!Wo&&$o&&$o.resolve?((Go=$o.resolve(void 0)).constructor=$o,jo=Fe(Go.then,Go),qo=function(){jo(Vo)}):uo?qo=function(){Xo.nextTick(Vo)}:(Qo=Fe(Qo,c),qo=function(){Qo(Vo)}):(Bo=!0,Fo=zo.createTextNode(""),new Jo(Vo).observe(Fo,{characterData:!0}),qo=function(){Fo.data=Bo=!Bo}));var ta=ea||function(e){var t={fn:e,next:void 0};Do&&(Do.next=t),Uo||(Uo=t,qo()),Do=t},ra=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},na=function(){this.head=null,this.tail=null};na.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}};var ia,oa,aa=na,sa=c.Promise,ca="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,ua=!ca&&!uo&&"object"==typeof window&&"object"==typeof document,da=sa&&sa.prototype,la=Te("species"),pa=!1,ma=I(c.PromiseRejectionEvent),ha=qe("Promise",(function(){var e=Sn(sa),t=e!==String(sa);if(!t&&66===J)return!0;if(!da.catch||!da.finally)return!0;if(!J||J<51||!/native code/.test(e)){var r=new sa((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};if((r.constructor={})[la]=n,!(pa=r.then((function(){}))instanceof n))return!0}return!t&&(ua||ca)&&!ma})),fa={CONSTRUCTOR:ha,REJECTION_EVENT:ma,SUBCLASSING:pa},ga=TypeError,va=function(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw ga("Bad Promise constructor");t=e,r=n})),this.resolve=ne(t),this.reject=ne(r)},ya={f:function(e){return new va(e)}},Ma=Ho.set,Ia="Promise",Sa=fa.CONSTRUCTOR,Ta=fa.REJECTION_EVENT,ba=Ar.getterFor(Ia),Ca=Ar.set,_a=sa&&sa.prototype,Ea=sa,wa=_a,Ra=c.TypeError,ka=c.document,Aa=c.process,Na=ya.f,xa=Na,Oa=!!(ka&&ka.createEvent&&c.dispatchEvent),Pa="unhandledrejection",La=function(e){var t;return!(!q(e)||!I(t=e.then))&&t},Va=function(e,t){var r,n,i,o=t.value,a=1==t.state,s=a?e.ok:e.fail,c=e.resolve,u=e.reject,d=e.domain;try{s?(a||(2===t.rejection&&Fa(t),t.rejection=1),!0===s?r=o:(d&&d.enter(),r=s(o),d&&(d.exit(),i=!0)),r===e.promise?u(Ra("Promise-chain cycle")):(n=La(r))?b(n,r,c,u):c(r)):u(o)}catch(e){d&&!i&&d.exit(),u(e)}},Ua=function(e,t){e.notified||(e.notified=!0,ta((function(){for(var r,n=e.reactions;r=n.get();)Va(r,e);e.notified=!1,t&&!e.rejection&&qa(e)})))},Da=function(e,t,r){var n,i;Oa?((n=ka.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),c.dispatchEvent(n)):n={promise:t,reason:r},!Ta&&(i=c["on"+e])?i(n):e===Pa&&function(e,t){var r=c.console;r&&r.error&&(1==arguments.length?r.error(e):r.error(e,t))}("Unhandled promise rejection",r)},qa=function(e){b(Ma,c,(function(){var t,r=e.facade,n=e.value;if(Ba(e)&&(t=ra((function(){uo?Aa.emit("unhandledRejection",n,r):Da(Pa,r,n)})),e.rejection=uo||Ba(e)?2:1,t.error))throw t.value}))},Ba=function(e){return 1!==e.rejection&&!e.parent},Fa=function(e){b(Ma,c,(function(){var t=e.facade;uo?Aa.emit("rejectionHandled",t):Da("rejectionhandled",t,e.value)}))},Ga=function(e,t,r){return function(n){e(t,n,r)}},ja=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,Ua(e,!0))},Ha=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw Ra("Promise can't be resolved itself");var n=La(t);n?ta((function(){var r={done:!1};try{b(n,t,Ga(Ha,r,e),Ga(ja,r,e))}catch(t){ja(r,t,e)}})):(e.value=t,e.state=1,Ua(e,!1))}catch(t){ja({done:!1},t,e)}}};Sa&&(wa=(Ea=function(e){ho(this,wa),ne(e),b(ia,this);var t=ba(this);try{e(Ga(Ha,t),Ga(ja,t))}catch(e){ja(t,e)}}).prototype,(ia=function(e){Ca(this,{type:Ia,done:!1,notified:!1,parent:!1,reactions:new aa,rejection:!1,state:0,value:void 0})}).prototype=Br(wa,"then",(function(e,t){var r=ba(this),n=Na(yo(this,Ea));return r.parent=!0,n.ok=!I(e)||e,n.fail=I(t)&&t,n.domain=uo?Aa.domain:void 0,0==r.state?r.reactions.add(n):ta((function(){Va(n,r)})),n.promise})),oa=function(){var e=new ia,t=ba(e);this.promise=e,this.resolve=Ga(Ha,t),this.reject=Ga(ja,t)},ya.f=Na=function(e){return e===Ea||void 0===e?new oa(e):xa(e)}),nt({global:!0,constructor:!0,wrap:!0,forced:Sa},{Promise:Ea}),en(Ea,Ia,!1,!0),po(Ia);var Wa=Te("iterator"),Ka=!1;try{var Ya=0,Qa={next:function(){return{done:!!Ya++}},return:function(){Ka=!0}};Qa[Wa]=function(){return this},Array.from(Qa,(function(){throw 2}))}catch(e){}var Ja=function(e,t){if(!t&&!Ka)return!1;var r=!1;try{var n={};n[Wa]=function(){return{next:function(){return{done:r=!0}}}},e(n)}catch(e){}return r},za=fa.CONSTRUCTOR||!Ja((function(e){sa.all(e).then(void 0,(function(){}))}));nt({target:"Promise",stat:!0,forced:za},{all:function(e){var t=this,r=ya.f(t),n=r.resolve,i=r.reject,o=ra((function(){var r=ne(t.resolve),o=[],a=0,s=1;Ji(e,(function(e){var c=a++,u=!1;s++,b(r,t,e).then((function(e){u||(u=!0,o[c]=e,--s||n(o))}),i)})),--s||n(o)}));return o.error&&i(o.value),r.promise}});var Xa=fa.CONSTRUCTOR;sa&&sa.prototype,nt({target:"Promise",proto:!0,forced:Xa,real:!0},{catch:function(e){return this.then(void 0,e)}}),nt({target:"Promise",stat:!0,forced:za},{race:function(e){var t=this,r=ya.f(t),n=r.reject,i=ra((function(){var i=ne(t.resolve);Ji(e,(function(e){b(i,t,e).then(r.resolve,n)}))}));return i.error&&n(i.value),r.promise}}),nt({target:"Promise",stat:!0,forced:fa.CONSTRUCTOR},{reject:function(e){var t=ya.f(this);return b(t.reject,void 0,e),t.promise}});var $a=function(e,t){if(We(e),q(t)&&t.constructor===e)return t;var r=ya.f(e);return(0,r.resolve)(t),r.promise},Za=fa.CONSTRUCTOR,es=G("Promise"),ts=!Za;nt({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return $a(ts&&this===es?sa:this,e)}}),nt({target:"Promise",stat:!0},{allSettled:function(e){var t=this,r=ya.f(t),n=r.resolve,i=r.reject,o=ra((function(){var r=ne(t.resolve),i=[],o=0,a=1;Ji(e,(function(e){var s=o++,c=!1;a++,b(r,t,e).then((function(e){c||(c=!0,i[s]={status:"fulfilled",value:e},--a||n(i))}),(function(e){c||(c=!0,i[s]={status:"rejected",reason:e},--a||n(i))}))})),--a||n(i)}));return o.error&&i(o.value),r.promise}});var rs="No one promise resolved";nt({target:"Promise",stat:!0},{any:function(e){var t=this,r=G("AggregateError"),n=ya.f(t),i=n.resolve,o=n.reject,a=ra((function(){var n=ne(t.resolve),a=[],s=0,c=1,u=!1;Ji(e,(function(e){var d=s++,l=!1;c++,b(n,t,e).then((function(e){l||u||(u=!0,i(e))}),(function(e){l||u||(l=!0,a[d]=e,--c||o(new r(a,rs)))}))})),--c||o(new r(a,rs))}));return a.error&&o(a.value),n.promise}});var ns=sa&&sa.prototype,is=!!sa&&u((function(){ns.finally.call({then:function(){}},(function(){}))}));nt({target:"Promise",proto:!0,real:!0,forced:is},{finally:function(e){var t=yo(this,G("Promise")),r=I(e);return this.then(r?function(r){return $a(t,e()).then((function(){return r}))}:e,r?function(r){return $a(t,e()).then((function(){throw r}))}:e)}});var os=M("".charAt),as=M("".charCodeAt),ss=M("".slice),cs=function(e){return function(t,r){var n,i,o=Xi(V(t)),a=mt(r),s=o.length;return a<0||a>=s?e?"":void 0:(n=as(o,a))<55296||n>56319||a+1===s||(i=as(o,a+1))<56320||i>57343?e?os(o,a):n:e?ss(o,a,a+2):i-56320+(n-55296<<10)+65536}},us={codeAt:cs(!1),charAt:cs(!0)},ds=us.charAt,ls="String Iterator",ps=Ar.set,ms=Ar.getterFor(ls);ln(String,"String",(function(e){ps(this,{type:ls,string:Xi(e),index:0})}),(function(){var e,t=ms(this),r=t.string,n=t.index;return n>=r.length?{value:void 0,done:!0}:(e=ds(r,n),t.index+=e.length,{value:e,done:!1})}));var hs=B.Promise;nt({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=ya.f(this),r=ra(e);return(r.error?t.reject:t.resolve)(r.value),t.promise}});var fs=hs,gs=E.f,vs=M(gs),ys=M([].push),Ms=function(e){return function(t){for(var r,n=U(t),i=wt(n),o=i.length,a=0,s=[];o>a;)r=i[a++],S&&!vs(n,r)||ys(s,e?[r,n[r]]:n[r]);return s}},Is={entries:Ms(!0),values:Ms(!1)},Ss=Is.values;nt({target:"Object",stat:!0},{values:function(e){return Ss(e)}});var Ts=B.Object.values,bs=Date,Cs=M(bs.prototype.getTime);nt({target:"Date",stat:!0},{now:function(){return Cs(new bs)}});var _s=B.Date.now,Es=Te("isConcatSpreadable"),ws=J>=51||!u((function(){var e=[];return e[Es]=!1,e.concat()[0]!==e})),Rs=ii("concat"),ks=function(e){if(!q(e))return!1;var t=e[Es];return void 0!==t?!!t:Mn(e)};nt({target:"Array",proto:!0,arity:1,forced:!ws||!Rs},{concat:function(e){var t,r,n,i,o,a=le(this),s=On(a,0),c=0;for(t=-1,n=arguments.length;t<n;t++)if(ks(o=-1===t?a:arguments[t]))for(i=Mt(o),Zn(c+i),r=0;r<i;r++,c++)r in o&&ei(s,c,o[r]);else Zn(c+1),ei(s,c++,o);return s.length=c,s}});var As=$t("Array").concat,Ns=Array.prototype,xs=function(e){var t=e.concat;return e===Ns||j(Ns,e)&&t===Ns.concat?As:t},Os=/MSIE .\./.test(H),Ps=c.Function,Ls=function(e){return Os?function(t,r){var n=Io(arguments.length,1)>2,i=I(t)?t:Ps(t),o=n?Wt(arguments,2):void 0;return e(n?function(){h(i,this,o)}:i,r)}:e},Vs={setTimeout:Ls(c.setTimeout),setInterval:Ls(c.setInterval)},Us=Vs.setInterval;nt({global:!0,bind:!0,forced:c.setInterval!==Us},{setInterval:Us});var Ds=Vs.setTimeout;nt({global:!0,bind:!0,forced:c.setTimeout!==Ds},{setTimeout:Ds});var qs=B.setTimeout,Bs=n((function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,n,o,a){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new i(n,o||e,a),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function s(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),s.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,o=n.length,a=new Array(o);i<o;i++)a[i]=n[i].fn;return a},s.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},s.prototype.emit=function(e,t,n,i,o,a){var s=r?r+e:e;if(!this._events[s])return!1;var c,u,d=this._events[s],l=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),l){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,n),!0;case 4:return d.fn.call(d.context,t,n,i),!0;case 5:return d.fn.call(d.context,t,n,i,o),!0;case 6:return d.fn.call(d.context,t,n,i,o,a),!0}for(u=1,c=new Array(l-1);u<l;u++)c[u-1]=arguments[u];d.fn.apply(d.context,c)}else{var p,m=d.length;for(u=0;u<m;u++)switch(d[u].once&&this.removeListener(e,d[u].fn,void 0,!0),l){case 1:d[u].fn.call(d[u].context);break;case 2:d[u].fn.call(d[u].context,t);break;case 3:d[u].fn.call(d[u].context,t,n);break;case 4:d[u].fn.call(d[u].context,t,n,i);break;default:if(!c)for(p=1,c=new Array(l-1);p<l;p++)c[p-1]=arguments[p];d[u].fn.apply(d[u].context,c)}}return!0},s.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},s.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},s.prototype.removeListener=function(e,t,n,i){var o=r?r+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||n&&s.context!==n||a(this,o);else{for(var c=0,u=[],d=s.length;c<d;c++)(s[c].fn!==t||i&&!s[c].once||n&&s[c].context!==n)&&u.push(s[c]);u.length?this._events[o]=1===u.length?u[0]:u:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&a(this,t)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s}));nt({global:!0},{globalThis:c});var Fs=c,Gs=Array,js=Math.max,Hs=function(e,t,r){for(var n=Mt(e),i=gt(t,n),o=gt(void 0===r?n:r,n),a=Gs(js(o-i,0)),s=0;i<o;i++,s++)ei(a,s,e[i]);return a.length=s,a},Ws=Ri.f,Ks="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Ys={f:function(e){return Ks&&"Window"==A(e)?function(e){try{return Ws(e)}catch(e){return Hs(Ks)}}(e):Ws(U(e))}},Qs={f:Te},Js=$e.f,zs=function(e){var t=B.Symbol||(B.Symbol={});me(t,e)||Js(t,e,{value:Qs.f(e)})},Xs=function(){var e=G("Symbol"),t=e&&e.prototype,r=t&&t.valueOf,n=Te("toPrimitive");t&&!t[n]&&Br(t,n,(function(e){return b(r,this)}),{arity:1})},$s=Vn.forEach,Zs=xt("hidden"),ec="Symbol",tc=Ar.set,rc=Ar.getterFor(ec),nc=Object.prototype,ic=c.Symbol,oc=ic&&ic.prototype,ac=c.TypeError,sc=c.QObject,cc=xe.f,uc=$e.f,dc=Ys.f,lc=E.f,pc=M([].push),mc=ue("symbols"),hc=ue("op-symbols"),fc=ue("wks"),gc=!sc||!sc.prototype||!sc.prototype.findChild,vc=S&&u((function(){return 7!=Dt(uc({},"a",{get:function(){return uc(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=cc(nc,t);n&&delete nc[t],uc(e,t,r),n&&e!==nc&&uc(nc,t,n)}:uc,yc=function(e,t){var r=mc[e]=Dt(oc);return tc(r,{type:ec,tag:e,description:t}),S||(r.description=t),r},Mc=function(e,t,r){e===nc&&Mc(hc,t,r),We(e);var n=Ee(t);return We(r),me(mc,n)?(r.enumerable?(me(e,Zs)&&e[Zs][n]&&(e[Zs][n]=!1),r=Dt(r,{enumerable:w(0,!1)})):(me(e,Zs)||uc(e,Zs,w(1,{})),e[Zs][n]=!0),vc(e,n,r)):uc(e,n,r)},Ic=function(e,t){We(e);var r=U(t),n=wt(r).concat(Cc(r));return $s(n,(function(t){S&&!b(Sc,r,t)||Mc(e,t,r[t])})),e},Sc=function(e){var t=Ee(e),r=b(lc,this,t);return!(this===nc&&me(mc,t)&&!me(hc,t))&&(!(r||!me(this,t)||!me(mc,t)||me(this,Zs)&&this[Zs][t])||r)},Tc=function(e,t){var r=U(e),n=Ee(t);if(r!==nc||!me(mc,n)||me(hc,n)){var i=cc(r,n);return!i||!me(mc,n)||me(r,Zs)&&r[Zs][n]||(i.enumerable=!0),i}},bc=function(e){var t=dc(U(e)),r=[];return $s(t,(function(e){me(mc,e)||me(Tt,e)||pc(r,e)})),r},Cc=function(e){var t=e===nc,r=dc(t?hc:U(e)),n=[];return $s(r,(function(e){!me(mc,e)||t&&!me(nc,e)||pc(n,mc[e])})),n};z||(ic=function(){if(j(oc,this))throw ac("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?Xi(arguments[0]):void 0,t=ve(e),r=function(e){this===nc&&b(r,hc,e),me(this,Zs)&&me(this[Zs],t)&&(this[Zs][t]=!1),vc(this,t,w(1,e))};return S&&gc&&vc(nc,t,{configurable:!0,set:r}),yc(t,e)},oc=ic.prototype,Br(oc,"toString",(function(){return rc(this).tag})),Br(ic,"withoutSetter",(function(e){return yc(ve(e),e)})),E.f=Sc,$e.f=Mc,kt.f=Ic,xe.f=Tc,Ri.f=Ys.f=bc,or.f=Cc,Qs.f=function(e){return yc(Te(e),e)},S&&uc(oc,"description",{configurable:!0,get:function(){return rc(this).description}})),nt({global:!0,constructor:!0,wrap:!0,forced:!z,sham:!z},{Symbol:ic}),$s(wt(fc),(function(e){zs(e)})),nt({target:ec,stat:!0,forced:!z},{useSetter:function(){gc=!0},useSimple:function(){gc=!1}}),nt({target:"Object",stat:!0,forced:!z,sham:!S},{create:function(e,t){return void 0===t?Dt(e):Ic(Dt(e),t)},defineProperty:Mc,defineProperties:Ic,getOwnPropertyDescriptor:Tc}),nt({target:"Object",stat:!0,forced:!z},{getOwnPropertyNames:bc}),Xs(),en(ic,ec),Tt[Zs]=!0;var _c=z&&!!Symbol.for&&!!Symbol.keyFor,Ec=ue("string-to-symbol-registry"),wc=ue("symbol-to-string-registry");nt({target:"Symbol",stat:!0,forced:!_c},{for:function(e){var t=Xi(e);if(me(Ec,t))return Ec[t];var r=G("Symbol")(t);return Ec[t]=r,wc[r]=t,r}});var Rc=ue("symbol-to-string-registry");nt({target:"Symbol",stat:!0,forced:!_c},{keyFor:function(e){if(!Z(e))throw TypeError(te(e)+" is not a symbol");if(me(Rc,e))return Rc[e]}});var kc=!z||u((function(){or.f(1)}));nt({target:"Object",stat:!0,forced:kc},{getOwnPropertySymbols:function(e){var t=or.f;return t?t(le(e)):[]}}),zs("asyncIterator"),zs("hasInstance"),zs("isConcatSpreadable"),zs("iterator"),zs("match"),zs("matchAll"),zs("replace"),zs("search"),zs("species"),zs("split"),zs("toPrimitive"),Xs(),zs("toStringTag"),en(G("Symbol"),"Symbol"),zs("unscopables"),en(c.JSON,"JSON",!0);var Ac=B.Symbol;zs("asyncDispose"),zs("dispose"),zs("matcher"),zs("metadataKey"),zs("observable"),zs("metadata"),zs("patternMatch"),zs("replaceAll");var Nc=Ac,xc=u((function(){qr(1)}));nt({target:"Object",stat:!0,forced:xc,sham:!Lr},{getPrototypeOf:function(e){return qr(le(e))}});var Oc=B.Object.getPrototypeOf,Pc=M([].reverse),Lc=[1,2];nt({target:"Array",proto:!0,forced:String(Lc)===String(Lc.reverse())},{reverse:function(){return Mn(this)&&(this.length=this.length),Pc(this)}});var Vc=$t("Array").reverse,Uc=Array.prototype,Dc=function(e){var t=e.reverse;return e===Uc||j(Uc,e)&&t===Uc.reverse?Vc:t},qc=ii("slice"),Bc=Te("species"),Fc=Array,Gc=Math.max;nt({target:"Array",proto:!0,forced:!qc},{slice:function(e,t){var r,n,i,o=U(this),a=Mt(o),s=gt(e,a),c=gt(void 0===t?a:t,a);if(Mn(o)&&(r=o.constructor,(An(r)&&(r===Fc||Mn(r.prototype))||q(r)&&null===(r=r[Bc]))&&(r=void 0),r===Fc||void 0===r))return Wt(o,s,c);for(n=new(void 0===r?Fc:r)(Gc(c-s,0)),i=0;s<c;s++,i++)s in o&&ei(n,i,o[s]);return n.length=i,n}});var jc=$t("Array").slice,Hc=Array.prototype,Wc=function(e){var t=e.slice;return e===Hc||j(Hc,e)&&t===Hc.slice?jc:t},Kc=Qs.f("iterator"),Yc=St.includes,Qc=u((function(){return!Array(1).includes()}));nt({target:"Array",proto:!0,forced:Qc},{includes:function(e){return Yc(this,e,arguments.length>1?arguments[1]:void 0)}});var Jc=$t("Array").includes,zc=Te("match"),Xc=TypeError,$c=function(e){if(function(e){var t;return q(e)&&(void 0!==(t=e[zc])?!!t:"RegExp"==A(e))}(e))throw Xc("The method doesn't accept regular expressions");return e},Zc=Te("match"),eu=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[Zc]=!1,"/./"[e](t)}catch(e){}}return!1},tu=M("".indexOf);nt({target:"String",proto:!0,forced:!eu("includes")},{includes:function(e){return!!~tu(Xi(V(this)),Xi($c(e)),arguments.length>1?arguments[1]:void 0)}});var ru=$t("String").includes,nu=Array.prototype,iu=String.prototype,ou=function(e){var t=e.includes;return e===nu||j(nu,e)&&t===nu.includes?Jc:"string"==typeof e||e===iu||j(iu,e)&&t===iu.includes?ru:t},au=Vn.map,su=ii("map");nt({target:"Array",proto:!0,forced:!su},{map:function(e){return au(this,e,arguments.length>1?arguments[1]:void 0)}});var cu=$t("Array").map,uu=Array.prototype,du=function(e){var t=e.map;return e===uu||j(uu,e)&&t===uu.map?cu:t},lu=Vn.filter,pu=ii("filter");nt({target:"Array",proto:!0,forced:!pu},{filter:function(e){return lu(this,e,arguments.length>1?arguments[1]:void 0)}});var mu=$t("Array").filter,hu=Array.prototype,fu=function(e){var t=e.filter;return e===hu||j(hu,e)&&t===hu.filter?mu:t},gu=n((function(e,t){e.exports=function(){function e(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
e=function(){return t};var t={},r=Object.prototype,n=r.hasOwnProperty,i="function"==typeof Nc?Nc:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,r){return st(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(t){c=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var i=t&&t.prototype instanceof p?t:p,o=Bt(i.prototype),a=new b(n||[]);return o._invoke=function(e,t,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return _()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=I(a,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=d(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,a),o}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var l={};function p(){}function m(){}function h(){}var f={};c(f,o,(function(){return this}));var g=Oc&&Oc(Oc(C([])));g&&g!==r&&n.call(g,o)&&(f=g);var v=h.prototype=p.prototype=Bt(f);function y(e){var t;jn(t=["next","throw","return"]).call(t,(function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function M(e,t){function r(i,o,a,s){var c=d(e[i],e,o);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==typeof l&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}var i;this._invoke=function(e,n){function o(){return new t((function(t,i){r(e,n,t,i)}))}return i=i?i.then(o,o):o()}}function I(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,I(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=d(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function b(e){this.tryEntries=[{tryLoc:"root"}],jn(e).call(e,S,this),this.reset(!0)}function C(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:_}}function _(){return{value:void 0,done:!0}}return m.prototype=h,c(v,"constructor",h),c(h,"constructor",m),m.displayName=c(h,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Ht?Ht(e,h):(e.__proto__=h,c(e,s,"GeneratorFunction")),e.prototype=Bt(v),e},t.awrap=function(e){return{__await:e}},y(M.prototype),c(M.prototype,a,(function(){return this})),t.AsyncIterator=M,t.async=function(e,r,n,i,o){void 0===o&&(o=fs);var a=new M(u(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},y(v),c(v,s,"Generator"),c(v,o,(function(){return this})),c(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=[];for(var r in e)t.push(r);return Dc(t).call(t),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=C,b.prototype={constructor:b,reset:function(e){var t;if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,jn(t=this.tryEntries).call(t,T),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+Wc(r).call(r,1))&&(this[r]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;T(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:C(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function t(e){return t="function"==typeof Nc&&"symbol"==typeof Kc?function(e){return typeof e}:function(e){return e&&"function"==typeof Nc&&e.constructor===Nc&&e!==Nc.prototype?"symbol":typeof e},t(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),st(e,n.key,n)}}function i(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),st(e,"prototype",{writable:!1}),e}function o(e,t,r,n){function i(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=fs))((function(r,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):i(e.value).then(a,s)}c((n=n.apply(e,t||[])).next())}))}var a={isDataReportEnable:!0,maxSize:100,msgListMaxSize:1e3,cacheMaxSize:1e3,maxDelay:3e5,maxInterval:3e4,minInterval:1e4,timeout:5e3,autoStart:!0,loginFailIgnoreInterval:72e5},s=12,c=8e3,u=function(){},d=function(){function n(e){r(this,n),this.isUploadEnable=!0,this.serverAllowUpload=!1,this.initConfigLoaded=!1,this.loading=!1,this.isDestroyed=!1,this.reportConfig=a,this.configPath="dispatcher/req",this.dataReportPath="statics/report/common/form",this.traceMsgCache={},this.reqRetryCount=0,this.highPriorityMsgList=[],this.msgList=[],this.lowPriorityMsgList=[],this.cacheMsgList=[],this.lastReportTime=_s(),this.timer=null,this.endedAsyncMsgByModule={},this.lastFailLogin={},this.setConfig(e),this.reportConfig.isDataReportEnable&&this.reportConfig.autoStart&&this.initUploadConfig()}return i(n,[{key:"setConfig",value:function(e){var t=dr({},this.reportConfig.common,e.common);this.reportConfig=dr({},this.reportConfig,e),this.reportConfig.common=t,this.reportConfig.common.sdk_type||(this.reportConfig.common.sdk_type="im")}},{key:"reportImmediately",value:function(e,t){var r=this;this.reportConfig.isDataReportEnable&&this.reportConfig.request(e,dr({dataType:"json",method:"POST",timeout:this.reportConfig.timeout},t)).catch((function(e){var t,n;null===(n=null===(t=r.reportConfig)||void 0===t?void 0:t.logger)||void 0===n||n.warn("Reporter immediately upload failed",e)}))}},{key:"report",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(r.priority||(r.priority=this.getEventPriority(e,t)),this.reportConfig.isDataReportEnable&&e){if("login"===e&&!1===t.succeed&&t.process_id){var n=this.lastFailLogin[t.process_id]||0;if(t.start_time-n<a.loginFailIgnoreInterval)return;this.lastFailLogin[t.process_id]=t.start_time}var i=_s();"HIGH"===r.priority?this.highPriorityMsgList.push({module:e,msg:t,createTime:i}):"NORMAL"===r.priority?this.msgList.push({module:e,msg:t,createTime:i}):"LOW"===r.priority&&this.lowPriorityMsgList.push({module:e,msg:t,createTime:i}),this.highPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.highPriorityMsgList.shift(),this.msgList.length>this.reportConfig.msgListMaxSize&&this.msgList.shift(),this.lowPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.lowPriorityMsgList.shift(),this.doReport()}}},{key:"reportTraceStart",value:function(e,t){if(this.reportConfig.isDataReportEnable&&e&&!this.traceMsgCache[e]){var r=dr(dr({start_time:_s()},t),{extension:[]});this.traceMsgCache[e]=r}}},{key:"reportTraceUpdate",value:function(e){}},{key:"reportTraceUpdateV2",value:function(e,t,r){var n,i=this;if(this.reportConfig.isDataReportEnable&&this.traceMsgCache[e]){var o=this.traceMsgCache[e].extension,a=o.length,s=(new Date).getTime();0===a?t.duration=s-this.traceMsgCache[e].start_time:o[a-1].end_time?t.duration=s-o[a-1].end_time:t.duration=s-this.traceMsgCache[e].start_time,o.push(dr({end_time:s},t));var c=o.length-1;(null==r?void 0:r.asyncParams)&&((n=this.traceMsgCache[e]).asyncPromiseArray||(n.asyncPromiseArray=[]),this.traceMsgCache[e].asyncPromiseArray.push(r.asyncParams.then((function(t){i.traceMsgCache[e]&&i.traceMsgCache[e].extension[c]&&dr(i.traceMsgCache[e].extension[c],t)}))))}}},{key:"reportTraceEnd",value:function(e){var t,r,n=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.reportConfig.isDataReportEnable&&this.traceMsgCache[e])if("nos"!==e||!1===i){"boolean"==typeof i?this.traceMsgCache[e].succeed=!!i:this.traceMsgCache[e].state=i,this.traceMsgCache[e].duration=_s()-this.traceMsgCache[e].start_time,jn(t=this.traceMsgCache[e].extension).call(t,(function(e){delete e.end_time}));var o=this.traceMsgCache[e];if(this.traceMsgCache[e]=null,o.asyncPromiseArray){(r=this.endedAsyncMsgByModule)[e]||(r[e]=[]),this.endedAsyncMsgByModule[e].push(o);var a=function(){var t;n.endedAsyncMsgByModule[e]&&ou(t=n.endedAsyncMsgByModule[e]).call(t,o)&&(delete o.asyncPromiseArray,n.report(e,o,{priority:n.getEventPriority(e,o)}))};fs.all(o.asyncPromiseArray).then(a).catch(a)}else this.report(e,o,{priority:this.getEventPriority(e,o)})}else this.traceMsgCache[e]=null}},{key:"getEventPriority",value:function(e,t){if("exceptions"===e){if(0===t.action)return"HIGH";if(2===t.action)return"HIGH";if(1===t.action&&0!==t.exception_service)return"HIGH"}else{if("msgReceive"===e)return"LOW";if("nim_api_trace"===e)return"LOW"}return"NORMAL"}},{key:"reportTraceCancel",value:function(e){this.reportConfig.isDataReportEnable&&(this.endedAsyncMsgByModule[e]=[],this.traceMsgCache[e]=null)}},{key:"pause",value:function(){this.reportConfig.isDataReportEnable&&(this.isUploadEnable=!1)}},{key:"restore",value:function(){this.reportConfig.isDataReportEnable&&(this.isUploadEnable=!0,this.initConfigLoaded||this.initUploadConfig())}},{key:"destroy",value:function(){var e,t=this;this.reportConfig.isDataReportEnable&&(jn(e=fr(this.traceMsgCache)).call(e,(function(e){t.reportTraceEnd(e,1)})),null!==this.timer&&clearTimeout(this.timer),this.setConfig=u,this.report=u,this.reportTraceStart=u,this.reportTraceUpdate=u,this.reportTraceEnd=u,this.pause=u,this.restore=u,this.destroy=u,this.reqRetryCount=0,this.cacheMsgList=[],this.traceMsgCache={},this.lowPriorityMsgList=[],this.msgList=[],this.highPriorityMsgList=[],this.reportConfig={},this.isDestroyed=!0)}},{key:"initUploadConfig",value:function(){var r,n;return o(this,void 0,void 0,e().mark((function i(){var o,a,u,d,l,p=this;return e().wrap((function(i){for(var m;;)switch(i.prev=i.next){case 0:if(!this.loading){i.next=2;break}return i.abrupt("return");case 2:this.loading=!0,o=this.reportConfig.common||{},a=du(m=this.reportConfig.compassDataEndpoint.split(",")).call(m,(function(e){var t;return xs(t="".concat(e,"/")).call(t,p.configPath)})),u=e().mark((function t(i){return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!p.initConfigLoaded&&!p.isDestroyed){e.next=2;break}return e.abrupt("return","break");case 2:return e.prev=2,e.next=5,p.reportConfig.request(a[i],{method:"GET",dataType:"json",params:{deviceId:o.dev_id,sdkVer:o.sdk_ver,platform:o.platform,appkey:o.app_key},timeout:p.reportConfig.timeout}).then((function(e){var t,r;if(!p.isDestroyed){if(200===e.status&&e.data&&200===e.data.code){p.initConfigLoaded=!0;var n=e.data.data||{};p.reportConfig.maxSize=n.maxSize>1e3?1e3:n.maxSize,p.reportConfig.maxInterval=n.maxInterval>1e4?1e4:n.maxInterval,p.reportConfig.maxInterval=n.maxInterval<10?10:n.maxInterval,p.reportConfig.minInterval=n.minInterval<2?2:n.minInterval,p.reportConfig.maxDelay=n.maxDelay||300,p.reportConfig.maxInterval=1e3*p.reportConfig.maxInterval,p.reportConfig.minInterval=1e3*p.reportConfig.minInterval,p.reportConfig.maxDelay=1e3*p.reportConfig.maxDelay,n.endpoint?p.dataReportEndpoint=n.endpoint:p.dataReportEndpoint=a[i],p.serverAllowUpload=!0,p.loading=!1,p.reportHeartBeat()}else 200===e.status&&(p.initConfigLoaded=!0);null===(r=null===(t=p.reportConfig)||void 0===t?void 0:t.logger)||void 0===r||r.log("Get reporter upload config success")}})).catch((function(e){var t,r;p.isDestroyed||(p.loading=!1,null===(r=null===(t=p.reportConfig)||void 0===t?void 0:t.logger)||void 0===r||r.error("Get reporter upload config failed",e),p.reqRetryCount<s&&(p.reqRetryCount++,qs((function(){p.isDestroyed||p.initUploadConfig()}),c)))}));case 5:e.next=14;break;case 7:if(e.prev=7,e.t0=e.catch(2),!p.isDestroyed){e.next=11;break}return e.abrupt("return",{v:void 0});case 11:p.loading=!1,null===(n=null===(r=p.reportConfig)||void 0===r?void 0:r.logger)||void 0===n||n.error("Exec reporter request failed",e.t0),p.reqRetryCount<s&&(p.reqRetryCount++,qs((function(){p.isDestroyed||p.initUploadConfig()}),c));case 14:case"end":return e.stop()}}),t,null,[[2,7]])})),d=0;case 7:if(!(d<a.length)){i.next=17;break}return i.delegateYield(u(d),"t0",9);case 9:if("break"!==(l=i.t0)){i.next=12;break}return i.abrupt("break",17);case 12:if("object"!==t(l)){i.next=14;break}return i.abrupt("return",l.v);case 14:d++,i.next=7;break;case 17:case"end":return i.stop()}}),i,this)})))}},{key:"reportHeartBeat",value:function(){var e=this;this.isDestroyed||(this.timer=qs((function(){e.reportHeartBeat()}),this.reportConfig.minInterval),this.doReport())}},{key:"doReport",value:function(){if(!this.isDestroyed){var e=this.highPriorityMsgList.length+this.msgList.length+this.lowPriorityMsgList.length+this.cacheMsgList.length>2*this.reportConfig.maxSize?this.reportConfig.minInterval:this.reportConfig.maxInterval;_s()-this.lastReportTime>=e&&this.upload()}}},{key:"getUploadMsg",value:function(){var e,t,r,n,i,o,a=this,s={},c=_s();this.highPriorityMsgList=fu(e=this.highPriorityMsgList).call(e,(function(e){return c-e.createTime<a.reportConfig.maxDelay})),this.msgList=fu(t=this.msgList).call(t,(function(e){return c-e.createTime<a.reportConfig.maxDelay})),this.lowPriorityMsgList=fu(r=this.lowPriorityMsgList).call(r,(function(e){return c-e.createTime<a.reportConfig.maxDelay})),this.cacheMsgList=fu(n=this.cacheMsgList).call(n,(function(e){return c-e.createTime<a.reportConfig.maxDelay}));var u=Wc(i=this.highPriorityMsgList).call(i,0,this.reportConfig.maxSize);if(this.highPriorityMsgList=Wc(o=this.highPriorityMsgList).call(o,u.length),u.length<this.reportConfig.maxSize){var d,l,p=this.reportConfig.maxSize-u.length;u=xs(u).call(u,Wc(d=this.msgList).call(d,0,p)),this.msgList=Wc(l=this.msgList).call(l,p)}if(u.length<this.reportConfig.maxSize){var m,h,f=this.reportConfig.maxSize-u.length;u=xs(u).call(u,Wc(m=this.lowPriorityMsgList).call(m,0,f)),this.lowPriorityMsgList=Wc(h=this.lowPriorityMsgList).call(h,f)}if(u.length<this.reportConfig.maxSize){var g,v,y=this.reportConfig.maxSize-u.length;u=xs(u).call(u,Wc(g=this.cacheMsgList).call(g,0,y)),this.cacheMsgList=Wc(v=this.cacheMsgList).call(v,y)}return jn(u).call(u,(function(e){s[e.module]?s[e.module].push(e.msg):s[e.module]=[e.msg]})),{uploadMsgArr:u,uploadMsg:s}}},{key:"upload",value:function(){var e,t,r=this;if(this.isUploadEnable&&this.serverAllowUpload&&!(this.lastReportTime&&_s()-this.lastReportTime<this.reportConfig.minInterval)){var n=this.getUploadMsg(),i=n.uploadMsgArr,o=n.uploadMsg;if(i.length){this.lastReportTime=_s();try{var a,s=xs(a="".concat(this.dataReportEndpoint,"/")).call(a,this.dataReportPath);this.reportConfig.request(s,{dataType:"json",method:"POST",data:{common:this.reportConfig.common,event:o},headers:{sdktype:"im"},timeout:this.reportConfig.timeout}).catch((function(e){var t,n,o,a;r.cacheMsgList=Wc(t=xs(n=r.cacheMsgList).call(n,i)).call(t,0,r.reportConfig.cacheMaxSize),null===(a=null===(o=r.reportConfig)||void 0===o?void 0:o.logger)||void 0===a||a.warn("Reporter upload failed",e)}))}catch(r){null===(t=null===(e=this.reportConfig)||void 0===e?void 0:e.logger)||void 0===t||t.warn("Exec reporter request failed",r)}clearTimeout(this.timer),this.reportHeartBeat()}}}}]),n}();return d}()})),vu=$t("Array").values,yu=Array.prototype,Mu={DOMTokenList:!0,NodeList:!0},Iu=function(e){var t=e.values;return e===yu||j(yu,e)&&t===yu.values||me(Mu,zr(e))?vu:t},Su=St.indexOf,Tu=M([].indexOf),bu=!!Tu&&1/Tu([1],1,-0)<0,Cu=Un("indexOf");nt({target:"Array",proto:!0,forced:bu||!Cu},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return bu?Tu(this,e,t)||0:Su(this,e,t)}});var _u=$t("Array").indexOf,Eu=Array.prototype,wu=function(e){var t=e.indexOf;return e===Eu||j(Eu,e)&&t===Eu.indexOf?_u:t},Ru=Vn.every,ku=Un("every");nt({target:"Array",proto:!0,forced:!ku},{every:function(e){return Ru(this,e,arguments.length>1?arguments[1]:void 0)}});var Au=$t("Array").every,Nu=Array.prototype,xu=function(e){var t=e.every;return e===Nu||j(Nu,e)&&t===Nu.every?Au:t},Ou=u((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}})),Pu=Object.isExtensible,Lu=u((function(){Pu(1)}))||Ou?function(e){return!!q(e)&&(!Ou||"ArrayBuffer"!=A(e))&&(!Pu||Pu(e))}:Pu,Vu=!u((function(){return Object.isExtensible(Object.preventExtensions({}))})),Uu=n((function(e){var t=$e.f,r=!1,n=ve("meta"),i=0,o=function(e){t(e,n,{value:{objectID:"O"+i++,weakData:{}}})},a=e.exports={enable:function(){a.enable=function(){},r=!0;var e=Ri.f,t=M([].splice),i={};i[n]=1,e(i).length&&(Ri.f=function(r){for(var i=e(r),o=0,a=i.length;o<a;o++)if(i[o]===n){t(i,o,1);break}return i},nt({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:Ys.f}))},fastKey:function(e,t){if(!q(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!me(e,n)){if(!Lu(e))return"F";if(!t)return"E";o(e)}return e[n].objectID},getWeakData:function(e,t){if(!me(e,n)){if(!Lu(e))return!0;if(!t)return!1;o(e)}return e[n].weakData},onFreeze:function(e){return Vu&&r&&Lu(e)&&!me(e,n)&&o(e),e}};Tt[n]=!0})),Du=$e.f,qu=Vn.forEach,Bu=Ar.set,Fu=Ar.getterFor,Gu=function(e,t,r){var n,i=-1!==e.indexOf("Map"),o=-1!==e.indexOf("Weak"),a=i?"set":"add",s=c[e],d=s&&s.prototype,l={};if(S&&I(s)&&(o||d.forEach&&!u((function(){(new s).entries().next()})))){var p=(n=t((function(t,r){Bu(ho(t,p),{type:e,collection:new s}),null!=r&&Ji(r,t[a],{that:t,AS_ENTRIES:i})}))).prototype,m=Fu(e);qu(["add","clear","delete","forEach","get","has","set","keys","values","entries"],(function(e){var t="add"==e||"set"==e;!(e in d)||o&&"clear"==e||Ze(p,e,(function(r,n){var i=m(this).collection;if(!t&&o&&!q(r))return"get"==e&&void 0;var a=i[e](0===r?0:r,n);return t?this:a}))})),o||Du(p,"size",{configurable:!0,get:function(){return m(this).collection.size}})}else n=r.getConstructor(t,e,i,a),Uu.enable();return en(n,e,!1,!0),l[e]=n,nt({global:!0,forced:!0},l),o||r.setStrong(n,e,i),n},ju=function(e,t,r){for(var n in t)r&&r.unsafe&&e[n]?e[n]=t[n]:Br(e,n,t[n],r);return e},Hu=$e.f,Wu=Uu.fastKey,Ku=Ar.set,Yu=Ar.getterFor,Qu={getConstructor:function(e,t,r,n){var i=e((function(e,i){ho(e,o),Ku(e,{type:t,index:Dt(null),first:void 0,last:void 0,size:0}),S||(e.size=0),P(i)||Ji(i,e[n],{that:e,AS_ENTRIES:r})})),o=i.prototype,a=Yu(t),s=function(e,t,r){var n,i,o=a(e),s=c(e,t);return s?s.value=r:(o.last=s={index:i=Wu(t,!0),key:t,value:r,previous:n=o.last,next:void 0,removed:!1},o.first||(o.first=s),n&&(n.next=s),S?o.size++:e.size++,"F"!==i&&(o.index[i]=s)),e},c=function(e,t){var r,n=a(e),i=Wu(t);if("F"!==i)return n.index[i];for(r=n.first;r;r=r.next)if(r.key==t)return r};return ju(o,{clear:function(){for(var e=a(this),t=e.index,r=e.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete t[r.index],r=r.next;e.first=e.last=void 0,S?e.size=0:this.size=0},delete:function(e){var t=this,r=a(t),n=c(t,e);if(n){var i=n.next,o=n.previous;delete r.index[n.index],n.removed=!0,o&&(o.next=i),i&&(i.previous=o),r.first==n&&(r.first=i),r.last==n&&(r.last=o),S?r.size--:t.size--}return!!n},forEach:function(e){for(var t,r=a(this),n=Fe(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:r.first;)for(n(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!c(this,e)}}),ju(o,r?{get:function(e){var t=c(this,e);return t&&t.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),S&&Hu(o,"size",{get:function(){return a(this).size}}),i},setStrong:function(e,t,r){var n=t+" Iterator",i=Yu(t),o=Yu(n);ln(e,t,(function(e,t){Ku(this,{type:n,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,r=e.last;r&&r.removed;)r=r.previous;return e.target&&(e.last=r=r?r.next:e.state.first)?"keys"==t?{value:r.key,done:!1}:"values"==t?{value:r.value,done:!1}:{value:[r.key,r.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),r?"entries":"values",!r,!0),po(t)}};Gu("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Qu);var Ju=B.Map,zu=[].push,Xu=function(e){var t,r,n,i,o=arguments.length,a=o>1?arguments[1]:void 0;return go(this),(t=void 0!==a)&&ne(a),P(e)?new this:(r=[],t?(n=0,i=Fe(a,o>2?arguments[2]:void 0),Ji(e,(function(e){b(zu,r,i(e,n++))}))):Ji(e,zu,{that:r}),new this(r))};nt({target:"Map",stat:!0,forced:!0},{from:Xu});var $u=function(){return new this(Wt(arguments))};nt({target:"Map",stat:!0,forced:!0},{of:$u});var Zu=function(){for(var e,t=We(this),r=ne(t.delete),n=!0,i=0,o=arguments.length;i<o;i++)e=b(r,t,arguments[i]),n=n&&e;return!!n};nt({target:"Map",proto:!0,real:!0,forced:!0},{deleteAll:Zu}),nt({target:"Map",proto:!0,real:!0,forced:!0},{emplace:function(e,t){var r,n,i=We(this),o=ne(i.get),a=ne(i.has),s=ne(i.set);return b(a,i,e)?(r=b(o,i,e),"update"in t&&(r=t.update(r,e,i),b(s,i,e,r)),r):(n=t.insert(e,i),b(s,i,e,n),n)}});var ed=Hi;nt({target:"Map",proto:!0,real:!0,forced:!0},{every:function(e){var t=We(this),r=ed(t),n=Fe(e,arguments.length>1?arguments[1]:void 0);return!Ji(r,(function(e,r,i){if(!n(r,e,t))return i()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),nt({target:"Map",proto:!0,real:!0,forced:!0},{filter:function(e){var t=We(this),r=ed(t),n=Fe(e,arguments.length>1?arguments[1]:void 0),i=new(yo(t,G("Map"))),o=ne(i.set);return Ji(r,(function(e,r){n(r,e,t)&&b(o,i,e,r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}}),nt({target:"Map",proto:!0,real:!0,forced:!0},{find:function(e){var t=We(this),r=ed(t),n=Fe(e,arguments.length>1?arguments[1]:void 0);return Ji(r,(function(e,r,i){if(n(r,e,t))return i(r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),nt({target:"Map",proto:!0,real:!0,forced:!0},{findKey:function(e){var t=We(this),r=ed(t),n=Fe(e,arguments.length>1?arguments[1]:void 0);return Ji(r,(function(e,r,i){if(n(r,e,t))return i(e)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}});var td=M([].push);nt({target:"Map",stat:!0,forced:!0},{groupBy:function(e,t){ne(t);var r=Hi(e),n=new this,i=ne(n.has),o=ne(n.get),a=ne(n.set);return Ji(r,(function(e){var r=t(e);b(i,n,r)?td(b(o,n,r),e):b(a,n,r,[e])}),{IS_ITERATOR:!0}),n}}),nt({target:"Map",proto:!0,real:!0,forced:!0},{includes:function(e){return Ji(ed(We(this)),(function(t,r,n){if((i=r)===(o=e)||i!=i&&o!=o)return n();var i,o}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),nt({target:"Map",stat:!0,forced:!0},{keyBy:function(e,t){var r=new this;ne(t);var n=ne(r.set);return Ji(e,(function(e){b(n,r,t(e),e)})),r}}),nt({target:"Map",proto:!0,real:!0,forced:!0},{keyOf:function(e){return Ji(ed(We(this)),(function(t,r,n){if(r===e)return n(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),nt({target:"Map",proto:!0,real:!0,forced:!0},{mapKeys:function(e){var t=We(this),r=ed(t),n=Fe(e,arguments.length>1?arguments[1]:void 0),i=new(yo(t,G("Map"))),o=ne(i.set);return Ji(r,(function(e,r){b(o,i,n(r,e,t),r)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}}),nt({target:"Map",proto:!0,real:!0,forced:!0},{mapValues:function(e){var t=We(this),r=ed(t),n=Fe(e,arguments.length>1?arguments[1]:void 0),i=new(yo(t,G("Map"))),o=ne(i.set);return Ji(r,(function(e,r){b(o,i,e,n(r,e,t))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),i}}),nt({target:"Map",proto:!0,real:!0,arity:1,forced:!0},{merge:function(e){for(var t=We(this),r=ne(t.set),n=arguments.length,i=0;i<n;)Ji(arguments[i++],r,{that:t,AS_ENTRIES:!0});return t}});var rd=TypeError;nt({target:"Map",proto:!0,real:!0,forced:!0},{reduce:function(e){var t=We(this),r=ed(t),n=arguments.length<2,i=n?void 0:arguments[1];if(ne(e),Ji(r,(function(r,o){n?(n=!1,i=o):i=e(i,o,r,t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),n)throw rd("Reduce of empty map with no initial value");return i}}),nt({target:"Map",proto:!0,real:!0,forced:!0},{some:function(e){var t=We(this),r=ed(t),n=Fe(e,arguments.length>1?arguments[1]:void 0);return Ji(r,(function(e,r,i){if(n(r,e,t))return i()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}});var nd=TypeError;nt({target:"Map",proto:!0,real:!0,forced:!0},{update:function(e,t){var r=We(this),n=ne(r.get),i=ne(r.has),o=ne(r.set),a=arguments.length;ne(t);var s=b(i,r,e);if(!s&&a<3)throw nd("Updating absent value");var c=s?b(n,r,e):ne(a>2?arguments[2]:void 0)(e,r);return b(o,r,e,t(c,e,r)),r}});var id=TypeError,od=function(e,t){var r,n=We(this),i=ne(n.get),o=ne(n.has),a=ne(n.set),s=arguments.length>2?arguments[2]:void 0;if(!I(t)&&!I(s))throw id("At least one callback required");return b(o,n,e)?(r=b(i,n,e),I(t)&&(r=t(r),b(a,n,e,r))):I(s)&&(r=s(),b(a,n,e,r)),r};nt({target:"Map",proto:!0,real:!0,forced:!0},{upsert:od}),nt({target:"Map",proto:!0,real:!0,name:"upsert",forced:!0},{updateOrInsert:od});var ad=Ju,sd=n((function(e){function t(r){var n;return e.exports=t=Ht?tr(n=Oc).call(n):function(e){return e.__proto__||Oc(e)},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})),cd=n((function(e){e.exports=function(e){var t;return-1!==wu(t=Function.toString.call(e)).call(t,"[native code]")},e.exports.__esModule=!0,e.exports.default=e.exports})),ud=G("Reflect","construct"),dd=Object.prototype,ld=[].push,pd=u((function(){function e(){}return!(ud((function(){}),[],e)instanceof e)})),md=!u((function(){ud((function(){}))})),hd=pd||md;nt({target:"Reflect",stat:!0,forced:hd,sham:hd},{construct:function(e,t){go(e),We(t);var r=arguments.length<3?e:go(arguments[2]);if(md&&!pd)return ud(e,t,r);if(e==r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var n=[null];return h(ld,n,t),new(h(Xt,e,n))}var i=r.prototype,o=Dt(q(i)?i:dd),a=h(e,o,t);return q(a)?a:o}});var fd=B.Reflect.construct,gd=n((function(e){e.exports=function(){if("undefined"==typeof Reflect||!fd)return!1;if(fd.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(fd(Boolean,[],(function(){}))),!0}catch(e){return!1}},e.exports.__esModule=!0,e.exports.default=e.exports})),vd=n((function(e){function t(r,n,i){var o;return gd()?(e.exports=t=tr(o=fd).call(o),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=t=function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(tr(Function).apply(e,n));return r&&rr(i,r.prototype),i},e.exports.__esModule=!0,e.exports.default=e.exports),t.apply(null,arguments)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})),yd=n((function(e){function t(r){var n="function"==typeof ad?new ad:void 0;return e.exports=t=function(e){if(null===e||!cd(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return vd(e,arguments,sd(this).constructor)}return t.prototype=Bt(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),rr(t,e)},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})),Md=r(yd),Id=TypeError,Sd=function(e){return function(t,r,n,i){ne(r);var o=le(t),a=O(o),s=Mt(o),c=e?s-1:0,u=e?-1:1;if(n<2)for(;;){if(c in a){i=a[c],c+=u;break}if(c+=u,e?c<0:s<=c)throw Id("Reduce of empty array with no initial value")}for(;e?c>=0:s>c;c+=u)c in a&&(i=r(i,a[c],c,o));return i}},Td=[Sd(!1),Sd(!0)][0],bd=Un("reduce");nt({target:"Array",proto:!0,forced:!bd||!uo&&J>79&&J<83},{reduce:function(e){var t=arguments.length;return Td(this,e,t,t>1?arguments[1]:void 0)}});var Cd,_d,Ed,wd,Rd,kd,Ad,Nd,xd,Od,Pd,Ld,Vd,Ud,Dd,qd,Bd,Fd,Gd,jd,Hd,Wd,Kd,Yd,Qd,Jd,zd,Xd,$d,Zd,el,tl,rl,nl,il,ol,al,sl,cl,ul,dl,ll,pl,ml,hl,fl,gl,vl=$t("Array").reduce,yl=Array.prototype,Ml=function(e){var t=e.reduce;return e===yl||j(yl,e)&&t===yl.reduce?vl:t};!function(e){e[e.V2NIM_DATA_SYNC_TYPE_LEVEL_FULL=0]="V2NIM_DATA_SYNC_TYPE_LEVEL_FULL",e[e.V2NIM_DATA_SYNC_TYPE_LEVEL_BASIC=1]="V2NIM_DATA_SYNC_TYPE_LEVEL_BASIC"}(Cd||(Cd={})),function(e){e[e.V2NIM_DATA_SYNC_TYPE_MAIN=1]="V2NIM_DATA_SYNC_TYPE_MAIN",e[e.V2NIM_DATA_SYNC_TYPE_TEAM_MEMBER=2]="V2NIM_DATA_SYNC_TYPE_TEAM_MEMBER",e[e.V2NIM_DATA_SYNC_TYPE_SUPER_TEAM_MEMBER=3]="V2NIM_DATA_SYNC_TYPE_SUPER_TEAM_MEMBER"}(_d||(_d={})),function(e){e[e.V2NIM_DATA_SYNC_STATE_WAITING=1]="V2NIM_DATA_SYNC_STATE_WAITING",e[e.V2NIM_DATA_SYNC_STATE_SYNCING=2]="V2NIM_DATA_SYNC_STATE_SYNCING",e[e.V2NIM_DATA_SYNC_STATE_COMPLETED=3]="V2NIM_DATA_SYNC_STATE_COMPLETED"}(Ed||(Ed={})),function(e){e[e.V2NIM_CONVERSATION_TYPE_UNKNOWN=0]="V2NIM_CONVERSATION_TYPE_UNKNOWN",e[e.V2NIM_CONVERSATION_TYPE_P2P=1]="V2NIM_CONVERSATION_TYPE_P2P",e[e.V2NIM_CONVERSATION_TYPE_TEAM=2]="V2NIM_CONVERSATION_TYPE_TEAM",e[e.V2NIM_CONVERSATION_TYPE_SUPER_TEAM=3]="V2NIM_CONVERSATION_TYPE_SUPER_TEAM"}(wd||(wd={})),function(e){e[e.V2NIM_MESSAGE_STATUS_DEFAULT=0]="V2NIM_MESSAGE_STATUS_DEFAULT",e[e.V2NIM_MESSAGE_STATUS_REVOKE=1]="V2NIM_MESSAGE_STATUS_REVOKE",e[e.V2NIM_MESSAGE_STATUS_BACKFILL=2]="V2NIM_MESSAGE_STATUS_BACKFILL"}(Rd||(Rd={})),function(e){e[e.V2NIM_FRIEND_MODE_TYPE_ADD=1]="V2NIM_FRIEND_MODE_TYPE_ADD",e[e.V2NIM_FRIEND_MODE_TYPE_APPLY=2]="V2NIM_FRIEND_MODE_TYPE_APPLY"}(kd||(kd={})),function(e){e[e.V2NIM_FRIEND_ADD_APPLICATION_TYPE_RECEIVED=1]="V2NIM_FRIEND_ADD_APPLICATION_TYPE_RECEIVED",e[e.V2NIM_FRIEND_ADD_APPLICATION_TYPE_REJECTED=2]="V2NIM_FRIEND_ADD_APPLICATION_TYPE_REJECTED"}(Ad||(Ad={})),function(e){e[e.V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT=0]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_INIT",e[e.V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED=1]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_AGREED",e[e.V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED=2]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_REJECTED",e[e.V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED=3]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_EXPIRED",e[e.V2NIM_FRIEND_ADD_APPLICATION_STATUS_DIRECT_ADD=4]="V2NIM_FRIEND_ADD_APPLICATION_STATUS_DIRECT_ADD"}(Nd||(Nd={})),function(e){e[e.V2NIM_FRIEND_DELETION_TYPE_BY_SELF=1]="V2NIM_FRIEND_DELETION_TYPE_BY_SELF",e[e.V2NIM_FRIEND_DELETION_TYPE_BY_PEER=2]="V2NIM_FRIEND_DELETION_TYPE_BY_PEER"}(xd||(xd={})),function(e){e[e.V2NIM_FRIEND_VERIFY_TYPE_ADD=1]="V2NIM_FRIEND_VERIFY_TYPE_ADD",e[e.V2NIM_FRIEND_VERIFY_TYPE_APPLY=2]="V2NIM_FRIEND_VERIFY_TYPE_APPLY",e[e.V2NIM_FRIEND_VERIFY_TYPE_ACCEPT=3]="V2NIM_FRIEND_VERIFY_TYPE_ACCEPT",e[e.V2NIM_FRIEND_VERIFY_TYPE_REJECT=4]="V2NIM_FRIEND_VERIFY_TYPE_REJECT"}(Od||(Od={})),function(e){e[e.V2NIM_LOGIN_AUTH_TYPE_DEFAULT=0]="V2NIM_LOGIN_AUTH_TYPE_DEFAULT",e[e.V2NIM_LOGIN_AUTH_TYPE_DYNAMIC_TOKEN=1]="V2NIM_LOGIN_AUTH_TYPE_DYNAMIC_TOKEN",e[e.V2NIM_LOGIN_AUTH_TYPE_THIRD_PARTY=2]="V2NIM_LOGIN_AUTH_TYPE_THIRD_PARTY"}(Pd||(Pd={})),function(e){e[e.V2NIM_LOGIN_STATUS_LOGOUT=0]="V2NIM_LOGIN_STATUS_LOGOUT",e[e.V2NIM_LOGIN_STATUS_LOGINED=1]="V2NIM_LOGIN_STATUS_LOGINED",e[e.V2NIM_LOGIN_STATUS_LOGINING=2]="V2NIM_LOGIN_STATUS_LOGINING",e[e.V2NIM_LOGIN_STATUS_UNLOGIN=3]="V2NIM_LOGIN_STATUS_UNLOGIN"}(Ld||(Ld={})),function(e){e[e.V2NIM_LOGIN_CLIENT_TYPE_UNKNOWN=0]="V2NIM_LOGIN_CLIENT_TYPE_UNKNOWN",e[e.V2NIM_LOGIN_CLIENT_TYPE_ANDROID=1]="V2NIM_LOGIN_CLIENT_TYPE_ANDROID",e[e.V2NIM_LOGIN_CLIENT_TYPE_IOS=2]="V2NIM_LOGIN_CLIENT_TYPE_IOS",e[e.V2NIM_LOGIN_CLIENT_TYPE_PC=4]="V2NIM_LOGIN_CLIENT_TYPE_PC",e[e.V2NIM_LOGIN_CLIENT_TYPE_WP=8]="V2NIM_LOGIN_CLIENT_TYPE_WP",e[e.V2NIM_LOGIN_CLIENT_TYPE_WEB=16]="V2NIM_LOGIN_CLIENT_TYPE_WEB",e[e.V2NIM_LOGIN_CLIENT_TYPE_RESTFUL=32]="V2NIM_LOGIN_CLIENT_TYPE_RESTFUL",e[e.V2NIM_LOGIN_CLIENT_TYPE_MAC_OS=64]="V2NIM_LOGIN_CLIENT_TYPE_MAC_OS",e[e.V2NIM_LOGIN_CLIENT_TYPE_HARMONY_OS=65]="V2NIM_LOGIN_CLIENT_TYPE_HARMONY_OS"}(Vd||(Vd={})),function(e){e[e.V2NIM_KICKED_OFFLINE_REASON_CLIENT_EXCLUSIVE=1]="V2NIM_KICKED_OFFLINE_REASON_CLIENT_EXCLUSIVE",e[e.V2NIM_KICKED_OFFLINE_REASON_SERVER=2]="V2NIM_KICKED_OFFLINE_REASON_SERVER",e[e.V2NIM_KICKED_OFFLINE_REASON_CLIENT=3]="V2NIM_KICKED_OFFLINE_REASON_CLIENT",e[e.V2NIM_KICKED_OFFLINE_REASON_CLIENT_QUIETLY=4]="V2NIM_KICKED_OFFLINE_REASON_CLIENT_QUIETLY"}(Ud||(Ud={})),function(e){e[e.V2NIM_LOGIN_CLIENT_CHANGE_LIST=1]="V2NIM_LOGIN_CLIENT_CHANGE_LIST",e[e.V2NIM_LOGIN_CLIENT_CHANGE_LOGIN=2]="V2NIM_LOGIN_CLIENT_CHANGE_LOGIN",e[e.V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT=3]="V2NIM_LOGIN_CLIENT_CHANGE_LOGOUT"}(Dd||(Dd={})),function(e){e[e.V2NIM_CONNECT_STATUS_DISCONNECTED=0]="V2NIM_CONNECT_STATUS_DISCONNECTED",e[e.V2NIM_CONNECT_STATUS_CONNECTED=1]="V2NIM_CONNECT_STATUS_CONNECTED",e[e.V2NIM_CONNECT_STATUS_CONNECTING=2]="V2NIM_CONNECT_STATUS_CONNECTING",e[e.V2NIM_CONNECT_STATUS_WAITING=3]="V2NIM_CONNECT_STATUS_WAITING"}(qd||(qd={})),function(e){e[e.V2NIM_MESSAGE_AI_STATUS_UNKNOW=0]="V2NIM_MESSAGE_AI_STATUS_UNKNOW",e[e.V2NIM_MESSAGE_AI_STATUS_AT=1]="V2NIM_MESSAGE_AI_STATUS_AT",e[e.V2NIM_MESSAGE_AI_STATUS_RESPONSE=2]="V2NIM_MESSAGE_AI_STATUS_RESPONSE"}(Bd||(Bd={})),function(e){e[e.V2NIM_MESSAGE_TYPE_INVALID=-1]="V2NIM_MESSAGE_TYPE_INVALID",e[e.V2NIM_MESSAGE_TYPE_TEXT=0]="V2NIM_MESSAGE_TYPE_TEXT",e[e.V2NIM_MESSAGE_TYPE_IMAGE=1]="V2NIM_MESSAGE_TYPE_IMAGE",e[e.V2NIM_MESSAGE_TYPE_AUDIO=2]="V2NIM_MESSAGE_TYPE_AUDIO",e[e.V2NIM_MESSAGE_TYPE_VIDEO=3]="V2NIM_MESSAGE_TYPE_VIDEO",e[e.V2NIM_MESSAGE_TYPE_LOCATION=4]="V2NIM_MESSAGE_TYPE_LOCATION",e[e.V2NIM_MESSAGE_TYPE_NOTIFICATION=5]="V2NIM_MESSAGE_TYPE_NOTIFICATION",e[e.V2NIM_MESSAGE_TYPE_FILE=6]="V2NIM_MESSAGE_TYPE_FILE",e[e.V2NIM_MESSAGE_TYPE_AVCHAT=7]="V2NIM_MESSAGE_TYPE_AVCHAT",e[e.V2NIM_MESSAGE_TYPE_TIPS=10]="V2NIM_MESSAGE_TYPE_TIPS",e[e.V2NIM_MESSAGE_TYPE_ROBOT=11]="V2NIM_MESSAGE_TYPE_ROBOT",e[e.V2NIM_MESSAGE_TYPE_CALL=12]="V2NIM_MESSAGE_TYPE_CALL",e[e.V2NIM_MESSAGE_TYPE_CUSTOM=100]="V2NIM_MESSAGE_TYPE_CUSTOM"}(Fd||(Fd={})),function(e){e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_UNDEFINED=-1]="V2NIM_MESSAGE_NOTIFICATION_TYPE_UNDEFINED",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE=0]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_KICK=1]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_KICK",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_LEAVE=2]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_LEAVE",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_UPDATE_TINFO=3]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_UPDATE_TINFO",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_DISMISS=4]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_DISMISS",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_APPLY_PASS=5]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_APPLY_PASS",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_OWNER_TRANSFER=6]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_OWNER_TRANSFER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_ADD_MANAGER=7]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_ADD_MANAGER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_REMOVE_MANAGER=8]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_REMOVE_MANAGER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE_ACCEPT=9]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_INVITE_ACCEPT",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_BANNED_TEAM_MEMBER=10]="V2NIM_MESSAGE_NOTIFICATION_TYPE_TEAM_BANNED_TEAM_MEMBER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE=401]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_KICK=402]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_KICK",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_LEAVE=403]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_LEAVE",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_UPDATE_TINFO=404]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_UPDATE_TINFO",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_DISMISS=405]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_DISMISS",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_APPLY_PASS=410]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_APPLY_PASS",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_OWNER_TRANSFER=406]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_OWNER_TRANSFER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_ADD_MANAGER=407]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_ADD_MANAGER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_REMOVE_MANAGER=408]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_REMOVE_MANAGER",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE_ACCEPT=411]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_INVITE_ACCEPT",e[e.V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_BANNED_TEAM_MEMBER=409]="V2NIM_MESSAGE_NOTIFICATION_TYPE_SUPER_TEAM_BANNED_TEAM_MEMBER"}(Gd||(Gd={})),function(e){e[e.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN=0]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UNKNOWN",e[e.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS=1]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_SUCCESS",e[e.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED=2]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_FAILED",e[e.V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING=3]="V2NIM_MESSAGE_ATTACHMENT_UPLOAD_STATE_UPLOADING"}(jd||(jd={})),function(e){e[e.V2NIM_MESSAGE_SENDING_STATE_UNKNOWN=0]="V2NIM_MESSAGE_SENDING_STATE_UNKNOWN",e[e.V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED=1]="V2NIM_MESSAGE_SENDING_STATE_SUCCEEDED",e[e.V2NIM_MESSAGE_SENDING_STATE_FAILED=2]="V2NIM_MESSAGE_SENDING_STATE_FAILED",e[e.V2NIM_MESSAGE_SENDING_STATE_SENDING=3]="V2NIM_MESSAGE_SENDING_STATE_SENDING"}(Hd||(Hd={})),function(e){e[e.V2NIM_QUERY_DIRECTION_DESC=0]="V2NIM_QUERY_DIRECTION_DESC",e[e.V2NIM_QUERY_DIRECTION_ASC=1]="V2NIM_QUERY_DIRECTION_ASC"}(Wd||(Wd={})),function(e){e[e.V2NIM_MESSAGE_REVOKE_TYPE_UNDEFINED=0]="V2NIM_MESSAGE_REVOKE_TYPE_UNDEFINED",e[e.V2NIM_MESSAGE_REVOKE_TYPE_P2P_BOTHWAY=1]="V2NIM_MESSAGE_REVOKE_TYPE_P2P_BOTHWAY",e[e.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_BOTHWAY=2]="V2NIM_MESSAGE_REVOKE_TYPE_TEAM_BOTHWAY",e[e.V2NIM_MESSAGE_REVOKE_TYPE_SUPERTEAM_BOTHWAY=3]="V2NIM_MESSAGE_REVOKE_TYPE_SUPERTEAM_BOTHWAY",e[e.V2NIM_MESSAGE_REVOKE_TYPE_P2P_ONEWAY=4]="V2NIM_MESSAGE_REVOKE_TYPE_P2P_ONEWAY",e[e.V2NIM_MESSAGE_REVOKE_TYPE_TEAM_ONEWAY=5]="V2NIM_MESSAGE_REVOKE_TYPE_TEAM_ONEWAY"}(Kd||(Kd={})),function(e){e[e.V2NIM_MESSAGE_PIN_STATE_NOT_PINNED=0]="V2NIM_MESSAGE_PIN_STATE_NOT_PINNED",e[e.V2NIM_MESSAGE_PIN_STATE_PINNED=1]="V2NIM_MESSAGE_PIN_STATE_PINNED",e[e.V2NIM_MESSAGE_PIN_STATE_UPDATED=2]="V2NIM_MESSAGE_PIN_STATE_UPDATED"}(Yd||(Yd={})),function(e){e[e.V2NIM_QUICK_COMMENT_STATE_ADD=1]="V2NIM_QUICK_COMMENT_STATE_ADD",e[e.V2NIM_QUICK_COMMENT_STATE_REMOVE=2]="V2NIM_QUICK_COMMENT_STATE_REMOVE"}(Qd||(Qd={})),function(e){e[e.V2NIM_CLIENT_ANTISPAM_OPERATE_NONE=0]="V2NIM_CLIENT_ANTISPAM_OPERATE_NONE",e[e.V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE=1]="V2NIM_CLIENT_ANTISPAM_OPERATE_REPLACE",e[e.V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD=2]="V2NIM_CLIENT_ANTISPAM_OPERATE_CLIENT_SHIELD",e[e.V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD=3]="V2NIM_CLIENT_ANTISPAM_OPERATE_SERVER_SHIELD"}(Jd||(Jd={})),function(e){e[e.V2NIM_SORT_ORDER_DESC=0]="V2NIM_SORT_ORDER_DESC",e[e.V2NIM_SORT_ORDER_ASC=1]="V2NIM_SORT_ORDER_ASC"}(zd||(zd={})),function(e){e[e.P2P_DELETE_MSG=7]="P2P_DELETE_MSG",e[e.TEAM_DELETE_MSG=8]="TEAM_DELETE_MSG",e[e.SUPERTEAM_DELETE_MSG=12]="SUPERTEAM_DELETE_MSG",e[e.P2P_ONE_WAY_DELETE_MSG=13]="P2P_ONE_WAY_DELETE_MSG",e[e.TEAM_ONE_WAY_DELETE_MSG=14]="TEAM_ONE_WAY_DELETE_MSG",e[e.CUSTOM_P2P_MSG=100]="CUSTOM_P2P_MSG",e[e.CUSTOM_TEAM_MSG=101]="CUSTOM_TEAM_MSG",e[e.CUSTOM_SUPERTEAM_MSG=103]="CUSTOM_SUPERTEAM_MSG"}(Xd||(Xd={})),function(e){e[e.V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF=0]="V2NIM_TEAM_MESSAGE_MUTE_MODE_OFF",e[e.V2NIM_TEAM_MESSAGE_MUTE_MODE_ON=1]="V2NIM_TEAM_MESSAGE_MUTE_MODE_ON",e[e.V2NIM_TEAM_MESSAGE_MUTE_MODE_NORMAL_ON=2]="V2NIM_TEAM_MESSAGE_MUTE_MODE_NORMAL_ON"}($d||($d={})),function(e){e[e.V2NIM_P2P_MESSAGE_MUTE_MODE_OFF=0]="V2NIM_P2P_MESSAGE_MUTE_MODE_OFF",e[e.V2NIM_P2P_MESSAGE_MUTE_MODE_ON=1]="V2NIM_P2P_MESSAGE_MUTE_MODE_ON"}(Zd||(Zd={})),function(e){e[e.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_ALL=0]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_ALL",e[e.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_NORMAL=1]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_NORMAL",e[e.V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_MANAGER=2]="V2NIM_TEAM_MEMBER_ROLE_QUERY_TYPE_MANAGER"}(el||(el={})),function(e){e[e.V2NIM_TEAM_TYPE_INVALID=0]="V2NIM_TEAM_TYPE_INVALID",e[e.V2NIM_TEAM_TYPE_ADVANCED=1]="V2NIM_TEAM_TYPE_ADVANCED",e[e.V2NIM_TEAM_TYPE_SUPER=2]="V2NIM_TEAM_TYPE_SUPER"}(tl||(tl={})),function(e){e[e.V2NIM_TEAM_JOIN_MODE_FREE=0]="V2NIM_TEAM_JOIN_MODE_FREE",e[e.V2NIM_TEAM_JOIN_MODE_APPLY=1]="V2NIM_TEAM_JOIN_MODE_APPLY",e[e.V2NIM_TEAM_JOIN_MODE_INVITE=2]="V2NIM_TEAM_JOIN_MODE_INVITE"}(rl||(rl={})),function(e){e[e.V2NIM_TEAM_AGREE_MODE_AUTH=0]="V2NIM_TEAM_AGREE_MODE_AUTH",e[e.V2NIM_TEAM_AGREE_MODE_NO_AUTH=1]="V2NIM_TEAM_AGREE_MODE_NO_AUTH"}(nl||(nl={})),function(e){e[e.V2NIM_TEAM_INVITE_MODE_MANAGER=0]="V2NIM_TEAM_INVITE_MODE_MANAGER",e[e.V2NIM_TEAM_INVITE_MODE_ALL=1]="V2NIM_TEAM_INVITE_MODE_ALL"}(il||(il={})),function(e){e[e.V2NIM_TEAM_UPDATE_INFO_MODE_MANAGER=0]="V2NIM_TEAM_UPDATE_INFO_MODE_MANAGER",e[e.V2NIM_TEAM_UPDATE_INFO_MODE_ALL=1]="V2NIM_TEAM_UPDATE_INFO_MODE_ALL"}(ol||(ol={})),function(e){e[e.V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN=0]="V2NIM_TEAM_CHAT_BANNED_MODE_UNBAN",e[e.V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_NORMAL=1]="V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_NORMAL",e[e.V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_ALL=2]="V2NIM_TEAM_CHAT_BANNED_MODE_BANNED_ALL"}(al||(al={})),function(e){e[e.V2NIM_TEAM_UPDATE_EXTENSION_MODE_MANAGER=0]="V2NIM_TEAM_UPDATE_EXTENSION_MODE_MANAGER",e[e.V2NIM_TEAM_UPDATE_EXTENSION_MODE_ALL=1]="V2NIM_TEAM_UPDATE_EXTENSION_MODE_ALL"}(sl||(sl={})),function(e){e[e.V2NIM_TEAM_MEMBER_ROLE_NORMAL=0]="V2NIM_TEAM_MEMBER_ROLE_NORMAL",e[e.V2NIM_TEAM_MEMBER_ROLE_OWNER=1]="V2NIM_TEAM_MEMBER_ROLE_OWNER",e[e.V2NIM_TEAM_MEMBER_ROLE_MANAGER=2]="V2NIM_TEAM_MEMBER_ROLE_MANAGER"}(cl||(cl={})),function(e){e[e.V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION=0]="V2NIM_TEAM_JOIN_ACTION_TYPE_APPLICATION",e[e.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_APPLICATION=1]="V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_APPLICATION",e[e.V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION=2]="V2NIM_TEAM_JOIN_ACTION_TYPE_INVITATION",e[e.V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_INVITATION=3]="V2NIM_TEAM_JOIN_ACTION_TYPE_REJECT_INVITATION"}(ul||(ul={})),function(e){e[e.V2NIM_TEAM_JOIN_ACTION_STATUS_INIT=0]="V2NIM_TEAM_JOIN_ACTION_STATUS_INIT",e[e.V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED=1]="V2NIM_TEAM_JOIN_ACTION_STATUS_AGREED",e[e.V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED=2]="V2NIM_TEAM_JOIN_ACTION_STATUS_REJECTED",e[e.V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED=3]="V2NIM_TEAM_JOIN_ACTION_STATUS_EXPIRED"}(dl||(dl={})),function(e){e[e.teamApply=0]="teamApply",e[e.teamApplyReject=1]="teamApplyReject",e[e.teamInvite=2]="teamInvite",e[e.teamInviteReject=3]="teamInviteReject",e[e.tlistUpdate=4]="tlistUpdate",e[e.superTeamApply=15]="superTeamApply",e[e.superTeamApplyReject=16]="superTeamApplyReject",e[e.superTeamInvite=17]="superTeamInvite",e[e.superTeamInviteReject=18]="superTeamInviteReject"}(ll||(ll={})),function(e){e[e.V2NIM_AI_MODEL_TYPE_UNKNOW=0]="V2NIM_AI_MODEL_TYPE_UNKNOW",e[e.V2NIM_AI_MODEL_TYPE_QWEN=1]="V2NIM_AI_MODEL_TYPE_QWEN",e[e.V2NIM_AI_MODEL_TYPE_AZURE=2]="V2NIM_AI_MODEL_TYPE_AZURE",e[e.V2NIM_AI_MODEL_TYPE_PRIVATE=3]="V2NIM_AI_MODEL_TYPE_PRIVATE"}(pl||(pl={})),function(e){e.V2NIM_AI_MODEL_ROLE_TYPE_SYSTEM="system",e.V2NIM_AI_MODEL_ROLE_TYPE_USER="user",e.V2NIM_AI_MODEL_ROLE_TYPE_ASSISTANT="assistant"}(ml||(ml={})),function(e){e[e.V2NIM_SIGNALLING_EVENT_TYPE_UNKNOWN=0]="V2NIM_SIGNALLING_EVENT_TYPE_UNKNOWN",e[e.V2NIM_SIGNALLING_EVENT_TYPE_CLOSE=1]="V2NIM_SIGNALLING_EVENT_TYPE_CLOSE",e[e.V2NIM_SIGNALLING_EVENT_TYPE_JOIN=2]="V2NIM_SIGNALLING_EVENT_TYPE_JOIN",e[e.V2NIM_SIGNALLING_EVENT_TYPE_INVITE=3]="V2NIM_SIGNALLING_EVENT_TYPE_INVITE",e[e.V2NIM_SIGNALLING_EVENT_TYPE_CANCEL_INVITE=4]="V2NIM_SIGNALLING_EVENT_TYPE_CANCEL_INVITE",e[e.V2NIM_SIGNALLING_EVENT_TYPE_REJECT=5]="V2NIM_SIGNALLING_EVENT_TYPE_REJECT",e[e.V2NIM_SIGNALLING_EVENT_TYPE_ACCEPT=6]="V2NIM_SIGNALLING_EVENT_TYPE_ACCEPT",e[e.V2NIM_SIGNALLING_EVENT_TYPE_LEAVE=7]="V2NIM_SIGNALLING_EVENT_TYPE_LEAVE",e[e.V2NIM_SIGNALLING_EVENT_TYPE_CONTROL=8]="V2NIM_SIGNALLING_EVENT_TYPE_CONTROL"}(hl||(hl={})),function(e){e[e.V2NIM_SIGNALLING_CHANNEL_TYPE_AUDIO=1]="V2NIM_SIGNALLING_CHANNEL_TYPE_AUDIO",e[e.V2NIM_SIGNALLING_CHANNEL_TYPE_VIDEO=2]="V2NIM_SIGNALLING_CHANNEL_TYPE_VIDEO",e[e.V2NIM_SIGNALLING_CHANNEL_TYPE_CUSTOM=3]="V2NIM_SIGNALLING_CHANNEL_TYPE_CUSTOM"}(fl||(fl={})),function(e){e[e.V2NIM_USER_STATUS_TYPE_UNKNOWN=0]="V2NIM_USER_STATUS_TYPE_UNKNOWN",e[e.V2NIM_USER_STATUS_TYPE_LOGIN=1]="V2NIM_USER_STATUS_TYPE_LOGIN",e[e.V2NIM_USER_STATUS_TYPE_LOGOUT=2]="V2NIM_USER_STATUS_TYPE_LOGOUT",e[e.V2NIM_USER_STATUS_TYPE_DISCONNECT=3]="V2NIM_USER_STATUS_TYPE_DISCONNECT"}(gl||(gl={}));var Il={V2NIM_ERROR_CODE_UNKNOWN:{code:0,message:"unknown error"},V2NIM_ERROR_CODE_SUCCESS:{code:200,message:"success"},V2NIM_ERROR_CODE_HANDSHAKE:{code:201,message:"handshake error"},V2NIM_ERROR_CODE_REQUEST_TEMPERARY_FORBIDDEN:{code:398,message:"request temprary forbidden"},V2NIM_ERROR_CODE_SERVER_UNIT_ERROR:{code:399,message:"server unit error"},V2NIM_ERROR_CODE_FORBIDDEN:{code:403,message:"forbidden"},V2NIM_ERROR_CODE_NOT_FOUND:{code:404,message:"not found"},V2NIM_ERROR_CODE_PARAMETER_ERROR:{code:414,message:"parameter error"},V2NIM_ERROR_CODE_RATE_LIMIT_REACHED:{code:416,message:"rate limit reached"},V2NIM_ERROR_CODE_MULTI_LOGIN_FORBIDDEN:{code:417,message:"multi login forbidden"},V2NIM_ERROR_CODE_SERVER_INTERNAL_ERROR:{code:500,message:"server internal error"},V2NIM_ERROR_CODE_SERVER_BUSY:{code:503,message:"server busy"},V2NIM_ERROR_CODE_APP_UNREACHABLE:{code:511,message:"app server unreachable"},V2NIM_ERROR_CODE_SERVICE_UNAVAILABLE:{code:514,message:"service unavailable"},V2NIM_ERROR_CODE_PROTOCOL_BLACKHOLE_FILTERED:{code:599,message:"protocol filtered by blackhole rule"},V2NIM_ERROR_CODE_NO_PERMISSION:{code:997,message:"appid has no permission to call the protocol"},V2NIM_ERROR_CODE_UNPACK_ERROR:{code:998,message:"unpack error"},V2NIM_ERROR_CODE_PACK_ERROR:{code:999,message:"pack error"},V2NIM_ERROR_CODE_IM_DISABLED:{code:101301,message:"IM disabled"},V2NIM_ERROR_CODE_SERVICE_ADDRESS_INVALID:{code:101302,message:"service address invalid"},V2NIM_ERROR_CODE_APPKEY_NOT_EXIST:{code:101303,message:"appkey not exist"},V2NIM_ERROR_CODE_BUNDLEID_CHECK_FAILED:{code:101304,message:"bundleid check failed"},V2NIM_ERROR_CODE_APPKEY_BLOCKED:{code:101403,message:"appkey blocked"},V2NIM_ERROR_CODE_INVALID_TOKEN:{code:102302,message:"invalid token"},V2NIM_ERROR_CODE_ROBOT_NOT_ALLOWED:{code:102303,message:"robot not allowed"},V2NIM_ERROR_CODE_ACCOUNT_NOT_EXIST:{code:102404,message:"account not exist"},V2NIM_ERROR_CODE_ACCOUNT_CHAT_BANNED:{code:102421,message:"account chat banned"},V2NIM_ERROR_CODE_ACCOUNT_BANNED:{code:102422,message:"account banned"},V2NIM_ERROR_CODE_ACCOUNT_IN_BLOCK_LIST:{code:102426,message:"account in block list"},V2NIM_ERROR_CODE_USER_PROFILE_NOT_EXIST:{code:103404,message:"user profile not exist"},V2NIM_ERROR_CODE_USER_PROFILE_HIT_ANTISPAM:{code:103451,message:"user profile hit antispam"},V2NIM_ERROR_CODE_PEER_FRIEND_LIMIT:{code:104301,message:"peer friend limit"},V2NIM_ERROR_CODE_FRIEND_APPLICATION_NOT_EXIST:{code:104302,message:"friend application not exist"},V2NIM_ERROR_CODE_FRIEND_NOT_EXIST:{code:104404,message:"friend not exist"},V2NIM_ERROR_CODE_FRIEND_ALREADY_EXIST:{code:104405,message:"friend already exist"},V2NIM_ERROR_CODE_SELF_FRIEND_OPERATION_NOT_ALLOWED:{code:104429,message:"self friend operation not allowed"},V2NIM_ERROR_CODE_FRIEND_LIMIT:{code:104435,message:"friend limit"},V2NIM_ERROR_CODE_FRIEND_OPERATION_RATE_LIMIT:{code:104449,message:"friend operation rate limit"},V2NIM_ERROR_CODE_FRIEND_HIT_ANTISPAM:{code:104451,message:"friend hit antispam"},V2NIM_ERROR_CODE_SELF_MUTE_OPERATION_NOT_ALLOWED:{code:105429,message:"self mute operation not allowed"},V2NIM_ERROR_CODE_MUTE_LIST_LIMIT:{code:105435,message:"mute list limit"},V2NIM_ERROR_CODE_SELF_BLOCK_LIST_OPERATION_NOT_ALLOWED:{code:106429,message:"self block list operation not allowed"},V2NIM_ERROR_CODE_BLOCK_LIST_LIMIT:{code:106435,message:"block list limit"},V2NIM_ERROR_CODE_REVOKE_THIRD_PARTY_MESSAGE_NOT_ALLOWED:{code:107301,message:"revoke third party message not allowed"},V2NIM_ERROR_CODE_SHORT_TO_LONG_URL_FAILED:{code:107307,message:"short to long URL failed"},V2NIM_ERROR_CODE_URL_INVALID:{code:107308,message:"URL invalid"},V2NIM_ERROR_CODE_DURATION_OUT_OF_RANGE:{code:107309,message:"duration out of range"},V2NIM_ERROR_CODE_GET_FILE_META_INFO_FAILED:{code:107310,message:"get file meta info failed"},V2NIM_ERROR_CODE_AUDIO_FILE_SIZE_LIMIT:{code:107311,message:"audio file size limit"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_TIMEOUT:{code:107312,message:"voice to text timeout"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_FAILED:{code:107313,message:"voice to text failed"},V2NIM_ERROR_CODE_REVOKE_EXCEED_TIME_LIMIT:{code:107314,message:"revoke message exceed time limit"},V2NIM_ERROR_CODE_REVOKE_MESSAGE_NOT_ALLOWED:{code:107315,message:"revoke specific message not allowed"},V2NIM_ERROR_CODE_FORCE_PUSH_LIST_LIMIT:{code:107316,message:"force push list limit"},V2NIM_ERROR_CODE_TEAM_MESSAGE_RECEIPT_RATE_LIMIT:{code:107317,message:"team message receipt rate limit"},V2NIM_ERROR_CODE_SNAPSHOT_NOT_EXIST:{code:107318,message:"snapshot not exist"},V2NIM_ERROR_CODE_PIN_LIMIT:{code:107319,message:"pin limit"},V2NIM_ERROR_CODE_PIN_NOT_EXIST:{code:107320,message:"pin not exist"},V2NIM_ERROR_CODE_QUICK_COMMENT_LIMIT:{code:107321,message:"quick comment limit"},V2NIM_ERROR_CODE_PIN_ALREADY_EXIST:{code:107322,message:"pin already exist"},V2NIM_ERROR_CODE_VOICE_TO_TEXT_FUNCTION_DISABLED:{code:107333,message:"voice to text function disabled"},V2NIM_ERROR_CODE_CLOUD_SEARCH_FUNCTION_DISABLED:{code:107334,message:"cloud search function disabled"},V2NIM_ERROR_CODE_ONE_WAY_DELETE_FUNCTION_DISABLED:{code:107335,message:"one-way delete function disabled"},V2NIM_ERRPR_CODE_ONEWAY_DELETION_NOT_ALLOW_FOR_TARGET_MESSAGES:{code:107338,message:"one-way deletion is not allowed for target messages"},V2NIM_ERRPR_CODE_SENDER_CANNOT_INCLUDED_IN_TARGET_LIST:{code:107339,message:"The message sender cannot be included in the target list"},V2NIM_ERROR_CODE_ROBOT_CANNOT_SEND_TARGET_MESSAGE:{code:107340,message:"Robot can not send target message"},V2NIM_ERROR_CODE_PIN_TARGET_MESSAGE_NOT_ALLOWED:{code:107345,message:"Pin target message is not allowed"},V2NIM_ERROR_CODE_TARGET_MESSAGE_NOT_ALLOWED_REPLY:{code:107346,message:"Target message not allowed reply"},V2NIM_ERROR_CODE_TARGET_MESSAGE_NOT_ALLOWED_QUICK_COMMENT:{code:107347,message:"Target message not allowed quick comment"},V2NIM_ERROR_CODE_REVOKE_MESSAGE_TO_SELF_NOT_ALLOWED:{code:107429,message:"revoke message to self not allowed"},V2NIM_ERROR_CODE_APP_CHAT_BANNED:{code:107410,message:"app chat banned"},V2NIM_ERROR_CODE_QUICK_COMMENT_FUNCTION_DISABLED:{code:107326,message:"quick comment function disabled"},V2NIM_ERROR_CODE_PIN_FUNCTION_DISABLED:{code:107327,message:"PIN function disabled"},V2NIM_ERROR_CODE_TEAM_READ_RECEIPT_FUNCTION_DISABLED:{code:107324,message:"read receipt for team messages function disabled"},V2NIM_ERROR_CODE_P2P_READ_RECEIPT_FUNCTION_DISABLED:{code:107325,message:"read receipt for p2p messages function disabled"},V2NIM_ERROR_CODE_RATE_LIMIT_FOR_MESSAGING_REACHED:{code:107323,message:"rate limit for messaging reached"},V2NIM_ERROR_CODE_MESSAGE_HIT_ANTISPAM:{code:107451,message:"message hit antispam"},V2NIM_ERROR_CODE_MESSAGE_NOT_EXIST:{code:107404,message:"message not exist"},V2NIM_ERROR_CODE_UNSENDING_MESSAGE_EXPIRED:{code:107406,message:"unsending message expired"},V2NIM_ERROR_CODE_TEAM_MARK_READ_FAILED:{code:107302,message:"sending message failed for marking message read failed for too many team members"},V2NIM_ERROR_CODE_SENDER_OR_MANAGER_PERMISSION_ONLY_REVOKE:{code:107303,message:"only sender or manager can revoke message"},V2NIM_ERROR_CODE_DELETE_SELF_MESSAGE_NOT_ALLOWED:{code:107328,message:"delete self message not allowed"},V2NIM_ERROR_CODE_NOT_CHATBOT_ACCOUNT:{code:107329,message:"is not chatbot account"},V2NIM_ERROR_CODE_MESSAGE_SENSE_REQUIRED:{code:107330,message:"sender or receiver must sense message"},V2NIM_ERROR_CODE_HIGH_PRIORITY_MESSAGE_RATE_LIMIT:{code:107304,message:"rate limit of high-priority messages exceeded"},ACK_MESSAGE_BE_HIGH_PRIORITY:{code:107305,message:"ack message should be high-priority"},V2NIM_ERROR_CODE_DUPLICATE_CLIENT_MESSAGE_ID:{code:107306,message:"duplicate client message ID"},V2NIM_ERROR_CODE_INVALID_TIME_RANGE:{code:107439,message:"invalid time range"},V2NIM_ERROR_CODE_NOT_ADVANCED_TEAM:{code:108302,message:"not advanced team"},V2NIM_ERROR_CODE_TEAM_MANAGER_LIMIT:{code:108303,message:"team manager limit"},V2NIM_ERROR_CODE_JOINED_TEAM_LIMIT:{code:108305,message:"joined team limit"},V2NIM_ERROR_CODE_TEAM_NORMAL_MEMBER_CHAT_BANNED:{code:108306,message:"team normal member chat banned"},V2NIM_ERROR_CODE_INVITED_ACCOUNT_NOT_FRIEND:{code:108307,message:"invited account not friend"},V2NIM_ERROR_CODE_REJECT_ALL_TEAM_APPLICATIONS:{code:108308,message:"reject all team applications"},V2NIM_ERROR_CODE_TARGETING_MESSAGE_FOR_TEAM_DISABLED:{code:108318,message:"Targeting messages for group chat is disabled"},V2NIM_ERROR_CODE_INCLUSIVE_AS_FALSE_NOT_ALLOWED_FOR_SUPER_TEAM:{code:108319,message:'Setting "inclusive" to false for super teams is not allowed'},V2NIM_ERROR_CODE_CANNOT_MAKE_SUPER_TEAM_MESSAGE_VISIBLE_TO_NEW_MEMBERS:{code:108320,message:"Cannot make super team targeted messages visible to new members"},V2NIM_ERROR_CODE_CANNOT_ALLOW_TARGETED_MESSAGES_INCLUSIVE_TO_NEW_MEMBERS:{code:108321,message:"Cannot allow targeted messages inclusive to new members"},V2NIM_ERROR_CODE_TEAM_NOT_EXIST:{code:108404,message:"team not exist"},V2NIM_ERROR_CODE_TEAM_ALREADY_CHAT_BANNED:{code:108420,message:"team already chat banned"},V2NIM_ERROR_CODE_ALL_TEAM_MEMBER_CHAT_BANNED:{code:108423,message:"all team member chat banned"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_LIMIT:{code:108434,message:"extended super team limit"},V2NIM_ERROR_CODE_CREATED_TEAM_LIMIT:{code:108435,message:"created team limit"},V2NIM_ERROR_CODE_TEAM_INVITATION_LIMIT:{code:108437,message:"team invitation limit"},V2NIM_ERROR_CODE_TEAM_HIT_ANTISPAM:{code:108451,message:"team hit antispam"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_LIMIT_NOT_CONFIGURED:{code:108304,message:"extended super team limit not configured"},V2NIM_ERROR_CODE_SUPER_TEAM_SERVICE_DISABLED:{code:108311,message:"super team service disabled"},V2NIM_ERROR_CODE_TEAM_READ_RECEIPT_RECORD_NOT_FOUND:{code:108301,message:"read receipt record for the team message not found"},V2NIM_ERROR_CODE_NOT_MANAGER:{code:108430,message:"unable to assign owner manager"},V2NIM_ERROR_CODE_ONLINE_MEMBER_COUNT_DISABLED:{code:108406,message:"number of online users service disabled"},V2NIM_ERROR_CODE_TRANSFER_DISABLED:{code:108310,message:"unable to transfer the ownership to owner"},V2NIM_ERROR_CODE_CREATE_TEAM_DISABLED:{code:108309,message:"unable to create team with more than %s people"},V2NIM_ERROR_CODE_EXTENDED_SUPER_TEAM_CREATE_FAILED:{code:108313,message:"/ extended super team creation failed，use open api to create the team"},V2NIM_ERROR_CODE_TEAM_MESSAGE_READ_RECEIPT_DISABLED:{code:108312,message:"read receipt for team messages function disabled"},V2NIM_ERROR_CODE_RETRY:{code:108449,message:"an error occurred, try again"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_NOT_TEAM_MEMBER:{code:109301,message:"list of chat banned users contains non team members"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_OPERATOR:{code:109303,message:"list of chat banned users contains the operator"},V2NIM_ERROR_CODE_CHAT_BAN_LIST_CONTAIN_TEAM_OWNER:{code:109304,message:"list of chat banned users contains the team owner"},V2NIM_ERROR_CODE_OPERATION_ON_TEAM_MANAGER_NOT_ALLOWED:{code:109305,message:"operation on team manager not allowed"},V2NIM_ERROR_CODE_NO_TEAM_INVITE_PERMISSION:{code:109306,message:"no team invite permission"},V2NIM_ERROR_CODE_TEAM_OWNER_QUIT_NOT_ALLOWED:{code:109307,message:"team owner quit not allowed"},V2NIM_ERROR_CODE_TEAM_OWNER_IN_KICK_LIST:{code:109308,message:"list of kicked user contains the team owner"},V2NIM_ERROR_CODE_INVITE_ROBOT_ACCOUNT_NOT_ALLOWED:{code:109309,message:"invite robot account not allowed"},V2NIM_ERROR_CODE_KICK_OPERATOR_NOT_ALLOWED:{code:109310,message:"kick operator not allowed"},V2NIM_ERROR_CODE_TEAM_MEMBER_ALREADY_EXIST:{code:109311,message:"team member already exist"},V2NIM_ERROR_CODE_TEAM_INVITATION_OR_APPLICATION_NOT_EXIST:{code:109313,message:"team invitation or application not exist"},V2NIM_ERROR_CODE_OPERATION_ON_TEAM_OWNER_NOT_ALLOWED:{code:109314,message:"operation on team owner not allowed"},V2NIM_ERROR_CODE_FORCED_PUSH_LIST_INCLUDES_NON_TARGETED_ACCOUNTS:{code:109318,message:"The forced push list includes non-targeted accounts"},V2NIM_ERROR_CODE_TEAM_MEMBER_NOT_EXIST:{code:109404,message:"team member not exist"},V2NIM_ERROR_CODE_TEAM_MEMBER_CHAT_BANNED:{code:109424,message:"team member chat banned"},V2NIM_ERROR_CODE_TEAM_OWNER_OPERATION_PERMISSION_REQUIRED:{code:109427,message:"team owner operation permission required"},V2NIM_ERROR_CODE_TEAM_OWNER_OR_MANAGER_OPERATION_PERMISSION_REQUIRED:{code:109432,message:"team owner or manager operation permission required"},V2NIM_ERROR_CODE_TEAM_MEMBER_CONCURRENT_OPERATION_FAILED:{code:109449,message:"team member concurrent operation failed"},V2NIM_ERROR_CODE_TEAM_MEMBER_HIT_ANTISPAM:{code:109451,message:"team member hit antispam"},V2NIM_ERROR_CODE_CONVERSATION_AND_ACCOUNT_MISMATCH:{code:110302,message:"conversation and account mismatch"},V2NIM_ERROR_CODE_CONVERSATION_STICK_TOP_LIMIT:{code:110303,message:"conversation stick top limit"},V2NIM_ERROR_CODE_CONVERSATION_BELONGED_GROUP_LIMIT:{code:110304,message:"conversation belonged group limit"},V2NIM_ERROR_CODE_CONVERSATION_NOT_EXIST:{code:110404,message:"conversation not exist"},V2NIM_ERROR_CODE_CHATROOM_LINK_UNAVAILABLE:{code:113304,message:"chatroom link unavailable"},V2NIM_ERROR_CODE_IM_CONNECTION_ABNORMAL:{code:113305,message:"IM connection abnormal"},V2NIM_ERROR_CODE_CHATROOM_NOT_EXIST:{code:113404,message:"chatroom not exist"},V2NIM_ERROR_CODE_CHATROOM_CLOSED:{code:113406,message:"chatroom closed"},V2NIM_ERROR_CODE_CHATROOM_REPEATED_OPERATION:{code:113409,message:"chatroom repeated operation"},V2NIM_ERROR_CODE_CHATROOM_DISABLED:{code:113410,message:"chatroom disabled"},V2NIM_ERROR_CODE_ALL_CHATROOM_MEMBER_CHAT_BANNED:{code:113423,message:"all chatroom member chat banned"},V2NIM_ERROR_CODE_CHATROOM_HIT_ANTISPAM:{code:113451,message:"chatroom hit antispam"},V2NIM_ERROR_CODE_ANONYMOUS_MEMBER_FORBIDDEN:{code:114303,message:"anonymous member forbidden"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_NOT_EXIST:{code:114404,message:"chatroom member not exist"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_REPEATED_OPERATION:{code:114405,message:"chatroom member repeated operation"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_CHAT_BANNED:{code:114421,message:"chatroom member chat banned"},V2NIM_ERROR_CODE_ACCOUNT_IN_CHATROOM_BLOCK_LIST:{code:114426,message:"account in chatroom block list"},V2NIM_ERROR_CODE_CHATROOM_OWNER_OPERATION_PERMISSION_REQUIRED:{code:114427,message:"chatroom owner operation permission required"},V2NIM_ERROR_CODE_SELF_IN_CHATROOM_MEMBER_OPERATION_LIST:{code:114429,message:"self in chatroom member operation list"},V2NIM_ERROR_CODE_CHATROOM_OWNER_OR_MANAGER_OPERATION_PERMISSION_REQUIRED:{code:114432,message:"chatroom owner or manager operation permission required"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_LIMIT:{code:114437,message:"chatroom member limit"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_CONCURRENT_OPERATION_FAILED:{code:114449,message:"chatroom member concurrent operation failed"},V2NIM_ERROR_CODE_CHATROOM_MEMBER_HIT_ANTISPAM:{code:114451,message:"chatroom member hit antispam"},V2NIM_ERROR_CODE_CONVERSATION_GROUP_NOT_EXIST:{code:116404,message:"conversation group not exist"},V2NIM_ERROR_CODE_CONVERSATION_GROUP_LIMIT:{code:116435,message:"conversation group limit"},V2NIM_ERROR_CODE_CONVERSATIONS_IN_GROUP_LIMIT:{code:116437,message:"conversations in group limit"},V2NIM_ERROR_CODE_COLLECTION_LIMIT:{code:189301,message:"collection limit"},V2NIM_ERROR_CODE_COLLECTION_NOT_EXIST:{code:189302,message:"collection not exist"},V2NIM_ERROR_CODE_COLLECTION_CONCURRENT_OPERATION_FAILED:{code:189449,message:"collection concurrent operation failed"},V2NIM_ERROR_CODE_INTERNAL:{code:190001,message:"internal error"},V2NIM_ERROR_CODE_ILLEGAL_STATE:{code:190002,message:"illegal state"},V2NIM_ERROR_CODE_MISUSE:{code:191001,message:"misuse"},V2NIM_ERROR_CODE_CANCELLED:{code:191002,message:"operation cancelled"},V2NIM_ERROR_CODE_CALLBACK_FAILED:{code:191003,message:"callback failed"},V2NIM_ERROR_CODE_INVALID_PARAMETER:{code:191004,message:"invalid parameter"},V2NIM_ERROR_CODE_TIMEOUT:{code:191005,message:"timeout"},V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST:{code:191006,message:"resource not exist"},V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST:{code:191007,message:"resource already exist"},V2NIM_ERROR_CODE_CONNECT_FAILED:{code:192001,message:"connect failed"},V2NIM_ERROR_CODE_CONNECT_TIMEOUT:{code:192002,message:"connect timeout"},V2NIM_ERROR_CODE_DISCONNECT:{code:192003,message:"disconnect"},V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT:{code:192004,message:"protocol timeout"},V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED:{code:192005,message:"protocol send failed"},V2NIM_ERROR_CODE_REQUEST_FAILED:{code:192006,message:"request failed"},V2NIM_ERROR_CODE_FILE_NOT_FOUND:{code:194001,message:"file not found"},V2NIM_ERROR_CODE_FILE_CREATE_FAILED:{code:194002,message:"file create failed"},V2NIM_ERROR_CODE_FILE_OPEN_FAILED:{code:194003,message:"file open failed"},V2NIM_ERROR_CODE_FILE_WRITE_FAILED:{code:194004,message:"file write failed"},V2NIM_ERROR_CODE_FILE_READ_FAILED:{code:194005,message:"file read failed"},V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:{code:194006,message:"file upload failed"},V2NIM_ERROR_CODE_FILE_DOWNLOAD_FAILED:{code:194007,message:"file download failed"},V2NIM_ERROR_CODE_CLIENT_ANTISPAM:{code:195001,message:"client anti-spam"},V2NIM_ERROR_CODE_SERVER_ANTISPAM:{code:195002,message:"server anti-spam"}},Sl=fr(Il),Tl=Ml(Sl).call(Sl,(function(e,t){var r=Il[t];return e[t]=r.code,e}),{}),bl=Ml(Sl).call(Sl,(function(e,t){var r=Il[t];return e[r.code]=r.message,e}),{}),Cl=Object.freeze({__proto__:null,V2NIMErrorCode:Tl,V2NIMErrorDesc:bl,get V2NIMDataSyncLevel(){return Cd},get V2NIMDataSyncType(){return _d},get V2NIMDataSyncState(){return Ed},get V2NIMConversationType(){return wd},get V2NIMLastMessageState(){return Rd},get V2NIMFriendAddMode(){return kd},get V2NIMFriendAddApplicationType(){return Ad},get V2NIMFriendAddApplicationStatus(){return Nd},get V2NIMFriendDeletionType(){return xd},get V2NIMFriendVerifyType(){return Od},get V2NIMLoginAuthType(){return Pd},get V2NIMLoginStatus(){return Ld},get V2NIMLoginClientType(){return Vd},get V2NIMKickedOfflineReason(){return Ud},get V2NIMLoginClientChange(){return Dd},get V2NIMConnectStatus(){return qd},get V2NIMMessageType(){return Fd},get V2NIMMessageNotificationType(){return Gd},get V2NIMMessageAttachmentUploadState(){return jd},get V2NIMMessageSendingState(){return Hd},get V2NIMQueryDirection(){return Wd},get V2NIMMessageRevokeType(){return Kd},get V2NIMMessagePinState(){return Yd},get V2NIMMessageQuickCommentType(){return Qd},get V2NIMClientAntispamOperateType(){return Jd},get V2NIMSortOrder(){return zd},get V2NIMSystemMessageType(){return Xd},get V2NIMTeamMessageMuteMode(){return $d},get V2NIMP2PMessageMuteMode(){return Zd},get V2NIMTeamMemberRoleQueryType(){return el},get V2NIMTeamType(){return tl},get V2NIMTeamJoinMode(){return rl},get V2NIMTeamAgreeMode(){return nl},get V2NIMTeamInviteMode(){return il},get V2NIMTeamUpdateInfoMode(){return ol},get V2NIMTeamChatBannedMode(){return al},get V2NIMTeamUpdateExtensionMode(){return sl},get V2NIMTeamJoinActionType(){return ul},get V2NIMTeamJoinActionStatus(){return dl},get V2NIMTeamNotificationType(){return ll},get V2NIMTeamMemberRole(){return cl},get V2NIMAIModelRoleType(){return ml},get V2NIMAIModelType(){return pl},get V2NIMSignallingChannelType(){return fl},get V2NIMSignallingEventType(){return hl},get V2NIMUserStatusType(){return gl}}),_l=function(e){function t(t){var r;return(r=e.call(this,t.desc)||this).name="V2NIMError",r.code=t.code||0,r.desc=t.desc||bl[r.code]||Nl[r.code]||"",r.message=r.desc,r.detail=t.detail||{},r}return nr(t,e),t.prototype.toString=function(){var e,t=this.name+"\n code: "+this.code+'\n message: "'+this.message+'"\n detail: '+(this.detail?_i(this.detail):"");return(null===(e=null==this?void 0:this.detail)||void 0===e?void 0:e.rawError)&&(t+="\n rawError: "+this.detail.rawError.message),t},t}(Md(Error)),El=function(e){function t(t,r,n){var i;return void 0===r&&(r={}),(i=e.call(this,{code:Tl.V2NIM_ERROR_CODE_PARAMETER_ERROR,detail:{reason:t,rules:n,data:r}})||this).name="validateError",i.message=i.message+"\n"+_i(i.detail,null,2),i.data=r,i.rules=n,i}return nr(t,e),t}(_l),wl=function(e){function t(t){var r,n,i,o;return(r=e.call(this,{code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:null===(n=t.detail)||void 0===n?void 0:n.reason,rules:null===(i=t.detail)||void 0===i?void 0:i.rules,data:null===(o=t.detail)||void 0===o?void 0:o.data}})||this).name="ValidateErrorV2",r}return nr(t,e),t}(_l),Rl=function(e){function t(t,r,n){var i;return(i=e.call(this,{code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:t,key:r,rules:n}})||this).name="formatError",i}return nr(t,e),t}(_l),kl=function(e){function t(t){var r;return(r=e.call(this,dr({code:400},t))||this).desc=r.desc||"upload file error",r.message=r.desc,r.name="uploadError",r}return nr(t,e),t}(_l),Al=function(e){function t(t,r,n){var i;return void 0===r&&(r={}),void 0===n&&(n=400),(i=e.call(this,{code:n,desc:t,detail:r})||this).name="customError",i.data=r,i}return nr(t,e),t}(_l),Nl={200:null,406:null,808:null,810:null,302:"The user name or password is incorrect.",405:"Parameter length too long",408:"Client request timed out",415:"Client network unavailable",422:"Account disabled",508:"Expiration date",509:"Invalid",7101:"Be pulled black",700:"Partial failure of batch operation",801:"The number of people in the team has reached the upper limit",802:"No permission",803:"The team does not exist or has not changed",804:"The user is not in the team",805:"Team type mismatch",806:"The number of teams created has reached the limit",807:"Team member not valid",809:"Already in the team",811:"The number of accounts in the forced push list exceeds the limit",812:"The team is muted",813:"Due to the limited number of team, some pull people successfully",814:"Disable team message read service",815:"Maximum number of team administrators",816:"Batch operation partial failure",9102:"Channel failure",9103:"This call has been answered / rejected at another end",10201:"Signaling: target NIM client is offline",10202:"Signaling: push is unreachable",10404:"Signaling: channel not exists",10405:"Signaling: channel already exists",10406:"Signaling: member of channel not exists",10407:"Signaling: member of channel already exists",10408:"Signaling: the invitation request does not exist or has expired",10409:"Signaling: the invitation request has been rejected",10410:"Signaling: the invitation request has been accepted",10414:"Signaling: request parameter error",10417:"Signaling: uid conflict",10419:"Signaling: the number of members of channel exceed the limit",10420:"Signaling: member is already in the channel on other client",10700:"Signaling: phased success",13002:"Abnormal chatroom status",13003:"In the blacklist",13004:"In the mute list",13006:"All members are muted, and only the administrator can speak"};function xl(e,t){return t=t||[],fu(e=e||[]).call(e,(function(e){return-1===wu(t).call(t,e)}))}function Ol(e,t){return t instanceof RegExp?"__REGEXP "+t.toString():t}function Pl(e,t,r,n){var i;void 0===t&&(t={}),void 0===n&&(n=!1);var o={};return jn(i=fr(e)).call(i,(function(i){var a=e[i].type,s=r?"In "+r+", ":"";if(null==t){var c=s+"param is null or undefined";throw n?new wl({detail:{reason:c,data:{key:i},rules:"required"}}):new El(c,{key:i},"required")}if(void 0===t[i]){if(!1===e[i].required)return void(o[i]=t[i]);var u=s+"param '"+i+"' is required";throw n?new wl({detail:{reason:u,data:{key:i},rules:"required"}}):new El(u,{key:i},"required")}var d=Ll[a];if(d&&!d(t,i,e[i],n)){var l=s+"param '"+i+"' unexpected",p={key:i,value:t[i]};throw n?new wl({detail:{reason:l,data:p,rules:_i(e[i],Ol)}}):new El(l,p,_i(e[i],Ol))}o[i]=t[i]})),o}var Ll={string:function(e,t,r){var n=r.allowEmpty,i=r.max,o=r.min,a=r.regExp,s=e[t];return!("string"!=typeof s||!1===n&&""===s||"number"==typeof i&&s.length>i||"number"==typeof o&&s.length<o||function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}(a)&&!a.test(s))},number:function(e,t,r){var n=r.min,i=r.max,o=e[t];return!("number"!=typeof o||"number"==typeof n&&o<n||"number"==typeof i&&o>i)},boolean:function(e,t){return"boolean"==typeof e[t]},file:function(e,t){return!0},enum:function(e,t,r){var n=Iu(r),i=e[t];return!n||wu(n).call(n,i)>-1},jsonstr:function(e,t){try{var r=JSON.parse(e[t]);return"object"==typeof r&&null!==r}catch(e){return!1}},func:function(e,t){return"function"==typeof e[t]},array:function(e,t,r,n){void 0===n&&(n=!1);var i=r.itemType,o=r.rules,a=r.min,s=r.max,c=Iu(r),u=e[t];return!(!Ei(u)||"number"==typeof s&&u.length>s||"number"==typeof a&&u.length<a||i&&"enum"!==i&&!xu(u).call(u,(function(e){return typeof e===i}))||"enum"===i&&c&&xl(u,c).length||(o&&jn(u).call(u,(function(e,r){return Pl(o,e,t+"["+r+"]",n)})),0))},object:function(e,t,r,n){void 0===n&&(n=!1);var i=r.rules,o=r.allowEmpty,a=e[t];if("object"!=typeof a||null===a)return!1;if(i){var s=fr(i),c=fr(a),u=fu(c).call(c,(function(e){return wu(s).call(s,e)>-1}));if(!1===o&&0===u.length)return!1;Pl(i,a,t,n)}return!0}};function Vl(e,t){if(!e)throw new _l({code:Tl.V2NIM_ERROR_CODE_ILLEGAL_STATE});Pl({conversationId:{type:"string",allowEmpty:!1,regExp:new RegExp("^"+e+"\\|[1-3]\\|")}},{conversationId:t},"",!0)}var Ul=function(e,t,r,n){try{return n?t(We(r)[0],r[1]):t(r)}catch(t){Wi(e,"throw",t)}},Dl=Array,ql=!Ja((function(e){Array.from(e)}));nt({target:"Array",stat:!0,forced:ql},{from:function(e){var t=le(e),r=An(this),n=arguments.length,i=n>1?arguments[1]:void 0,o=void 0!==i;o&&(i=Fe(i,n>2?arguments[2]:void 0));var a,s,c,u,d,l,p=Gi(t),m=0;if(!p||this===Dl&&Bi(p))for(a=Mt(t),s=r?new this(a):Dl(a);a>m;m++)l=o?i(t[m],m):t[m],ei(s,m,l);else for(d=(u=Hi(t,p)).next,s=r?new this:[];!(c=b(d,u)).done;m++)l=o?Ul(u,i,[c.value,m],!0):c.value,ei(s,m,l);return s.length=m,s}});var Bl=B.Array.from,Fl=Gi;function Gl(e,t){var r,n=void 0!==Nc&&Fl(e)||e["@@iterator"];if(n)return tr(r=(n=n.call(e)).next).call(r,n);if(Ei(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return jl(e,t);var n=Wc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Bl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?jl(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function jl(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var Hl=function(){function e(){this.timerList=[],this.id=1,this.timer=null,this.timeout=0}var t=e.prototype;return t.addTimer=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=1);var n=(new Date).getTime(),i=this.id;return this.timerList.push({id:i,loop:r,count:0,timeout:n+t,interval:t,callback:e}),this.id++,this.checkTimer(n),i},t.checkTimer=function(e){if(void 0===e&&(e=(new Date).getTime()),this.removeFinished(),0!==this.timerList.length||null==this.timer){for(var t,r,n=0,i=Gl(this.timerList);!(t=i()).done;){var o=t.value;(0===n||n>o.timeout)&&(n=o.timeout)}0!==this.timerList.length&&(null===this.timer||n<this.timeout||this.timeout<e)&&(this.timer=qs(tr(r=this.nowTime).call(r,this),n-e),this.timeout=n)}},t.nowTime=function(){for(var e,t=(new Date).getTime(),r=Gl(this.timerList);!(e=r()).done;){var n=e.value;t>=n.timeout&&(n.callback(),n.count++,n.timeout=t+n.interval)}this.clerTime(),this.checkTimer(t)},t.clerTime=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},t.deleteTimer=function(e){for(var t=this.timerList.length-1;t>=0;t--){var r;this.timerList[t].id===e&&di(r=this.timerList).call(r,t,1)}},t.removeFinished=function(){for(var e=this.timerList.length-1;e>=0;e--){var t,r=this.timerList[e];r.loop>=0&&r.count>=r.loop&&di(t=this.timerList).call(t,e,1)}},t.destroy=function(){this.clerTime(),this.timerList=[],this.id=1,this.timer=null},e}(),Wl=n((function(e){function t(r){return e.exports=t="function"==typeof Nc&&"symbol"==typeof Kc?function(e){return typeof e}:function(e){return e&&"function"==typeof Nc&&e.constructor===Nc&&e!==Nc.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})),Kl=n((function(e){var t=Wl.default;function r(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
e.exports=r=function(){return n},e.exports.__esModule=!0,e.exports.default=e.exports;var n={},i=Object.prototype,o=i.hasOwnProperty,a="function"==typeof Nc?Nc:{},s=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function d(e,t,r){return st(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(e){d=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i=t&&t.prototype instanceof h?t:h,o=Bt(i.prototype),a=new _(n||[]);return o._invoke=function(e,t,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return w()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=T(a,r);if(s){if(s===m)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=p(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===m)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,a),o}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}n.wrap=l;var m={};function h(){}function f(){}function g(){}var v={};d(v,s,(function(){return this}));var y=Oc&&Oc(Oc(E([])));y&&y!==i&&o.call(y,s)&&(v=y);var M=g.prototype=h.prototype=Bt(v);function I(e){var t;jn(t=["next","throw","return"]).call(t,(function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,r){function n(i,a,s,c){var u=p(e[i],e,a);if("throw"!==u.type){var d=u.arg,l=d.value;return l&&"object"==t(l)&&o.call(l,"__await")?r.resolve(l.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):r.resolve(l).then((function(e){d.value=e,s(d)}),(function(e){return n("throw",e,s,c)}))}c(u.arg)}var i;this._invoke=function(e,t){function o(){return new r((function(r,i){n(e,t,r,i)}))}return i=i?i.then(o,o):o()}}function T(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method))return m;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var n=p(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,m;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,m):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function _(e){this.tryEntries=[{tryLoc:"root"}],jn(e).call(e,b,this),this.reset(!0)}function E(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(o.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:w}}function w(){return{value:void 0,done:!0}}return f.prototype=g,d(M,"constructor",g),d(g,"constructor",f),f.displayName=d(g,u,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Ht?Ht(e,g):(e.__proto__=g,d(e,u,"GeneratorFunction")),e.prototype=Bt(M),e},n.awrap=function(e){return{__await:e}},I(S.prototype),d(S.prototype,c,(function(){return this})),n.AsyncIterator=S,n.async=function(e,t,r,i,o){void 0===o&&(o=fs);var a=new S(l(e,t,r,i),o);return n.isGeneratorFunction(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},I(M),d(M,u,"Generator"),d(M,s,(function(){return this})),d(M,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=[];for(var r in e)t.push(r);return Dc(t).call(t),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},n.values=E,_.prototype={constructor:_,reset:function(e){var t;if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,jn(t=this.tryEntries).call(t,C),!e)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+Wc(r).call(r,1))&&(this[r]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=o.call(i,"catchLoc"),c=o.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;C(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:E(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),m}},n}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})),Yl=Kl(),Ql=Yl;try{regeneratorRuntime=Yl}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=Yl:Function("r","regeneratorRuntime = r")(Yl)}function Jl(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}function zl(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(a,s)}c((n=n.apply(e,t||[])).next())}))}function Xl(e){return null!=e&&"object"==typeof e&&Oc(e)==Object.prototype}function $l(e,t){var r=Xl(e)||Ei(e),n=Xl(t)||Ei(t);if(r&&n){for(var i in t){var o=$l(e[i],t[i]);void 0!==o&&(e[i]=o)}return e}return t}var Zl={setLogger:function(e){throw new Error("setLogger not implemented.")},platform:"",WebSocket:function(){function e(e,t){throw this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,this.binaryType="",new Error("Method not implemented.")}var t=e.prototype;return t.close=function(e,t){throw new Error("Method not implemented.")},t.send=function(e){throw new Error("Method not implemented.")},t.onclose=function(e){throw new Error("Method not implemented.")},t.onerror=function(e){throw new Error("Method not implemented.")},t.onmessage=function(e){throw new Error("Method not implemented.")},t.onopen=function(e){throw new Error("Method not implemented.")},e}(),localStorage:{},request:function(e,t){throw new Error("request not implemented.")},uploadFile:function(e){throw new Error("uploadFile not implemented.")},getSystemInfo:function(){throw new Error("getSystemInfo not implemented.")},getFileUploadInformation:function(e){throw new Error("getFileUploadInformation not implemented.")},envPayload:{},net:{getNetworkStatus:function(){return fs.resolve({net_type:0,net_connect:!0})},onNetworkStatusChange:function(e){},offNetworkStatusChange:function(){}},logStorage:function(){function e(e){}var t=e.prototype;return t.open=function(){return fs.resolve()},t.close=function(){},t.addLogs=function(e){return fs.resolve()},t.extractLogs=function(){return fs.resolve()},e}()},ep=["error","warn","log","debug"],tp=function(){},rp=["off","error","warn","log","debug"],np=function(){function e(e,t){void 0===t&&(t={}),this.storageArr=[],this.debugLevel="off",this.timer=0,this.strategies={debug:{name:"debg",func:console.log},log:{name:"info",func:console.log},warn:{name:"warn",func:console.warn},error:{name:"erro",func:console.error}},this.debug=tp,this.log=tp,this.warn=tp,this.error=tp,this.iid=Math.round(1e3*Math.random()),this.debugLevel=ou(rp).call(rp,e)?e:"off",t.debugLevel&&(this.debugLevel=ou(rp).call(rp,t.debugLevel)?t.debugLevel:this.debugLevel),this.logStorage=!1===t.storageEnable?null:new Zl.logStorage(null==t?void 0:t.storageName),this.setOptions(t),this.setLogFunc(this.debugLevel),this.setTimer(),this.open()}var t=e.prototype;return t.getDebugMode=function(){return"debug"===this.debugLevel},t.open=function(e){var t=this;this.logStorage&&this.logStorage.open(e).then((function(){t.log("Logger::open success")})).catch((function(e){t.warn("Logger::open failed",e)}))},t.setOptions=function(e){if(e&&e.logFunc){var t=e.logFunc;for(var r in t){var n=r,i=t[n];i&&(this.strategies[n].func=i)}}},t.setLogFunc=function(e,t){var r=this;void 0===t&&(t="log");var n=Qn(ep).call(ep,(function(t){return t===e})),i=Qn(ep).call(ep,(function(e){return e===t}));jn(ep).call(ep,(function(e,t){r[e]=function(){if(!(t>n&&t>i)){var r=Wc(Array.prototype).call(arguments),o=this.strategies[e],a=this.formatArgs(r,o.name);t<=i&&this.logStorage&&this.prepareSaveLog(a,e),t<=n&&o.func(a)}}}))},t.extractLogs=function(){var e;return this.logStorage?null===(e=this.logStorage)||void 0===e?void 0:e.extractLogs():fs.resolve("")},t.prepareSaveLog=function(e,t){this.storageArr.push({text:e,level:t,time:_s(),iid:this.iid}),this.timer||this.setTimer(),this.storageArr.length>=100&&(this.triggerTimer(),this.storageArr=[])},t.saveLogs=function(){return zl(this,void 0,void 0,Ql.mark((function e(){var t;return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logStorage){e.next=2;break}return e.abrupt("return");case 2:return t=this.storageArr,this.storageArr=[],e.prev=4,e.next=7,this.logStorage.addLogs(t);case 7:e.next=11;break;case 9:e.prev=9,e.t0=e.catch(4);case 11:case"end":return e.stop()}}),e,this,[[4,9]])})))},t.clearTimer=function(){this.timer&&clearTimeout(this.timer),this.timer=0},t.setTimer=function(){var e;this.clearTimer(),this.timer=qs(tr(e=this.triggerTimer).call(e,this),5e3)},t.triggerTimer=function(){this.clearTimer(),this.saveLogs()},t.formatArgs=function(e,t){var r=new Date;return"[NIM "+this.iid+" "+t+" "+(r.getMonth()+1)+"-"+r.getDate()+" "+r.getHours()+":"+r.getMinutes()+":"+r.getSeconds()+":"+r.getMilliseconds()+"] "+du(e).call(e,(function(e){return e instanceof _l?e.toString():e instanceof Error?e&&e.message?e.message:e:"object"==typeof e?_i(e):e})).join(" ")},t.destroy=function(){this.debug=tp,this.log=tp,this.warn=tp,this.error=tp,this.saveLogs(),this.clearTimer(),this.storageArr=[],this.logStorage&&this.logStorage.close()},e}(),ip=Math.min,op=[].lastIndexOf,ap=!!op&&1/[1].lastIndexOf(1,-0)<0,sp=Un("lastIndexOf"),cp=ap||!sp?function(e){if(ap)return h(op,this,arguments)||0;var t=U(this),r=Mt(t),n=r-1;for(arguments.length>1&&(n=ip(n,mt(arguments[1]))),n<0&&(n=r+n);n>=0;n--)if(n in t&&t[n]===e)return n||0;return-1}:op;nt({target:"Array",proto:!0,forced:cp!==[].lastIndexOf},{lastIndexOf:cp});var up,dp=$t("Array").lastIndexOf,lp=Array.prototype,pp=function(e){var t=e.lastIndexOf;return e===lp||j(lp,e)&&t===lp.lastIndexOf?dp:t},mp="\t\n\v\f\r                　\u2028\u2029\ufeff",hp=M("".replace),fp="["+mp+"]",gp=RegExp("^"+fp+fp+"*"),vp=RegExp(fp+fp+"*$"),yp=function(e){return function(t){var r=Xi(V(t));return 1&e&&(r=hp(r,gp,"")),2&e&&(r=hp(r,vp,"")),r}},Mp={start:yp(1),end:yp(2),trim:yp(3)},Ip=Pr.PROPER,Sp=Mp.trim;nt({target:"String",proto:!0,forced:(up="trim",u((function(){return!!mp[up]()||"​᠎"!=="​᠎"[up]()||Ip&&mp[up].name!==up})))},{trim:function(){return Sp(this)}});var Tp,bp=$t("String").trim,Cp=String.prototype,_p=function(e){var t=e.trim;return"string"==typeof e||e===Cp||j(Cp,e)&&t===Cp.trim?bp:t},Ep=(Tp=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},function(){return Tp()+Tp()+Tp()+Tp()+Tp()+Tp()+Tp()+Tp()});function wp(e){var t;return fu(t=fr(e)).call(t,(function(e){return!(+e>=0)}))}function Rp(e,t){var r,n=fu(r=fr(e)).call(r,(function(r){return e[r]==t}));return n.length>0?n[0]:void 0}function kp(e,t){if(void 0===t&&(t="-"),!e)throw new Al("No sessionId",{},400);var r=wu(e).call(e,t);if(-1===r)throw new Al("Can not find conjunctions",{},400);var n=Wc(e).call(e,0,r);return{accid:Wc(e).call(e,r+1),scene:"super_team"===n?"superTeam":n}}function Ap(){return"undefined"!=typeof tt&&tt.getSystemInfo?"TT":"undefined"!=typeof swan&&swan.getSystemInfo?"BAIDU":"undefined"!=typeof my&&my.getSystemInfo?"ALI":"undefined"!=typeof wx&&wx.getSystemInfo?"WX":"unknow environment"}function Np(e,t){return function(e,t,r,n){for(var i in e=e||{},r=r||{},n=n||function(){},t=t||{}){var o=n(e[i],t[i]);e[i]=void 0===o?t[i]:o}for(var a in r){var s=n(e[a],r[a]);e[a]=void 0===s?r[a]:s}return e}({},e,t,(function(e,t){return void 0===t?e:t}))}function xp(){return fs.resolve()}function Op(){}function Pp(e){var t=pp(e).call(e,"."),r=t>-1?Wc(e).call(e,t+1):"";return/^\d+$/.test(_p(r).call(r))&&(r=""),r}function Lp(e,t,r){return 0===e.length||e[0][t]<=r?0:e[e.length-1][t]>r?e.length:Qn(e).call(e,(function(n,i){if(e[i-1]&&e[i-1][t]>r&&r>=n[t])return!0}))}var Vp=function(){function e(e){this.lastSuccUploadHost="",this.core=e}var t=e.prototype;return t.getFileUploadInformation=function(e){return Zl.getFileUploadInformation(e)},t.request=function(e,t,r){var n=this,i=(new Date).getTime(),o=(null==r?void 0:r.exception_service)||0;return Zl.request(e,t).catch((function(r){var a,s,c,u,d=r;throw n.core.reporter.reportTraceStart("exceptions",{user_id:n.core.options.account||(null===(s=null===(a=n.core)||void 0===a?void 0:a.auth)||void 0===s?void 0:s.account),trace_id:null===(u=null===(c=n.core.clientSocket)||void 0===c?void 0:c.socket)||void 0===u?void 0:u.sessionId,start_time:i,action:1,exception_service:o}),n.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof d.code?d.code:0,description:d.message||""+d.code,operation_type:0,target:e,context:t?_i(t):""},{asyncParams:Zl.net.getNetworkStatus()}),n.core.reporter.reportTraceEnd("exceptions",1),r}))},t.uploadFile=function(e){var t,r,n,i;return zl(this,void 0,void 0,Ql.mark((function o(){var a,s,c,u,d,l,p,m,h,f,g,v,y,M;return Ql.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:c="BROWSER"===Zl.platform,u=c?e.chunkUploadHostBackupList:e.commonUploadHostBackupList,d=c?e.chunkUploadHost:e.commonUploadHost,l=wu(u).call(u,d),p=-1===l?xs(a=[d]).call(a,u):xs(s=[d]).call(s,Wc(u).call(u,0,l),Wc(u).call(u,l+1)),m=Math.max(wu(p).call(p,this.lastSuccUploadHost),0),h=null,f=0;case 8:if(!(f<p.length)){o.next=32;break}return g=(new Date).getTime(),v=p[(f+m)%p.length],o.prev=11,o.next=14,Zl.uploadFile(dr(dr({},e),c?{chunkUploadHost:v}:{commonUploadHost:v}));case 14:return y=o.sent,this.lastSuccUploadHost=v,o.abrupt("return",y);case 19:if(o.prev=19,o.t0=o.catch(11),this.core.cloudStorage.nos.nosErrorCount--,h=o.t0,M=o.t0,this.core.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account||(null===(r=null===(t=this.core)||void 0===t?void 0:t.auth)||void 0===r?void 0:r.account),trace_id:null===(i=null===(n=this.core.clientSocket)||void 0===n?void 0:n.socket)||void 0===i?void 0:i.sessionId,start_time:g,action:1,exception_service:3}),this.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof M.code?M.code:0,description:M.message||""+M.code,operation_type:1,target:v},{asyncParams:Zl.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1),!o.t0||o.t0.code!==Tl.V2NIM_ERROR_CODE_CANCELLED&&10499!==o.t0.errCode){o.next=29;break}throw o.t0;case 29:f++,o.next=8;break;case 32:throw h;case 33:case"end":return o.stop()}}),o,this,[[11,19]])})))},e}(),Up="weblink.netease.im:443",Dp=["https://lbs.netease.im/lbs/webconf.jsp"],qp="https://abt-online.netease.im/v1/api/abt/client/getExperimentInfo",Bp="imElite_sdk_abtest_web",Fp="https://statistic.live.126.net,https://statistic-overseas.yunxinfw.com",Gp=function(){function e(e,t){this.abtInfo={},this.core=e,this.config=Np({isAbtestEnable:!0,abtestUrl:qp,abtestProjectKey:Bp},t)}var t=e.prototype;return t.setOptions=function(e){this.config=Np(this.config,e)},t.abtRequest=function(){var e,t;return zl(this,void 0,void 0,Ql.mark((function r(){var n;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.config.isAbtestEnable){r.next=2;break}return r.abrupt("return");case 2:if(!this.abtInfo.experiments){r.next=4;break}return r.abrupt("return");case 4:if(this.config.abtestUrl){r.next=6;break}return r.abrupt("return");case 6:return r.prev=6,r.next=9,this.core.adapters.request(this.config.abtestUrl,{method:"POST",dataType:"json",headers:{sdktype:"ABTest"},data:{clientInfo:{projectKey:this.config.abtestProjectKey,appKey:this.core.options.appkey,osType:"Web",sdkVersion:"10.7.0",deviceId:this.core.config.deviceId},useLocalCache:!0}},{exception_service:7});case 9:n=r.sent,r.next=15;break;case 12:r.prev=12,r.t0=r.catch(6),this.core.logger.warn("ABTest request failed");case 15:this.abtInfo=(null===(t=null===(e=null==n?void 0:n.data)||void 0===e?void 0:e.data)||void 0===t?void 0:t.abtInfo)||{};case 16:case"end":return r.stop()}}),r,this,[[6,12]])})))},e}();function jp(e){var t={},r=new fs((function(e,r){t.abort=r}));return t.promise=fs.race([e,r]),t}fs.reject;var Hp=function(){function e(){this.abortFns=[]}var t=e.prototype;return t.add=function(e){var t=jp(e);return this.abortFns.push(t.abort),t.promise},t.clear=function(e){var t;jn(t=this.abortFns).call(t,(function(t){return t(e||new _l({code:Tl.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:"Aborted"}}))})),this.abortFns=[]},t.destroy=function(){this.clear()},e}(),Wp=Mp.trim,Kp=c.parseInt,Yp=c.Symbol,Qp=Yp&&Yp.iterator,Jp=/^[+-]?0x/i,zp=M(Jp.exec),Xp=8!==Kp(mp+"08")||22!==Kp(mp+"0x16")||Qp&&!u((function(){Kp(Object(Qp))}))?function(e,t){var r=Wp(Xi(e));return Kp(r,t>>>0||(zp(Jp,r)?16:10))}:Kp;nt({global:!0,forced:parseInt!=Xp},{parseInt:Xp});var $p=B.parseInt;function Zp(e,t){if("object"!=typeof e||null===e)return e;for(var r=(t=t||"").split("."),n=0;n<r.length;n++){var i=r[n],o=e[i],a=wu(i).call(i,"["),s=wu(i).call(i,"]");if(-1!==a&&-1!==s&&a<s){var c=Wc(i).call(i,0,a),u=$p(Wc(i).call(i,a+1,s));o=e[c],o=Ei(o)?o[u]:void 0}if(null==o)return o;e=o}return e}var em={tolerantRTT:3e3,bestRTT:100,maxChances:5,enable:!0},tm={timestamp:0,rtt:0,baseClock:0,baseTime:0},rm=function(){function e(e,t,r){void 0===r&&(r="getServerTime"),this.serverOrigin=tm,this.config=em,this.isSettingNTP=!1,this.currentChance=0,this.failedDelay=2e3,this.successDelay=3e5,this.timer=0,this.cmdName="getServerTime",this.core=e,this.logger=e.logger,this.promiseManager=new Hp,this.cmdName=r,t&&this.setOptions(t)}var t=e.prototype;return t.setOptions=function(e){this.config=dr({},em,this.config,e)},t.reset=function(){this.timer&&clearTimeout(this.timer),this.promiseManager.clear(),this.serverOrigin=tm,this.currentChance=0},t.setOriginTimetick=function(){return zl(this,void 0,void 0,Ql.mark((function e(){var t,r,n,i,o,a,s,c,u,d;return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.config.enable){e.next=2;break}return e.abrupt("return");case 2:if(!this.isSettingNTP){e.next=4;break}return e.abrupt("return");case 4:if(!(this.currentChance>=this.config.maxChances)){e.next=6;break}return e.abrupt("return");case 6:if(t=Zp(this.core,"auth.status"),r=Zp(this.core,"status"),n=Zp(this.core,"V2NIMLoginService.lifeCycle.loginStatus"),"logined"===t||"logined"===r||1===n){e.next=11;break}return e.abrupt("return");case 11:return this.isSettingNTP=!0,this.currentChance++,this.timer&&clearTimeout(this.timer),this.timer=0,i="TimeOrigin::setOriginTimetick:",o=_s(),this.core.logger.debug(i+" getServerTime start, times "+this.currentChance),e.prev=18,e.next=21,this.promiseManager.add(this.core.sendCmd(this.cmdName));case 21:s=e.sent,a=Zp(s,"content.time"),this.isSettingNTP=!1,e.next=33;break;case 26:return e.prev=26,e.t0=e.catch(18),c=e.t0,this.isSettingNTP=!1,this.logger.warn(i+" Calculate Delay time, getServerTime error",c),c.code!==Tl.V2NIM_ERROR_CODE_CANCELLED&&(this.timer=qs(tr(u=this.setOriginTimetick).call(u,this),this.failedDelay)),e.abrupt("return");case 33:if(a){e.next=37;break}return this.core.logger.warn(i+" Calculate Delay time incorrect format"),this.config.enable=!1,e.abrupt("return");case 37:d=_s()-o,this.doSet(a,d);case 39:case"end":return e.stop()}}),e,this,[[18,26]])})))},t.doSet=function(e,t){var r,n="TimeOrigin::setOriginTimetick:";if(t>this.config.tolerantRTT)this.logger.warn(n+" Denied, cause of exceeding the maximum tolerance range of RTT: "+t),this.timer=qs(tr(r=this.setOriginTimetick).call(r,this),this.failedDelay);else if(t>this.config.bestRTT){var i;this.serverOrigin.rtt&&t>=this.serverOrigin.rtt?this.logger.warn(n+" Denied, cause of current.RTT >= serverOrigin.RTT: "+t):(this.setServerOrigin(t,e),this.logger.log(n+" Accept within maximum tolerance range of RTT: "+t+", ntpTimestamp: "+this.serverOrigin.timestamp+", localClock: "+this.serverOrigin.baseClock+", localTime: "+this.serverOrigin.baseTime)),this.timer=qs(tr(i=this.setOriginTimetick).call(i,this),this.failedDelay)}else{var o;this.setServerOrigin(t,e),this.logger.debug(n+" Accept within best RTT: "+t+", ntpTimestamp: "+this.serverOrigin.timestamp+", localClock: "+this.serverOrigin.baseClock+", localTime: "+this.serverOrigin.baseTime),this.currentChance=0,this.timer=qs(tr(o=this.setOriginTimetick).call(o,this),this.successDelay)}},t.getNTPTime=function(e){if(void 0===e&&(e=this.getTimeNode()),this.checkNodeReliable(e)){var t=Math.floor(e.time-this.serverOrigin.baseTime);return this.serverOrigin.timestamp+t}return _s()},t.checkNodeReliable=function(e){if(void 0===e&&(e=this.getTimeNode()),this.serverOrigin.timestamp){if(0===this.serverOrigin.baseClock)return!0;var t=e.clock-this.serverOrigin.baseClock,r=e.time-this.serverOrigin.baseTime;return Math.abs(r-t)<500}return!1},t.checkPerformance=function(){return"BROWSER"===Zl.platform&&!("undefined"==typeof performance||!performance.now)},e.checkPerformance=function(){return"BROWSER"===Zl.platform&&!("undefined"==typeof performance||!performance.now)},t.getTimeNode=function(){return{clock:this.checkPerformance()?performance.now():0,time:_s()}},e.getTimeNode=function(){return{clock:e.checkPerformance()?performance.now():0,time:_s()}},t.setServerOrigin=function(e,t){this.serverOrigin={timestamp:t+Math.floor(e/2),rtt:e,baseClock:this.checkPerformance()?performance.now():0,baseTime:_s()}},e}(),nm={user_id:"",trace_id:"",action:7,exception_service:6,duration:0,start_time:0,state:1,extension:[]},im=function(){function e(e,t){this.traceData=nm,this.core=e,this.traceData=dr({},nm,t),this.traceData.extension=[]}var t=e.prototype;return t.reset=function(){this.traceData=dr({},nm),this.traceData.extension=[]},t.start=function(){var e,t;this.reset(),this.traceData.user_id=this.core.account,this.traceData.trace_id=(null===(t=null===(e=this.core.clientSocket)||void 0===e?void 0:e.socket)||void 0===t?void 0:t.sessionId)||"",this.traceData.start_time=(new Date).getTime()},t.update=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Zl.net.getNetworkStatus();case 2:r=t.sent,n=r.net_type,i=r.net_connect,this.traceData.extension.push(dr({code:0,foreground:!0,foreg_backg_switch:!1,net_type:n,net_connect:i},e));case 6:case"end":return t.stop()}}),t,this)})))},t.end=function(e){var t=this.traceData.extension[0],r=this.traceData.extension[1];if(t&&0===t.operation_type&&r&&1===r.operation_type){var n=t.net_type!==r.net_type||t.net_connect!==r.net_connect;if(e||!n)return this.traceData.duration=(new Date).getTime()-this.traceData.start_time,this.core.reporter.report("exceptions",this.traceData),void this.reset();this.reset()}else this.reset()},e}(),om={user_id:"",trace_id:"",net_connect:!0,net_type:0,duration:0,start_time:0,history:[],succeed:!1},am=function(){function e(e){this.traceData=om,this.core=e,this.reset()}var t=e.prototype;return t.reset=function(){this.traceData=dr({},om),this.traceData.history=[]},t.start=function(e){this.reset(),this.traceData.user_id=e,this.traceData.start_time=_s()},t.updateBegin=function(e){this.traceData.history.push(dr({head:"",body:"",start_time:_s(),httpdns:!1,index:0},e))},t.updateComplete=function(e){var t;jn(t=this.traceData.history).call(t,(function(t){t.target===e.target&&(dr(t,e),t.duration=_s()-t.start_time)}))},t.end=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.traceData.succeed=e,this.traceData.history=fu(r=this.traceData.history).call(r,(function(e){return void 0!==e.code})),0!==this.traceData.history.length){t.next=5;break}return this.reset(),t.abrupt("return");case 5:return this.traceData.duration=_s()-this.traceData.start_time,t.next=8,Zl.net.getNetworkStatus();case 8:n=t.sent,i=n.net_type,o=n.net_connect,this.traceData.net_type=i,this.traceData.net_connect=o,this.core.reporter.report("nim_sdk_lbs_records",this.traceData),this.reset();case 15:case"end":return t.stop()}}),t,this)})))},e}();function sm(e){var t,r,n=!0;return"boolean"==typeof(null===(t=null==e?void 0:e.reporterConfig)||void 0===t?void 0:t.enableCompass)?n=e.reporterConfig.enableCompass:"boolean"==typeof(null===(r=null==e?void 0:e.reporterConfig)||void 0===r?void 0:r.isDataReportEnable)&&(n=e.reporterConfig.isDataReportEnable),n}var cm={user_id:"",trace_id:"",action:0,state:0,duration:0,start_time:0,offset:0,full_size:0,transferred_size:0,operation_type:0,remote_addr:""},um="ReporterHook::setMonitorForResources:",dm=function(){function e(e,t){this.traceData=cm,this.core=e,this.traceData=dr({},cm,t)}var t=e.prototype;return t.reset=function(){this.traceData=dr({},cm)},t.start=function(){var e,t;this.reset(),this.traceData.user_id=this.core.account,this.traceData.trace_id=(null===(t=null===(e=this.core.clientSocket)||void 0===e?void 0:e.socket)||void 0===t?void 0:t.sessionId)||"",this.traceData.start_time="timeOrigin"in this.core?this.core.timeOrigin.getNTPTime():_s()},t.update=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.traceData.user_id){t.next=2;break}return t.abrupt("return");case 2:this.core.logger.log(um+" upload update",e),dr(this.traceData,e);case 4:case"end":return t.stop()}}),t,this)})))},t.end=function(e){this.traceData.user_id&&(this.core.logger.log(um+" upload end cause of "+e),this.traceData.state=e,this.traceData.duration=("timeOrigin"in this.core?this.core.timeOrigin.getNTPTime():_s())-this.traceData.start_time,this.core.reporter.report("nim_sdk_resources",this.traceData),this.traceData=cm)},e}(),lm={},pm={},mm={},hm={apiVersion:"v1",debugLevel:"off",needReconnect:!0,reconnectionAttempts:ir,lbsUrls:Dp,linkUrl:Up,abtestUrl:qp,isAbtestEnable:!0},fm=function(e){function t(r,n){var i,o,a;if(void 0===n&&(n={}),(a=e.call(this)||this).instanceName="NIM",a.pluginMap={},a.eventBus=new Bs,a.options={},a.V2NIMConversationIdUtil={},a.V2NIMMessageCreator={},a.V2NIMMessageAttachmentCreator={},a.V2NIMClientAntispamUtil={},a.DataStructureConverter={},a.V2NIMMessageConverter={},a.V2NIMMessageLogUtil={},a.V2NIMMessageExtendUtil={},a.V2NIMStorageUtil={},a.V2NIMNotificationService={},a.V2NIMStorageService={},a.auth={},a.V1NIMLoginService={},a.V2NIMLoginService={},a.clientSocket={},a.V2NIMSyncService={},a.V2NIMConversationService={},a.V2NIMConversationGroupService={},a.V2NIMMessageService={},a.V2NIMTeamService={},a.V2NIMUserService={},a.V2NIMFriendService={},a.V2NIMSettingService={},a.V2NIMAIService={},a.V2NIMSignallingService={},a.V2NIMSubscriptionService={},a.V2NIMPassthroughService={},a.YSFService={},a.offlinePush={},a.sync={},a.msg={},a.msgLog={},a.session={},a.cloudSession={},a.misc={},a.user={},a.friend={},a.systemMessage={},a.team={},a.event={},a.msgExtend={},a.cloudStorage={},a.passThrough={},a.superTeam={},a.plugin={},a.signaling={},a.qchatChannel={},a.qchatMedia={},a.qchatMsg={},a.qchatRole={},a.qchatServer={},a.pluginMap=mm,a.logger=new np(r.debugLevel,n.loggerConfig),n.privateConf){var s=a.getConfigFromPrivate(n.privateConf),c=s.authConfig,u=s.cloudStorageConfig,d=s.reporterConfig;dr(r,c),a.setInitOptions(r),a.otherOptions=dr(dr({},n),{cloudStorageConfig:dr(dr({storageKeyPrefix:"NIM"},n.cloudStorageConfig),u),reporterConfig:dr(dr({},n.reporterConfig),d),V1NIMLoginServiceConfig:dr(dr(dr({},r),n.V1NIMLoginServiceConfig),c),V2NIMLoginServiceConfig:dr(dr({},n.V2NIMLoginServiceConfig),c)})}else a.setInitOptions(r),a.otherOptions=dr(dr({},n),{V1NIMLoginServiceConfig:dr(dr({},r),n.V1NIMLoginServiceConfig),cloudStorageConfig:dr({storageKeyPrefix:"NIM"},n.cloudStorageConfig)});a.timerManager=new Hl,a.timeOrigin=new rm(ut(a)),a.adapters=new Vp(ut(a)),a.abtest=new Gp(ut(a),dr(dr({isAbtestEnable:a.options.isAbtestEnable,abtestUrl:a.options.abtestUrl},a.otherOptions.abtestConfig),{abtestProjectKey:Bp}));var l=Zl.getSystemInfo(),p=function(e,t){var r,n,i=null===(r=null==t?void 0:t.reporterConfig)||void 0===r?void 0:r.compassDataEndpoint,o=null===(n=null==t?void 0:t.reporterConfig)||void 0===n?void 0:n.reportConfigUrl;if(i)return i;if(o){var a=o.match(/^https:\/\/([^/]+)\/*/);return Ei(a)&&a.length>=1?"https://"+a[1]:(e.error("Invalid reportConfigUrl: "+o),Fp)}return Fp}(a.logger,a.otherOptions);a.reporter=new gu(dr(dr({},p?{compassDataEndpoint:p}:{}),{isDataReportEnable:sm(a.otherOptions),common:{app_key:r.appkey,dev_id:"",platform:"Web",sdk_ver:"10.7.0",env:"online",os_name:l.os,os_ver:l.osVer,lib_env:l.libEnv,host_env:l.hostEnv,host_env_ver:l.hostEnvVer,manufactor:l.manufactor,model:l.model,v2:"v1"!==a.options.apiVersion},request:Zl.request,logger:a.logger,autoStart:!0})),a.reporterHookLinkKeep=new im(ut(a)),a.reporterHookCloudStorage=new dm(ut(a)),a.reporterHookLBS=new am(ut(a)),Zl.setLogger(a.logger);var m=a.getServiceKeys(fr(lm));return jn(m).call(m,(function(e){var t=lm[e];a[e]=new t(ut(a))})),jn(i=fr(lm)).call(i,(function(e){a.callSetOptions(e)})),jn(o=fr(pm)).call(o,(function(e){var t=pm[e];void 0!==t&&(a[e]=new t(ut(a)))})),t.instance=ut(a),a.logger.log("NIM init, version:10.7.0, sdk version:100700, appkey:"+r.appkey),a}nr(t,e);var r=t.prototype;return r.getServiceKeys=function(e){var t=Qn(e).call(e,(function(e){return"V1NIMLoginService"===e}));if(t>-1){var r=e[t];di(e).call(e,t,1),"v1"===this.options.apiVersion&&e.unshift(r)}var n=Qn(e).call(e,(function(e){return"V2NIMLoginService"===e}));if(n>-1){var i=e[n];di(e).call(e,n,1),"v2"===this.options.apiVersion&&e.unshift(i)}var o=Qn(e).call(e,(function(e){return"sync"===e}));if(o>-1){var a=e[o];di(e).call(e,o,1),"v1"===this.options.apiVersion&&e.push(a)}var s=Qn(e).call(e,(function(e){return"V2NIMSyncService"===e}));if(s>-1){var c=e[s];di(e).call(e,s,1),"v2"===this.options.apiVersion&&e.push(c)}return e},t.getInstance=function(e,r){if(!t.instance){if(e)return new t(e,r);throw new Error("Instance not exist, please input options")}if(e){if(t.instance.options.account===e.account&&t.instance.options.appkey===e.appkey)return t.instance.setOptions(e),t.instance;throw new Error("Unexpected login")}return t.instance},r.setInitOptions=function(e){Pl({appkey:{type:"string"},apiVersion:{type:"enum",values:["v1","v2"],required:!1},binaryWebsocket:{type:"boolean",required:!1},needReconnect:{type:"boolean",required:!1},reconnectionAttempts:{type:"number",required:!1},customClientType:{type:"number",min:1,required:!1},authType:{type:"number",min:0,max:2,required:!1},lbsUrls:{type:"array",itemType:"string",min:1,required:!1},linkUrl:{type:"string",allowEmpty:!1,required:!1}},e),this.options=dr(dr({},hm),e)},r.getConfigFromPrivate=function(e){return e?{authConfig:JSON.parse(_i({appkey:e.appkey||void 0,lbsUrls:e.weblbsUrl?[e.weblbsUrl]:void 0,linkUrl:e.link_web||void 0})),cloudStorageConfig:JSON.parse(_i({chunkUploadHost:e.nos_uploader||void 0,commonUploadHost:e.nos_uploader||void 0,commonUploadHostBackupList:e.nos_uploader?[e.nos_uploader]:void 0,chunkUploadHostBackupList:e.nos_uploader?[e.nos_uploader]:void 0,uploadReplaceFormat:e.nos_downloader_v2?(e.nosSsl?"https://":"http://")+e.nos_downloader_v2:void 0,downloadUrl:void 0!==e.nos_accelerate?e.nos_accelerate:void 0,downloadHostList:""===e.nos_accelerate_host?[]:"string"==typeof e.nos_accelerate_host?[e.nos_accelerate_host]:Ei(e.nos_accelerate_host)?e.nos_accelerate_host:void 0})),reporterConfig:JSON.parse(_i({enableCompass:"boolean"==typeof e.enableCompass?e.enableCompass:void 0,compassDataEndpoint:e.compassDataEndpoint||void 0}))}:{authConfig:{},cloudStorageConfig:{},reporterConfig:{}}},r.connect=function(e){return void 0===e&&(e={}),this.V1NIMLoginService.login(e)},r.setOptions=function(e){if("object"==typeof e&&null!==e){if(Object.prototype.hasOwnProperty.call(e,"account")&&e.account!==this.options.account||Object.prototype.hasOwnProperty.call(e,"appkey")&&e.appkey!==this.options.appkey)throw new _l({code:Tl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"NIM::setOptions account and appkey is not allowed to reset"}});if(Object.prototype.hasOwnProperty.call(e,"apiVersion")&&e.apiVersion!==this.options.apiVersion)throw new _l({code:Tl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"NIM::setOptions apiVersion is not allowed to reset"}});if(Object.prototype.hasOwnProperty.call(e,"binaryWebsocket")&&e.binaryWebsocket!==this.options.binaryWebsocket)throw new _l({code:Tl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"NIM::setOptions binaryWebsocket is not allowed to reset"}});Pl({token:{type:"string",required:!1},needReconnect:{type:"boolean",required:!1},reconnectionAttempts:{type:"number",required:!1},customClientType:{type:"number",min:1,required:!1},authType:{type:"number",min:0,max:2,required:!1},lbsUrls:{type:"array",itemType:"string",min:1,required:!1},linkUrl:{type:"string",allowEmpty:!1,required:!1}},e),this.logger.log("NIM::setOptions options is",e),this.options=dr(dr({},this.options),e),this.V1NIMLoginService.setOptions&&this.V1NIMLoginService.setOptions(this.options)}},r.disconnect=function(){return this.V1NIMLoginService.logout()},r._disconnect=function(){return"v1"===this.options.apiVersion?this.V1NIMLoginService.logout():"v2"===this.options.apiVersion?0===Zp(this.V2NIMLoginService,"lifeCycle.connectStatus")&&0===Zp(this.V2NIMLoginService,"lifeCycle.loginStatus")?fs.resolve():this.V2NIMLoginService.logout():fs.resolve()},r.destroy=function(){var e=this;return t.instance=void 0,this._disconnect().then((function(){e.status="destroyed",e.removeAllListeners(),e.eventBus.removeAllListeners(),e.logger.destroy(),e.reporter.destroy(),e.timerManager.destroy(),e._clearModuleData("destroy"),e._removeAllModuleListeners(),e.connect=xp,e.disconnect=xp,e._disconnect=xp,e.destroy=xp}))},r._clearModuleData=function(e){void 0===e&&(e="logout");var t=Ts(this);jn(t).call(t,(function(t){t&&"function"==typeof t.reset&&t.reset(e)}))},r._removeAllModuleListeners=function(){var e=Ts(this);jn(e).call(e,(function(e){e&&"function"==typeof e.removeAllListeners&&e.removeAllListeners()}))},r.kick=function(e){return this.V1NIMLoginService.kick(e)},r.sendCmd=function(e,t,r){return this.clientSocket.sendCmd(e,t,r)},r.emit=function(t){var r=this;try{for(var n,i,o=_s(),a=arguments.length,s=new Array(a>1?a-1:0),c=1;c<a;c++)s[c-1]=arguments[c];var u=(n=e.prototype.emit).call.apply(n,xs(i=[this,t]).call(i,s)),d=_s()-o;return d>=10&&this.logger.warn("Core::emit event: "+t+" process takes: "+d+"ms"),u}catch(e){return this.logger.error("Core::emit event: "+t+". Error: "+e),qs((function(){throw r.logger.error("Core::emit throw error in setTimeout. event: "+t+". Error: "+e),e}),0),!1}},r._registerDep=function(e,t){this[t]&&this[t].name||(this[t]=new e(this),this.callSetOptions(t))},r.callSetOptions=function(e){var t=e+"Config",r=e+"Options",n=this.otherOptions[t]||this.otherOptions[r]||{},i=Zp(this,e+".setOptions");"function"==typeof i&&("cloudStorage"===e&&(n=this.otherOptions[t]||this.otherOptions.serverConfig||{}),i.call(this[e],n))},t.registerService=function(e,t){lm[t]=e},t.registerPrivateService=function(e,t){pm[t]=e},t.registerPlugin=function(e,t){mm[t]=e},ct(t,[{key:"account",get:function(){return this.auth.account}},{key:"status",get:function(){return this.V1NIMLoginService.status},set:function(e){this.V1NIMLoginService.status=e}},{key:"config",get:function(){return{timeout:8e3,deviceId:this.auth.deviceId}}}]),t}(Bs);fm.sdkVersion=100700,fm.sdkVersionFormat="10.7.0";var gm=n((function(e,t){e.exports=function(){function e(e){if(e){var t,r="";return jn(t=fr(e)).call(t,(function(t,n){r+=0===n?"?":"&",r+=t+"="+e[t]})),r}return""}var t=function(e){function t(t,r,n,i){var o;return(o=e.call(this,n)||this).source=t,o.code=r,o.desc=n,o.detail=i||{},o}return nr(t,e),t}(Md(Error));function r(r,n){void 0===n&&(n={dataType:"json",method:"GET",timeout:5e3});var i="text"===n.dataType?"text/plain; charset=UTF-8":"application/json; charset=UTF-8",o="GET"===n.method?e(n.params):"";return new fs((function(e,a){if(window.XMLHttpRequest){var s,c=new XMLHttpRequest;if(c.onreadystatechange=function(){if(4===c.readyState)if(200===c.status){try{s=JSON.parse(c.response||"{}")}catch(e){s=c.response}e({status:c.status,data:s})}else qs((function(){a(new t(1,c.status,"readyState: "+c.readyState+"; statusText: "+c.statusText))}),0)},c.open(n.method,""+r+o),c.timeout=n.timeout||5e3,c.setRequestHeader("Content-Type",i),n.headers)for(var u in n.headers)c.setRequestHeader(u,n.headers[u]);c.ontimeout=function(e){a(new t(1,408,e&&e.message?e.message:"request timeout"))},c.send(_i(n.data))}else a(new t(2,10400,"request no suppout"))}))}return r}()})),vm=Math.floor,ym=function(e,t){var r=e.length,n=vm(r/2);return r<8?Mm(e,t):Im(e,ym(Hs(e,0,n),t),ym(Hs(e,n),t),t)},Mm=function(e,t){for(var r,n,i=e.length,o=1;o<i;){for(n=o,r=e[o];n&&t(e[n-1],r)>0;)e[n]=e[--n];n!==o++&&(e[n]=r)}return e},Im=function(e,t,r,n){for(var i=t.length,o=r.length,a=0,s=0;a<i||s<o;)e[a+s]=a<i&&s<o?n(t[a],r[s])<=0?t[a++]:r[s++]:a<i?t[a++]:r[s++];return e},Sm=ym,Tm=H.match(/firefox\/(\d+)/i),bm=!!Tm&&+Tm[1],Cm=/MSIE|Trident/.test(H),_m=H.match(/AppleWebKit\/(\d+)\./),Em=!!_m&&+_m[1],wm=[],Rm=M(wm.sort),km=M(wm.push),Am=u((function(){wm.sort(void 0)})),Nm=u((function(){wm.sort(null)})),xm=Un("sort"),Om=!u((function(){if(J)return J<70;if(!(bm&&bm>3)){if(Cm)return!0;if(Em)return Em<603;var e,t,r,n,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(n=0;n<47;n++)wm.push({k:t+n,v:r})}for(wm.sort((function(e,t){return t.v-e.v})),n=0;n<wm.length;n++)t=wm[n].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));nt({target:"Array",proto:!0,forced:Am||!Nm||!xm||!Om},{sort:function(e){void 0!==e&&ne(e);var t=le(this);if(Om)return void 0===e?Rm(t):Rm(t,e);var r,n,i=[],o=Mt(t);for(n=0;n<o;n++)n in t&&km(i,t[n]);for(Sm(i,function(e){return function(t,r){return void 0===r?-1:void 0===t?1:void 0!==e?+e(t,r)||0:Xi(t)>Xi(r)?1:-1}}(e)),r=Mt(i),n=0;n<r;)t[n]=i[n++];for(;n<o;)ri(t,n++);return t}});var Pm=$t("Array").sort,Lm=Array.prototype,Vm=function(e){var t=e.sort;return e===Lm||j(Lm,e)&&t===Lm.sort?Pm:t},Um=n((function(e,t){e.exports=function(){var e={d:function(t,r){for(var n in r)e.o(r,n)&&!e.o(t,n)&&st(t,n,{enumerable:!0,get:r[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t={};e.d(t,{default:function(){return S}});var r=function e(t){for(var r in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.directUploadAddr="https://wanproxy-web.127.net",this.retryCount=4,this.trunkSize=4194304,this.trunkUploadTimeout=5e4,this.getOffsetTimeout=1e4,this.version="1.0",this.enableCache=!0,this.logger=console,this.onError=function(e){},this.onProgress=function(e){},this.onUploadProgress=function(e){},this.onComplete=function(e){},t)this[r]=t[r]};function n(e,t){var r=void 0!==Nc&&Fl(e)||e["@@iterator"];if(!r){if(Ei(e)||(r=function(e,t){if(e){var r;if("string"==typeof e)return i(e,t);var n=Wc(r=Object.prototype.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Bl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw a}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var o={privateObj:{},setItem:function(e,t){o.privateObj[e]=t},getItem:function(e){return o.privateObj[e]},removeItem:function(e){delete o.privateObj[e]},getKeys:function(){return fr(o.privateObj)}},a={getFileKey:function(e){var t=e.size.toString(),r=e.lastModified.toString();return"_NosUploader_"+e.name+Wc(t).call(t,t.length-5)+Wc(r).call(r,r.length-5)},getFileInfo:function(e){var t=o.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch(e){return null}},initFile:function(e,t,r){a.clearExpiredInfo();var n=this.getFileKey(t),i={ctx:void 0!==e.ctx?e.ctx:"",bucket:e.bucketName,obj:e.objectName,token:e.token,modifyAt:_s(),end:!1};return e.payload&&(i.payload=e.payload),r&&o.setItem(n,_i(i)),n},setUploadContext:function(e,t,r){var n=this.getFileInfo(e);n&&(n.ctx=t,r&&o.setItem(e,_i(n)))},setComplete:function(e,t){var r=this.getFileInfo(e);r&&(r.modifyAt=_s(),r.end=!0,t&&o.setItem(e,_i(r)))},getUploadContext:function(e){var t=this.getFileInfo(e);return t?t.ctx:""},removeFileInfo:function(e){0===wu(e).call(e,"_NosUploader_")&&o.removeItem(e)},clearExpiredInfo:function(){var e,t="function"==typeof o.getKeys?o.getKeys():fr(o),r=_s(),i=[],s=n(t);try{for(s.s();!(e=s.n()).done;){var c=e.value;if(0===wu(c).call(c,"_NosUploader_")){var u=a.getFileInfo(c);null===u||r-u.modifyAt>S.expireTime?o.removeItem(c):i.push({fileInfo:u,key:c})}}}catch(e){s.e(e)}finally{s.f()}if(i.length>S.maxFileCache){var d,l,p=n(Wc(d=Vm(i).call(i,(function(e,t){return t.fileInfo.modifyAt-e.fileInfo.modifyAt}))).call(d,S.maxFileCache));try{for(p.s();!(l=p.n()).done;){var m,h=l.value;0===wu(m=h.key).call(m,"_NosUploader_")&&o.removeItem(h.key)}}catch(e){p.e(e)}finally{p.f()}}}},s=a;function c(e){return(c="function"==typeof Nc&&"symbol"==typeof Kc?function(e){return typeof e}:function(e){return e&&"function"==typeof Nc&&e.constructor===Nc&&e!==Nc.prototype?"symbol":typeof e})(e)}function u(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){var t="function"==typeof ad?new ad:void 0;return(d=function(e){var r,n;if(null===e||(n=e,-1===wu(r=Function.toString.call(n)).call(r,"[native code]")))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return l(e,arguments,h(this).constructor)}return i.prototype=Bt(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),m(i,e)})(e)}function l(e,t,r){return(l=p()?fd:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(tr(Function).apply(e,n));return r&&m(i,r.prototype),i}).apply(null,arguments)}function p(){if("undefined"==typeof Reflect||!fd)return!1;if(fd.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(fd(Boolean,[],(function(){}))),!0}catch(e){return!1}}function m(e,t){return(m=Ht||function(e,t){return e.__proto__=t,e})(e,t)}function h(e){return(h=Ht?Oc:function(e){return e.__proto__||Oc(e)})(e)}var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Bt(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(i,e);var t,r,n=(t=i,r=p(),function(){var e,n=h(t);if(r){var i=h(this).constructor;e=fd(n,arguments,i)}else e=n.apply(this,arguments);return u(this,e)});function i(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(r=n.call(this,"NosUploadError:"+e)).errCode=t,r.errMsg=e,r}return i}(d(Error)),g=function e(t,r,n){if("uploading"===t.uploadState){var i=t.config,o=t.param,a=s.getUploadContext(t.fileKey);if(!a)return n(0);var c=new XMLHttpRequest,u=i.directUploadAddr+"/".concat(o.bucketName)+"/".concat(encodeURIComponent(o.objectName))+"?uploadContext"+"&context=".concat(a)+"&version=".concat(i.version);c.onreadystatechange=function(){var o;if("abort"!==t.uploadState&&4===c.readyState){var a,d,l,p;try{p=JSON.parse(c.responseText)}catch(e){p={errMsg:"JsonParseError in getOffset. xhr.status = "+c.status+". xhr.responseText: "+c.responseText,errCode:500}}200===c.status?p.errCode?t.config.onError(new f(p.errMsg,p.errCode)):n(p.offset):c.status.toString().match(/^5/)?e(t,r-1,n):r>0?("function"==typeof(null===(o=i.logger)||void 0===o?void 0:o.error)&&i.logger.error(xs(a="getOffset(".concat(u,") error. retry after 3 seconds. ")).call(a,(new Date).toTimeString())),qs((function(){e(t,r-1,n)}),3500)):c.status?(s.removeFileInfo(t.fileKey),i.onError(new f(xs(d=xs(l="getOffset(".concat(u,") error: ")).call(l,c.status," ")).call(d,c.statusText)))):i.onError(new f("getOffset(".concat(u,") error. no Error Code")))}},c.open("get",u),c.setRequestHeader("x-nos-token",o.token),c.timeout=i.getOffsetTimeout,c.send()}},v=function e(t,r,n,i){if("uploading"===t.uploadState){var o=t.param,a=t.config,c=Wc(File.prototype),u=void 0!==o.ctx?o.ctx:"",d=r+a.trunkSize>=t.file.size,l=d?t.file.size:r+a.trunkSize,p=new XMLHttpRequest,m=a.directUploadAddr+"/".concat(o.bucketName)+"/".concat(encodeURIComponent(o.objectName));if(p.upload.onprogress=function(e){if("abort"!==t.uploadState){var n=0;e.lengthComputable?(n=(r+e.loaded)/t.file.size,a.onProgress(n),a.onUploadProgress({loaded:e.loaded,total:t.file.size,percentage:n,percentageText:(100*n).toFixed(2)+"%"})):a.onError(new f("browser does not support query upload progress"))}},p.onreadystatechange=function(){var o,c;if("abort"!==t.uploadState&&4===p.readyState){var u,l,h,g;try{g=JSON.parse(p.responseText)}catch(e){"function"==typeof(null===(o=a.logger)||void 0===o?void 0:o.error)&&a.logger.error("JsonParseError in uploadTrunk. xhr.status = "+p.status+". xhr.responseText: "+p.responseText,e),g={errMsg:"JsonParseError in uploadTrunk. xhr.status = "+p.status+". xhr.responseText: "+p.responseText}}200===p.status?(t.setContext(g.context),d?(i(),t.setComplete()):e(t,g.offset,a.retryCount,i)):p.status.toString().match(/^5/)?n>0?e(t,r,n-1,i):(s.removeFileInfo(t.fileKey),a.onError(new f(g.errMsg,g.errCode))):n>0?("function"==typeof(null===(c=a.logger)||void 0===c?void 0:c.error)&&a.logger.error(xs(u="uploadTrunk(".concat(m,") error. retry after 3 seconds. ")).call(u,(new Date).toTimeString())),qs((function(){e(t,r,n-1,i)}),3500)):p.status?(s.removeFileInfo(t.fileKey),a.onError(new f(xs(l=xs(h="uploadTrunk(".concat(m,") error: ")).call(h,p.status," ")).call(l,p.statusText)))):a.onError(new f("uploadTrunk(".concat(m,") error. no Error Code. Please check your network")))}},p.open("post",m+"?offset=".concat(r)+"&complete=".concat(d)+"&context=".concat(u)+"&version=".concat(a.version)),p.setRequestHeader("x-nos-token",o.token),o.md5&&p.setRequestHeader("content-md5",o.md5),t.file.type&&p.setRequestHeader("content-type",t.file.type),p.timeout=a.trunkUploadTimeout,"undefined"!=typeof FileReader){var h=new FileReader;h.addEventListener("load",(function(e){var t;(null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.result)instanceof ArrayBuffer&&e.target.result.byteLength>0?p.send(e.target.result):a.onError(new f("Read ArrayBuffer failed",194003))})),h.addEventListener("error",(function(e){var t=e.target.error;a.onError(new f("Read ArrayBuffer error. ".concat(t.toString()),194003))})),h.readAsArrayBuffer(c.call(t.file,r,l))}else p.send(c.call(t.file,r,l))}};function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),st(e,n.key,n)}}var M=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.uploadState="paused",this.config=n,this.file=t,this.param=r,this.fileKey=s.initFile(r,t,this.config.enableCache),this.resume()}var t;return(t=[{key:"resume",value:function(){var e=this;if("uploading"!==this.uploadState){this.setUploadState("uploading");var t=this.config;g(this,t.retryCount,(function(r){v(e,r,t.retryCount,(function(){e.setUploadState("ended"),"function"==typeof t.onComplete&&t.onComplete(e.param)}))}))}}},{key:"pause",value:function(){this.setUploadState("paused")}},{key:"abort",value:function(){"ended"!==this.uploadState&&"abort"!==this.uploadState&&(this.setUploadState("abort"),this.config.onError(new f("Upload Aborted",10499)))}},{key:"setUploadState",value:function(e){e!==this.uploadState&&(this.uploadState=e)}},{key:"setContext",value:function(e){s.setUploadContext(this.fileKey,e,this.config.enableCache),this.param.ctx=e}},{key:"setComplete",value:function(){s.setComplete(this.fileKey,this.config.enableCache),this.setUploadState("ended")}}])&&y(e.prototype,t),e}(),I={maxFileCache:1/0,expireTime:864e5,getFileUploadInformation:function(e){var t=s.getFileKey(e),r=s.getFileInfo(t);return null===r?null:_s()-r.modifyAt>I.expireTime?(s.removeFileInfo(t),null):{uploadInfo:dr({bucketName:r.bucket,objectName:r.obj,token:r.token,ctx:r.ctx},r.payload?{payload:r.payload}:{}),complete:r.end}},setMaxFileCache:function(e){I.maxFileCache=e},setExpireTime:function(e){I.expireTime=e},printCaches:function(){if("undefined"!=typeof localStorage)for(var e=0,t=fr(localStorage);e<t.length;e++){var r=t[e],n=s.getFileInfo(r);n&&console.log(n,"modifiedAt",new Date(n.modifyAt).toTimeString())}},createConfig:function(e){return new r(e)},createTask:function(e,t,r){return new M(e,t,r)}},S=I;return t.default}()})),Dm=Vn.some,qm=Un("some");nt({target:"Array",proto:!0,forced:!qm},{some:function(e){return Dm(this,e,arguments.length>1?arguments[1]:void 0)}});var Bm=$t("Array").some,Fm=Array.prototype,Gm=function(e){var t=e.some;return e===Fm||j(Fm,e)&&t===Fm.some?Bm:t},jm={debug:function(){},log:function(){},warn:function(){},error:function(){}};function Hm(e){jm=e}function Wm(){if(!navigator||!navigator.userAgent)return!1;var e=[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i];return Gm(e).call(e,(function(e){return navigator.userAgent.match(e)}))}function Km(){var e;return!(!navigator||!navigator.userAgent)&&"object"==typeof navigator&&"string"==typeof navigator.userAgent&&wu(e=navigator.userAgent).call(e,"Electron")>=0}function Ym(){return navigator&&navigator.userAgent}function Qm(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a,s,c;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=jm,e.fileInput||e.file){t.next=3;break}throw new Error("File not exist");case 3:if(!e.file){t.next=7;break}a=e.file,t.next=21;break;case 7:if("string"!=typeof e.fileInput){t.next=16;break}if(!((s=document.getElementById(e.fileInput))&&s.files&&s.files[0])){t.next=13;break}a=s.files[0],t.next=14;break;case 13:throw new Error("Can not get file from fileInput");case 14:t.next=21;break;case 16:if(!(e.fileInput&&e.fileInput.files&&e.fileInput.files[0])){t.next=20;break}a=e.fileInput.files[0],t.next=21;break;case 20:throw new Error("Can not get file from fileInput "+e.fileInput);case 21:if(!(e.maxSize&&a.size>e.maxSize)){t.next=23;break}throw new Error("The file exceeds maxSize limit. maxSize: "+e.maxSize+", get "+a.size);case 23:return t.next=25,new fs((function(t,r){var n,i=Um.getFileUploadInformation(a),s=Um.createConfig({enableCache:!0,retryCount:0,directUploadAddr:e.chunkUploadHost,onError:function(e){r(e)},onUploadProgress:e.onUploadProgress||function(){},onComplete:function(e){t(e)}});if(i)if(i.complete)e.onUploadProgress&&e.onUploadProgress({total:a.size,loaded:a.size,percentage:1,percentageText:"100%"}),t(i.uploadInfo);else{n=Um.createTask(a,i.uploadInfo,s);try{e.onUploadStart&&e.onUploadStart(n)}catch(e){o.error("Adapter uploadFile: options.onUploadStart error",e&&e.message),n.abort(),r(e)}}else{n=Um.createTask(a,dr(dr({bucketName:e.nosToken.bucket,objectName:decodeURIComponent(e.nosToken.objectName),token:e.nosToken.token},e.md5?{md5:e.md5}:{}),e.payload?{payload:e.payload}:{}),s);try{e.onUploadStart&&e.onUploadStart(n)}catch(e){o.error("Adapter uploadFile: options.onUploadStart error",e&&e.message),n.abort(),r(e)}}}));case 25:return(c=t.sent).name=a.name,c.size=a.size,c.type=a.type,c.ext=pp(r=c.name).call(r,".")>-1?Wc(n=c.name).call(n,pp(i=c.name).call(i,".")+1).toLowerCase():"",t.abrupt("return",c);case 31:case"end":return t.stop()}}),t)})))}function Jm(e){var t;if(e.file)t=e.file;else if("string"==typeof e.fileInput){var r=document.getElementById(e.fileInput);if(!(r&&r.files&&r.files[0]))throw new Error("Can not get file from fileInput");t=r.files[0]}else{if(!(e.fileInput&&e.fileInput.files&&e.fileInput.files[0]))throw new Error("Can not get file from fileInput "+e.fileInput);t=e.fileInput.files[0]}return Um.getFileUploadInformation(t)}
/*!
    	 * Platform.js v1.3.6
    	 * Copyright 2014-2020 Benjamin Tan
    	 * Copyright 2011-2013 John-David Dalton
    	 * Available under MIT license
    	 */var zm=n((function(e,r){(function(){var n={function:!0,object:!0}[typeof window]&&window||this,i=r,o=e&&!e.nodeType&&e,a=i&&o&&"object"==typeof t&&t;!a||a.global!==a&&a.window!==a&&a.self!==a||(n=a);var s=Math.pow(2,53)-1,c=/\bOpera/,u=Object.prototype,d=u.hasOwnProperty,l=u.toString;function p(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function m(e){return e=y(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:p(e)}function h(e,t){for(var r in e)d.call(e,r)&&t(e[r],r,e)}function f(e){return null==e?p(e):l.call(e).slice(8,-1)}function g(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function v(e,t){var r=null;return function(e,t){var r=-1,n=e?e.length:0;if("number"==typeof n&&n>-1&&n<=s)for(;++r<n;)t(e[r],r,e);else h(e,t)}(e,(function(n,i){r=t(r,n,i,e)})),r}function y(e){return String(e).replace(/^ +| +$/g,"")}var M=function e(t){var r=n,i=t&&"object"==typeof t&&"String"!=f(t);i&&(r=t,t=null);var o=r.navigator||{},a=o.userAgent||"";t||(t=a);var s,u,d=i?!!o.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(l.toString()),p="Object",M=i?p:"ScriptBridgingProxyObject",I=i?p:"Environment",S=i&&r.java?"JavaPackage":f(r.java),T=i?p:"RuntimeObject",b=/\bJava/.test(S)&&r.java,C=b&&f(r.environment)==I,_=b?"a":"α",E=b?"b":"β",w=r.document||{},R=r.operamini||r.opera,k=c.test(k=i&&R?R["[[Class]]"]:f(R))?k:R=null,A=t,N=[],x=null,O=t==a,P=O&&R&&"function"==typeof R.version&&R.version(),L=function(e){return v(e,(function(e,r){return e||RegExp("\\b"+(r.pattern||g(r))+"\\b","i").exec(t)&&(r.label||r)}))}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),V=function(e){return v(e,(function(e,r){return e||RegExp("\\b"+(r.pattern||g(r))+"\\b","i").exec(t)&&(r.label||r)}))}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),U=B([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),D=function(e){return v(e,(function(e,r,n){return e||(r[U]||r[/^[a-z]+(?: +[a-z]+\b)*/i.exec(U)]||RegExp("\\b"+g(n)+"(?:\\b|\\w*\\d)","i").exec(t))&&n}))}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),q=function(e){return v(e,(function(e,r){var n=r.pattern||g(r);return!e&&(e=RegExp("\\b"+n+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(e=function(e,t,r){var n={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&r&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(n=n[/[\d.]+$/.exec(e)])&&(e="Windows "+n),e=String(e),t&&r&&(e=e.replace(RegExp(t,"i"),r)),m(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(e,n,r.label||r)),e}))}(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function B(e){return v(e,(function(e,r){var n=r.pattern||g(r);return!e&&(e=RegExp("\\b"+n+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+n+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+n+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((e=String(r.label&&!RegExp(n,"i").test(r.label)?r.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),r=r.label||r,e=m(e[0].replace(RegExp(n,"i"),r).replace(RegExp("; *(?:"+r+"[_-])?","i")," ").replace(RegExp("("+r+")[-_.]?(\\w)","i"),"$1 $2"))),e}))}function F(e){return v(e,(function(e,r){return e||(RegExp(r+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null}))}if(L&&(L=[L]),/\bAndroid\b/.test(q)&&!U&&(s=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(t))&&(U=y(s[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),D&&!U?U=B([D]):D&&U&&(U=U.replace(RegExp("^("+g(D)+")[-_.\\s]","i"),D+" ").replace(RegExp("^("+g(D)+")[-_.]?(\\w)","i"),D+" $2")),(s=/\bGoogle TV\b/.exec(U))&&(U=s[0]),/\bSimulator\b/i.test(t)&&(U=(U?U+" ":"")+"Simulator"),"Opera Mini"==V&&/\bOPiOS\b/.test(t)&&N.push("running in Turbo/Uncompressed mode"),"IE"==V&&/\blike iPhone OS\b/.test(t)?(D=(s=e(t.replace(/like iPhone OS/,""))).manufacturer,U=s.product):/^iP/.test(U)?(V||(V="Safari"),q="iOS"+((s=/ OS ([\d_]+)/i.exec(t))?" "+s[1].replace(/_/g,"."):"")):"Konqueror"==V&&/^Linux\b/i.test(q)?q="Kubuntu":D&&"Google"!=D&&(/Chrome/.test(V)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(U))||/\bAndroid\b/.test(q)&&/^Chrome/.test(V)&&/\bVersion\//i.test(t)?(V="Android Browser",q=/\bAndroid\b/.test(q)?q:"Android"):"Silk"==V?(/\bMobi/i.test(t)||(q="Android",N.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&N.unshift("accelerated")):"UC Browser"==V&&/\bUCWEB\b/.test(t)?N.push("speed mode"):"PaleMoon"==V&&(s=/\bFirefox\/([\d.]+)\b/.exec(t))?N.push("identifying as Firefox "+s[1]):"Firefox"==V&&(s=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(q||(q="Firefox OS"),U||(U=s[1])):!V||(s=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(V))?(V&&!U&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(s+"/")+8))&&(V=null),(s=U||D||q)&&(U||D||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(q))&&(V=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(q)?q:s)+" Browser")):"Electron"==V&&(s=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&N.push("Chromium "+s),P||(P=F(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",g(V),"(?:Firefox|Minefield|NetFront)"])),(s=("iCab"==L&&parseFloat(P)>3?"WebKit":/\bOpera\b/.test(V)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(L)&&"WebKit"||!L&&/\bMSIE\b/i.test(t)&&("Mac OS"==q?"Tasman":"Trident")||"WebKit"==L&&/\bPlayStation\b(?! Vita\b)/i.test(V)&&"NetFront")&&(L=[s]),"IE"==V&&(s=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(V+=" Mobile",q="Windows Phone "+(/\+$/.test(s)?s:s+".x"),N.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(V="IE Mobile",q="Windows Phone 8.x",N.unshift("desktop mode"),P||(P=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=V&&"Trident"==L&&(s=/\brv:([\d.]+)/.exec(t))&&(V&&N.push("identifying as "+V+(P?" "+P:"")),V="IE",P=s[1]),O){if(function(e,t){var r=null!=e?typeof e[t]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(r)||"object"==r&&!e[t])}(r,"global"))if(b&&(A=(s=b.lang.System).getProperty("os.arch"),q=q||s.getProperty("os.name")+" "+s.getProperty("os.version")),C){try{P=r.require("ringo/engine").version.join("."),V="RingoJS"}catch(t){(s=r.system)&&s.global.system==r.system&&(V="Narwhal",q||(q=s[0].os||null))}V||(V="Rhino")}else"object"==typeof r.process&&!r.process.browser&&(s=r.process)&&("object"==typeof s.versions&&("string"==typeof s.versions.electron?(N.push("Node "+s.versions.node),V="Electron",P=s.versions.electron):"string"==typeof s.versions.nw&&(N.push("Chromium "+P,"Node "+s.versions.node),V="NW.js",P=s.versions.nw)),V||(V="Node.js",A=s.arch,q=s.platform,P=(P=/[\d.]+/.exec(s.version))?P[0]:null));else f(s=r.runtime)==M?(V="Adobe AIR",q=s.flash.system.Capabilities.os):f(s=r.phantom)==T?(V="PhantomJS",P=(s=s.version||null)&&s.major+"."+s.minor+"."+s.patch):"number"==typeof w.documentMode&&(s=/\bTrident\/(\d+)/i.exec(t))?(P=[P,w.documentMode],(s=+s[1]+4)!=P[1]&&(N.push("IE "+P[1]+" mode"),L&&(L[1]=""),P[1]=s),P="IE"==V?String(P[1].toFixed(1)):P[0]):"number"==typeof w.documentMode&&/^(?:Chrome|Firefox)\b/.test(V)&&(N.push("masking as "+V+" "+P),V="IE",P="11.0",L=["Trident"],q="Windows");q=q&&m(q)}if(P&&(s=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(P)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(O&&o.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(x=/b/i.test(s)?"beta":"alpha",P=P.replace(RegExp(s+"\\+?$"),"")+("beta"==x?E:_)+(/\d+\+?/.exec(s)||"")),"Fennec"==V||"Firefox"==V&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(q))V="Firefox Mobile";else if("Maxthon"==V&&P)P=P.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(U))"Xbox 360"==U&&(q=null),"Xbox 360"==U&&/\bIEMobile\b/.test(t)&&N.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(V)&&(!V||U||/Browser|Mobi/.test(V))||"Windows CE"!=q&&!/Mobi/i.test(t))if("IE"==V&&O)try{null===r.external&&N.unshift("platform preview")}catch(t){N.unshift("embedded")}else(/\bBlackBerry\b/.test(U)||/\bBB10\b/.test(t))&&(s=(RegExp(U.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||P)?(q=((s=[s,/BB10/.test(t)])[1]?(U=null,D="BlackBerry"):"Device Software")+" "+s[0],P=null):this!=h&&"Wii"!=U&&(O&&R||/Opera/.test(V)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==V&&/\bOS X (?:\d+\.){2,}/.test(q)||"IE"==V&&(q&&!/^Win/.test(q)&&P>5.5||/\bWindows XP\b/.test(q)&&P>8||8==P&&!/\bTrident\b/.test(t)))&&!c.test(s=e.call(h,t.replace(c,"")+";"))&&s.name&&(s="ing as "+s.name+((s=s.version)?" "+s:""),c.test(V)?(/\bIE\b/.test(s)&&"Mac OS"==q&&(q=null),s="identify"+s):(s="mask"+s,V=k?m(k.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(s)&&(q=null),O||(P=null)),L=["Presto"],N.push(s));else V+=" Mobile";(s=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(s=[parseFloat(s.replace(/\.(\d)$/,".0$1")),s],"Safari"==V&&"+"==s[1].slice(-1)?(V="WebKit Nightly",x="alpha",P=s[1].slice(0,-1)):P!=s[1]&&P!=(s[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(P=null),s[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(t)||0)[1],537.36==s[0]&&537.36==s[2]&&parseFloat(s[1])>=28&&"WebKit"==L&&(L=["Blink"]),O&&(d||s[1])?(L&&(L[1]="like Chrome"),s=s[1]||((s=s[0])<530?1:s<532?2:s<532.05?3:s<533?4:s<534.03?5:s<534.07?6:s<534.1?7:s<534.13?8:s<534.16?9:s<534.24?10:s<534.3?11:s<535.01?12:s<535.02?"13+":s<535.07?15:s<535.11?16:s<535.19?17:s<536.05?18:s<536.1?19:s<537.01?20:s<537.11?"21+":s<537.13?23:s<537.18?24:s<537.24?25:s<537.36?26:"Blink"!=L?"27":"28")):(L&&(L[1]="like Safari"),s=(s=s[0])<400?1:s<500?2:s<526?3:s<533?4:s<534?"4+":s<535?5:s<537?6:s<538?7:s<601?8:s<602?9:s<604?10:s<606?11:s<608?12:"12"),L&&(L[1]+=" "+(s+="number"==typeof s?".x":/[.+]/.test(s)?"":"+")),"Safari"==V&&(!P||parseInt(P)>45)?P=s:"Chrome"==V&&/\bHeadlessChrome/i.test(t)&&N.unshift("headless")),"Opera"==V&&(s=/\bzbov|zvav$/.exec(q))?(V+=" ",N.unshift("desktop mode"),"zvav"==s?(V+="Mini",P=null):V+="Mobile",q=q.replace(RegExp(" *"+s+"$"),"")):"Safari"==V&&/\bChrome\b/.exec(L&&L[1])?(N.unshift("desktop mode"),V="Chrome Mobile",P=null,/\bOS X\b/.test(q)?(D="Apple",q="iOS 4.3+"):q=null):/\bSRWare Iron\b/.test(V)&&!P&&(P=F("Chrome")),P&&0==P.indexOf(s=/[\d.]+$/.exec(q))&&t.indexOf("/"+s+"-")>-1&&(q=y(q.replace(s,""))),q&&-1!=q.indexOf(V)&&!RegExp(V+" OS").test(q)&&(q=q.replace(RegExp(" *"+g(V)+" *"),"")),L&&!/\b(?:Avant|Nook)\b/.test(V)&&(/Browser|Lunascape|Maxthon/.test(V)||"Safari"!=V&&/^iOS/.test(q)&&/\bSafari\b/.test(L[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(V)&&L[1])&&(s=L[L.length-1])&&N.push(s),N.length&&(N=["("+N.join("; ")+")"]),D&&U&&U.indexOf(D)<0&&N.push("on "+D),U&&N.push((/^on /.test(N[N.length-1])?"":"on ")+U),q&&(s=/ ([\d.+]+)$/.exec(q),u=s&&"/"==q.charAt(q.length-s[0].length-1),q={architecture:32,family:s&&!u?q.replace(s[0],""):q,version:s?s[1]:null,toString:function(){var e=this.version;return this.family+(e&&!u?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(s=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(A))&&!/\bi686\b/i.test(A)?(q&&(q.architecture=64,q.family=q.family.replace(RegExp(" *"+s),"")),V&&(/\bWOW64\b/i.test(t)||O&&/\w(?:86|32)$/.test(o.cpuClass||o.platform)&&!/\bWin64; x64\b/i.test(t))&&N.unshift("32-bit")):q&&/^OS X/.test(q.family)&&"Chrome"==V&&parseFloat(P)>=39&&(q.architecture=64),t||(t=null);var G={};return G.description=t,G.layout=L&&L[0],G.manufacturer=D,G.name=V,G.prerelease=x,G.product=U,G.ua=t,G.version=V&&P,G.os=q||{architecture:null,family:null,version:null,toString:function(){return"null"}},G.parse=e,G.toString=function(){return this.description||""},G.version&&N.unshift(P),G.name&&N.unshift(V),q&&V&&(q!=String(q).split(" ")[0]||q!=V.split(" ")[0]&&!U)&&N.push(U?"("+q+")":"on "+q),N.length&&(G.description=N.join(" ")),G}();i&&o?h(M,(function(e,t){i[t]=e})):n.platform=M}).call(t)}));function Xm(){var e,t,r=zm.version||"";if(Km())try{var n=navigator.userAgent.match(/Electron\/([\d.]+\d+)/);n&&n[1]&&"string"==typeof n[1]&&(r=n[1])}catch(e){}return{os:(null===(e=zm.os)||void 0===e?void 0:e.family)||"",osVer:(null===(t=zm.os)||void 0===t?void 0:t.version)||"",browser:zm.name||"",browserVer:zm.version||"",libEnv:"BROWSER",hostEnv:Km()?"Electron":Wm()?"H5":Ym()?"BROWSER":"Unset",hostEnvEnum:Km()?5:Wm()?101:Ym()?100:0,hostEnvVer:r,userAgent:navigator&&navigator.userAgent,model:r,manufactor:zm.name||""}}var $m=null,Zm=null,eh={getNetworkStatus:function(){return fs.resolve({net_type:0,net_connect:"undefined"==typeof navigator||"boolean"!=typeof navigator.onLine||navigator.onLine})},onNetworkStatusChange:function(e){$m=function(){e({isConnected:!0,networkType:0})},Zm=function(){e({isConnected:!1,networkType:0})},window.addEventListener("online",$m),window.addEventListener("offline",Zm)},offNetworkStatusChange:function(){$m&&window.removeEventListener("online",$m),Zm&&window.removeEventListener("offline",Zm),$m=null,Zm=null}},th=Vn.find,rh=!0;"find"in[]&&Array(1).find((function(){rh=!1})),nt({target:"Array",proto:!0,forced:rh},{find:function(e){return th(this,e,arguments.length>1?arguments[1]:void 0)}});var nh=$t("Array").find,ih=Array.prototype,oh=function(e){var t=e.find;return e===ih||j(ih,e)&&t===ih.find?nh:t},ah="log",sh=function(){function e(e,t){this.db=null,this.stores=[],this.name=e,this.version=t}var t=e.prototype;return t.setName=function(e){this.name=e},t.getDB=function(){if(!this.db)throw new Error("DB not ready");return this.db},t.getStore=function(e){var t,r=oh(t=this.stores).call(t,(function(t){return t.storeName===e}));if(!r)throw new Error("LogStorage: store not found. "+e);return r},t.open=function(){var e=this,t=window.indexedDB.open(this.name,this.version);return new fs((function(r,n){t.onerror=function(e){var t=e.target;n(t.error)},t.onsuccess=function(t){var n,i,o=t.target;e.db=o.result,e.db.removeEventListener("close",tr(n=e.triggerDBCloseEvt).call(n,e)),e.db.addEventListener("close",tr(i=e.triggerDBCloseEvt).call(i,e)),e.stores.push(new ch(ah,e)),r()},t.onupgradeneeded=function(t){var r=t.target;e.upgradeDBBySchema(r)}}))},t.triggerDBCloseEvt=function(){try{this.db&&this.db.close(),this.db=null}catch(e){}this.open()},t.upgradeDBBySchema=function(e){var t=e.result,r=e.transaction&&t.objectStoreNames.contains(ah)?e.transaction.objectStore(ah):t.createObjectStore(ah,{keyPath:"id",autoIncrement:!0});try{r.index("time")}catch(e){r.createIndex("time","time",{unique:!1})}},t.close=function(){var e;this.db&&(this.db.removeEventListener("close",tr(e=this.triggerDBCloseEvt).call(e,this)),this.db.close(),this.stores=[],this.db=null)},e}(),ch=function(){function e(e,t){this.idb=null,this.storeName=e,this.idb=t}var t=e.prototype;return t.getDB=function(){if(!this.idb)throw new Error("DB not ready");return this.idb.getDB()},t.getStoreName=function(){return this.storeName},t.bulkCreate=function(e){var t=this.getDB(),r=this.getStoreName(),n=t.transaction(r,"readwrite"),i=n.objectStore(r);return jn(e).call(e,(function(e){i.add(e)})),new fs((function(e,t){n.oncomplete=function(){e()},n.onerror=function(e){var r=e.target;t(r.error)},n.onabort=function(e){var r=e.target;r.error instanceof Error?t(r.error):t(new Error("TransactionAborted"))}}))},t.bulkDelete=function(e){var t=e.keyName,r=e.lower,n=e.upper,i=e.lowerOpen,o=void 0!==i&&i,a=e.upperOpen,s=void 0!==a&&a,c=IDBKeyRange.bound(r,n,o,s),u=this.getDB(),d=this.getStoreName(),l=u.transaction(d,"readwrite"),p=l.objectStore(d).index(t).openCursor(c),m=0;return p.onsuccess=function(e){var t=e.target.result;t&&(t.delete(),m++,t.continue())},new fs((function(e,t){l.oncomplete=function(){e(m)},l.onerror=function(e){var r=e.target;t(r.error)},l.onabort=function(e){var r=e.target;r.error instanceof Error?t(r.error):t(new Error("TransactionAborted"))}}))},t.readAllAndClear=function(){var e=this.getDB(),t=this.getStoreName(),r=e.transaction(t,"readwrite").objectStore(t);if(!r.getAll)throw new Error("IDBExtract not support");var n=r.getAll();return new fs((function(e,t){n.onsuccess=function(t){var n=t.target;r.clear(),e(n.result)},n.onerror=function(e){var r=e.target;t(r.error)}}))},e}(),uh=function(){function e(e){void 0===e&&(e="nim-logs"),this.idb=new sh(e,1)}var t=e.prototype;return t.open=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e&&this.idb.setName(e),t.next=3,this.idb.open();case 3:return r=this.idb.getStore(ah),t.prev=4,t.next=7,r.bulkDelete({keyName:"time",lower:0,upper:_s()-2592e5});case 7:t.next=11;break;case 9:t.prev=9,t.t0=t.catch(4);case 11:case"end":return t.stop()}}),t,this,[[4,9]])})))},t.close=function(){this.idb.close()},t.addLogs=function(e){return this.idb.getStore(ah).bulkCreate(e)},t.extractLogs=function(){return zl(this,void 0,void 0,Ql.mark((function e(){var t,r,n,i,o;return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.idb.getStore(ah),e.next=3,r.readAllAndClear();case 3:if(0!==(n=e.sent).length){e.next=6;break}return e.abrupt("return","");case 6:return i=Ml(n).call(n,(function(e,t){var r=t.iid;return e[r]||(e[r]=[]),e[r].push(t),e}),{}),o=du(t=fr(i)).call(t,(function(e){var t=i[e];return"==========iid:"+e+"==========\n "+du(t).call(t,(function(e){return e.text})).join("\n")})).join("\n"),e.abrupt("return",new File([o],"nim-logs.txt",{type:"text/plain"}));case 9:case"end":return e.stop()}}),e,this)})))},e}();function dh(e,t){var r,n=void 0!==Nc&&Fl(e)||e["@@iterator"];if(n)return tr(r=(n=n.call(e)).next).call(r,n);if(Ei(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return lh(e,t);var n=Wc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Bl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?lh(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function lh(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var ph={},mh={};function hh(e,t,r,n){var i=ph[e];if(!i)return r.error("createCmd:: can not find cmd config: ",e),null;var o,a={SER:t,SID:i.sid,CID:i.cid,Q:[]};return i.params&&n&&jn(o=i.params).call(o,(function(e){var t=n[e.name];if(null!=t){var r=e.type,i=e.reflectMapper,o=e.select;switch(e.type){case"PropertyArray":r="ArrayMable",t=du(t).call(t,(function(e){return{t:"Property",v:i?vh(e,i,o):e}}));break;case"Property":t=i?vh(t,i,o):t;break;case"Bool":t=t?"true":"false"}a.Q.push({t:r,v:t})}})),{packet:a,hasPacketResponse:"boolean"!=typeof i.hasPacketResponse||i.hasPacketResponse,hasPacketTimer:"boolean"!=typeof i.hasPacketTimer||i.hasPacketTimer}}function fh(e,t){var r,n;try{n=JSON.parse(e)}catch(r){return void t.error('Parse command error:"'+e+'"')}var i=n.sid+"_"+n.cid,o=n.r;if(ou(r=["4_1","4_2","4_10","4_11"]).call(r,i)){var a=n.r[1].headerPacket;i=a.sid+"_"+a.cid,n.sid=a.sid,n.cid=a.cid,o=n.r[1].body}var s=mh[i],c=[];if(s){for(var u,d=dh(s);!(u=d()).done;){var l=u.value;c.push(gh(n,l.config,l.cmd,o,t))}return c}t.error("parseCmd:: mapper not exist",i,n.code)}function gh(e,t,r,n,i){var o,a={cmd:r,raw:e,error:null,service:null==t?void 0:t.service,content:{},__receiveTimeNode:rm.getTimeNode()};if(!r||!t)return a.notFound=!0,a;(18===t.sid||t.sid>=26&&t.sid<100)&&(e.code=function(e){if("number"!=typeof e||e!=e)throw new _l({code:Tl.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"Read code failed",rawData:""+e}});if(e<0||e>=0&&e<1e3||e>=2e4&&e<=20099)return e;var t=(65535&e)>>9;return 1e5+1e3*(t-=t<=38?1:2)+(511&e)}(e.code));var s,c=function(e,t){var r=bl[e],n=Nl[e];return null===n?null:new _l({code:e,desc:r||n||e,detail:{cmd:t,timetag:_s()}})}(e.code,r);if(a.error=c,a.error){if(a.error.detail.cmd=r,!(null===(o=null==t?void 0:t.ignoreErrCodes)||void 0===o?void 0:ou(o).call(o,e.code)))return a;i.warn("parseCmd:: ignore error ",a.error),a.error.detail.ignore=!0}return t.response&&jn(s=t.response).call(s,(function(e,t){var r=n[t],i=e.type,o=e.name,s=e.reflectMapper;if(void 0!==r)switch(i){case"Property":a.content[o]=s?yh(r,s):r;break;case"PropertyArray":a.content[o]=du(r).call(r,(function(e){return s?yh(e,s):e}));break;case"Int":case"Long":case"Byte":a.content[o]=+r;break;case"Bool":a.content[o]="true"===r||!0===r||1===r;break;default:a.content[o]=r}})),a}function vh(e,t,r){var n={};for(var i in e=function(e,t){var r={};for(var n in t){for(var i,o=t[n],a="number"==typeof o?n:o.access?o.access:n,s=e,c=dh(a.split("."));!(i=c()).done;){var u=i.value;if(void 0===s[u]||null===s[u]){s=void 0;break}s=s[u]}void 0!==s&&(r[a]=s)}return r}(e,t),t){var o=t[i],a="number"==typeof o?i:o.access?o.access:i;if(!r||ou(r).call(r,i))if(a in e){if("number"==typeof o)n[o]=e[a];else if("object"==typeof o)if(o.converter){var s=o.converter(e[a],e);void 0!==s&&(n[o.id]=s)}else n[o.id]=e[a]}else"object"==typeof o&&o.def&&("function"==typeof o.def?n[o.id]=o.def(e):n[o.id]=o.def)}return n}function yh(e,t){var r={};for(var n in e){var i=t[n];if("string"==typeof i)r[i]=e[n];else if("object"==typeof i&&"prop"in i){var o=i.access?i.access:i.prop;if(i.converter){var a=i.converter(e[n],e);void 0!==a&&(r[o]=a)}else i.type&&"number"===i.type?r[o]=+e[n]:i.type&&"boolean"===i.type?r[o]=!("0"===e[n]||!e[n]):r[o]=e[n]}}for(var s in t){var c=t[s];if(c&&void 0!==c.def){var u=c.access?c.access:c.prop;u in r||("function"==typeof c.def?r[u]=c.def(e):r[u]=c.def)}}return r=function(e){var t={},r=function(r){var n=r.split(".");Ml(n).call(n,(function(t,i,o){return t[i]||(t[i]=isNaN(Number(n[o+1]))?n.length-1==o?e[r]:{}:[])}),t)};for(var n in e)r(n);return t}(r),r}function Mh(e){for(var t in dr(ph,e.cmdConfig),e.cmdMap){var r=e.cmdMap[t],n=e.cmdConfig[r];if(n)if(Ei(mh[t])){for(var i,o=!1,a=dh(mh[t]);!(i=a()).done;){var s=i.value;if(s.cmd===r&&s.config.service===n.service){o=!0;break}}o||mh[t].push({config:n,cmd:r})}else mh[t]=[{config:n,cmd:r}]}}function Ih(e){var t,r={};return jn(t=fr(e)).call(t,(function(t){r[t]=Sh(e[t])})),r}function Sh(e){var t={};for(var r in e){var n=e[r];"number"==typeof n?t[n]=r:"object"==typeof n&&(t[n.id]={prop:r,type:n.retType,access:n.retAccess?n.retAccess:n.access?n.access:r,def:n.retDef,converter:n.retConverter})}return t}function Th(e){return e?1:0}function bh(e){if(e&&"object"==typeof e)try{return _i(e)}catch(e){return}}function Ch(e){if(e&&"string"==typeof e)try{return JSON.parse(e)}catch(e){return}}var _h,Eh,wh,Rh,kh,Ah={"1_2":"heartbeat","2_3":"login","2_5":"kicked","2_6":"logout","2_7":"nimLoginClientChange","2_8":"kick"},Nh={login:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,deviceId:13,appkey:18,account:19,browser:24,clientSession:26,deviceInfo:32,isReactNative:112,token:1e3,customTag:38,customClientType:39,sdkHumanVersion:40,hostEnv:41,userAgent:42,libEnv:44,authType:115,loginExt:116},loginRes:{lastLoginDeviceId:17,customTag:38,connectionId:102,ip:103,port:104,country:106,hasXMPush:111},loginPort:{type:3,os:4,mac:5,deviceId:13,account:19,deviceInfo:32,customTag:38,customClientType:39,connectionId:102,ip:103,port:104,time:109,pushType:110,hasTokenPreviously:111},aosPushInfo:{pushType:110,hasTokenPreviously:111}},xh=Ih(Nh),Oh={login:{sid:2,cid:3,service:"auth",params:[{type:"Property",name:"login",reflectMapper:Nh.login}],response:[{type:"Property",name:"loginRes",reflectMapper:xh.loginRes},{type:"PropertyArray",name:"loginPorts",reflectMapper:xh.loginPort},{type:"Property",name:"aosPushInfo",reflectMapper:xh.aosPushInfo}]},logout:{sid:2,cid:6,service:"auth"},heartbeat:{sid:1,cid:2,service:"auth"},kicked:{sid:2,cid:5,service:"auth",response:[{type:"Int",name:"clientType"},{type:"Int",name:"reason"},{type:"String",name:"ext"},{type:"Int",name:"customClientType"}]},nimLoginClientChange:{sid:2,cid:7,service:"auth",response:[{type:"Byte",name:"state"},{type:"PropertyArray",name:"datas",reflectMapper:xh.loginPort}]},kick:{sid:2,cid:8,service:"auth",params:[{type:"StrArray",name:"deviceIds"}],response:[{type:"StrArray",name:"deviceIds"}]}};function Ph(e,t){if(!Xl(t))return{};var r=JSON.parse(_i(t)),n=Lh(e,r);return JSON.parse(_i(dr(dr({},r),n)))}function Lh(e,t){if(!Xl(t))return{};var r={},n=fr(e);return jn(n).call(n,(function(n){var i=e[n].type;if("string"!=typeof i){var o=Lh(e[n],t);fr(o).length>0&&(r[n]=o)}else{var a=e[n],s=a.rawKey||n,c=Vh[i](t,s,a);void 0!==c&&(t[s]=void 0,r[n]=c)}})),r}!function(e){e[e.text=0]="text",e[e.image=1]="image",e[e.audio=2]="audio",e[e.video=3]="video",e[e.geo=4]="geo",e[e.notification=5]="notification",e[e.file=6]="file",e[e.tip=10]="tip",e[e.robot=11]="robot",e[e.g2=12]="g2",e[e.custom=100]="custom"}(_h||(_h={})),function(e){e[e.p2p=0]="p2p",e[e.team=1]="team",e[e.superTeam=5]="superTeam"}(Eh||(Eh={})),function(e){e[e.Android=1]="Android",e[e.iOS=2]="iOS",e[e.PC=4]="PC",e[e.WindowsPhone=8]="WindowsPhone",e[e.Web=16]="Web",e[e.Server=32]="Server",e[e.Mac=64]="Mac",e[e.HarmonyOS=65]="HarmonyOS"}(wh||(wh={})),function(e){e[e.unread=1]="unread",e[e.read=2]="read",e[e.deleted=3]="deleted",e[e.sending=4]="sending",e[e.sendFailed=5]="sendFailed",e[e.sent=6]="sent",e[e.receipt=7]="receipt",e[e.refused=10]="refused"}(Rh||(Rh={})),function(e){e[e.default=0]="default",e[e.leave=1]="leave",e[e.roam=2]="roam"}(kh||(kh={}));var Vh={number:function(e,t){if(void 0!==e[t])return+e[t]},string:function(e,t){if(void 0!==e[t])return e[t]},boolean:function(e,t){return+e[t]>0||0!=+e[t]&&void 0},enum:function(e,t,r){return Iu(r)[e[t]]},object:function(e,t){if(void 0!==e[t])try{return JSON.parse(e[t])}catch(e){return{}}}};function Uh(e,t){if(!Xl(t))return{};var r=JSON.parse(_i(t)),n=Dh(e,r);return JSON.parse(_i(dr(dr({},r),n)))}function Dh(e,t){var r;if(!Xl(t))return Ml(r=fr(e)).call(r,(function(t,r){return t[e[r].rawKey||r]=void 0,t}),{});var n={},i=fr(e);return jn(i).call(i,(function(r){var i=e[r].type;if("string"!=typeof i){var o=Dh(e[r],t[r]);return dr(n,o),void(t[r]=void 0)}var a=e[r],s=a.rawKey||r,c=qh[i](t,r,a);t[s]=void 0,n[s]=c})),n}var qh={number:function(e,t){return e[t]},string:function(e,t){return e[t]},boolean:function(e,t){return!0===e[t]?1:!1===e[t]?0:void 0},enum:function(e,t,r){return Iu(r)[e[t]]},object:function(e,t){if(void 0!==e[t])try{return _i(e[t])}catch(e){return""}}},Bh=qh;function Fh(e,t){return e&&e.length>0?du(e).call(e,(function(e){return dr(dr({},e),{account:e.account,connectionId:e.connectionId,deviceId:e.deviceId,ip:e.ip,mac:e.mac,os:e.os,type:Rp(wh,e.type)||e.type,time:$p(e.time),online:3!==t})})):[]}var Gh={1:{reason:"samePlatformKick",message:"The same account is not allowed to multiple login at the same time"},2:{reason:"serverKick",message:"Kicked out by IM server"},3:{reason:"otherPlatformKick",message:"Kicked out by other client of your account"},4:{reason:"silentlyKick",message:"Quietly kicked"}},jh=Hh;function Hh(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Hh.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=1&Math.floor(10*t)?e+r:e-r}return 0|Math.min(e,this.max)},Hh.prototype.reset=function(){this.attempts=0},Hh.prototype.setMin=function(e){this.ms=e},Hh.prototype.setMax=function(e){this.max=e},Hh.prototype.setJitter=function(e){this.jitter=e};var Wh,Kh=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],Yh=["transport not supported","client not handshaken","unauthorized"],Qh=["reconnect"],Jh=function(e){function t(t,r){var n;return(n=e.call(this)||this).url=r,n.websocket=null,n.socketConnectTimer=0,n.core=t,n.url=r,n.status="disconnected",n.logger=t.logger,n.connect(),n}nr(t,e);var r=t.prototype;return r.connect=function(){var e=this;"connecting"!==this.status&&"connected"!==this.status?(this.status="connecting",this.core.adapters.request("https://"+this.url+"/socket.io/1/?t="+_s(),{method:"GET",dataType:"text",timeout:this.core.options.xhrConnectTimeout||8e3},{exception_service:6}).then((function(t){if("connecting"===e.status){var r=t.data.split(":"),n=r[0];return r[1],e.sessionId=n,e.logger.log("imsocket::XHR success. status "+e.status+", "+("connecting"===e.status?"continue websocket connection":"stop websocket connection")),e._createWebsocket("wss://"+e.url+"/socket.io/1/websocket/"+n)}})).catch((function(t){if("connecting"===e.status){var r='imsocket::XHR fail. raw message: "'+(t=t||{}).message+'", code: "'+t.code+'"',n=t.code;n="v2"===Zp(e.core,"options.apiVersion")?t.code===Tl.V2NIM_ERROR_CODE_CONNECT_TIMEOUT?Tl.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:Tl.V2NIM_ERROR_CODE_CONNECT_FAILED:408===t.code?408:415;var i=new _l({code:n,detail:{reason:r,rawError:t}});e.logger.error(r),e.status="disconnected",e.emit("handshakeFailed",i)}}))):this.logger.warn("imsocket::socket is connecting or connected",this.status)},r.close=function(){if(this.status="disconnected",this.websocket){this.logger.log("imsocket:: close websocket");try{this.websocket.send(this.encodePacket({type:"disconnect"}))}catch(e){this.logger.warn("imsocket::attempt to send encodePacket error",e)}try{this.websocket.close()}catch(e){this.logger.warn("imsocket::attempt to close websocket error",e)}this.clean(),this.emit("disconnect",{code:0,reason:"Active close websocket"})}},r.clean=function(){this.status="disconnected",clearTimeout(this.socketConnectTimer),this.websocket&&(this.socketUrl=void 0,this.websocket.onmessage=null,this.websocket.onopen=null,this.websocket.onerror=null,this.websocket.onclose=null,this.websocket=null)},r.onConnect=function(){this.status="connected",this.emit("connect"),clearTimeout(this.socketConnectTimer)},r._createWebsocket=function(e){var t,r=this;this.socketConnectTimer=qs((function(){r.logger.error("imsocket::Websocket connect timeout. url: ",r.socketUrl),r.emit("handshakeFailed",new _l({code:"v2"===Zp(r.core,"options.apiVersion")?Tl.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:415,detail:{reason:"imsocket::Websocket connect timeout. url: "+r.socketUrl}}))}),this.core.options.socketConnectTimeout||8e3),this.socketUrl=e,this.websocket=new Zl.WebSocket(e),this.websocket.onmessage=tr(t=this.onMessage).call(t,this),this.websocket.onclose=function(e){var t=(null==e?void 0:e.reason)||(null==e?void 0:e.message)||(null==e?void 0:e.errMsg)||"websocket.onclose";r.logger.log("imsocket::Websocket onclose done. code is "+(null==e?void 0:e.code)+" and reason is "+t),r.clean(),r.emit("disconnect",{code:(null==e?void 0:e.code)||0,reason:t})},this.websocket.onerror=function(e){r.logger.error("imsocket::Websocket onerror",e),"logined"===r.core.status&&r.core.clientSocket.ping()}},r.onMessage=function(e){var t,r=this.decodePacket(e.data);if(r)switch(r.type){case"connect":this.onConnect();break;case"disconnect":this.close(),this.emit("disconnect",{code:0,reason:"MessageEvent type disconnect"});break;case"message":case"json":this.emit("message",r.data);break;case"event":r.name&&this.emit(r.name,r.args);break;case"error":"unauthorized"===r.reason?this.emit("connect_failed",r.reason):this.emit("error",r.reason),this.logger.error("imsocket::Websocket connect failed, onmessage type error. url: ",this.socketUrl),clearTimeout(this.socketConnectTimer),this.emit("handshakeFailed",new _l({code:"v2"===Zp(this.core,"options.apiVersion")?Tl.V2NIM_ERROR_CODE_CONNECT_FAILED:408,detail:{reason:"imsocket::Websocket connect failed, onMessage socket error. url: "+this.socketUrl}}));break;case"heartbeat":null===(t=this.websocket)||void 0===t||t.send(this.encodePacket({type:"heartbeat"}));break;default:this.logger.warn("imsocket::Websocket no handler type",r.type)}},r.encodePacket=function(e){var t,r,n=e.type,i=e.id,o=void 0===i?"":i,a=e.endpoint,s=void 0===a?"":a,c=e.ack,u=null;if(!n)return"";switch(n){case"error":t=e.reason?wu(Yh).call(Yh,e.reason):"",r=e.advice?wu(Qh).call(Qh,e.advice):"",""===t&&""===r||(u=t+(""!==r?"+"+r:""));break;case"message":""!==e.data&&(u=e.data);break;case"event":t={name:e.name},t=e.args&&e.args.length?{name:e.name,args:e.args}:{name:e.name},u=_i(t);break;case"json":u=_i(e.data);break;case"connect":e.qs&&(u=e.qs);break;case"ack":u=e.ackId+(e.args&&e.args.length?"+"+_i(e.args):"")}var d=[wu(Kh).call(Kh,n),o+("data"===c?"+":""),s];return null!=u&&d.push(u),d.join(":")},r.decodePacket=function(e){if(e)if("�"!=e.charAt(0)){var t=e.match(/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/);if(t){var r,n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],c={type:Kh[+n],endpoint:a};switch(i&&(c.id=i,c.ack=!o||"data"),c.type){case"error":r=s.split("+"),c.reason=Yh[+r[0]]||"";break;case"message":c.data=s||"";break;case"connect":c.qs=s||"";break;case"event":try{var u=JSON.parse(s);c.name=u.name,c.args=u.args}catch(e){this.logger.error("imsocket::parseData::type::event error",e)}c.args=c.args||[];break;case"json":try{c.data=JSON.parse(s)}catch(e){this.logger.error("imsocket::parseData::type::json error",e)}break;case"ack":if((r=s.match(/^([0-9]+)(\+)?(.*)/))&&(c.ackId=r[1],c.args=[],r[3]))try{c.args=r[3]?JSON.parse(r[3]):[]}catch(e){this.logger.error("imsocket::parseData::type::ack error",e)}}return c}}else this.logger.error("imsocket::unrecognize dataStr",Wc(e).call(e,0,20))},r.send=function(e){var t,r={data:e,type:"message",endpoint:""};null===(t=this.websocket)||void 0===t||t.send(this.encodePacket(r))},t}(Bs);function zh(e){e=e||[];for(var t=[],r=0;r<e.length;r++)-1===wu(t).call(t,e[r])&&t.push(e[r]);return t}function Xh(e,t){var r,n=void 0!==Nc&&Fl(e)||e["@@iterator"];if(n)return tr(r=(n=n.call(e)).next).call(r,n);if(Ei(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return $h(e,t);var n=Wc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Bl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$h(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function $h(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}!function(e){e[e.ACTIVE=1]="ACTIVE",e[e.KICKED=2]="KICKED",e[e.OFFLINE=3]="OFFLINE"}(Wh||(Wh={}));var Zh=function(){function e(e,t){this.linkUrls=[],this.isAutoReconnect=!1,this.packetTimeout=3e4,this.packetSer=1,this.retryCount=0,this.reconnectTimer=0,this.backoff=new jh({max:8e3,min:1600,jitter:.01}),this.sendingCmdMap=new ad,this.pingTimer=0,this.hasNetworkListener=!1,this.core=e,t&&(this.auth=t),this.logger=e.logger,this.reporter=e.reporter,this.timerManager=e.timerManager}var t=e.prototype;return t.setSessionId=function(e){},t.connect=function(e,t){return void 0===e&&(e={}),zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o,a,s,c;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(Pl({linkUrls:{type:"array",itemType:"string",required:!1}},e),/^(unconnected|waitReconnect)$/.test(this.core.status)){r.next=5;break}return n="Core socket status is "+this.core.status+", and would not connect",this.logger.warn(n),r.abrupt("return",fs.reject(n));case 5:this.core.status="connecting",e.linkUrls&&e.linkUrls.length>0&&(this.linkUrls=xs(i=e.linkUrls).call(i,this.linkUrls),this.linkUrls=zh(this.linkUrls)),0===this.linkUrls.length&&this.linkUrls.push(Up),o=0;case 9:if(!(o<this.linkUrls.length)){r.next=31;break}return a=this.linkUrls[o],s=(new Date).getTime(),r.prev=12,r.next=15,this.doConnect(a);case 15:return this.core.status="connected",this.logger.log("clientsocketV1::connect success with url: "+a),r.abrupt("return",a);case 20:r.prev=20,r.t0=r.catch(12),c=r.t0,t&&t(c,a),this.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account,start_time:s,action:0,exception_service:6}),this.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof c.code?c.code:0,description:c.message||""+c.code,operation_type:0,target:a},{asyncParams:Zl.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1),this.logger.warn("clientsocketV1::connect failed with url: "+a,r.t0);case 28:o++,r.next=9;break;case 31:throw 0===this.retryCount?this.doDisconnect(Wh.ACTIVE,"SocketHandshakeFailed"):this.doDisconnect(Wh.OFFLINE,"ReconnectHadRetryAllLinks"),new Error("clientSocketV1::socket xhr or socket connect failed");case 33:case"end":return r.stop()}}),r,this,[[12,20]])})))},t.doConnect=function(e){var t=this,r=!1;return new fs((function(n,i){var o;t.socket=new Jh(t.core,e),t.socket.on("connect",(function(){t.logger.log("clientSocketV1::on connect",e),t.core.reporterHookLinkKeep&&(t.core.reporterHookLinkKeep.start(),t.core.reporterHookLinkKeep.update({code:0,description:"connection begin",operation_type:0,target:e})),r=!0,n()})),t.socket.on("message",tr(o=t.onMessage).call(o,t)),t.socket.on("disconnect",(function(n){return zl(t,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.logger.log("clientSocketV1::socket on disconnect",n),!this.core.reporterHookLinkKeep){t.next=5;break}return t.next=4,this.core.reporterHookLinkKeep.update({code:(null==n?void 0:n.code)||0,description:(null==n?void 0:n.reason)||"socket on disconnect",operation_type:1,target:e});case 4:this.core.reporterHookLinkKeep.end(!1);case 5:r=!0,this.doDisconnect(Wh.OFFLINE,"SocketOnDisconnect");case 7:case"end":return t.stop()}}),t,this)})))})),t.socket.on("handshakeFailed",(function(e){r?t.ping():(t.logger.error('clientsocketV1::handshake failed: "'+(e&&e.message)+'"'),t.cleanSocket()),r=!0,i(e)}))}))},t.cleanSocket=function(){this.socket&&("function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),"function"==typeof this.socket.close&&this.socket.close(),this.socket=void 0)},t.beforeConnect=function(){this.reconnectTimer&&clearTimeout(this.reconnectTimer)},t.resetConnectStatus=function(){clearTimeout(this.reconnectTimer),this.backoff.reset(),this.retryCount=0,this.initOnlineListener()},t.doDisconnect=function(e,t,r){var n,i,o,a,s;if(this.logger.log("doDisconnect: type "+e+", description "+t),"unconnected"!==this.core.status){var c={1:"close",2:"kicked",3:"broken"}[e]||"";this.markAllCmdInvaild(new _l({code:415,desc:"Packet timeout due to instance disconnect",detail:{reason:"Packet timeout due to instance disconnect",disconnect_reason:c}})),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.cleanSocket();var u=!this.core.options.needReconnect||this.retryCount>=this.core.options.reconnectionAttempts;if(e===Wh.ACTIVE||u)this.logger.log("doDisconnect: emit disconnect, type "+e,u),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.core.eventBus.emit("disconnect"),this.core.emit("disconnect"),null===(n=this.auth)||void 0===n||n.emit("disconnect"),this.destroyOnlineListener();else if(e===Wh.KICKED){this.logger.log("doDisconnect: kicked"),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer);var d="string"==typeof t?{reason:"unknow",message:t}:t;this.core.eventBus.emit("kicked",d),this.core.emit("kicked",d),null===(i=this.auth)||void 0===i||i.emit("kicked",d),this.destroyOnlineListener()}else e===Wh.OFFLINE&&this.core.V1NIMLoginService.isManualLoginAttempt?(this.logger.log("doDisconnect: offline in manual login phase. no reconnect"),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.destroyOnlineListener()):e===Wh.OFFLINE&&(null===(a=null===(o=this.auth)||void 0===o?void 0:o.authenticator)||void 0===a?void 0:a.checkLoginTerminalCode(null==r?void 0:r.code))?(this.logger.log("doDisconnect: login terminal code "+(null==r?void 0:r.code)+", no reconnect"),this.core.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.destroyOnlineListener(),this.core.eventBus.emit("disconnect"),this.core.emit("disconnect"),null===(s=this.auth)||void 0===s||s.emit("disconnect")):e===Wh.OFFLINE?(this.logger.log("doDisconnect: start to reconnect"),this.attempToReconnect()):this.logger.log("doDisconnect: nothing to do")}else this.logger.warn("doDisconnect: already unconnected")},t.attempToReconnect=function(){var e,t,r=this;if("waitReconnect"!==this.core.status){0===this.retryCount&&(this.core.eventBus.emit("disconnect"),this.core.emit("disconnect"),null===(e=this.auth)||void 0===e||e.emit("disconnect"));var n=this.backoff.duration();this.retryCount++,this.logger.log("willReconnect "+this.retryCount+" "+n),this.core.eventBus.emit("willReconnect",{retryCount:this.retryCount,duration:n}),this.core.emit("willReconnect",{retryCount:this.retryCount,duration:n}),null===(t=this.auth)||void 0===t||t.emit("willReconnect",{retryCount:this.retryCount,duration:n}),this.core.status="waitReconnect",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.reconnectTimer=qs((function(){return zl(r,void 0,void 0,Ql.mark((function e(){var t=this;return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("waitReconnect"===this.core.status){e.next=3;break}return this.logger.warn("doDisconnect: reconnectTimer status is "+this.core.status+", would not go on reconnecting"),e.abrupt("return");case 3:return e.next=5,Zl.net.getNetworkStatus();case 5:!1===e.sent.net_connect?(this.logger.log("doDisconnect: skip this reconnection attempt because network is offline"),this.core.status="connecting",this.retryCount>=this.core.options.reconnectionAttempts?this.doDisconnect(Wh.OFFLINE,"MaxReconnectionAttemptExceed"):this.attempToReconnect()):this.core.V1NIMLoginService.login({isAutoReconnect:!0}).catch((function(){t.logger.error("clientsocketV1::attempToReconnect failed "+t.retryCount)}));case 7:case"end":return e.stop()}}),e,this)})))}),n)}else this.logger.warn("doDisconnect: already is waiting reconnect")},t.sendCmd=function(e,t,r){var n=this;if("logined"!==this.core.status&&"login"!==e&&"chatroomLogin"!==e&&"qchatLogin"!==e)return this.logger.warn("instance status is "+this.core.status+", so can not sendCmd "+e),fs.reject({cmd:e,error:{code:"No_connected",message:"Connection not established",timetag:(new Date).getTime()}});if(!this.socket||!this.socket.send)return fs.reject("No_socket");var i="heartbeat"!==e,o=i?this.packetSer++:0,a=hh(e,o,this.logger,t);if(!a){var s="SendCmd "+o+" "+e+" error";return this.logger.error(s),fs.reject(new Error(s))}var c=a.packet,u=a.hasPacketResponse,d=a.hasPacketTimer,l=_i(c);i&&(this.logger.getDebugMode()?this.logger.debug("clientsocketV1::sendCmd",e,"ser:"+o,l):this.logger.log("clientsocketV1::sendCmd",e,"ser:"+o));var p=(new Date).getTime();return new fs((function(i,a){u&&n.sendingCmdMap.set(o,{cmd:e,params:t,callback:[i,a],timer:d?qs((function(){var t=new _l({code:408,desc:"Packet Timeout",detail:{reason:"Packet Timeout",cmd:e,ser:o,timetag:_s()}});n.markCmdInvalid(o,t,e)}),r&&r.timeout?r.timeout:n.core.config.timeout):null});try{n.socket.send(l),u||i(c)}catch(t){var s=new _l({code:415,detail:{reason:t&&t.message||"Unable to send packet",cmd:e,ser:o,timetag:_s(),rawError:t}});n.markCmdInvalid(o,s,e),a(t)}})).catch((function(e){var t,r=[408,415];if(!ou(r).call(r,e.code))return fs.reject(e);n.reporter.reportTraceStart("exceptions",{user_id:n.core.options.account,trace_id:null===(t=n.socket)||void 0===t?void 0:t.sessionId,start_time:p,action:2,exception_service:6});var i=Zp(e,"data.disconnect_reason")||"",o=408===e.code?"Send failed due to timeout":"Send failed. Reason unknown";return o=415===e.code?_i({disconnect_reason:i}):o,n.reporter.reportTraceUpdateV2("exceptions",{code:e.code||415,description:o,operation_type:1,target:c.SID+"-"+c.CID,context:""+c.SER},{asyncParams:Zl.net.getNetworkStatus()}),n.reporter.reportTraceEnd("exceptions",1),fs.reject(e)}))},t.onMessage=function(e){var t=fh(e,this.logger);if(t)for(var r,n=Xh(t);!(r=n()).done;){var i=r.value,o=i.raw.ser;if(i.error&&this.logger.error("core:onMessage packet error",i.raw.sid+"_"+i.raw.cid+", ser:"+o+",",i.error),i.notFound)return void this.logger.warn("clientsocketV1::onMessage packet not found",i.raw.sid+"_"+i.raw.cid+", ser:"+o);"heartbeat"!==i.cmd&&(this.logger.getDebugMode()?this.logger.debug("imsocket::recvCmd ser:"+o,i.cmd,i.content):this.logger.log("imsocket::recvCmd ser:"+o,i.cmd)),this.packetHandler(i)}},t.packetHandler=function(e){var t,r,n=this;if(e){var i=e.raw.ser,o=this.sendingCmdMap.get(i);if(o&&o.cmd===e.cmd){var a=o.callback,s=o.timer,c=o.params;if(clearTimeout(s),e.params=c,this.sendingCmdMap.delete(i),"heartbeat"===e.cmd)return void a[0]();var u=null===(t=this.core[e.service])||void 0===t?void 0:t.process(e);u&&"function"==typeof u.then?u.then((function(e){a[0](e)})).catch((function(e){a[1](e)})):(this.logger.log("imsocket:: handlerFn without promise",e.service,e.cmd),a[0]())}else{var d=null===(r=this.core[e.service])||void 0===r?void 0:r.process(e);d&&"function"==typeof d.then&&d.catch((function(e){n.logger.error("imsocket::no obj cache, no process handler",e)}))}}},t.markCmdInvalid=function(e,t,r){var n=this.sendingCmdMap.get(e);if(n){var i=n.callback,o=n.timer;o&&clearTimeout(o),this.sendingCmdMap.delete(e),this.logger.warn("packet "+e+", "+r+" is invalid:",t),i[1](t)}},t.markAllCmdInvaild=function(e){var t,r=this;this.logger.log("markAllCmdInvaild",e),jn(t=this.sendingCmdMap).call(t,(function(t){var n=t.callback,i=t.timer,o=t.cmd;r.logger.log('markAllCmdInvaild:: cmd "'+o+'"'),i&&clearTimeout(i),n[1](e)})),this.sendingCmdMap.clear()},t.ping=function(){var e;return zl(this,void 0,void 0,Ql.mark((function t(){var r=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return clearTimeout(this.pingTimer),t.prev=1,t.next=4,this.sendCmd("heartbeat");case 4:t.next=18;break;case 6:return t.prev=6,t.t0=t.catch(1),t.next=10,this.testHeartBeat5Timeout();case 10:if(!t.sent){t.next=18;break}if(!this.core.reporterHookLinkKeep){t.next=16;break}return t.next=15,this.core.reporterHookLinkKeep.update({code:0,description:"Heartbeat-discovered link failure",operation_type:1,target:null===(e=this.socket)||void 0===e?void 0:e.url});case 15:this.core.reporterHookLinkKeep.end(!0);case 16:return this.doDisconnect(Wh.OFFLINE,"PingError"),t.abrupt("return");case 18:this.pingTimer=qs((function(){r.ping()}),3e4);case 19:case"end":return t.stop()}}),t,this,[[1,6]])})))},t.testHeartBeat5Timeout=function(){return zl(this,void 0,void 0,Ql.mark((function e(){var t;return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:clearTimeout(this.pingTimer),t=0;case 2:if(!(t<5)){e.next=15;break}return e.prev=3,e.next=6,this.sendCmd("heartbeat",{},{timeout:3e3});case 6:return e.abrupt("return",!1);case 9:e.prev=9,e.t0=e.catch(3),this.logger.log("clientsocketV1:: test heartbeat "+t+" Timeout");case 12:t++,e.next=2;break;case 15:return e.abrupt("return",!0);case 16:case"end":return e.stop()}}),e,this,[[3,9]])})))},t.initOnlineListener=function(){var e=this;this.hasNetworkListener||(this.logger.log("clientsocketV1::onlineListener:init"),this.hasNetworkListener=!0,Zl.net.onNetworkStatusChange((function(t){e.logger.log("clientsocketV1::onlineListener:network change",t),t.isConnected&&"logined"===e.core.status?e.ping():t.isConnected&&"waitReconnect"===e.core.status?(e.reconnectTimer&&clearTimeout(e.reconnectTimer),e.core.V1NIMLoginService.login({isAutoReconnect:!0}).catch((function(){e.logger.error("clientsocketV1::attempToReconnect failed "+e.retryCount)}))):t.isConnected||e.doDisconnect(Wh.OFFLINE,"OfflineListener")})))},t.destroyOnlineListener=function(){this.logger.log("clientsocketV1::onlineListener:destroy"),Zl.net.offNetworkStatusChange(),this.hasNetworkListener=!1},t.disconnect=function(){switch(this.core.status){case"connected":case"logined":case"connecting":case"waitReconnect":return this.doDisconnect(Wh.ACTIVE,"UserActiveDisconnect"),fs.resolve();default:return fs.resolve()}},e}(),ef=function(){function e(e){this.socketLinkUrls=[],this.timer=0,this.failedCount=0,this.core=e,this.auth=e.V1NIMLoginService,this.logger=this.core.logger}var t=e.prototype;return t.getLbsInfos=function(){return zl(this,void 0,void 0,Ql.mark((function e(){var t,r,n,i;return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.socketLinkUrls.length>0)){e.next=5;break}return t=this.socketLinkUrls,this.socketLinkUrls=[],this.core.logger.log("V1NIMLoginService::getLbsInfos:use cache link",t),e.abrupt("return",fs.resolve(t));case 5:return this.core.reporterHookLBS.start(this.core.account),r=zh(this.auth.config.lbsUrls),e.prev=7,e.next=10,this.ladderLoad(r);case 10:if(200===(n=e.sent).status&&n.data){e.next=14;break}throw this.core.logger.error("V1NIMLoginService::getLbsInfos:error status",n.status,n),new _l({code:Tl.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"V1NIMLoginService::getLbsInfos failed, status "+n.status}});case 14:this.success(n),e.next=25;break;case 17:if(e.prev=17,e.t0=e.catch(7),i=e.t0,this.core.logger.error("V1NIMLoginService::lbs getLbsInfos error, use default link: "+this.auth.config.linkUrl+". error:",e.t0),this.reportForFail(r[0],i.code,i.message),!this.checkTerminator(i.code)){e.next=24;break}throw e.t0;case 24:this.socketLinkUrls=[this.auth.config.linkUrl];case 25:return e.abrupt("return",this.socketLinkUrls);case 26:case"end":return e.stop()}}),e,this,[[7,17]])})))},t.checkTerminator=function(e){return e===Tl.V2NIM_ERROR_CODE_CANCELLED||e===Tl.V2NIM_ERROR_CODE_TIMEOUT},t.generateUrl=function(e){return e+(wu(e).call(e,"?")>-1?"&":"?")+"k="+this.core.options.appkey+"&id="+this.core.auth.getLoginUser()+"&sv=180&pv=1&networkType=0&lv=1"},t.requstLbs=function(e){return this.auth.doLoginStepsManager.add(this.core.adapters.request(this.generateUrl(e),{method:"GET",dataType:"json",timeout:8e3}))},t.setLadderTimer=function(e,t,r,n){var i=this;this.timer&&clearTimeout(this.timer);var o=e[t];this.timer=qs((function(){o&&(i.setLadderTimer(e,t+1,r,n),i.core.logger.log("V1NIMLoginService::getLbsInfos "+t+":",o),i.reportForLbsStart(o,t),i.requstLbs(o).then((function(e){i.reset(),r(dr(dr({},e),{url:o}))})).catch((function(r){var a;if(i.core.logger.warn("V1NIMLoginService::getLbsInfos "+t+" failed:",r),i.failedCount+=1,i.reportForFailOnce(o,r.code,(null===(a=r.detail)||void 0===a?void 0:a.reason)||r.message),i.failedCount>=e.length||i.checkTerminator(r.code))return i.reset(),void n(r)})))}),2e3)},t.ladderLoad=function(e){var t=this;return new fs((function(r,n){e.length>1&&t.setLadderTimer(e,1,r,n);var i=e[0];t.core.logger.log("V1NIMLoginService::getLbsInfos 0:",i),t.reportForLbsStart(i,0),t.requstLbs(i).then((function(e){t.reset(),r(dr(dr({},e),{url:i}))})).catch((function(r){var o;t.failedCount+=1,t.core.logger.warn("V1NIMLoginService::getLbsInfos 0 failed:",r),t.reportForFailOnce(i,r.code,(null===(o=r.detail)||void 0===o?void 0:o.reason)||r.message),(t.failedCount>=e.length||t.checkTerminator(r.code))&&(t.reset(),n(r))}))}))},t.success=function(e){var t,r,n,i,o=e.data,a=[this.auth.config.linkUrl];Zp(o,"common.link")&&(a=xs(i=Zp(o,"common.link")).call(i,a)),Zp(o,'common["link.default"]')&&(a=xs(a).call(a,Zp(o,'common["link.default"]'))),this.socketLinkUrls=a,o["nos-chunk"]&&(this.logger.log("getLbsInfos success. lbs.nos-chunk",o["nos-chunk"]),null===(r=this.core.cloudStorage)||void 0===r||r.setOptions({chunkUploadHost:o["nos-chunk"]})),Ei(o.nosup)&&o.nosup.length>0&&(this.logger.log("getLbsInfos success. lbs.nosup",o.nosup),null===(n=this.core.cloudStorage)||void 0===n||n.setOptions({commonUploadHostBackupList:o.nosup,commonUploadHost:o.nosup[0]})),this.core.logger.log("V1NIMLoginService::getLbsInfos success, socket link:",Wc(t=this.socketLinkUrls).call(t,0),"chunkUploadHost: ",e.data["nos-chunk"]),this.reportForLbsSuccess(e.url,e.data)},t.reportForLbsStart=function(e,t){this.core.reporterHookLBS.updateBegin({target:e,index:t})},t.reportForLbsSuccess=function(e,t){this.core.reporterHookLBS.updateComplete({target:e,code:200,body:_i(t)}),this.core.reporterHookLBS.end(!0),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:e,code:200,succeed:!0},{asyncParams:Zl.net.getNetworkStatus()})},t.reportForFailOnce=function(e,t,r){this.core.reporterHookLBS.updateComplete({target:e,code:t,body:r})},t.reportForFail=function(e,t,r){this.core.reporterHookLBS.end(!1),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:e,description:r,code:t,succeed:!1},{asyncParams:Zl.net.getNetworkStatus()})},t.reset=function(){this.socketLinkUrls=[],this.failedCount=0,clearTimeout(this.timer)},e}(),tf=function(){function e(e){this.core=e}var t=e.prototype;return t.verifyAuthentication=function(e){var t,r,n;return void 0===e&&(e=!1),zl(this,void 0,void 0,Ql.mark((function i(){var o,a,s,c,u,d,l,p,m,h,f,g;return Ql.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return a=this.core.options,s=Zl.getSystemInfo(),c=dr(dr({},a),{appLogin:e?0:1,appkey:a.appkey,account:a.account,token:a.token,deviceId:this.core.auth.deviceId,clientSession:this.core.auth.clientSession,clientType:16,protocolVersion:1,sdkVersion:100700,sdkHumanVersion:"10.7.0",os:s.os,browser:s.browser,userAgent:this.core.options.loginSDKTypeParamCompat?"Native/10.7.0":Wc(o=s.userAgent.replace("{{appkey}}",a.appkey)).call(o,0,299),libEnv:this.core.options.loginSDKTypeParamCompat?void 0:s.libEnv,hostEnv:this.core.options.loginSDKTypeParamCompat?0:s.hostEnvEnum}),u=s.os.toLowerCase(),"UNIAPP"!==Zl.platform||"ios"!==u&&"android"!==u||(c.isReactNative=1,c.clientType="ios"===u?2:1,d=!!(null===(t=this.core.offlinePush.authConfig)||void 0===t?void 0:t.honorCertificateName),s.pushDeviceInfo&&s.pushDeviceInfo.MANUFACTURER&&(c.deviceInfo=_i(dr({IS_SUPPORT_HONOR:d},s.pushDeviceInfo)))),this.core.logger.log("clientSocketV1::do login ",a.account,null===(n=null===(r=this.core.clientSocket)||void 0===r?void 0:r.socket)||void 0===n?void 0:n.sessionId),i.next=8,this.core.clientSocket.sendCmd("login",{login:c});case 8:if(!(l=i.sent).error){i.next=11;break}throw l.error;case 11:return p=l.content,m=p.loginRes,h=p.loginPorts,f=p.aosPushInfo,g=Fh(h,2),(g=fu(g).call(g,(function(e){return e.connectionId!==m.connectionId}))).length>0&&this.core.emit("multiPortLogin",g),i.abrupt("return",dr(dr({},m),{aosPushInfo:f}));case 16:case"end":return i.stop()}}),i,this)})))},t.checkLoginTerminalCode=function(e){if(void 0===e)return!1;var t=[201,302,317,403,404,417,422];return ou(t).call(t,e)},e}(),rf=function(e){function t(t,r){var n;return(n=e.call(this)||this).name=t,n.logger=r.logger,n.core=r,n}nr(t,e);var r=t.prototype;return r.checkV2=function(){var e=this.core.options.apiVersion;if("v2"===e)return!0;throw new _l({code:Tl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:'The version "'+e+'" of client is not supported.'}})},r.checkLogin=function(){if(1!==this.core.V2NIMLoginService.getLoginStatus())throw new _l({code:Tl.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:"The client is not logged in."}})},r.emit=function(t){for(var r=this,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];this.logger.debug(this.name+"::emit event: '"+t.toString()+"',",void 0!==i[0]?i[0]:"",void 0!==i[1]?i[1]:"",void 0!==i[2]?i[2]:"");try{var a,s;return(a=e.prototype.emit).call.apply(a,xs(s=[this,t]).call(s,i))}catch(e){return qs((function(){throw r.logger.error(r.name+"::emit throw error in setTimeout. event: "+t.toString()+". Error",e),e}),0),!1}},r.process=function(e){var t=this[e.cmd+"Handler"];if("function"==typeof t){if(e.error)return this.logger.error(e.cmd+"::recvError",e.error),fs.reject(e.error);try{var r=t.call(this,e);return fs.resolve(r)}catch(e){return fs.reject(e)}}var n=Zp(e,"error.detail.ignore");return e.error&&!n?fs.reject(e.error):fs.resolve(e)},t}(Bs),nf=function(){function e(e,t){this.name=e,this.core=t,this.name=e,this.logger=t.logger,this.core=t}return e.prototype.process=function(e){var t=this[e.cmd+"Handler"];if("function"==typeof t)return t.call(this,e);var r=Zp(e,"error.detail.ignore");return e.error&&!r?fs.reject(e.error):fs.resolve(e)},e}(),of={"6_3":"notifylog","6_4":"uploadLog","6_23":"getServerTime","6_31":"notifyDetect","6_32":"uploadDetect"},af={type:1,params:2,result:3,t1:100,t2:101,t3:102,t4:103,t5:104,t6:105},sf={notifylog:{sid:6,cid:3,service:"misc"},uploadLog:{sid:6,cid:4,service:"misc",hasPacketResponse:!1,params:[{type:"String",name:"url"},{type:"Property",name:"data",reflectMapper:{type:1,content:2}}]},getServerTime:{sid:6,cid:23,service:"misc",response:[{type:"Long",name:"time"}]},notifyDetect:{sid:6,cid:31,service:"misc",response:[{type:"Property",name:"data",reflectMapper:Sh(af)}]},uploadDetect:{sid:6,cid:32,service:"misc",hasPacketResponse:!1,params:[{type:"Property",name:"data",reflectMapper:af}]}},cf={type:{type:"number"},t1:{type:"number"},t2:{type:"number"},t3:{type:"number"},t4:{type:"number"},t5:{type:"number"},t6:{type:"number"}},uf=function(e){function t(t){var r;return(r=e.call(this,"misc",t)||this).core=t,Mh({cmdMap:of,cmdConfig:sf}),r.setListener(),r}nr(t,e);var r=t.prototype;return r.setListener=function(){var e=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(){e.core.timeOrigin.setOriginTimetick()})),this.core.eventBus.on("logined",(function(){e.core.timeOrigin.setOriginTimetick()}))},r.getServerTime=function(){return zl(this,void 0,void 0,Ql.mark((function e(){var t;return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.clientSocket.sendCmd("getServerTime");case 2:return t=e.sent,e.abrupt("return",$p(t.content.time));case 4:case"end":return e.stop()}}),e,this)})))},r.notifyDetectHandler=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.content.data,(r=Ph(cf,n)).t3=e.__receiveTimeNode.time,r.t4=_s(),t.prev=3,t.next=6,this.core.clientSocket.sendCmd("uploadDetect",{data:r});case 6:t.next=11;break;case 8:t.prev=8,t.t0=t.catch(3),this.core.logger.warn("misc::notifyDetectHandler:upload failed",t.t0);case 11:case"end":return t.stop()}var n}),t,this,[[3,8]])})))},r.notifylogHandler=function(){return zl(this,void 0,void 0,Ql.mark((function e(){var t,r,n;return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=void 0,e.prev=1,e.next=4,this.core.logger.extractLogs();case 4:t=e.sent,e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return");case 10:if(t){e.next=12;break}return e.abrupt("return");case 12:if("string"!=typeof t){e.next=14;break}return e.abrupt("return");case 14:return r="",e.prev=15,e.next=18,this.core.cloudStorage.uploadFile({type:"file",file:t});case 18:n=e.sent,r=n.url,e.next=25;break;case 22:return e.prev=22,e.t1=e.catch(15),e.abrupt("return");case 25:if(r){e.next=27;break}return e.abrupt("return");case 27:return r+=(wu(r).call(r,"?")>0?"&":"?")+"download="+(new Date).getTime()+"_web.log",e.prev=28,e.next=31,this.core.clientSocket.sendCmd("uploadLog",{url:r});case 31:e.next=36;break;case 33:return e.prev=33,e.t2=e.catch(28),e.abrupt("return");case 36:case"end":return e.stop()}}),e,this,[[1,7],[15,22],[28,33]])})))},t}(nf),df={needReconnect:!0,reconnectionAttempts:ir,lbsUrls:Dp,linkUrl:Up,xhrConnectTimeout:8e3,socketConnectTimeout:8e3},lf=function(e){function t(t,r){var n;(n=e.call(this,"V1NIMLoginService",t)||this).account="",n.token="",n.deviceId="",n.processId="",n.clientSession="",n.status="unconnected",n.config=df,n.isManualLoginAttempt=!1,n.core._registerDep(uf,"misc"),Mh({cmdMap:Ah,cmdConfig:Oh}),t.V1NIMLoginService=ut(n),r&&n.setOptions(r);var i=new Zh(n.core,ut(n));return n.clientSocket=i,"v1"===n.core.options.apiVersion&&(n.core.clientSocket=i,n.core.auth=ut(n)),n.lbs=new ef(t),n.authenticator=new tf(t),n.doLoginStepsManager=new Hp,n}nr(t,e);var r=t.prototype;return r.reset=function(){this.lbs.reset()},r.setOptions=function(e){e&&fr(e).length>0?(this.config=Np(this.config,e),this.account=e.account||this.core.options.account,this.token=e.token||this.core.options.token,this.core.options=dr(dr({},this.core.options),this.config)):(this.config=Np(this.core.options,this.config),this.account=this.core.options.account,this.token=this.core.options.token);var t="",r="";this.config.isFixedDeviceId?(t=Zl.localStorage.getItem("__NIM_DEVC_ID__")||Ep(),r=Zl.localStorage.getItem("__NIM_CLIENT_SESSION_ID__")||Ep(),Zl.localStorage.setItem("__NIM_DEVC_ID__",t),Zl.localStorage.setItem("__NIM_CLIENT_SESSION_ID__",r)):(t=Ep(),r=Ep()),this.deviceId=t,this.clientSession=r,this.core.reporter.setConfig({common:{dev_id:t}})},r.connect=function(e){return void 0===e&&(e={}),this.login(e)},r.login=function(e){return void 0===e&&(e={}),zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._checkApiVersion(),e.isAutoReconnect||(this.isManualLoginAttempt=!0,this.processId=Ep()),t.next=4,this._connect(e);case 4:return this.core.abtest.abtRequest(),t.prev=5,t.next=8,this.doLogin(e.isAutoReconnect);case 8:this.processId=Ep(),this.isManualLoginAttempt=!1,t.next=16;break;case 12:throw t.prev=12,t.t0=t.catch(5),this.isManualLoginAttempt=!1,t.t0;case 16:case"end":return t.stop()}}),t,this,[[5,12]])})))},r._connect=function(e){return void 0===e&&(e={}),zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(/^(unconnected|waitReconnect)$/.test(this.core.status)){t.next=4;break}return r="NIM status is "+this.core.status+", and would not connect",this.logger.warn(r),t.abrupt("return",fs.reject(r));case 4:return this.clientSocket.beforeConnect(),this.core.reporter.reportTraceCancel("login"),this.core.reporter.reportTraceStart("login",{user_id:this.core.options.account,action:e.isAutoReconnect?"auto_login":"manual_login",binary_websocket:!1,process_id:this.processId}),this.core.reporter.reportTraceUpdateV2("login",{code:0,description:_i(dr(dr({},this.core.options),{account:"***",token:"***"})),operation_type:"conf_init",succeed:!0,duration:0,target:""},{asyncParams:Zl.net.getNetworkStatus()}),t.next=10,this.lbs.getLbsInfos();case 10:return n=t.sent,t.prev=11,t.next=14,this.clientSocket.connect({linkUrls:n,isAutoReconnect:e.isAutoReconnect},(function(e,t){o.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:t,code:e.code||408,description:"ws_handshake_failed:"+e.message,succeed:!1},{asyncParams:Zl.net.getNetworkStatus()})}));case 14:(i=t.sent)&&this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:i,code:200,succeed:!0},{asyncParams:Zl.net.getNetworkStatus()}),t.next=22;break;case 18:throw t.prev=18,t.t0=t.catch(11),this.core.reporter.reportTraceEnd("login",!1),t.t0;case 22:case"end":return t.stop()}}),t,this,[[11,18]])})))},r.doLogin=function(e){return void 0===e&&(e=!1),zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.authenticator.verifyAuthentication(e);case 3:r=t.sent,this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"2-3",code:200,succeed:!0},{asyncParams:Zl.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("login",!0),this.core.status="logined",t.next=21;break;case 9:if(t.prev=9,t.t0=t.catch(0),n=t.t0,i=Zp(n,"data.disconnect_reason")||"",o=415===n.code?_i({disconnect_reason:i}):n.message,this.core.logger.warn("nim login:: login failed",t.t0),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"2-3",code:n.code||0,succeed:!1,description:o},{asyncParams:Zl.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("login",!1),this.clientSocket.doDisconnect(Wh.OFFLINE,this.isManualLoginAttempt?"FailedToInitializeLogin":"ReconnectLoginFailed",t.t0),!this.isManualLoginAttempt){t.next=20;break}throw t.t0;case 20:return t.abrupt("return");case 21:return t.prev=21,t.next=24,this.core.cloudStorage.init();case 24:t.next=29;break;case 26:t.prev=26,t.t1=t.catch(21),this.core.logger.error("NIM:login cloudStorage init failed ",t.t1);case 29:this.core.eventBus.emit("logined",r),this.core.emit("logined",r),this.emit("logined",r),this.core.logger.log("login done"),this.clientSocket.resetConnectStatus(),this.clientSocket.ping();case 35:case"end":return t.stop()}}),t,this,[[0,9],[21,26]])})))},r.disconnect=function(){return this.logout()},r.logout=function(){return zl(this,void 0,void 0,Ql.mark((function e(){return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._checkApiVersion(),this.doLoginStepsManager.clear(),e.t0=this.status,e.next="logined"===e.t0?5:"connected"===e.t0||"connecting"===e.t0||"waitReconnect"===e.t0?18:"unconnected"===e.t0||"destroyed"===e.t0?21:22;break;case 5:return e.prev=5,e.next=8,this.clientSocket.sendCmd("logout",void 0,{timeout:1e3});case 8:this.clientSocket.doDisconnect(Wh.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),e.next=17;break;case 12:e.prev=12,e.t1=e.catch(5),this.logger.error("Instance::disconnect sendCmd:logout error",e.t1),this.clientSocket.doDisconnect(Wh.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData();case 17:return e.abrupt("break",22);case 18:return this.clientSocket.doDisconnect(Wh.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),e.abrupt("return",fs.resolve());case 21:return e.abrupt("return",fs.resolve());case 22:case"end":return e.stop()}}),e,this,[[5,12]])})))},r.kick=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){var n;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this._checkApiVersion(),r.next=3,this.clientSocket.sendCmd("kick",e);case 3:return n=r.sent,r.abrupt("return",null===(t=n.content)||void 0===t?void 0:t.deviceIds);case 5:case"end":return r.stop()}}),r,this)})))},r._checkApiVersion=function(){if("v1"!==this.core.options.apiVersion)throw new _l({code:Tl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:'apiVersion is not "v1"'}})},r.nimLoginClientChangeHandler=function(e){if(e.error)this.logger.error("nimLoginClientChangeHandler:: error, ",e.error);else{var t=e.content,r=Fh(t.datas,t.state);r.length>0&&(this.core.emit("multiPortLogin",r),this.emit("multiPortLogin",r))}},r.kickedHandler=function(e){if(e.error)this.logger.error("kickedHandler:: error, ",e.error);else{var t=function(e){var t=Ph({clientType:{type:"enum",values:wh},customClientType:{type:"number"}},e),r=Gh[t.reason];return dr(t,r=r||{reason:"unknow",message:"Unknown reason"})}(e.content);this.logger.warn("kicked::",t),this.clientSocket.doDisconnect(Wh.KICKED,t),this.core._clearModuleData()}},r.getConnectStatus=function(){switch(this.core.status){case"unconnected":case"destroyed":default:return 0;case"connecting":return 2;case"connected":case"logined":return 1;case"waitReconnect":return 3}},r.getLoginStatus=function(){switch(this.core.status){case"unconnected":case"destroyed":case"waitReconnect":default:return 0;case"connecting":case"connected":return 2;case"logined":return 1}},r.getLoginUser=function(){return this.core.options.account},r.emit=function(t){for(var r,n,i,o,a=this.name+"::emit "+t.toString(),s=arguments.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=arguments[u];return(r=this.logger).log.apply(r,xs(n=[""+a]).call(n,c)),(i=e.prototype.emit).call.apply(i,xs(o=[this,t]).call(o,c))},t}(rf);function pf(e){return Ph({type:{type:"number"},port:{type:"number"},customClientType:{type:"number"},timestamp:{type:"number"},loginType:{type:"number"}},e)}function mf(e){e=e||{};var t={};for(var r in e)t[e[r]]=r;return t}var hf={"26_3":"v2Login","26_5":"v2Logout","26_8":"v2KickOffline","26_9":"v2BeKicked","26_10":"v2LoginClientChange","36_1":"v2GetChatroomLinkAddress"},ff={"1_2":"heartbeat","2_7":"nimLoginClientChange","24_8":"qchatLoginClientChange"},gf={webLoginReqTag:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,clientId:13,appkey:18,account:19,browser:24,clientSession:26,deviceInfo:32,isReactNative:112,customTag:38,customClientType:39,sdkHumanVersion:40,hostEnv:41,userAgent:42,libEnv:44,authType:115,thirdPartyExtension:116,token:1e3},mixAuthRepTag:{clientId:1,consid:2,clientIP:3,port:4,type:5,customClientType:6,timestamp:7,customTag:8,os:9,pushType:10,hasTokenPreviously:11,loginType:12},nimAuthRepTag:{type:3,os:4,mac:5,clientId:13,account:19,deviceInfo:32,customTag:38,customClientType:39,consid:102,clientIP:103,port:104,timestamp:109,pushType:110,hasTokenPreviously:111},qchatAuthRepTag:{clientId:8,consid:102,clientIP:103,port:104,type:6,customClientType:13,timestamp:105,os:30,pushType:100,hasTokenPreviously:101}},vf={v2Login:{sid:26,cid:3,service:"auth",params:[{type:"Property",name:"tag",reflectMapper:gf.webLoginReqTag}],response:[{type:"Property",name:"data",reflectMapper:mf(gf.mixAuthRepTag)},{type:"PropertyArray",name:"loginClients",reflectMapper:mf(gf.mixAuthRepTag)}]},v2Logout:{sid:26,cid:5,service:"auth"},v2KickOffline:{sid:26,cid:8,service:"auth",params:[{type:"StrArray",name:"clientIds"}],response:[{type:"StrArray",name:"clientIds"}]},v2BeKicked:{sid:26,cid:9,service:"auth",response:[{type:"Int",name:"clientType"},{type:"Int",name:"reason"},{type:"String",name:"reasonDesc"},{type:"Int",name:"customClientType"}]},v2LoginClientChange:{sid:26,cid:10,service:"auth",response:[{type:"Byte",name:"state"},{type:"PropertyArray",name:"datas",reflectMapper:mf(gf.mixAuthRepTag)}]},v2GetChatroomLinkAddress:{sid:36,cid:1,service:"auth",params:[{type:"Long",name:"roomId"},{type:"Bool",name:"miniProgram"}],response:[{type:"StrArray",name:"linkAddress"}]}},yf={heartbeat:{sid:1,cid:2,service:"auth"},nimLoginClientChange:{sid:2,cid:7,service:"auth",response:[{type:"Byte",name:"state"},{type:"PropertyArray",name:"datas",reflectMapper:mf(gf.nimAuthRepTag)}]},qchatLoginClientChange:{sid:24,cid:8,service:"auth",response:[{type:"Byte",name:"state"},{type:"Property",name:"data",reflectMapper:mf(gf.qchatAuthRepTag)}]}},Mf=us.codeAt;nt({target:"String",proto:!0},{codePointAt:function(e){return Mf(this,e)}});var If=$t("String").codePointAt,Sf=String.prototype,Tf=function(e){var t=e.codePointAt;return"string"==typeof e||e===Sf||j(Sf,e)&&t===Sf.codePointAt?If:t},bf=RangeError,Cf=String.fromCharCode,_f=String.fromCodePoint,Ef=M([].join),wf=!!_f&&1!=_f.length;nt({target:"String",stat:!0,arity:1,forced:wf},{fromCodePoint:function(e){for(var t,r=[],n=arguments.length,i=0;n>i;){if(t=+arguments[i++],gt(t,1114111)!==t)throw bf(t+" is not a valid code point");r[i]=t<65536?Cf(t):Cf(55296+((t-=65536)>>10),t%1024+56320)}return Ef(r,"")}});var Rf=B.String.fromCodePoint,kf=function(e){var t;if(void 0!==e)return(t=Pf(e)).sign=1,t},Af=function(e){return"[object Array]"===Object.prototype.toString.call(e)},Nf=function(e){var t;return Gm(t=["number"==typeof e,"string"==typeof e&&e.length>0,Af(e)&&e.length>0,e instanceof Pf]).call(t,(function(e){return!0===e}))},xf="Invalid Number",Of="Invalid Number - Division By Zero";function Pf(e){var t;if(!(this instanceof Pf))return new Pf(e);if(this.number=[],this.sign=1,this.rest=0,Nf(e)){if(Af(e)){for((e.length&&"-"===e[0]||"+"===e[0])&&(this.sign="+"===e[0]?1:-1,e.shift(0)),t=e.length-1;t>=0;t--)if(!this.addDigit(e[t]))return}else for("-"!==(e=e.toString()).charAt(0)&&"+"!==e.charAt(0)||(this.sign="+"===e.charAt(0)?1:-1,e=e.substring(1)),t=e.length-1;t>=0;t--)if(!this.addDigit($p(e.charAt(t),10)))return}else this.number=xf}Pf.prototype.addDigit=function(e){return function(e){return/^\d$/.test(e)}(e)?(this.number.push(e),this):(this.number=xf,!1)},Pf.prototype._compare=function(e){var t,r;if(!Nf(e))return null;if(t=Pf(e),this.sign!==t.sign)return this.sign;if(this.number.length>t.number.length)return this.sign;if(this.number.length<t.number.length)return-1*this.sign;for(r=this.number.length-1;r>=0;r--){if(this.number[r]>t.number[r])return this.sign;if(this.number[r]<t.number[r])return-1*this.sign}return 0},Pf.prototype.gt=function(e){return this._compare(e)>0},Pf.prototype.gte=function(e){return this._compare(e)>=0},Pf.prototype.equals=function(e){return 0===this._compare(e)},Pf.prototype.lte=function(e){return this._compare(e)<=0},Pf.prototype.lt=function(e){return this._compare(e)<0},Pf.prototype.subtract=function(e){var t;return void 0===e?this:(t=Pf(e),this.sign!==t.sign?(this.number=Pf._add(this,t),this):(this.sign=this.lt(t)?-1:1,this.number=kf(this).lt(kf(t))?Pf._subtract(t,this):Pf._subtract(this,t),this))},Pf._add=function(e,t){var r,n=0,i=Math.max(e.number.length,t.number.length);for(r=0;r<i||n>0;r++)e.number[r]=(n+=(e.number[r]||0)+(t.number[r]||0))%10,n=Math.floor(n/10);return e.number},Pf._subtract=function(e,t){var r,n,i=0,o=e.number.length;for(r=0;r<o;r++)e.number[r]-=(t.number[r]||0)+i,e.number[r]+=10*(i=e.number[r]<0?1:0);for(r=0,o=e.number.length-1;0===e.number[o-r]&&o-r>0;)r++;return r>0&&di(n=e.number).call(n,-r),e.number},Pf.prototype.multiply=function(e){if(void 0===e)return this;var t,r,n=Pf(e),i=0,o=[];if(this.isZero()||n.isZero())return Pf(0);for(this.sign*=n.sign,t=0;t<this.number.length;t++)for(i=0,r=0;r<n.number.length||i>0;r++)o[t+r]=(i+=(o[t+r]||0)+this.number[t]*(n.number[r]||0))%10,i=Math.floor(i/10);return this.number=o,this},Pf.prototype.divide=function(e){if(void 0===e)return this;var t,r,n=Pf(e),i=[],o=Pf(0);if(n.isZero())return this.number=Of,this;if(this.isZero())return this.rest=Pf(0),this;if(this.sign*=n.sign,n.sign=1,1===n.number.length&&1===n.number[0])return this.rest=Pf(0),this;for(t=this.number.length-1;t>=0;t--)for(o.multiply(10),o.number[0]=this.number[t],i[t]=0;n.lte(o);)i[t]++,o.subtract(n);for(t=0,r=i.length-1;0===i[r-t]&&r-t>0;)t++;return t>0&&di(i).call(i,-t),this.rest=o,this.number=i,this},Pf.prototype.mod=function(e){return this.divide(e).rest},Pf.prototype.isZero=function(){var e;for(e=0;e<this.number.length;e++)if(0!==this.number[e])return!1;return!0},Pf.prototype.toString=function(){var e,t="";if("string"==typeof this.number)return this.number;for(e=this.number.length-1;e>=0;e--)t+=this.number[e];return this.sign>0?t:"-"+t};var Lf=Math.pow(2,32);function Vf(e){for(var t=new Uint8Array(5),r=new DataView(t.buffer),n=0;4294967168&e;)r.setUint8(n++,127&e|128),e>>>=7;return r.setUint8(n++,127&e),Wc(t).call(t,0,n)}function Uf(e){if("function"==typeof TextEncoder)return(new TextEncoder).encode(e);var t=function(e){for(var t=[],r=e.length,n=0;n<r;){var i=Tf(e).call(e,n),o=0,a=0;for(i<=127?(o=0,a=0):i<=2047?(o=6,a=192):i<=65535?(o=12,a=224):i<=2097151&&(o=18,a=240),t.push(a|i>>o),o-=6;o>=0;)t.push(128|i>>o&63),o-=6;n+=i>=65536?2:1}return t}(e);return new Uint8Array(t)}function Df(e){return"function"==typeof TextDecoder?new TextDecoder("utf-8").decode(e):function(e){for(var t="",r=0;r<e.length;){var n=e[r],i=0,o=0;if(n<=127?(i=0,o=255&n):n<=223?(i=1,o=31&n):n<=239?(i=2,o=15&n):n<=244&&(i=3,o=7&n),e.length-r-i>0)for(var a=0;a<i;)o=o<<6|63&(n=e[r+a+1]),a+=1;else o=65533,i=e.length-r;t+=Rf(o),r+=i+1}return t}(e)}var qf=function(){function e(e){this.offset=0,this.buffer=new Uint8Array(e),this.view=new DataView(e)}var t=e.prototype;return t.checkBufferBoundaryAccess=function(){return this.offset>=this.buffer.byteLength},t.length=function(){var e;return(null===(e=this.view)||void 0===e?void 0:e.byteLength)||0},t.getBuffer=function(){return this.view.buffer},t.getOffset=function(){return this.offset},t.popRaw=function(e){try{var t,r=Wc(t=this.buffer).call(t,this.offset,this.offset+e);return this.offset+=e,r}catch(e){throw new Error("UnpackException raw "+(e&&e.message))}},t.popByte=function(){try{var e=this.view.getUint8(this.offset);return this.offset+=1,e}catch(e){throw new Error("UnpackException byte "+(e&&e.message))}},t.popVarbin=function(){return this.popRaw(this.popVarInt())},t.popString=function(){try{return Df(this.popVarbin())}catch(e){throw new Error("UnpackException string "+(e&&e.message))}},t.popInt=function(){try{var e=this.view.getUint32(this.offset,!0);return this.offset+=4,e}catch(e){throw new Error("UnpackException int "+(e&&e.message))}},t.popVarInt=function(){var e=1,t=0,r=0,n=0;do{if(t+=(127&(r=this.popByte()))*e,e*=128,(n+=1)>5)throw new Error("Variable length quantity is too long")}while(128&r);return t},t.popLong=function(){try{var e,t=function(e,t){void 0===t&&(t=!1);var r=new DataView(e.buffer),n=t?[4,0]:[0,4],i=n[0],o=n[1],a=r.getUint32(i,t),s=r.getUint32(o,t);return a>0?a*Lf+s:s}(Wc(e=this.buffer).call(e,this.offset,this.offset+8),!0);return this.offset+=8,Number(t)}catch(e){throw new Error("UnpackException long "+(e&&e.message))}},t.popShort=function(){try{var e=this.view.getUint16(this.offset,!0);return this.offset+=2,e}catch(e){throw new Error("UnpackException short "+(e&&e.message))}},t.popBoolean=function(){return this.popByte()>0},t.toString=function(){return Bl(new Uint8Array(this.buffer)).toString()},t.reset=function(){this.offset=0,this.buffer=null,this.view=null},e}(),Bf=function(){function e(e){this.packetLength=0,this.serviceId=0,this.commandId=0,this.serialId=0,this.tag=0,this.resCode=200,this.innerHeader=null,this.msgId=0,this.bodyArr=[],this.unpack=new qf(e)}var t=e.prototype;return t.reset=function(){this.innerHeader=null,this.bodyArr=[],this.unpack.reset()},t.getBodyDetail=function(){return this.bodyArr.join("")},t.unmarshalHeader=function(){var e,t=this._unmarshalHeader();this.packetLength=t.packetLength,this.serviceId=t.serviceId,this.commandId=t.commandId,this.serialId=t.serialId,this.tag=t.tag,this.resCode=t.resCode,4===t.serviceId&&ou(e=[1,2,10,11]).call(e,t.commandId)&&(this.msgId=this.unmarshalLong(),this.innerHeader=this._unmarshalHeader())},t._unmarshalHeader=function(){var e=this.unpack.popVarInt(),t=this.unpack.popByte(),r=this.unpack.popByte(),n=this.unpack.popShort(),i=this.unpack.popByte(),o=200;return this.hasRescode(i)&&(o=this.unpack.popShort()),{packetLength:e,serviceId:t,commandId:r,serialId:n,tag:i,resCode:o}},t.hasRescode=function(t){return 0!=((t=t||this.tag)&e.RES_CODE)},t.getHeader=function(){return{packetLength:this.packetLength,sid:this.serviceId,cid:this.commandId,ser:this.serialId,code:this.resCode}},t.getInnerHeader=function(){return this.innerHeader?{sid:this.innerHeader.serviceId,cid:this.innerHeader.commandId}:null},t.unmarshalProperty=function(){var e=this.unpack.popVarInt(),t={};this.bodyArr.push("\nProperty("+e+") {");for(var r=0;r<e;r++){var n=this.unpack.popVarInt();this.bodyArr.push(n+":");var i=this.unpack.popString();this.bodyArr.push('"'+i.length+" "+this.unpack.getOffset()+'",'),t[n]=i}return this.bodyArr.push("},"),t},t.unmarshalPropertyArray=function(){var e=this.unpack.popVarInt(),t=[];this.bodyArr.push("\nPropertyArray("+e+") [");for(var r=0;r<e;r++)t.push(this.unmarshalProperty());return this.bodyArr.push("],"),t},t.unmarshalLong=function(){var e=this.unpack.popLong();return this.bodyArr.push("\nLong:"+e),e},t.unmarshalLongArray=function(){var e=this.unpack.popVarInt(),t=[];this.bodyArr.push("\nLongArray "+e+":");for(var r=0;r<e;r++){var n=this.unpack.popLong();this.bodyArr.push(n+","),t.push(n)}return t},t.unmarshalStrArray=function(){var e=this.unpack.popVarInt(),t=[];this.bodyArr.push("\nStrArray "+e+":");for(var r=0;r<e;r++){var n=this.unpack.popString();this.bodyArr.push(n+","),t.push(n)}return t},t.unmarshalStrLongMap=function(){var e=this.unpack.popVarInt(),t={};this.bodyArr.push("\nStrLongMap "+e+":");for(var r=0;r<e;r++){var n=this.unpack.popString();this.bodyArr.push(n+",");var i=this.unpack.popLong();this.bodyArr.push(i+";"),t[n]=i}return t},t.unmarshalStrStrMap=function(){var e=this.unpack.popVarInt(),t={};this.bodyArr.push("\nStrStrMap "+e+":");for(var r=0;r<e;r++){var n=this.unpack.popString();this.bodyArr.push(n+",");var i=this.unpack.popString();this.bodyArr.push(i+";"),t[n]=i}return t},t.unmarshalLongLongMap=function(){var e=this.unpack.popVarInt(),t={};this.bodyArr.push("\nStrLongLongMap "+e+":");for(var r=0;r<e;r++){var n=this.unpack.popLong();this.bodyArr.push(n+",");var i=this.unpack.popLong();this.bodyArr.push(i+";"),t[n]=i}return{m_map:t}},t.unmarshalKVArray=function(){var e=this.unpack.popVarInt(),t=[];this.bodyArr.push("\nKVArray "+e+":");for(var r=0;r<e;r++)t.push(this.unmarshalStrStrMap());return t},t.unmarshal=function(e){var t,r=this,n=dr(dr({},this.getHeader()),{r:[]});if(this.innerHeader&&(n.r[0]=this.msgId,n.r[1]={body:[],headerPacket:this.getInnerHeader()}),!ou(t=[200,406,808,810,7101]).call(t,n.code))return _i(n);if(this.packetLength>0&&this.packetLength>this.unpack.length())throw new Error("UnpackException packetLength("+this.packetLength+") greater than bufferLength("+this.unpack.length()+")");var i=[];return e&&jn(e).call(e,(function(e){if(!r.unpack.checkBufferBoundaryAccess())switch(e.type){case"PropertyArray":i.push(r.unmarshalPropertyArray());break;case"Property":i.push(r.unmarshalProperty());break;case"Byte":i.push(r.unpack.popByte());break;case"Int":i.push(r.unpack.popInt());break;case"Bool":i.push(r.unpack.popBoolean());break;case"Long":i.push(r.unmarshalLong());break;case"LongArray":i.push(r.unmarshalLongArray());break;case"String":i.push(r.unpack.popString());break;case"StrArray":i.push(r.unmarshalStrArray());break;case"StrStrMap":i.push(r.unmarshalStrStrMap());break;case"StrLongMap":i.push(r.unmarshalStrLongMap());break;case"LongLongMap":i.push(r.unmarshalLongLongMap());break;case"KVArray":i.push(r.unmarshalKVArray())}})),this.innerHeader?n.r[1].body=i:n.r=i,_i(n)},e}();Bf.RES_CODE=2;var Ff=function(){function e(){this.offset=0,this.pageSize=1024,this.capacity=1048576,this.buffer=new Uint8Array(this.pageSize),this.view=new DataView(this.buffer.buffer)}var t=e.prototype;return t.reset=function(){this.offset=0,this.buffer=null,this.view=null},t.size=function(){return this.offset},t.getBuffer=function(){var e;return Wc(e=this.buffer).call(e,0,this.offset).buffer},t.ensureCapacity=function(e){var t=this.offset+e;if(t>this.capacity)throw new Error("PackException over limit");if(t>this.buffer.byteLength){var r=Math.ceil(t/this.pageSize)*this.pageSize,n=new Uint8Array(r);n.set(this.buffer),this.buffer=n,this.view=new DataView(this.buffer.buffer)}},t.putRaw=function(e){this.ensureCapacity(e.length);try{this.buffer.set(e,this.offset),this.offset+=e.length}catch(e){throw new Error("PackException raw")}},t.putByte=function(e){this.ensureCapacity(1);try{this.view.setUint8(this.offset++,e)}catch(e){throw new Error("PackException byte")}},t.putString=function(e){try{var t=Uf(e);this.putVarbin(t)}catch(e){throw new Error("PackException string")}},t.putInt=function(e){this.ensureCapacity(4);try{this.view.setInt32(this.offset,e,!0),this.offset+=4}catch(e){throw new Error("PackException int")}},t.putVarInt=function(e){var t=Vf(e);this.putRaw(t)},t.putBoolean=function(e){this.ensureCapacity(1);try{this.view.setUint8(this.offset++,e?1:0)}catch(e){throw new Error("PackException boolean")}},t.putLong=function(e){this.ensureCapacity(8);try{var t=function(e,t){void 0===t&&(t=!1);var r=new Uint8Array(8),n=new DataView(r.buffer),i=Number(e>Lf-1?e/Lf:0),o=Number(4294967295&e),a=t?[4,0]:[0,4],s=a[0],c=a[1];return n.setUint32(s,i,t),n.setUint32(c,o,t),r}(e,!0);this.buffer.set(t,this.offset),this.offset+=8}catch(e){throw new Error("PackException long")}},t.putStringAsLong=function(e){this.ensureCapacity(8);try{var t=function(e,t){var r,n;void 0===t&&(t=!1);var i=new Uint8Array(8),o=new DataView(i.buffer),a=Dc(r=Pf(e).divide(Lf).number).call(r).join(""),s=Dc(n=Pf(e).mod(Lf).number).call(n).join(""),c=Number(a),u=Number(s),d=t?[4,0]:[0,4],l=d[0],p=d[1];return o.setUint32(l,c,t),o.setUint32(p,u,t),i}(e,!0);this.buffer.set(t,this.offset),this.offset+=8}catch(e){throw new Error("PackException stringAsLong")}},t.putShort=function(e){this.ensureCapacity(2);try{this.view.setInt16(this.offset,e,!0),this.offset+=2}catch(e){throw new Error("PackException short")}},t.putVarbin=function(e){if(!e)return this.ensureCapacity(1),this.putVarInt(0);if(e.byteLength>Math.pow(2,31)-2)throw new Error("PackException varbin. too long");var t=Vf(e.length);this.ensureCapacity(t.length+e.length);try{this.buffer.set(t,this.offset),this.offset+=t.length,this.buffer.set(e,this.offset),this.offset+=e.length}catch(e){throw new Error("PackException varbin")}},e}();function Gf(e){if("number"!=typeof e){if(null==e)return!1;e=Number(e)}if(isNaN(e))throw new Error("Number type conversion error");return!0}function jf(e){return null==e}var Hf,Wf=function(){function e(e,t,r){this.pack=new Ff,this.packetLength=0,this.serviceId=0,this.commandId=0,this.serialId=0,this.tag=0,this.serviceId=e,this.commandId=t,this.serialId=r}var t=e.prototype;return t.marshalHeader=function(){this.pack.putVarInt(this.packetLength),this.pack.putByte(this.serviceId),this.pack.putByte(this.commandId),this.pack.putShort(this.serialId),this.pack.putByte(this.tag)},t.marshalProperty=function(e){var t=this,r=fr(e),n=fu(r).call(r,(function(e){return!jf(e)}));this.pack.putVarInt(n.length),jn(n).call(n,(function(r){t.pack.putVarInt(Number(r)),Ei(e[r])||"[object Object]"===Object.prototype.toString.call(e[r])?t.pack.putString(_i(e[r])):t.pack.putString(String(e[r]))}))},t.marshalPropertyArray=function(e){var t=this,r=e.length;this.pack.putVarInt(r),jn(e).call(e,(function(e){t.marshalProperty(null==e?void 0:e.v)}))},t.marshalStrArray=function(e){var t=this,r=fu(e).call(e,(function(e){return!jf(e)})),n=r.length;this.pack.putVarInt(n),jn(r).call(r,(function(e){t.pack.putString(String(e))}))},t.marshalLongArray=function(e){var t=this,r=fu(e).call(e,(function(e){return Gf(e)})),n=r.length;this.pack.putVarInt(n),jn(r).call(r,(function(e){t.putLong(e)}))},t.marshalStrStrMap=function(e){var t=this,r=fr(e),n=fu(r).call(r,(function(t){return!jf(e[t])&&!jf(t)}));this.pack.putVarInt(n.length),jn(n).call(n,(function(r){t.pack.putString(String(r)),t.pack.putString(String(e[r]))}))},t.marshalStrLongMap=function(e){var t=this,r=fr(e),n=fu(r).call(r,(function(t){return Gf(e[t])&&!jf(t)}));this.pack.putVarInt(n.length),jn(n).call(n,(function(r){t.pack.putString(String(r)),t.putLong(e[r])}))},t.marshalLongLongMap=function(e){var t=this,r=fr(e),n=fu(r).call(r,(function(t){var r=Number(t);return Gf(r)&&Gf(e[r])}));this.pack.putVarInt(n.length),jn(n).call(n,(function(r){var n=Number(r);t.putLong(n),t.putLong(e[n])}))},t.marshalKVArray=function(e){var t=this,r=e.length;this.pack.putVarInt(r),jn(e).call(e,(function(e){t.marshalStrStrMap(e)}))},t.putLong=function(e){"string"==typeof e&&e.length>15?this.pack.putStringAsLong(e):this.pack.putLong(Number(e))},t.marshal=function(e,t){var r=this;return this.marshalHeader(),t&&jn(t).call(t,(function(t,n){var i,o=t.type,a=null===(i=e[n])||void 0===i?void 0:i.v;if(!jf(a))switch(o){case"PropertyArray":r.marshalPropertyArray(a);break;case"Property":r.marshalProperty(a);break;case"Byte":if(!Gf(a))return;r.pack.putByte(Number(a));break;case"Int":if(!Gf(a))return;r.pack.putInt(Number(a));break;case"Bool":"false"===a?a=!1:"true"===a&&(a=!0),r.pack.putBoolean(a);break;case"Long":if(!Gf(a))return;r.putLong(a);break;case"LongArray":r.marshalLongArray(a);break;case"String":r.pack.putString(String(a));break;case"StrArray":r.marshalStrArray(a);break;case"StrStrMap":r.marshalStrStrMap(a);break;case"StrLongMap":r.marshalStrLongMap(a);break;case"LongLongMap":r.marshalLongLongMap(a);break;case"KVArray":r.marshalKVArray(a)}})),this.pack.getBuffer()},t.reset=function(){this.pack.reset()},e}(),Kf=function(e){function t(t,r){var n;return(n=e.call(this)||this).url=r,n.websocket=null,n.socketConnectTimer=0,n.core=t,n.url=r,n.status="disconnected",n.logger=t.logger,n.connect(),n}nr(t,e);var r=t.prototype;return r.connect=function(){"connecting"!==this.status&&"connected"!==this.status?(this.status="connecting",this._createWebsocket("wss://"+this.url+"/websocket")):this.logger.warn("imsocket::socket is connecting or connected",this.status)},r.close=function(){if(this.status="disconnected",this.websocket){this.logger.log("imsocket:: close websocket");try{this.websocket.close()}catch(e){this.logger.warn("imsocket::attempt to close websocket error",e)}this.clean(),this.emit("disconnect")}},r.clean=function(){this.status="disconnected",clearTimeout(this.socketConnectTimer),this.websocket&&(this.socketUrl=void 0,this.websocket.onmessage=null,this.websocket.onopen=null,this.websocket.onerror=null,this.websocket.onclose=null,this.websocket=null)},r.onConnect=function(){this.status="connected",this.emit("connect"),clearTimeout(this.socketConnectTimer)},r._createWebsocket=function(e){var t,r=this;this.socketConnectTimer=qs((function(){r.logger.error("imsocket::Websocket connect timeout. url: ",e),r.emit("connectFailed",new _l({code:"v2"===Zp(r.core,"options.apiVersion")?Tl.V2NIM_ERROR_CODE_CONNECT_TIMEOUT:415,detail:{reason:"imsocket::Websocket connect timeout. url: "+e}}))}),this.core.options.socketConnectTimeout||8e3),this.socketUrl=e,this.websocket=new Zl.WebSocket(e),this.websocket.binaryType="arraybuffer",this.websocket.onmessage=tr(t=this.onMessage).call(t,this),this.websocket.onclose=function(){r.logger.log("imsocket::Websocket onclose done"),"connected"===r.status?(r.clean(),r.emit("disconnect")):(r.clean(),r.emit("connectFailed",new _l({code:"v2"===Zp(r.core,"options.apiVersion")?Tl.V2NIM_ERROR_CODE_CONNECT_FAILED:414,detail:{reason:"imsocket::Websocket onclose done"}})))},this.websocket.onerror=function(e){r.logger.error("imsocket::Websocket onerror",e),"connected"===r.status?(r.clean(),r.emit("disconnect")):(r.clean(),r.emit("connectFailed",new _l({code:"v2"===Zp(r.core,"options.apiVersion")?Tl.V2NIM_ERROR_CODE_CONNECT_FAILED:414,detail:{reason:"imsocket::Websocket onerror."}})))},this.websocket.onopen=function(){r.onConnect()}},r.onMessage=function(e){if(e.data){var t=new Bf(e.data),r={sid:-1,cid:-1,ser:-1,packetLength:-1},n=null;try{t.unmarshalHeader(),r=t.getHeader(),n=t.getInnerHeader()}catch(t){this.reportBinaryError({err:t,sid:n?n.sid:null==r?void 0:r.sid,cid:n?n.cid:null==r?void 0:r.cid,rawBuf:e.data,type:"decode"})}var i=n?n.sid:r.sid,o=n?n.cid:r.cid,a=i+"_"+o,s=mh[a];if(s&&s.length>0){var c,u=s[0].config;try{c=t.unmarshal(u.response)}catch(n){var d=t.getBodyDetail();this.reportBinaryError({err:n,rawBuf:e.data,sid:i,cid:o,parseDetail:d,type:"decode"}),t.reset();var l=dr(dr({},r),{sid:i,cid:o,code:Tl.V2NIM_ERROR_CODE_UNPACK_ERROR});return this.logger.error('imsocket::onMessage "'+l.sid+"_"+l.cid+'", ser '+l.ser+", packetLength "+l.packetLength+" unmarshal error. "+d+" \n",n),void this.emit("message",_i(l))}this.emit("message",c)}else this.core.logger.warn("imsocket::onMessage cmd not found",a);t.reset()}},r.send=function(e,t,r,n,i){var o,a,s=new Wf(e,t,r),c=ph[n],u="";try{u=_i(i),a=s.marshal(JSON.parse(u),c.params)}catch(n){throw this.reportBinaryError({err:n,sid:e,cid:t,rawStr:u,type:"encode"}),s.reset(),new _l({code:Tl.V2NIM_ERROR_CODE_PACK_ERROR,detail:{reason:e+"-"+t+", ser "+r+" marshal error",rawError:n}})}null===(o=this.websocket)||void 0===o||o.send(a),s.reset()},r.reportBinaryError=function(e){var t,r,n,i=e.err,o=e.rawStr,a=e.sid,s=e.cid,c=e.type,u=e.parseDetail,d=e.rawBuf;if(d){try{n=function(e){if("function"!=typeof btoa)return"";for(var t="",r=new Uint8Array(e),n=r.byteLength,i=0;i<n;i++)t+=String.fromCharCode(r[i]);return r=null,btoa(t)}(d)}catch(e){n="reportBinaryError::arrayBufferToBase64 parsing failed, error: "+(null==e?void 0:e.message)+", sid: "+a+", cid: "+s,this.core.logger.error(n)}d=null}this.core.reporter.reportTraceStart("exceptions",{user_id:null===(t=this.core.auth)||void 0===t?void 0:t.account,trace_id:null===(r=this.core.clientSocket.socket)||void 0===r?void 0:r.sessionId,start_time:_s(),action:2,exception_service:9});var l=i?(i.message+";;;"||i.code+";;;")+(u?"parseDetail: "+u+";;;":"")+(o?" rawStr: "+o:"")+(n?" rawBuf: "+n:""):"";this.core.reporter.reportTraceUpdateV2("exceptions",{code:"encode"===c?Tl.V2NIM_ERROR_CODE_PACK_ERROR:Tl.V2NIM_ERROR_CODE_UNPACK_ERROR,description:l,operation_type:"encode"===c?3:4,target:a+"-"+s},{asyncParams:Zl.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1)},t}(Bs);function Yf(e,t){var r,n=void 0!==Nc&&Fl(e)||e["@@iterator"];if(n)return tr(r=(n=n.call(e)).next).call(r,n);if(Ei(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return Qf(e,t);var n=Wc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Bl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Qf(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Qf(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}!function(e){e[e.ACTIVE=1]="ACTIVE",e[e.KICKED=2]="KICKED",e[e.OFFLINE=3]="OFFLINE"}(Hf||(Hf={}));var Jf,zf=function(){function e(e){this.isReconnect=!1,this.packetTimeout=8e3,this.packetSer=1,this.backoff=new jh({max:8e3,min:1600,jitter:.01}),this.sendingCmdMap=new ad,this.pingTimer=0,this.hasNetworkListener=!1,this.core=e,this.auth=e.auth,this.logger=e.logger,this.reporter=e.reporter,this.timerManager=e.timerManager,this.eventBus=e.eventBus,this.setListener()}var t=e.prototype;return t.setListener=function(){var e=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(){e.isReconnect=!0}))},t.setSessionId=function(e){this.socket&&(this.socket.sessionId=e)},t.connect=function(e,t){var r,n;return void 0===t&&(t=!1),zl(this,void 0,void 0,Ql.mark((function i(){var o,a,s,c;return Ql.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(this.isReconnect=t,1!==(o=this.core.auth.getConnectStatus())){i.next=7;break}return a="clientSocket::connect status is "+o+", and would not repeat connect",s=new _l({code:Tl.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:a}}),this.logger.warn(a),i.abrupt("return",fs.reject(s));case 7:return this.auth.lifeCycle.processEvent("connect"),i.prev=8,i.next=11,this.auth.doLoginStepsManager.add(this.doConnect(e));case 11:this.logger.log("clientSocketV2:: connect success with link url: "+e+", isReconnect: "+t),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:e,code:200,mixlink:!0,succeed:!0},{asyncParams:Zl.net.getNetworkStatus()}),this.auth.lifeCycle.processEvent("connectSucc"),i.next=28;break;case 16:if(i.prev=16,i.t0=i.catch(8),c=i.t0,this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:e,code:c.code||0,description:"connectFailed:"+c.message,mixlink:!0,succeed:!1},{asyncParams:Zl.net.getNetworkStatus()}),c.code!==Tl.V2NIM_ERROR_CODE_CANCELLED&&c.code!==Tl.V2NIM_ERROR_CODE_TIMEOUT){i.next=25;break}throw null===(r=this.socket)||void 0===r||r.close(),null===(n=this.socket)||void 0===n||n.removeAllListeners(),this.socket=void 0,i.t0;case 25:throw this.logger.warn("clientSocketV2::connect failed with link url: "+e,c),this.auth.lifeCycle.processEvent("connectFail",c),i.t0;case 28:case"end":return i.stop()}}),i,this,[[8,16]])})))},t.doConnect=function(e){var t=this,r=!1;return new fs((function(n,i){var o;t.socket=new Kf(t.core,e),t.socket.on("connect",(function(){t.logger.log("clientSocketV2::socket on connect",e),t.core.reporterHookLinkKeep.start(),t.core.reporterHookLinkKeep.update({code:0,description:"connection begin",operation_type:0,target:e}),r=!0,n()})),t.socket.on("message",tr(o=t.onMessage).call(o,t)),t.socket.on("disconnect",(function(n){return zl(t,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=!0,this.logger.log("clientSocketV2::socket on disconnect "+e,n),t.next=4,this.core.reporterHookLinkKeep.update({code:(null==n?void 0:n.code)||0,description:(null==n?void 0:n.reason)||"socket on disconnect",operation_type:1,target:e});case 4:this.core.reporterHookLinkKeep.end(!1),this.doDisconnect(Hf.OFFLINE,"SocketOnDisconnect");case 6:case"end":return t.stop()}}),t,this)})))})),t.socket.on("connectFailed",(function(n){r?t.ping():(t.logger.error("clientSocketV2::connectFailed:"+e+", reason:"+(n&&n.message)),t.cleanSocket()),r=!0,i(n)}))}))},t.cleanSocket=function(){this.socket&&("function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),"function"==typeof this.socket.close&&this.socket.close(),this.socket=void 0)},t.resetSocketConfig=function(){this.backoff.reset(),this.initOnlineListener()},t.doDisconnect=function(e,t){if(this.logger.log("clientSocketV2::doDisconnect: type "+e+", reason ",t),0!==this.core.auth.getConnectStatus()){var r={1:"close",2:"kicked",3:"broken"}[e]||"";this.markAllCmdInvaild(new _l({code:Tl.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"Packet timeout due to instance disconnect",disconnect_reason:r}})),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.cleanSocket(),e===Hf.ACTIVE||e===Hf.KICKED?this.destroyOnlineListener():e===Hf.OFFLINE&&(this.auth.lifeCycle.processEvent("connectionBroken",new _l({code:Tl.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"connection broken due to internal reasons"}})),this.logger.log("clientSocketV2::doDisconnect: pending reconnect "+this.isReconnect),this.isReconnect&&this.auth.lifeCycle.processEvent("waiting"))}else this.logger.warn("clientSocketV2::doDisconnect: already disconnected")},t.sendCmd=function(e,t,r){var n=this,i=this.core.auth.getLoginStatus(),o=["v2Login","login","chatroomLogin","v2ChatroomLogin"],a={cmd:e};if(1!==i&&!ou(o).call(o,e))return this.logger.warn("clientSocketV2::NIM login status is "+i+", so can not sendCmd "+e),fs.reject(new _l({code:Tl.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:dr({reason:"Can not sendCmd due to no logined"},a)}));var s="heartbeat"!==e,c=s?this.packetSer++:0,u=hh(e,c,this.logger,t);if(!u){var d=new _l({code:Tl.V2NIM_ERROR_CODE_INTERNAL,detail:dr(dr({},a),{reason:"SendCmd::createCmd error: "+c+" "+e})});return this.logger.error(d),fs.reject(d)}var l=u.packet,p=u.hasPacketResponse,m=u.hasPacketTimer,h=_i(l);s&&(this.logger.getDebugMode()?this.logger.debug("clientSocketV2::sendCmd: "+l.SID+"_"+l.CID+","+e+",ser:"+c,h):this.logger.log("clientSocketV2::sendCmd: "+l.SID+"_"+l.CID+","+e+",ser:"+c));var f=(new Date).getTime();return new fs((function(i,o){p&&n.sendingCmdMap.set(c,{cmd:e,params:t,callback:[i,o],timer:m?qs((function(){var t=new _l({code:Tl.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,detail:dr({ser:c,reason:"Packet Timeout: ser "+c+" cmd "+e,timetag:(new Date).getTime()},a)});n.markCmdInvalid(c,t,e)}),r&&r.timeout?r.timeout:n.packetTimeout):null});try{n.socket.send(l.SID,l.CID,c,e,l.Q),p||i(l)}catch(t){var s=new _l({code:Tl.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED,detail:dr({ser:c,reason:"Unable to send packet"+(t&&t.message?": "+t.message:""),timetag:(new Date).getTime(),rawError:t},a)});n.markCmdInvalid(c,s,e),o(s)}})).catch((function(e){return zl(n,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e,n=[Tl.V2NIM_ERROR_CODE_DISCONNECT,Tl.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,Tl.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED],ou(n).call(n,r.code)){t.next=4;break}return t.abrupt("return",fs.reject(r));case 4:return this.reportSendCmdFailed(r,{sid:l.SID,cid:l.CID,ser:c},f),t.abrupt("return",fs.reject(r));case 6:case"end":return t.stop()}}),t,this)})))}))},t.reportSendCmdFailed=function(e,t,r){var n;this.reporter.reportTraceStart("exceptions",{user_id:this.core.auth.getLoginUser(),trace_id:null===(n=this.socket)||void 0===n?void 0:n.sessionId,start_time:r,action:2,exception_service:6});var i=Zp(e,"detail.disconnect_reason")||"",o=e.code===Tl.V2NIM_ERROR_CODE_DISCONNECT?_i({disconnect_reason:i}):e.detail.reason;this.reporter.reportTraceUpdateV2("exceptions",{code:e.code,description:o,operation_type:1,target:t.sid+"-"+t.cid,context:""+t.ser},{asyncParams:Zl.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1)},t.onMessage=function(e){var t=fh(e,this.logger);if(t){var r=t[0],n=r.raw.ser;"heartbeat"!==r.cmd&&(this.logger.getDebugMode()?this.logger.debug("clientSocketV2::recvCmd "+r.raw.sid+"_"+r.raw.cid+","+r.cmd+",ser:"+n,e):this.logger.log("clientSocketV2::recvCmd "+r.raw.sid+"_"+r.raw.cid+","+r.cmd+",ser:"+n+",code:"+r.raw.code));for(var i,o=Yf(t);!(i=o()).done;){var a=i.value;if(a.error&&this.logger.error("clientSocketV2::onMessage packet error",a.raw.sid+"_"+a.raw.cid+", ser:"+n+",",a.error),a.notFound)return void this.logger.warn("clientSocketV2::onMessage packet not found",a.raw.sid+"_"+a.raw.cid+", ser:"+n);this.packetHandler(a)}}},t.packetHandler=function(e){var t,r,n=this;if(e){var i=e.raw.ser,o=this.sendingCmdMap.get(i);if(o&&o.cmd===e.cmd){var a=o.callback,s=o.timer,c=o.params;if(clearTimeout(s),e.params=c,this.sendingCmdMap.delete(i),"heartbeat"===e.cmd)return void a[0]();var u=null===(t=this.core[e.service])||void 0===t?void 0:t.process(e);u&&"function"==typeof u.then?u.then((function(e){a[0](e)})).catch((function(e){a[1](e)})):(this.logger.log("clientSocketV2::handlerFn without promise",e.service,e.cmd),a[0](e))}else{var d=null===(r=this.core[e.service])||void 0===r?void 0:r.process(e);d&&"function"==typeof d.then&&d.catch((function(e){n.logger.error("clientSocketV2::no obj cache, no process handler",e)}))}}},t.markCmdInvalid=function(e,t,r){var n=this.sendingCmdMap.get(e);if(n){var i=n.callback,o=n.timer;o&&clearTimeout(o),this.sendingCmdMap.delete(e),this.logger.warn("clientSocketV2::packet "+e+", "+r+" is invalid:",t),i[1](t)}},t.markAllCmdInvaild=function(e){var t,r=this;this.logger.log("markAllCmdInvaild",e),jn(t=this.sendingCmdMap).call(t,(function(t){var n=t.callback,i=t.timer,o=t.cmd;r.logger.log("clientSocketV2::markAllCmdInvaild:cmd "+o),i&&clearTimeout(i),n[1](e)})),this.sendingCmdMap.clear()},t.ping=function(){var e;return zl(this,void 0,void 0,Ql.mark((function t(){var r=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return clearTimeout(this.pingTimer),t.prev=1,t.next=4,this.sendCmd("heartbeat");case 4:t.next=20;break;case 6:if(t.prev=6,t.t0=t.catch(1),t.t0.code!==Tl.V2NIM_ERROR_CODE_DISCONNECT){t.next=11;break}return t.abrupt("return");case 11:return t.next=13,this.testHeartBeat5Timeout();case 13:if(!t.sent){t.next=20;break}return t.next=17,this.core.reporterHookLinkKeep.update({code:0,description:"Heartbeat-discovered link failure",operation_type:1,target:null===(e=this.socket)||void 0===e?void 0:e.url});case 17:return this.core.reporterHookLinkKeep.end(!0),this.doDisconnect(Hf.OFFLINE,"PingError"),t.abrupt("return");case 20:this.pingTimer=qs((function(){r.ping()}),3e4);case 21:case"end":return t.stop()}}),t,this,[[1,6]])})))},t.testHeartBeat5Timeout=function(){return zl(this,void 0,void 0,Ql.mark((function e(){var t;return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:clearTimeout(this.pingTimer),t=0;case 2:if(!(t<5)){e.next=15;break}return e.prev=3,e.next=6,this.sendCmd("heartbeat",{},{timeout:3e3});case 6:return e.abrupt("return",!1);case 9:e.prev=9,e.t0=e.catch(3),this.logger.log("clientSocketV2::test heartbeat "+t+" Timeout");case 12:t++,e.next=2;break;case 15:return e.abrupt("return",!0);case 16:case"end":return e.stop()}}),e,this,[[3,9]])})))},t.initOnlineListener=function(){var e=this;this.hasNetworkListener||(this.logger.log("clientSocketV2::onlineListener:init"),this.hasNetworkListener=!0,Zl.net.onNetworkStatusChange((function(t){e.logger.log("clientSocketV2::onlineListener:network change",t);var r=e.auth.getConnectStatus(),n=e.auth.getLoginStatus();t.isConnected&&1===n?e.ping():t.isConnected&&3===r?(e.logger.log("clientSocketV2::onlineListener:online and connectStatus is waiting, do reLogin"),e.auth.reconnect.clearReconnectTimer(),e.auth.reconnect.doReLogin()):t.isConnected||e.doDisconnect(Hf.OFFLINE,"OfflineListener")})))},t.destroyOnlineListener=function(){this.logger.log("clientSocketV2::onlineListener:destroy"),Zl.net.offNetworkStatusChange(),this.hasNetworkListener=!1},e}();function Xf(e,t){var r,n=void 0!==Nc&&Fl(e)||e["@@iterator"];if(n)return tr(r=(n=n.call(e)).next).call(r,n);if(Ei(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return $f(e,t);var n=Wc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Bl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$f(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function $f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}!function(e){e[e.ACTIVE=1]="ACTIVE",e[e.KICKED=2]="KICKED",e[e.OFFLINE=3]="OFFLINE"}(Jf||(Jf={}));var Zf=function(){function e(e){this.isReconnect=!1,this.packetTimeout=8e3,this.packetSer=1,this.backoff=new jh({max:8e3,min:1600,jitter:.01}),this.sendingCmdMap=new ad,this.pingTimer=0,this.hasNetworkListener=!1,this.core=e,this.auth=e.auth,this.logger=e.logger,this.reporter=e.reporter,this.timerManager=e.timerManager,this.eventBus=e.eventBus,this.setListener()}var t=e.prototype;return t.setListener=function(){var e=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(){e.isReconnect=!0}))},t.setSessionId=function(e){this.socket&&(this.socket.sessionId=e)},t.connect=function(e,t){var r,n;return void 0===t&&(t=!1),zl(this,void 0,void 0,Ql.mark((function i(){var o,a,s,c;return Ql.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(this.isReconnect=t,1!==(o=this.core.auth.getConnectStatus())){i.next=7;break}return a="clientSocket::connect status is "+o+", and would not repeat connect",s=new _l({code:Tl.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:a}}),this.logger.warn(a),i.abrupt("return",fs.reject(s));case 7:return this.auth.lifeCycle.processEvent("connect"),i.prev=8,i.next=11,this.auth.doLoginStepsManager.add(this.doConnect(e));case 11:this.logger.log("clientSocketV2:: connect success with link url: "+e+", isReconnect: "+t),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:e,code:200,mixlink:!0,succeed:!0},{asyncParams:Zl.net.getNetworkStatus()}),this.auth.lifeCycle.processEvent("connectSucc"),i.next=28;break;case 16:if(i.prev=16,i.t0=i.catch(8),c=i.t0,this.core.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:e,code:c.code||0,description:"connectFailed:"+c.message,mixlink:!0,succeed:!1},{asyncParams:Zl.net.getNetworkStatus()}),c.code!==Tl.V2NIM_ERROR_CODE_CANCELLED&&c.code!==Tl.V2NIM_ERROR_CODE_TIMEOUT){i.next=25;break}throw null===(r=this.socket)||void 0===r||r.close(),null===(n=this.socket)||void 0===n||n.removeAllListeners(),this.socket=void 0,i.t0;case 25:throw this.logger.warn("clientSocketV2::connect failed with link url: "+e,c),this.auth.lifeCycle.processEvent("connectFail",c),i.t0;case 28:case"end":return i.stop()}}),i,this,[[8,16]])})))},t.doConnect=function(e){var t=this,r=!1;return new fs((function(n,i){var o;t.socket=new Jh(t.core,e),t.socket.on("connect",(function(){t.logger.log("clientSocketV2::socket on connect",e),t.core.reporterHookLinkKeep.start(),t.core.reporterHookLinkKeep.update({code:0,description:"connection begin",operation_type:0,target:e}),r=!0,n()})),t.socket.on("message",tr(o=t.onMessage).call(o,t)),t.socket.on("disconnect",(function(n){return zl(t,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=!0,this.logger.log("clientSocketV2::socket on disconnect",n),t.next=4,this.core.reporterHookLinkKeep.update({code:(null==n?void 0:n.code)||0,description:(null==n?void 0:n.reason)||"socket on disconnect",operation_type:1,target:e});case 4:this.core.reporterHookLinkKeep.end(!1),this.doDisconnect(Jf.OFFLINE,"SocketOnDisconnect");case 6:case"end":return t.stop()}}),t,this)})))})),t.socket.on("handshakeFailed",(function(e){r?t.ping():(t.logger.error('clientSocketV2::handshake failed: "'+(e&&e.message)+'"'),t.cleanSocket()),r=!0,i(e)}))}))},t.cleanSocket=function(){this.socket&&("function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),"function"==typeof this.socket.close&&this.socket.close(),this.socket=void 0)},t.resetSocketConfig=function(){this.backoff.reset(),this.initOnlineListener()},t.doDisconnect=function(e,t){if(this.logger.log("clientSocketV2::doDisconnect: type "+e+", reason ",t),0!==this.core.auth.getConnectStatus()){var r={1:"close",2:"kicked",3:"broken"}[e]||"";this.markAllCmdInvaild(new _l({code:Tl.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"Packet timeout due to instance disconnect",disconnect_reason:r}})),this.timerManager.destroy(),clearTimeout(this.pingTimer),this.cleanSocket(),e===Jf.ACTIVE||e===Jf.KICKED?this.destroyOnlineListener():e===Jf.OFFLINE&&(this.auth.lifeCycle.processEvent("connectionBroken",new _l({code:Tl.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"connection broken due to internal reasons"}})),this.logger.log("clientSocketV2::doDisconnect: pending reconnect "+this.isReconnect),this.isReconnect&&this.auth.lifeCycle.processEvent("waiting"))}else this.logger.warn("clientSocketV2::doDisconnect: already disconnected")},t.sendCmd=function(e,t,r){var n=this,i=this.core.auth.getLoginStatus(),o=["v2Login","login","chatroomLogin","v2ChatroomLogin"],a={cmd:e};if(1!==i&&!ou(o).call(o,e))return this.logger.warn("clientSocketV2::NIM login status is "+i+", so can not sendCmd "+e),fs.reject(new _l({code:Tl.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:dr({reason:"Can not sendCmd due to no logined"},a)}));var s="heartbeat"!==e,c=s?this.packetSer++:0,u=hh(e,c,this.logger,t);if(!u){var d=new _l({code:Tl.V2NIM_ERROR_CODE_INTERNAL,detail:dr(dr({},a),{reason:"SendCmd::createCmd error: "+c+" "+e})});return this.logger.error(d),fs.reject(d)}var l=u.packet,p=u.hasPacketResponse,m=u.hasPacketTimer,h=_i(l);s&&(this.logger.getDebugMode()?this.logger.debug("clientSocketV2::sendCmd: "+l.SID+"_"+l.CID+","+e+",ser:"+c,h):this.logger.log("clientSocketV2::sendCmd: "+l.SID+"_"+l.CID+","+e+",ser:"+c));var f=(new Date).getTime();return new fs((function(i,o){p&&n.sendingCmdMap.set(c,{cmd:e,params:t,callback:[i,o],timer:m?qs((function(){var t=new _l({code:Tl.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,detail:dr({ser:c,reason:"Packet Timeout: ser "+c+" cmd "+e,timetag:(new Date).getTime()},a)});n.markCmdInvalid(c,t,e)}),r&&r.timeout?r.timeout:n.packetTimeout):null});try{n.socket.send(h),p||i(l)}catch(t){var s=new _l({code:Tl.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED,detail:dr({ser:c,reason:"Unable to send packet"+(t&&t.message?": "+t.message:""),timetag:(new Date).getTime(),rawError:t},a)});n.markCmdInvalid(c,s,e),o(s)}})).catch((function(e){return zl(n,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e,i=[Tl.V2NIM_ERROR_CODE_DISCONNECT,Tl.V2NIM_ERROR_CODE_PROTOCOL_TIMEOUT,Tl.V2NIM_ERROR_CODE_PROTOCOL_SEND_FAILED],ou(i).call(i,n.code)){t.next=4;break}return t.abrupt("return",fs.reject(n));case 4:return this.reporter.reportTraceStart("exceptions",{user_id:this.core.auth.getLoginUser(),trace_id:null===(r=this.socket)||void 0===r?void 0:r.sessionId,start_time:f,action:2,exception_service:6}),o=Zp(n,"detail.disconnect_reason")||"",a=n.code===Tl.V2NIM_ERROR_CODE_DISCONNECT?_i({disconnect_reason:o}):n.detail.reason,this.reporter.reportTraceUpdateV2("exceptions",{code:n.code,description:a,operation_type:1,target:l.SID+"-"+l.CID,context:""+l.SER},{asyncParams:Zl.net.getNetworkStatus()}),this.reporter.reportTraceEnd("exceptions",1),t.abrupt("return",fs.reject(n));case 10:case"end":return t.stop()}}),t,this)})))}))},t.onMessage=function(e){var t=fh(e,this.logger);if(t)for(var r,n=Xf(t);!(r=n()).done;){var i=r.value,o=i.raw.ser;if(i.error&&this.logger.error("clientSocketV2::onMessage packet error",i.raw.sid+"_"+i.raw.cid+", ser:"+o+",",i.error),i.notFound)return void this.logger.warn("clientSocketV2::onMessage packet not found",i.raw.sid+"_"+i.raw.cid+", ser:"+o);"heartbeat"!==i.cmd&&(this.logger.getDebugMode()?this.logger.debug("clientSocketV2::recvCmd "+i.raw.sid+"_"+i.raw.cid+","+i.cmd+",ser:"+o,i.content):this.logger.log("clientSocketV2::recvCmd "+i.raw.sid+"_"+i.raw.cid+","+i.cmd+",ser:"+o+";code:"+i.raw.code)),this.packetHandler(i)}},t.packetHandler=function(e){var t,r,n=this;if(e){var i=e.raw.ser,o=this.sendingCmdMap.get(i);if(o&&o.cmd===e.cmd){var a=o.callback,s=o.timer,c=o.params;if(clearTimeout(s),e.params=c,this.sendingCmdMap.delete(i),"heartbeat"===e.cmd)return void a[0]();var u=null===(t=this.core[e.service])||void 0===t?void 0:t.process(e);u&&"function"==typeof u.then?u.then((function(e){a[0](e)})).catch((function(e){a[1](e)})):(this.logger.log("clientSocketV2::handlerFn without promise",e.service,e.cmd),a[0](e))}else{var d=null===(r=this.core[e.service])||void 0===r?void 0:r.process(e);d&&"function"==typeof d.then&&d.catch((function(e){n.logger.error("clientSocketV2::no obj cache, no process handler",e)}))}}},t.markCmdInvalid=function(e,t,r){var n=this.sendingCmdMap.get(e);if(n){var i=n.callback,o=n.timer;o&&clearTimeout(o),this.sendingCmdMap.delete(e),this.logger.warn("clientSocketV2::packet "+e+", "+r+" is invalid:",t),i[1](t)}},t.markAllCmdInvaild=function(e){var t,r=this;this.logger.log("markAllCmdInvaild",e),jn(t=this.sendingCmdMap).call(t,(function(t){var n=t.callback,i=t.timer,o=t.cmd;r.logger.log("clientSocketV2::markAllCmdInvaild:cmd "+o),i&&clearTimeout(i),n[1](e)})),this.sendingCmdMap.clear()},t.ping=function(){var e;return zl(this,void 0,void 0,Ql.mark((function t(){var r=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return clearTimeout(this.pingTimer),t.prev=1,t.next=4,this.sendCmd("heartbeat");case 4:t.next=20;break;case 6:if(t.prev=6,t.t0=t.catch(1),t.t0.code!==Tl.V2NIM_ERROR_CODE_DISCONNECT){t.next=11;break}return t.abrupt("return");case 11:return t.next=13,this.testHeartBeat5Timeout();case 13:if(!t.sent){t.next=20;break}return t.next=17,this.core.reporterHookLinkKeep.update({code:0,description:"Heartbeat-discovered link failure",operation_type:1,target:null===(e=this.socket)||void 0===e?void 0:e.url});case 17:return this.core.reporterHookLinkKeep.end(!0),this.doDisconnect(Jf.OFFLINE,"PingError"),t.abrupt("return");case 20:this.pingTimer=qs((function(){r.ping()}),3e4);case 21:case"end":return t.stop()}}),t,this,[[1,6]])})))},t.testHeartBeat5Timeout=function(){return zl(this,void 0,void 0,Ql.mark((function e(){var t;return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:clearTimeout(this.pingTimer),t=0;case 2:if(!(t<5)){e.next=15;break}return e.prev=3,e.next=6,this.sendCmd("heartbeat",{},{timeout:3e3});case 6:return e.abrupt("return",!1);case 9:e.prev=9,e.t0=e.catch(3),this.logger.log("clientSocketV2::test heartbeat "+t+" Timeout");case 12:t++,e.next=2;break;case 15:return e.abrupt("return",!0);case 16:case"end":return e.stop()}}),e,this,[[3,9]])})))},t.initOnlineListener=function(){var e=this;this.hasNetworkListener||(this.logger.log("clientSocketV2::onlineListener:init"),this.hasNetworkListener=!0,Zl.net.onNetworkStatusChange((function(t){e.logger.log("clientSocketV2::onlineListener:network change",t);var r=e.auth.getConnectStatus(),n=e.auth.getLoginStatus();t.isConnected&&1===n?e.ping():t.isConnected&&3===r?(e.logger.log("clientSocketV2::onlineListener:online and connectStatus is waiting, do reLogin"),e.auth.reconnect.clearReconnectTimer(),e.auth.reconnect.doReLogin()):t.isConnected||e.doDisconnect(Jf.OFFLINE,"OfflineListener")})))},t.destroyOnlineListener=function(){this.logger.log("clientSocketV2::onlineListener:destroy"),Zl.net.offNetworkStatusChange(),this.hasNetworkListener=!1},e}(),eg=function(){function e(e){this.currenRetryCount=0,this.backoff=new jh({max:8e3,min:1600,jitter:.01}),this.reconnectTimer=0,this.core=e,this.auth=e.V2NIMLoginService}var t=e.prototype;return t.reset=function(){this.currenRetryCount=0,this.backoff.reset(),this.reconnectTimer&&clearTimeout(this.reconnectTimer)},t.clearReconnectTimer=function(){this.reconnectTimer&&clearTimeout(this.reconnectTimer)},t.attempToReLogin=function(){var e=this,t=this.backoff.duration();if("function"==typeof this.reconnectDelayProvider)try{var r=this.reconnectDelayProvider(t);"number"==typeof r&&r>=0&&(t=r>=1e3?r:r+200+Math.ceil(300*Math.random()))}catch(e){this.core.logger.error("reconnect::connectDelayProvider excute failed,",e)}return this.currenRetryCount++,this.core.logger.log("reconnect::reconnect timer is about to be set, delay "+t+" ms, current retry count is "+this.currenRetryCount),this.core.reporter.reportTraceStart("login",{user_id:this.auth.getLoginUser(),action:"auto_login",binary_websocket:this.auth.binaryWebsocket}),this.clearReconnectTimer(),this.reconnectTimer=qs((function(){e.core.logger.log("reconnect::reconnect timer is now triggered");var t=e.auth.getConnectStatus();3===t?e.doReLogin():e.core.logger.warn("reconnect::reconnect timer is over because connect status now is "+t)}),t),!0},t.doReLogin=function(){var e=this;this.auth.loginOption.forceMode=!1,this.auth.originLoginPromise=this.auth.doLogin(!0);var t=this.auth.previousLoginManager.add(this.auth.originLoginPromise);return t.then((function(){e.core.reporter.reportTraceEnd("login",!0)})).catch((function(t){var r=t;if(e.core.logger.warn("reconnect::try login but failed due to",r),e.core.reporter.reportTraceEnd("login",!1),e.auth.checkLoginTerminalCode(r&&r.code))return e.auth.clientSocket.doDisconnect(Hf.ACTIVE,"ReloginTerminated"),void e.auth.lifeCycle.processEvent("exited",r);r&&399===r.code&&e.auth.lbs.reset(),e.auth.lifeCycle.processEvent("waiting")})),t},t._setReconnectDelayProvider=function(e){this.reconnectDelayProvider=e},e}(),tg=function(){function e(e){this.socketLinkUrls=[],this.timer=0,this.failedCount=0,this.core=e,this.auth=e.V2NIMLoginService}var t=e.prototype;return t.getLbsInfos=function(){return zl(this,void 0,void 0,Ql.mark((function e(){var t,r,n,i;return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.socketLinkUrls.length>0)){e.next=5;break}return t=this.socketLinkUrls.shift(),this.socketLinkUrls=[],this.core.logger.log("V2NIMLoginService::getLbsInfos:use cache link",t),e.abrupt("return",fs.resolve(t));case 5:return this.auth.lifeCycle.processEvent("addressing"),this.core.reporterHookLBS.start(this.core.account),r=zh(this.auth.config.lbsUrls),e.prev=8,e.next=11,this.ladderLoad(r);case 11:if(200===(n=e.sent).status&&n.data){e.next=15;break}throw this.core.logger.error("V1NIMLoginService::getLbsInfos:error status",n.status,n),new _l({code:Tl.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"V2NIMLoginService::getLbsInfos failed, status "+n.status}});case 15:this.success(n),e.next=26;break;case 18:if(e.prev=18,e.t0=e.catch(8),i=e.t0,this.core.logger.error("V2NIMLoginService::lbs getLbsInfos error, use default link: "+this.auth.config.linkUrl+". error:",e.t0),this.reportForFail(r[0],i.code,i.message),!this.checkTerminator(i.code)){e.next=25;break}throw e.t0;case 25:this.socketLinkUrls=[this.auth.config.linkUrl];case 26:return e.abrupt("return",this.socketLinkUrls.shift());case 27:case"end":return e.stop()}}),e,this,[[8,18]])})))},t.checkTerminator=function(e){return e===Tl.V2NIM_ERROR_CODE_CANCELLED||e===Tl.V2NIM_ERROR_CODE_TIMEOUT},t.generateUrl=function(e){return e+(wu(e).call(e,"?")>-1?"&":"?")+"k="+this.core.options.appkey+"&id="+this.core.auth.getLoginUser()+"&sv=180&pv=1&networkType=0&lv=1"},t.requstLbs=function(e){return this.auth.doLoginStepsManager.add(this.core.adapters.request(this.generateUrl(e),{method:"GET",dataType:"json",timeout:8e3}))},t.setLadderTimer=function(e,t,r,n){var i=this;this.timer&&clearTimeout(this.timer);var o=e[t];this.timer=qs((function(){o&&(i.setLadderTimer(e,t+1,r,n),i.core.logger.log("V2NIMLoginService::getLbsInfos "+t+":",o),i.reportForLbsStart(o,t),i.requstLbs(o).then((function(e){i.reset(),r(dr(dr({},e),{url:o}))})).catch((function(r){var a;if(i.core.logger.warn("V2NIMLoginService::getLbsInfos "+t+" failed:",r),i.failedCount+=1,i.reportForFailOnce(o,r.code,(null===(a=r.detail)||void 0===a?void 0:a.reason)||r.message),i.failedCount>=e.length||i.checkTerminator(r.code))return i.reset(),void n(r)})))}),2e3)},t.ladderLoad=function(e){var t=this;return new fs((function(r,n){e.length>1&&t.setLadderTimer(e,1,r,n);var i=e[0];t.core.logger.log("V2NIMLoginService::getLbsInfos 0:",i),t.reportForLbsStart(i,0),t.requstLbs(i).then((function(e){t.reset(),r(dr(dr({},e),{url:i}))})).catch((function(r){var o;t.failedCount+=1,t.core.logger.warn("V2NIMLoginService::getLbsInfos 0 failed:",r),t.reportForFailOnce(i,r.code,(null===(o=r.detail)||void 0===o?void 0:o.reason)||r.message),(t.failedCount>=e.length||t.checkTerminator(r.code))&&(t.reset(),n(r))}))}))},t.success=function(e){var t,r,n,i,o=e.data.common,a=o["mix.link"]||[],s=o["link.default"]||[];this.socketLinkUrls=xs(t=xs(a).call(a,s)).call(t,this.auth.config.linkUrl),e.data["nos-chunk"]&&(null===(n=this.core.cloudStorage)||void 0===n?void 0:n.setOptions)&&(this.core.logger.log("getLbsInfos success. lbs.nos-chunk",e.data["nos-chunk"]),this.core.cloudStorage.setOptions({chunkUploadHost:e.data["nos-chunk"]})),Ei(e.data.nosup)&&e.data.nosup.length>0&&(null===(i=this.core.cloudStorage)||void 0===i?void 0:i.setOptions)&&(this.core.logger.log("getLbsInfos success. lbs.nosup",e.data.nosup),this.core.cloudStorage.setOptions({commonUploadHostBackupList:e.data.nosup,commonUploadHost:e.data.nosup[0]})),this.core.logger.log("V2NIMLoginService::getLbsInfos success, socket link:",Wc(r=this.socketLinkUrls).call(r,0),"chunkUploadHost: ",e.data["nos-chunk"]),this.reportForLbsSuccess(e.url,e.data)},t.reportForLbsStart=function(e,t){this.core.reporterHookLBS.updateBegin({target:e,index:t})},t.reportForLbsSuccess=function(e,t){this.core.reporterHookLBS.updateComplete({target:e,code:200,body:_i(t)}),this.core.reporterHookLBS.end(!0),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:e,code:200,succeed:!0},{asyncParams:Zl.net.getNetworkStatus()})},t.reportForFailOnce=function(e,t,r){this.core.reporterHookLBS.updateComplete({target:e,code:t,body:r})},t.reportForFail=function(e,t,r){this.core.reporterHookLBS.end(!1),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:e,description:r,code:t,succeed:!1},{asyncParams:Zl.net.getNetworkStatus()})},t.reset=function(){this.socketLinkUrls=[],this.failedCount=0,clearTimeout(this.timer)},e}(),rg=function(){function e(e){this.lastLoginClientKey="__NIM_LAST_LOGIN_CLIENT__",this.loginClients=[],this.loginClientOfThisConnection={},this.core=e,this.auth=e.V2NIMLoginService}var t=e.prototype;return t.verifyAuthentication=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a,s,c,u,d,l,p;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.auth.doLoginStepsManager.add(this.refreshLoginToken(this.auth.account));case 2:return n=t.sent,t.next=5,this.auth.doLoginStepsManager.add(this.refreshThirdPartyExt(this.auth.account));case 5:return i=t.sent,this.auth.token=n,o=Zl.getSystemInfo(),a={appkey:this.core.options.appkey,account:this.auth.account,token:n,authType:this.auth.loginOption.authType,appLogin:e?0:1,clientType:16,clientSession:this.auth.clientSession,clientId:this.auth.deviceId,sdkVersion:100700,userAgent:this.core.options.loginSDKTypeParamCompat?"Native/10.7.0":Wc(r=o.userAgent.replace("{{appkey}}",this.core.options.appkey)).call(r,0,299),libEnv:this.core.options.loginSDKTypeParamCompat?void 0:o.libEnv,hostEnv:this.core.options.loginSDKTypeParamCompat?0:o.hostEnvEnum,sdkHumanVersion:this.core.options.flutterSdkVersion||"10.7.0",os:o.os,browser:o.browser,protocolVersion:1,customClientType:this.auth.config.customClientType,customTag:this.auth.config.customTag,thirdPartyExtension:i},s=o.os.toLowerCase(),"UNIAPP"!==Zl.platform||"ios"!==s&&"android"!==s?"React Native"===Zl.platform&&(this.core.logger.log("V2NIMLoginService deviceInfo",this.core.V2NIMLoginService.deviceInfo,"os",s),a.isReactNative=1,a.clientType="ios"===s?2:1,a.deviceInfo=_i(dr({IS_SUPPORT_HONOR:!0},this.core.V2NIMLoginService.deviceInfo))):(a.isReactNative=1,a.clientType="ios"===s?2:1,o.pushDeviceInfo&&o.pushDeviceInfo.MANUFACTURER&&(a.deviceInfo=_i(dr({IS_SUPPORT_HONOR:!0},o.pushDeviceInfo)))),this.core.logger.log("V2NIMLoginService::do login ",a.account,a.clientSession,a.appLogin),t.prev=12,t.next=15,this.auth.doLoginStepsManager.add(this.auth.clientSocket.sendCmd("v2Login",{tag:a}));case 15:c=t.sent,t.next=26;break;case 18:if(t.prev=18,t.t0=t.catch(12),u=t.t0,this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"26-3",code:u.code||0,succeed:!1,description:u.message},{asyncParams:Zl.net.getNetworkStatus()}),u.code!==Tl.V2NIM_ERROR_CODE_CANCELLED&&u.code!==Tl.V2NIM_ERROR_CODE_TIMEOUT){t.next=24;break}throw u;case 24:throw this.processLoginFailed(u),u;case 26:return d=c.content,l=d.data,p=d.loginClients,this.changeLoginClient(1,p),this.core.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"26-3",code:200,succeed:!0},{asyncParams:Zl.net.getNetworkStatus()}),this.loginClientOfThisConnection=pf(l),this.core.clientSocket.setSessionId(l.consid),Zl.localStorage.setItem(this.lastLoginClientKey,_i(dr({account:this.auth.account},this.loginClientOfThisConnection))),t.abrupt("return",this.loginClientOfThisConnection);case 33:case"end":return t.stop()}}),t,this,[[12,18]])})))},t.refreshLoginToken=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==this.auth.loginOption.authType){t.next=2;break}return t.abrupt("return",this.auth.token);case 2:if("function"==typeof this.auth.loginOption.tokenProvider){t.next=4;break}return t.abrupt("return",this.auth.token);case 4:return t.prev=4,t.next=7,this.auth.loginOption.tokenProvider(e);case 7:if("string"!=typeof(r=t.sent)){t.next=12;break}return t.abrupt("return",r);case 12:throw this.core.logger.error("V2NIMLoginService::excute tokenProvider complete but got Unexpected value:",r),new _l({code:Tl.V2NIM_ERROR_CODE_CALLBACK_FAILED,detail:{reason:"Excute tokenProvider complete but got Unexpected value",rawData:r}});case 14:t.next=23;break;case 16:throw t.prev=16,t.t0=t.catch(4),n=t.t0,i=n,n.code!==Tl.V2NIM_ERROR_CODE_CALLBACK_FAILED&&(this.core.logger.error("V2NIMLoginService::excute tokenProvider error:",n),i=new _l({code:Tl.V2NIM_ERROR_CODE_CALLBACK_FAILED,desc:"Excute tokenProvider error",detail:{rawError:t.t0}})),this.processLoginFailed(n),i;case 23:case"end":return t.stop()}}),t,this,[[4,16]])})))},t.refreshThirdPartyExt=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("function"==typeof this.auth.loginOption.loginExtensionProvider){t.next=2;break}return t.abrupt("return","");case 2:return t.prev=2,t.next=5,this.auth.loginOption.loginExtensionProvider(e);case 5:if("string"!=typeof(r=t.sent)){t.next=10;break}return t.abrupt("return",r);case 10:throw this.core.logger.error("V2NIMLoginService::excute loginExtensionProvider complete but got Unexpected value:",r),new _l({code:Tl.V2NIM_ERROR_CODE_CALLBACK_FAILED,detail:{reason:"Excute loginExtensionProvider complete but got Unexpected value",rawData:r}});case 12:t.next=25;break;case 14:if(t.prev=14,t.t0=t.catch(2),n=t.t0,i=n,n.code!==Tl.V2NIM_ERROR_CODE_CALLBACK_FAILED&&(this.core.logger.error("V2NIMLoginService::excute loginExtensionProvider error:",n),i=new _l({code:Tl.V2NIM_ERROR_CODE_CALLBACK_FAILED,detail:{reason:"Excute loginExtensionProvider error",rawError:t.t0}})),2!==this.auth.loginOption.authType){t.next=24;break}throw this.processLoginFailed(n),i;case 24:return t.abrupt("return","");case 25:case"end":return t.stop()}}),t,this,[[2,14]])})))},t.processLoginFailed=function(e){this.auth.clientSocket.doDisconnect(Hf.ACTIVE,e),this.checkLoginTerminalCode(e.code)&&(this.auth.authenticator.reset(),this.auth.authenticator.clearLastLoginClient()),this.auth.lifeCycle.processEvent("loginFail",e)},t.changeLoginClient=function(e,t){var r=this,n=du(t).call(t,(function(e){return pf(e)}));if(1===e)this.loginClients=n,this.auth.emit("onLoginClientChanged",e,this.loginClients);else if(2===e){var i=fu(n).call(n,(function(e){var t,n=fu(t=r.loginClients).call(t,(function(t){return t.clientId===e.clientId}));return r.loginClients.push(e),0===n.length}));i.length>0&&this.auth.emit("onLoginClientChanged",e,i)}else if(3===e){var o=fu(n).call(n,(function(e){var t;return function(e,t){t=t||function(){return!0};for(var r=[],n=(e=e||[]).length,i=0,o=0;o<n;o++)t(e[o-i])&&(r.push(di(e).call(e,o-i,1)[0]),i+=1)}(r.loginClients,(function(t){return t.clientId===e.clientId&&t.consid===e.consid})),0===fu(t=r.loginClients).call(t,(function(t){return t.clientId===e.clientId})).length}));o.length>0&&this.auth.emit("onLoginClientChanged",e,o)}},t.checkAutoLogin=function(e){if(e)return!1;var t=Zl.localStorage.getItem(this.lastLoginClientKey);if(!t)return!1;var r="",n="";try{var i=JSON.parse(t);r=Zp(i,"clientId"),n=Zp(i,"account")}catch(e){return!1}return r===this.auth.deviceId&&n===this.auth.account},t.checkLoginTerminalCode=function(e){var t=[Tl.V2NIM_ERROR_CODE_CANCELLED,Tl.V2NIM_ERROR_CODE_TIMEOUT,Tl.V2NIM_ERROR_CODE_HANDSHAKE,302,317,Tl.V2NIM_ERROR_CODE_FORBIDDEN,Tl.V2NIM_ERROR_CODE_NOT_FOUND,Tl.V2NIM_ERROR_CODE_PARAMETER_ERROR,Tl.V2NIM_ERROR_CODE_MULTI_LOGIN_FORBIDDEN,422,Tl.V2NIM_ERROR_CODE_IM_DISABLED,Tl.V2NIM_ERROR_CODE_APPKEY_NOT_EXIST,Tl.V2NIM_ERROR_CODE_BUNDLEID_CHECK_FAILED,Tl.V2NIM_ERROR_CODE_APPKEY_BLOCKED,Tl.V2NIM_ERROR_CODE_INVALID_TOKEN,Tl.V2NIM_ERROR_CODE_ROBOT_NOT_ALLOWED,Tl.V2NIM_ERROR_CODE_ACCOUNT_NOT_EXIST,Tl.V2NIM_ERROR_CODE_ACCOUNT_BANNED,Tl.V2NIM_ERROR_CODE_USER_PROFILE_NOT_EXIST];return ou(t).call(t,e)},t.reset=function(){this.loginClients=[],this.loginClientOfThisConnection={}},t.clearLastLoginClient=function(){Zl.localStorage.removeItem(this.lastLoginClientKey)},e}(),ng=function(){function e(e){this.name="V2NIMLoginLifeCycle",this.loginStatus=0,this.connectStatus=0,this.core=e,this.auth=e.V2NIMLoginService,this.logger=e.logger}var t=e.prototype;return t.processEvent=function(e,t,r){var n=this.getConnectStatus();switch(e){case"addressing":this.logger.log(this.name+"::addressing"),this.setLoginStatus(2),this.setConnectStatus(2);break;case"connect":this.logger.log(this.name+"::connecting"),this.setLoginStatus(2),this.setConnectStatus(2);break;case"connectSucc":this.logger.log(this.name+"::connect success"),this.setLoginStatus(2),this.setConnectStatus(1);break;case"connectFail":this.logger.log(this.name+"::connect fail",t),this.setLoginStatus(3),this.setConnectStatus(0,t);break;case"connectionBroken":this.logger.log(this.name+"::connectionBroken:",t),this.setLoginStatus(3),this.setConnectStatus(0,t),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleDisconnected",t);break;case"loginSucc":this.logger.log(this.name+"::login success, verify authentication success"),this.setLoginStatus(1),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleLoginSucc",r);break;case"loginFail":if(this.logger.log(this.name+"::login fail due to verify authentication failed:",t),!t)return;this.setLoginStatus(this.auth.authenticator.checkLoginTerminalCode(t.code)?0:3),this.setConnectStatus(0,t),this.auth.emit("onLoginFailed",t);break;case"logout":this.logger.log(this.name+"::logout"),this.setLoginStatus(0),this.setConnectStatus(0),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleLogout");break;case"kicked":this.logger.log(this.name+"::kicked",r),this.setLoginStatus(0),this.setConnectStatus(0,t),this.core.eventBus.emit("V2NIMLoginService/loginLifeCycleKicked");break;case"exited":this.logger.log(this.name+"::exited",t),this.setLoginStatus(0),this.setConnectStatus(0,t);break;case"waiting":this.logger.log(this.name+"::waiting to reconnect"),this.setLoginStatus(3),this.setConnectStatus(3),2!==n&&this.auth.reconnect.attempToReLogin()}},t.getConnectStatus=function(){return this.connectStatus},t.getLoginStatus=function(){return this.loginStatus},t.setLoginStatus=function(e){e!==this.loginStatus&&(this.loginStatus=e,this.auth.emit("onLoginStatus",e))},t.setConnectStatus=function(e,t){if(e!==this.connectStatus){var r=this.connectStatus;this.connectStatus=e,this.auth.emit("onConnectStatus",e),this.delegateConnectEvent(r,e,t)}},t.delegateConnectEvent=function(e,t,r){1===e&&0===t&&r&&this.auth.emit("onDisconnected",r),2===e&&0===t&&r&&this.auth.emit("onConnectFailed",r)},e}(),ig=function(){function e(e){this.core=e,this.auth=e.V2NIMLoginService,this.datas=[],this.mainSyncFlag=!1,this.conversationSyncFlag=!1}var t=e.prototype;return t.switchDataSync=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a,s,c;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.type,i=e.state,o=e.error,a=e.subType,1===n&&3===i&&("mainSync"===a?this.mainSyncFlag=!0:"conversationSync"===a&&(this.conversationSyncFlag=!0)),s=fu(r=this.datas).call(r,(function(e){return e.type===n})),(c=s.length>0?s[0]:null)?(c.state=i,c.error=o):this.datas.push({type:n,state:i,error:o}),1===n&&(2===i?this.auth.emit("onDataSync",n,i,o):3===i&&this.mainSyncFlag&&this.conversationSyncFlag&&(this.auth.emit("onDataSync",n,i,o),this.mainSyncFlag=!1,this.conversationSyncFlag=!1));case 6:case"end":return t.stop()}}),t,this)})))},t.reset=function(){this.datas=[],this.mainSyncFlag=!1,this.conversationSyncFlag=!1},e}();function og(e,t){e=e||{};var r={};return jn(t=t||[]).call(t,(function(t){void 0!==e[t]&&(r[t]=e[t])})),r}var ag=["https://lbs.netease.im/lbs/webconf.jsp"],sg={retryCount:3,timeout:6e4,forceMode:!1,authType:0,syncLevel:0},cg=function(e){function t(t,r){var n;void 0===r&&(r={}),(n=e.call(this,"V2NIMLoginService",t)||this).account="",n.previousLoginAccount="",n.token="",n.deviceId="",n.clientSession="",n.processId="",n.kickedDetail=null,n.binaryWebsocket=!0,n.core._registerDep(uf,"misc"),Mh({cmdMap:hf,cmdConfig:vf}),"v2"===t.options.apiVersion&&(Mh({cmdMap:ff,cmdConfig:yf}),n.core.auth=ut(n)),n.previousLoginManager=new Hp,n.doLoginStepsManager=new Hp,n.loginTimerManager=new Hl,n.loginOption=dr({},sg),n.config={lbsUrls:ag,linkUrl:"weblink.netease.im:443"},n.setOptions(r),t.V2NIMLoginService=ut(n);var i,o=n.core.options.binaryWebsocket,a="BROWSER"===Zl.platform&&"function"==typeof TextDecoder&&"function"==typeof TextEncoder&&"function"==typeof Uint8Array;return"boolean"==typeof o&&(a=a&&o),a?(n.binaryWebsocket=!0,i=new zf(n.core)):(n.binaryWebsocket=!1,i=new Zf(n.core)),n.clientSocket=i,"v2"===n.core.options.apiVersion&&(n.core.clientSocket=i),n.lifeCycle=new ng(t),n.reconnect=new eg(t),n.lbs=new tg(t),n.authenticator=new rg(t),n.dataSync=new ig(t),n}nr(t,e);var r=t.prototype;return r.setOptions=function(e){Pl({lbsUrls:{type:"array",itemType:"string",min:1,required:!1},linkUrl:{type:"string",allowEmpty:!1,required:!1}},e,"",!0),this.config=Np(this.config,e);var t="",r="";this.config.isFixedDeviceId?(t=Zl.localStorage.getItem("__NIM_DEVC_ID__")||Ep(),r=Zl.localStorage.getItem("__NIM_CLIENT_SESSION_ID__")||Ep(),Zl.localStorage.setItem("__NIM_DEVC_ID__",t),Zl.localStorage.setItem("__NIM_CLIENT_SESSION_ID__",r)):(t=Ep(),r=Ep()),this.deviceId=t,this.clientSession=r,this.core.reporter.setConfig({common:{dev_id:t}})},r.reset=function(){this.account="",this.token="",this.processId="",this.lbs.reset(),this.reconnect.reset(),this.authenticator.reset(),this.authenticator.clearLastLoginClient(),this.dataSync.reset()},r.login=function(e,t,r){return void 0===r&&(r={}),zl(this,void 0,void 0,Ql.mark((function n(){var i,o,a=this;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this._checkApiVersion(),i=Zl.getSystemInfo()||{},o=i.os?i.os.toLowerCase():"","React Native"!==Zl.platform||"android"!==o||!this.hasSettingService||!this.core.V2NIMSettingService.offlinePushPlugin){n.next=13;break}return n.prev=4,n.next=7,this.core.V2NIMSettingService.getRNDeviceInfo();case 7:this.deviceInfo=n.sent,n.next=13;break;case 10:n.prev=10,n.t0=n.catch(4),this.logger.error(n.t0);case 13:if(e){n.next=15;break}throw new wl({detail:{reason:"Empty account"}});case 15:if(Pl({retryCount:{type:"number",min:0,required:!1},forceMode:{type:"boolean",required:!1},authType:{type:"enum",values:[0,1,2],required:!1},syncLevel:{type:"enum",values:[1,0],required:!1}},r,"",!0),0!==r.authType||t){n.next=18;break}throw new wl({detail:{reason:"When authType is 0, token cannot be empty"}});case 18:if(""!==this.previousLoginAccount&&this.previousLoginAccount!==e&&this.core._clearModuleData(),0!==this.getLoginStatus()){n.next=23;break}this.logger.log("V2NIMLoginService::login:allowLogin:"+e,r),n.next=29;break;case 23:if(1!==this.getLoginStatus()){n.next=27;break}return n.abrupt("return",this.smoothForLogined(e,t,r));case 27:if(2!==this.getLoginStatus()){n.next=29;break}return n.abrupt("return",this.smoothForLogining(e,t,r));case 29:return this.account=e,this.previousLoginAccount=e,this.token=t,this.processId=Ep(),this.loginOption=Np(sg,r),this.kickedDetail=null,this.loginTimerManager.destroy(),this.loginTimerManager.addTimer((function(){var e=new _l({code:Tl.V2NIM_ERROR_CODE_TIMEOUT,detail:{reason:"Login API timeout"}});a.doLoginStepsManager.clear(e),a.previousLoginManager.clear(e),a.originLoginPromise=void 0,a.lifeCycle.processEvent("exited",e)}),this.loginOption.timeout>0?this.loginOption.timeout:6e4,1),n.prev=37,n.next=40,this.multiTryDoLogin();case 40:this.loginTimerManager.destroy(),n.next=47;break;case 43:throw n.prev=43,n.t1=n.catch(37),this.loginTimerManager.destroy(),n.t1;case 47:case"end":return n.stop()}}),n,this,[[4,10],[37,43]])})))},r.getChatroomLinkAddress=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n,i;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Pl({roomId:{type:"string",regExp:/^\d+$/,required:!0,allowEmpty:!1},miniProgram:{type:"boolean",required:!1}},{roomId:e,miniProgram:t},"",!0),n="unknow environment"!==Ap(),t=void 0===t?n:t,r.next=5,this.clientSocket.sendCmd("v2GetChatroomLinkAddress",{roomId:e,miniProgram:t});case 5:return i=r.sent,r.abrupt("return",i.content.linkAddress);case 7:case"end":return r.stop()}}),r,this)})))},r.multiTryDoLogin=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=new _l({code:Tl.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"loginFailed"}}),n=0;case 2:if(!(n<=this.loginOption.retryCount)){t.next=32;break}return i="V2NIMLoginService::times of login try: "+n,n>0?this.logger.warn(i):this.logger.log(i),t.prev=5,this.originLoginPromise=e||this.doLogin(!1),e=void 0,t.next=10,this.previousLoginManager.add(this.originLoginPromise);case 10:return o=t.sent,this.core.reporter.reportTraceEnd("login",!0),this.doLoginStepsManager.clear(),this.previousLoginManager.clear(),this.originLoginPromise=void 0,t.abrupt("return",o);case 18:if(t.prev=18,t.t0=t.catch(5),r=t.t0||r,this.logger.error("V2NIMLoginService::login failed, times of login try: "+n+", err.code: "+(null==r?void 0:r.code)+', err.message: "'+(null==r?void 0:r.message)+'"'),r.code!==Tl.V2NIM_ERROR_CODE_CANCELLED&&this.core.reporter.reportTraceEnd("login",!1),this.reconnect.clearReconnectTimer(),!this.checkLoginTerminalCode(r&&r.code)){t.next=28;break}throw this.lifeCycle.processEvent("exited",r),r;case 28:r&&399===r.code&&this.lbs.reset();case 29:n++,t.next=2;break;case 32:throw this.lifeCycle.processEvent("exited",r),r;case 34:case"end":return t.stop()}}),t,this,[[5,18]])})))},r.doLogin=function(e){var t,r;return zl(this,void 0,void 0,Ql.mark((function n(){var i,o,a;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=!!e||this.authenticator.checkAutoLogin(this.loginOption.forceMode),this.core.reporter.reportTraceCancel("login"),this.core.reporter.reportTraceStart("login",i?{user_id:this.account,action:"auto_login",process_id:this.processId,binary_websocket:this.binaryWebsocket}:{user_id:this.account,action:"manual_login",process_id:this.processId,binary_websocket:this.binaryWebsocket}),this.core.reporter.reportTraceUpdateV2("login",{code:0,description:_i(this.loginOption),operation_type:"conf_init",succeed:!0,duration:0,target:""},{asyncParams:Zl.net.getNetworkStatus()}),n.next=6,this.doLoginStepsManager.add(this.lbs.getLbsInfos());case 6:return o=n.sent,n.next=9,this.doLoginStepsManager.add(this.clientSocket.connect(o,e));case 9:return n.next=11,this.doLoginStepsManager.add(this.authenticator.verifyAuthentication(i));case 11:if(a=n.sent,this.lifeCycle.processEvent("loginSucc",void 0,dr(dr({},a),{isReconnect:e})),this.processId=Ep(),this.clientSocket.resetSocketConfig(),this.reconnect.reset(),this.clientSocket.ping(),this.core.abtest.abtRequest(),"function"==typeof(null===(t=this.core.V2NIMClientAntispamUtil)||void 0===t?void 0:t.downloadLocalAntiSpamVocabs)&&this.core.V2NIMClientAntispamUtil.downloadLocalAntiSpamVocabs(),"function"!=typeof(null===(r=this.core.cloudStorage)||void 0===r?void 0:r.init)){n.next=28;break}return n.prev=20,n.next=23,this.core.cloudStorage.init();case 23:n.next=28;break;case 25:n.prev=25,n.t0=n.catch(20),this.logger.warn("doLogin::cloudStorage init error",n.t0);case 28:return n.abrupt("return",a);case 29:case"end":return n.stop()}}),n,this,[[20,25]])})))},r.smoothForLogined=function(e,t,r){return zl(this,void 0,void 0,Ql.mark((function n(){var i;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=this.checkIsSameLogin(e,t,r),this.logger.warn("V2NIMLoginService::smoothForLogined:Logined, isSameLogin "+i),!i){n.next=6;break}return n.abrupt("return");case 6:return n.next=8,this.logout();case 8:return n.abrupt("return",this.login(e,t,r));case 9:case"end":return n.stop()}}),n,this)})))},r.smoothForLogining=function(e,t,r){return zl(this,void 0,void 0,Ql.mark((function n(){var i;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=this.checkIsSameLogin(e,t,r),this.logger.warn("V2NIMLoginService::smoothForLogining:Logining progress exists, abort the previous login attempt and start next attempt, isSameLogin "+i),this.previousLoginManager.clear(),this.reconnect.reset(),this.account=e,this.previousLoginAccount=e,this.token=t,this.loginOption=Np(this.loginOption,r),!i){n.next=18;break}if(this.originLoginPromise){n.next=11;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"NoPreviousLoginExists"}});case 11:return this.reconnect.reset(),n.next=14,fs.resolve();case 14:return n.next=16,this.multiTryDoLogin(this.originLoginPromise);case 16:n.next=25;break;case 18:return this.doLoginStepsManager.clear(),this.clientSocket.doDisconnect(Hf.ACTIVE,"Aborted"),this.reset(),this.lifeCycle.processEvent("logout"),n.next=24,fs.resolve();case 24:return n.abrupt("return",this.login(e,t,r));case 25:case"end":return n.stop()}}),n,this)})))},r.checkIsSameLogin=function(e,t,r){return this.account===e&&this.loginOption.authType===r.authType&&(0!==r.authType||this.token===t)},r.logout=function(){return zl(this,void 0,void 0,Ql.mark((function e(){var t,r;return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._checkApiVersion(),this.doLoginStepsManager.clear(),this.previousLoginManager.clear(),this.loginTimerManager.destroy(),this.originLoginPromise=void 0,t=this.getConnectStatus(),r=this.getLoginStatus(),e.t0=r,e.next=1===e.t0?10:2===e.t0?25:3===e.t0?29:0===e.t0?33:35;break;case 10:return e.prev=10,e.next=13,this.clientSocket.sendCmd("v2Logout",void 0,{timeout:1e3});case 13:this.clientSocket.doDisconnect(Hf.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),this.lifeCycle.processEvent("logout"),e.next=24;break;case 18:e.prev=18,e.t1=e.catch(10),this.logger.error("Instance::disconnect sendCmd:logout error",e.t1),this.clientSocket.doDisconnect(Hf.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),this.lifeCycle.processEvent("logout");case 24:return e.abrupt("break",37);case 25:case 29:return this.clientSocket.doDisconnect(Hf.ACTIVE,"UserActiveDisconnect"),this.core._clearModuleData(),this.lifeCycle.processEvent("logout"),e.abrupt("break",37);case 33:throw this.core._clearModuleData(),new _l({code:Tl.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:"Illegal logout. loginStatus "+r+". connectStatus "+t}});case 35:throw this.core._clearModuleData(),new _l({code:Tl.V2NIM_ERROR_CODE_ILLEGAL_STATE,detail:{reason:"Illegal logout. illegal status: loginStatus "+r+". connectStatus "+t}});case 37:case"end":return e.stop()}}),e,this,[[10,18]])})))},r.getConnectStatus=function(){return this.lifeCycle.getConnectStatus()},r.getLoginStatus=function(){return this.lifeCycle.getLoginStatus()},r.getLoginUser=function(){return this.account},r.getLoginClients=function(){var e;return du(e=function(e,t){e=e||[],t=t||"";for(var r=[],n=[],i=0;i<e.length;i++){var o=e[i][t];-1===wu(n).call(n,o)&&(n.push(o),r.push(e[i]))}return r}(this.authenticator.loginClients,"clientId")).call(e,(function(e){return og(e,["type","os","timestamp","customTag","customClientType","clientId","clientIP"])}))},r.getCurrentLoginClient=function(){var e;if(null===(e=this.authenticator.loginClientOfThisConnection)||void 0===e?void 0:e.clientId)return og(this.authenticator.loginClientOfThisConnection,["type","os","timestamp","customTag","customClientType","clientId","clientIP"])},r.getDataSync=function(){var e=this.dataSync.datas;return e&&e.length>0?du(e).call(e,(function(e){return{type:e.type,state:e.state}})):null},r.setReconnectDelayProvider=function(e){this.reconnect._setReconnectDelayProvider(e)},r.kickOffline=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._checkApiVersion(),Pl({clientId:{type:"string",allowEmpty:!1}},e,"",!0),t.next=4,this.clientSocket.sendCmd("v2KickOffline",{clientIds:[e.clientId]});case 4:if(0!==Zp(t.sent,"content.clientIds.length")){t.next=8;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_REQUEST_FAILED});case 8:case"end":return t.stop()}}),t,this)})))},r.getKickedOfflineDetail=function(){return this.kickedDetail},r.checkLoginTerminalCode=function(e){return this.authenticator.checkLoginTerminalCode(e)},r.checkIllegalState=function(){if(!this.getLoginUser())throw new _l({code:Tl.V2NIM_ERROR_CODE_ILLEGAL_STATE})},r._checkApiVersion=function(){if("v2"!==this.core.options.apiVersion)throw new _l({code:Tl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:'apiVersion is not "v2"'}})},r.v2LoginHandler=function(e){if(e.error)throw this.clientSocket.doDisconnect(Hf.ACTIVE,e.error),e.error;return e},r.v2LoginClientChangeHandler=function(e){this.authenticator.changeLoginClient($p(e.content.state),e.content.datas)},r.nimLoginClientChangeHandler=function(e){this.authenticator.changeLoginClient($p(e.content.state),e.content.datas)},r.qchatLoginClientChangeHandler=function(e){var t=$p(e.content.state);t=1===t?2:3,this.authenticator.changeLoginClient(t,[e.content.data])},r.v2BeKickedHandler=function(e){if(e.error)this.core.logger.error("v2BeKickedHandler error, ",e.error);else{var t=function(e){return Ph({reason:{type:"number"},clientType:{type:"number"},customClientType:{type:"number"}},e)}(e.content);this.core.logger.warn("v2Bekicked::",t),this.kickedDetail=t,this.clientSocket.doDisconnect(Hf.KICKED,t),this.core._clearModuleData(),this.lifeCycle.processEvent("kicked",new _l({code:Tl.V2NIM_ERROR_CODE_DISCONNECT,detail:{reason:"disconnect due to kicked"}}),t),this.emit("onKickedOffline",t)}},r.emit=function(t){for(var r,n,i=this.name+"::emit "+t.toString(),o=arguments.length,a=new Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];if("onLoginFailed"===t||"onDisconnected"===t||"onConnectFailed"===t){var c=a[0];this.logger.log(""+i,c.toString())}else if("onDataSync"===t){var u=a[2];this.logger.log(""+i,a[0],a[1],u&&u.toString())}else{var d,l;(d=this.logger).log.apply(d,xs(l=[""+i]).call(l,a))}return(r=e.prototype.emit).call.apply(r,xs(n=[this,t]).call(n,a))},ct(t,[{key:"hasSettingService",get:function(){var e;return!!(null===(e=this.core.V2NIMSettingService)||void 0===e?void 0:e.name)}}]),t}(rf),ug=Is.entries;nt({target:"Object",stat:!0},{entries:function(e){return ug(e)}});var dg=B.Object.entries,lg=function(){function e(){this.map=new ad,this.readTimeMap=new ad}var t=e.prototype;return t.set=function(e){var t=this;jn(e).call(e,(function(e){e=t.processConversation(e),du(t).set(e.conversationId,e)}))},t.reset=function(){du(this).clear()},t.count=function(){return du(this).size},t.sort=function(){var e,t=this,r=Bl(Iu(e=du(this)).call(e));Vm(r).call(r,(function(e,t){return t.sortOrder-e.sortOrder})),du(this).clear(),jn(r).call(r,(function(e){du(t).set(e.conversationId,e)}))},t.processConversation=function(e){return"string"==typeof e.lastMessage&&delete e.lastMessage,void 0===e.localExtension&&(e.localExtension=""),e},t.getById=function(e){return du(this).get(e)},t.getAll=function(){var e,t=Bl(Iu(e=du(this)).call(e));return Vm(t).call(t,(function(e,t){return t.sortOrder-e.sortOrder}))},t.getByOption=function(e,t,r){var n,i=r.conversationTypes,o=r.onlyUnread,a=r.conversationGroupIds,s=[];jn(n=du(this)).call(n,(function(e){if((!(i&&i.length>0)||ou(i).call(i,e.type))&&(!o||e.unreadCount)&&(!r.ignoreMuted||!e.mute)){if(a){var t=e.groupIds,n=(null==t?void 0:t.length)||0;if(0===a.length&&n>0)return;if(a.length>0&&0===n)return;if(a.length>0&&n>0&&!Gm(a).call(a,(function(e){return t&&ou(t).call(t,e)})))return}s.push(e)}})),s=Vm(s).call(s,(function(e,t){return t.sortOrder-e.sortOrder}));var c=0;e>0&&(c=Lp(s,"sortOrder",e),s[c]&&s[c].sortOrder===e&&(c+=1));var u=Wc(s).call(s,c).length;return(s=Wc(s).call(s,c,c+t)).length>0?{offset:u>t?s[s.length-1].sortOrder:0,finished:!(u>t),conversationList:s}:{offset:0,finished:!0,conversationList:s}},t.upsert=function(e){var t=e.conversationId,r=du(this).get(t);if(!r)return e=this.processConversation(dr({},e)),du(this).set(t,e),e.unreadCount>0;var n=e.unreadCount!==r.unreadCount,i=dr({},r,e);return i=this.processConversation(i),du(this).set(t,i),n},t.bulkUpsert=function(e){var t=this,r=!1;return jn(e).call(e,(function(e){t.upsert(e)&&(r=!0)})),r},t.deleteById=function(e){var t=this.getById(e);if(t)return du(this).delete(e),t},t.updateReadTime=function(e,t){this.readTimeMap.set(e,t)},t.getReadTime=function(e){return this.readTimeMap.get(e)||0},e}(),pg=M("".startsWith),mg=M("".slice),hg=Math.min,fg=eu("startsWith");nt({target:"String",proto:!0,forced:!fg},{startsWith:function(e){var t=Xi(V(this));$c(e);var r=yt(hg(arguments.length>1?arguments[1]:void 0,t.length)),n=Xi(e);return pg?pg(t,n,r):mg(t,r,r+n.length)===n}});var gg=$t("String").startsWith,vg=String.prototype,yg=function(e){var t=e.startsWith;return"string"==typeof e||e===vg||j(vg,e)&&t===vg.startsWith?gg:t},Mg=function(){function e(e){this.name="V2NIMConversationIdUtil",this.core=e}var t=e.prototype;return t.p2pConversationId=function(e){return this.core.account+"|1|"+e},t.teamConversationId=function(e){return this.core.account+"|2|"+e},t.superTeamConversationId=function(e){return this.core.account+"|3|"+e},t.messageConversationId=function(e){return 1===e.conversationType?e.senderId===this.core.account?this.p2pConversationId(e.receiverId):this.p2pConversationId(e.senderId):2===e.conversationType?this.teamConversationId(e.receiverId):this.superTeamConversationId(e.receiverId)},t.parseConversationType=function(e){try{if(e&&yg(e).call(e,this.core.account+"|")){var t=e.replace(this.core.account+"|","");return Number(t[0])}return this.core.logger.warn("conversationId is not start with "+this.core.account),0}catch(e){return 0}},t.parseConversationTargetId=function(e){try{if(e&&yg(e).call(e,this.core.account+"|")){var t=e.replace(this.core.account+"|","");return Wc(t).call(t,2)}return this.core.logger.warn("conversationId is not start with "+this.core.account),""}catch(e){return""}},t.convertToV1ConversationId=function(e){var t=this.parseConversationType(e);return(1===t?"p2p":2===t?"team":"superTeam")+"|"+this.parseConversationTargetId(e)},e}();function Ig(e,t){var r=typeof e;if(r!==typeof t)return!1;if("object"===r){if(Object.prototype.toString.call(e)!==Object.prototype.toString.call(t))return!1;if(Ei(e)){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!Ig(e[n],t[n]))return!1;return!0}if(e instanceof RegExp&&t instanceof RegExp)return e.toString()===t.toString();if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(null===e&&null===t)return!0;if(fr(e).length!==fr(t).length)return!1;for(var i in e)if(!Ig(e[i],t[i]))return!1;return!0}return e===t}var Sg={"31_1":"v2TeamCreate","32_1":"v2SuperTeamCreate","31_5":"v2TeamInviteMembers","32_5":"v2SuperTeamInviteMembers","31_6":"v2TeamKickMembers","32_6":"v2SuperTeamKickMembers","31_8":"v2TeamLeave","32_7":"v2SuperTeamLeave","31_7":"v2TeamUpdateInfo","32_8":"v2SuperTeamUpdateInfo","31_9":"v2TeamGetInfo","32_9":"v2SuperTeamGetInfo","31_12":"v2TeamDismiss","32_4":"v2SuperTeamDismiss","31_13":"v2TeamApplyToJoin","32_20":"v2SuperTeamApplyToJoin","31_14":"v2TeamAcceptJoinApplication","32_21":"v2SuperTeamAcceptJoinApplication","31_15":"v2TeamRejectJoinApplication","32_22":"v2SuperTeamRejectJoinApplication","31_16":"v2TeamAddManagers","32_26":"v2SuperTeamAddManagers","31_17":"v2TeamRemoveManagers","32_27":"v2SuperTeamRemoveManagers","31_18":"v2TeamTransferOwner","32_31":"v2SuperTeamTransferOwner","31_19":"v2TeamUpdateSelfMemberInfo","32_10":"v2SuperTeamUpdateSelfMemberInfo","31_20":"v2TeamUpdateMember","32_30":"v2SuperTeamUpdateMember","31_21":"v2TeamAcceptInvitation","32_23":"v2SuperTeamAcceptInvitation","31_22":"v2TeamRejectInvite","32_24":"v2SuperTeamRejectInvite","31_33":"v2TeamGetMemberInvitor","32_35":"v2SuperTeamGetMemberInvitor","31_25":"v2TeamMemberSetChatBannedStatus","32_29":"v2SuperTeamMemberSetChatBannedStatus","31_32":"v2TeamSetChatBannedMode","32_28":"v2SuperTeamSetChatBannedMode","31_34":"v2TeamGetByIds","32_36":"v2SuperTeamGetByIds","31_35":"v2TeamMemberGetListByIds","32_37":"v2SuperTeamMemberGetListByIds","31_36":"v2TeamMemberGetList","8_101":"v2TeamCreateMultiSync","8_109":"v2TeamSync","8_119":"v2TeamMemberUpdateMultiSync","8_126":"v2TeamMembersOfSelfInSync","21_101":"v2SuperTeamCreateMultiSync","21_109":"v2SuperTeamSync","21_110":"v2SuperTeamMemberUpdateMultiSync","21_111":"v2SuperTeamMembersOfSelfInSync"},Tg={antispamBusinessId:1},bg="V2NIMTeamService",Cg={teamId:1,name:3,teamType:{id:4,retConverter:function(e){return 0==+e?1:+e}},ownerAccountId:5,memberLimit:{id:6,retType:"number"},isValidTeam:{id:8,retConverter:function(e,t){return 1==+e&&(void 0===t[13]||1==+t[13])}},memberCount:{id:9,retType:"number"},memberUpdateTime:{id:10,retType:"number"},createTime:{id:11,retType:"number"},updateTime:{id:12,retType:"number"},intro:14,announcement:15,joinMode:{id:16,retType:"number"},serverExtension:18,customerExtension:19,avatar:20,agreeMode:{id:21,retType:"number"},inviteMode:{id:22,retType:"number"},updateInfoMode:{id:23,retType:"number"},updateExtensionMode:{id:24,retType:"number"},chatBannedMode:{id:101,retType:"number"}},_g={teamId:1,accountId:3,memberRole:{id:4,retType:"number"},teamNick:5,bits:{id:7,retType:"number"},inTeam:{id:9,retType:"boolean"},joinTime:{id:10,retType:"number"},updateTime:{id:11,retType:"number"},serverExtension:12,chatBanned:{id:13,retType:"boolean"},invitorAccountId:14,followAccountIds:{id:16,retConverter:function(e){try{return JSON.parse(e)}catch(e){return[]}}}},Eg={teamId:1,accountId:3,memberRole:{id:4,retType:"number"},teamNick:5,bits:{id:7,retType:"number"},inTeam:{id:9,retType:"boolean"},updateTime:{id:11,retType:"number"},serverExtension:12,chatBanned:{id:13,retType:"boolean"},invitorAccountId:14,joinTime:{id:15,retType:"number"},followAccountIds:{id:17,retConverter:function(e){try{return JSON.parse(e)}catch(e){return[]}}}},wg={accountIds:{id:1,converter:function(e){return _i(e)}},operation:2},Rg={v2TeamCreate:{sid:31,cid:1,service:bg,params:[{type:"Property",name:"team",reflectMapper:Cg},{type:"StrArray",name:"inviteeAccountIds"},{type:"String",name:"postscript"},{type:"Property",name:"antispamConfig",reflectMapper:Tg}],response:[{type:"Property",name:"team",reflectMapper:Sh(Cg)},{type:"StrArray",name:"failedList"}]},v2SuperTeamCreate:{sid:32,cid:1,service:bg,params:[{type:"Property",name:"team",reflectMapper:Cg},{type:"StrArray",name:"inviteeAccountIds"},{type:"String",name:"postscript"},{type:"Property",name:"antispamConfig",reflectMapper:Tg}],response:[{type:"Property",name:"team",reflectMapper:Sh(Cg)},{type:"StrArray",name:"failedList"}]},v2TeamInviteMembers:{sid:31,cid:5,service:bg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}],response:[{type:"Long",name:"time"},{type:"StrArray",name:"abortedAccidList"}]},v2SuperTeamInviteMembers:{sid:32,cid:5,service:bg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}],response:[{type:"StrArray",name:"abortedAccidList"},{type:"Long",name:"time"}]},v2TeamUpdateInfo:{sid:31,cid:7,service:bg,params:[{type:"Property",name:"team",reflectMapper:Cg},{type:"Property",name:"antispamConfig",reflectMapper:Tg}],response:[{type:"Long",name:"teamId"},{type:"Long",name:"timestamp"}]},v2SuperTeamUpdateInfo:{sid:32,cid:8,service:bg,params:[{type:"Property",name:"team",reflectMapper:Cg},{type:"Property",name:"antispamConfig",reflectMapper:Tg}],response:[{type:"Long",name:"timestamp"}]},v2TeamLeave:{sid:31,cid:8,service:bg,params:[{type:"Long",name:"teamId"}]},v2SuperTeamLeave:{sid:32,cid:7,service:bg,params:[{type:"Long",name:"teamId"}]},v2TeamGetInfo:{sid:31,cid:9,service:bg,params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"team",reflectMapper:Sh(Cg)}]},v2SuperTeamGetInfo:{sid:32,cid:9,service:bg,params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"team",reflectMapper:Sh(Cg)}]},v2TeamGetByIds:{sid:31,cid:34,service:bg,params:[{type:"LongArray",name:"teamIds"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:Sh(Cg)},{type:"LongArray",name:"tids"}]},v2SuperTeamGetByIds:{sid:32,cid:36,service:bg,params:[{type:"LongArray",name:"teamIds"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:Sh(Cg)},{type:"LongArray",name:"tids"}]},v2TeamDismiss:{sid:31,cid:12,service:bg,params:[{type:"Long",name:"teamId"}]},v2SuperTeamDismiss:{sid:32,cid:4,service:bg,params:[{type:"Long",name:"teamId"}]},v2TeamAcceptInvitation:{sid:31,cid:21,service:bg,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}],response:[{type:"Property",name:"team",reflectMapper:Sh(Cg)}]},v2SuperTeamAcceptInvitation:{sid:32,cid:23,service:bg,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}],response:[{type:"Property",name:"team",reflectMapper:Sh(Cg)}]},v2TeamRejectInvite:{sid:31,cid:22,service:bg,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},v2SuperTeamRejectInvite:{sid:32,cid:24,service:bg,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},v2TeamKickMembers:{sid:31,cid:6,service:bg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2SuperTeamKickMembers:{sid:32,cid:6,service:bg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2TeamApplyToJoin:{sid:31,cid:13,service:bg,params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:Sh(Cg)},{type:"Int",name:"isInTeam"}]},v2SuperTeamApplyToJoin:{sid:32,cid:20,service:bg,params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:Sh(Cg)},{type:"Int",name:"isInTeam"}]},v2TeamAcceptJoinApplication:{sid:31,cid:14,service:bg,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},v2SuperTeamAcceptJoinApplication:{sid:32,cid:21,service:bg,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},v2TeamRejectJoinApplication:{sid:31,cid:15,service:bg,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},v2SuperTeamRejectJoinApplication:{sid:32,cid:22,service:bg,params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},v2TeamAddManagers:{sid:31,cid:16,service:bg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2SuperTeamAddManagers:{sid:32,cid:26,service:bg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2TeamRemoveManagers:{sid:31,cid:17,service:bg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2SuperTeamRemoveManagers:{sid:32,cid:27,service:bg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},v2TeamTransferOwner:{sid:31,cid:18,service:bg,params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Bool",name:"leave"}]},v2SuperTeamTransferOwner:{sid:32,cid:31,service:bg,params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Bool",name:"leave"}]},v2TeamUpdateSelfMemberInfo:{sid:31,cid:19,service:bg,params:[{type:"Property",name:"teamMember",reflectMapper:_g},{type:"Property",name:"specialFollowUpdate",reflectMapper:wg}],response:[{type:"Property",name:"data",reflectMapper:Sh(_g)}]},v2SuperTeamUpdateSelfMemberInfo:{sid:32,cid:10,service:bg,params:[{type:"Property",name:"teamMember",reflectMapper:Eg},{type:"Property",name:"specialFollowUpdate",reflectMapper:wg}],response:[{type:"Property",name:"data",reflectMapper:Sh(Eg)}]},v2TeamUpdateMember:{sid:31,cid:20,service:bg,params:[{type:"Property",name:"teamMember",reflectMapper:_g}]},v2SuperTeamUpdateMember:{sid:32,cid:30,service:bg,params:[{type:"Property",name:"teamMember",reflectMapper:Eg}]},v2TeamGetMemberInvitor:{sid:31,cid:33,service:bg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}],response:[{type:"StrStrMap",name:"accountsMap"}]},v2SuperTeamGetMemberInvitor:{sid:32,cid:35,service:bg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}],response:[{type:"StrStrMap",name:"accountsMap"}]},v2TeamMemberSetChatBannedStatus:{sid:31,cid:25,service:bg,params:[{type:"Long",name:"teamId"},{type:"String",name:"accountId"},{type:"Int",name:"chatBanned"}]},v2SuperTeamMemberSetChatBannedStatus:{sid:32,cid:29,service:bg,params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accountId"},{type:"Int",name:"chatBanned"}]},v2TeamSetChatBannedMode:{sid:31,cid:32,service:bg,params:[{type:"Long",name:"teamId"},{type:"Int",name:"chatBannedMode"}]},v2SuperTeamSetChatBannedMode:{sid:32,cid:28,service:bg,params:[{type:"Long",name:"teamId"},{type:"Int",name:"chatBannedMode"}]},v2TeamMemberGetListByIds:{sid:31,cid:35,service:bg,params:[{type:"StrArray",name:"tag"}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Sh(_g)}]},v2SuperTeamMemberGetListByIds:{sid:32,cid:37,service:bg,params:[{type:"StrArray",name:"tag"}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Sh(Eg)}]},v2TeamMemberGetList:{sid:31,cid:36,service:bg,params:[{type:"Property",name:"tag",reflectMapper:{teamId:1,teamType:2,roleQueryType:3,onlyChatBanned:{id:4,converter:function(e){return+e}},nextToken:5,limit:6,direction:7}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Sh(_g)},{type:"Property",name:"pageInfo",reflectMapper:{1:"hasMore",2:"nextToken"}}]},v2TeamSync:{sid:8,cid:109,service:bg,response:[{type:"Long",name:"timetag"},{type:"PropertyArray",name:"datas",reflectMapper:Sh(Cg)}]},v2TeamCreateMultiSync:{sid:8,cid:101,service:bg,response:[{type:"Property",name:"data",reflectMapper:Sh(Cg)}]},v2TeamMemberUpdateMultiSync:{sid:8,cid:119,service:bg,response:[{type:"Property",name:"data",reflectMapper:Sh(_g)}]},v2TeamMembersOfSelfInSync:{sid:8,cid:126,service:bg,response:[{type:"PropertyArray",name:"datas",reflectMapper:Sh(_g)},{type:"Long",name:"timetag"}]},v2SuperTeamSync:{sid:21,cid:109,service:bg,response:[{type:"PropertyArray",name:"datas",reflectMapper:Sh(Cg)},{type:"Bool",name:"isAll"},{type:"Long",name:"timetag"}]},v2SuperTeamCreateMultiSync:{sid:21,cid:101,service:bg,response:[{type:"Property",name:"data",reflectMapper:Sh(Cg)}]},v2SuperTeamMemberUpdateMultiSync:{sid:21,cid:110,service:bg,response:[{type:"Property",name:"data",reflectMapper:Sh(Eg)}]},v2SuperTeamMembersOfSelfInSync:{sid:21,cid:111,service:bg,response:[{type:"PropertyArray",name:"datas",reflectMapper:Sh(Eg)},{type:"Long",name:"timetag"}]}};function kg(e,t){if(!e)return{};var r=e;return r.tinfo&&(r.tinfo=function(e){return yh(e,Sh(Cg))}(r.tinfo),r.tinfo.teamType=t),r.uinfos,void 0!==r.mute&&(r.mute=$p(r.mute)),r}function Ag(e,t,r){return void 0===r&&(r={}),dr({teamId:e,teamType:t,name:"",ownerAccountId:"",memberLimit:0,memberCount:0,createTime:0,updateTime:0,intro:"",announcement:"",avatar:"",joinMode:0,agreeMode:0,inviteMode:0,updateInfoMode:0,updateExtensionMode:0,chatBannedMode:0,isValidTeam:!0},r)}function Ng(e,t,r,n){return void 0===n&&(n={}),dr({teamId:e,teamType:t,accountId:r,joinTime:0,inTeam:!0,memberRole:0,chatBanned:!1},n)}function xg(e,t){return void 0===t&&(t=1),du(e).call(e,(function(e){return function(e,t){return void 0===t&&(t=1),e.teamType=t,e.chatBanned=void 0!==e.chatBanned&&e.chatBanned,e}(e,t)}))}function Og(e,t){var r,n=dr(dr({},t),{conversationId:e.V2NIMConversationIdUtil.messageConversationId(t),isSelf:t.senderId===e.account,sendingState:1,messageStatus:{errorCode:(null===(r=null==t?void 0:t.messageStatus)||void 0===r?void 0:r.errorCode)||200}});return n.threadReply&&(n.threadReply=dr(dr({},n.threadReply),{conversationType:n.conversationType,conversationId:n.conversationId})),n.threadRoot&&(n.threadRoot=dr(dr({},n.threadRoot),{conversationType:n.conversationType,conversationId:n.conversationId})),n}function Pg(e,t){return dr(dr({},t),{conversationId:e.V2NIMConversationIdUtil.messageConversationId(t)})}function Lg(e,t){var r=t.createTime,n=t.senderId,i=t.receiverId,o=t.conversationType;return{conversationType:o,conversationId:e.V2NIMConversationIdUtil.messageConversationId({conversationType:o,senderId:n,receiverId:i}),senderId:t.senderId,receiverId:t.receiverId,messageServerId:t.messageServerId,createTime:r,messageClientId:t.messageClientId}}function Vg(e,t){var r={7:1,8:2,12:3,13:1,14:2}[t.sysMsgType];return{postscript:t.postscript,revokeType:{7:1,8:2,12:3,13:4,14:5}[t.sysMsgType]||0,revokeAccountId:t.opeAccount||t.senderId,callbackExtension:t.callbackExtension,serverExtension:t.attach||"",messageRefer:{conversationType:r,conversationId:e.V2NIMConversationIdUtil.messageConversationId(dr(dr({},t),{conversationType:r,senderId:t.senderId,receiverId:t.receiverId})),senderId:t.senderId,receiverId:t.receiverId,messageServerId:t.messageServerId,createTime:t.deleteMsgCreatetime,messageClientId:t.messageClientId}}}function Ug(e,t){return{conversationId:1===t.conversationType?e.V2NIMConversationIdUtil.p2pConversationId(t.receiverId):2===t.conversationType?e.V2NIMConversationIdUtil.teamConversationId(t.teamId):e.V2NIMConversationIdUtil.superTeamConversationId(t.teamId),deleteTime:t.deleteTime,serverExtension:t.serverExtension}}function Dg(e,t){var r={0:0,401:401,1:1,402:402,2:2,403:403,3:3,404:404,4:4,405:405,5:5,410:410,6:6,406:406,7:7,407:407,8:8,408:408,9:9,411:411,10:10,409:409};return void 0===r[t]&&e.logger.warn("[V2NIMMessageService] undefined notification type: "+t),"number"==typeof r[t]?r[t]:-1}function qg(e,t){return 5===e.messageType?function(e,t){var r,n,i,o,a,s=t.attachment||{};if(t.attachment&&"type"in t.attachment)return t;var c=void 0;if(null===(r=s.data)||void 0===r?void 0:r.tinfo){var u=s.id,d=s.data,l=u>400?2:1,p=kg(dr({},d),l).tinfo;c={},p.teamId,c=Jl(p,["teamId"])}var m=dr(dr(dr(dr({raw:s.raw,type:Dg(e,s.id)},c?{updatedTeamInfo:c}:{}),{targetIds:(null===(n=s.data)||void 0===n?void 0:n.ids)||((null===(i=s.data)||void 0===i?void 0:i.id)?[s.data.id]:[])}),"string"==typeof(null===(o=s.data)||void 0===o?void 0:o.attach)?{serverExtension:s.data.attach}:{}),"number"==typeof(null===(a=s.data)||void 0===a?void 0:a.mute)?{chatBanned:0!==s.data.mute}:{});return dr(dr({},t),{attachment:m})}(t,e):100===e.messageType?function(e,t){var r,n,i;if("string"==typeof(null===(r=t.attachment)||void 0===r?void 0:r.raw)&&(null===(i=null===(n=e.V2NIMMessageService)||void 0===n?void 0:n.customAttachmentParsers)||void 0===i?void 0:i.length)>0){var o=t.subType||0,a=e.V2NIMMessageService.customAttachmentParsers,s=t.attachment.raw;Gm(a).call(a,(function(r){try{var n=r(o,s);if(Xl(n))return n.raw=s,t.attachment=n,!0}catch(t){return e.logger.warn("customAttachmentParser: subType "+o+", raw: "+s+". parse error with "+t),!1}return!1}))}return t}(t,e):e}function Bg(e,t){if(!t)return"";switch(e){case 100:return t.raw||"";case 1:case 3:case 2:case 6:return function(e){var t=e,r=t.width,n=t.height,i=t.duration;t.path,t.file,t.raw,t.ctx,t.payload,t.bucketName,t.objectName,t.token;var o=t.ext,a=Jl(t,["width","height","duration","path","file","raw","ctx","payload","bucketName","objectName","token","ext"]),s="string"==typeof o&&"."===o[0]?Wc(o).call(o,1):o;return _i(dr(dr(dr(dr(dr({},a),void 0===o?{}:{ext:s}),void 0===r?{}:{w:r}),void 0===n?{}:{h:n}),void 0===i?{}:{dur:i}))}(t);case 4:return function(e){return _i({lat:e.latitude,lng:e.longitude,title:e.address})}(t);case 12:return function(e){e.raw;var t=Jl(e,["raw"]);try{var r;return _i(dr(dr({},t),{durations:du(r=e.durations).call(r,(function(e){return{accid:e.accountId,duration:e.duration}}))}))}catch(t){return _i(e)}}(t);default:return t.raw||_i(t)}}function Fg(e,t){var r;try{switch(r=JSON.parse(e),t){case 100:return{raw:e};case 4:return function(e,t){return{latitude:t.lat,longitude:t.lng,address:t.title,raw:e}}(e,r);case 2:case 3:case 1:case 6:return function(e,t){var r=t.w,n=t.h,i=t.dur,o=t.ext,a=Jl(t,["w","h","dur","ext"]),s="string"==typeof o&&"."!==o[0]?"."+o:o;return dr(dr(dr(dr(dr(dr({},a),void 0===o?{}:{ext:s}),void 0===r?{}:{width:r}),void 0===n?{}:{height:n}),void 0===i?{}:{duration:i}),{raw:e})}(e,r);case 12:return function(e,t){var r;return dr(dr({},t),{durations:du(r=t.durations).call(r,(function(e){return{accountId:e.accid,duration:e.duration}})),raw:e})}(e,r);default:return"object"==typeof r&&r?dr(dr({},r),{raw:e}):{raw:e}}}catch(t){return"object"==typeof r&&r?dr(dr({},r),{raw:e}):{raw:e}}}var Gg="V2NIMMessageService",jg={"30_1":"v2SendP2pMessage","31_2":"v2SendTeamMessage","30_31":"v2MessageP2pModify","31_37":"v2MessageTeamModify","32_38":"v2MessageSuperTeamModify","7_33":"v2MessageOnModified","4_27":"v2MessageSyncModified","4_28":"v2MessageSuperTeamSyncModified","4_5":"v2BatchMarkRead","4_12":"syncP2PMessagReceipts","30_11":"v2SendP2PMessageReceipt","31_28":"v2SendTeamMessageReceipts","32_2":"v2SendSuperTeamMessage","7_12":"onP2PMessageReceipts","8_31":"onTeamMessageReceipts","31_29":"v2GetTeamMessageReceipts","31_30":"v2GetTeamMessageReceiptDetail","7_2":"onMsg","8_3":"onMsg","7_101":"onMsg","8_102":"onMsg","21_3":"onMsg","21_102":"onMsg","4_4":"syncOfflineMsgs","4_9":"syncRoamingMsgs","4_17":"syncRoamingMsgs","30_13":"v2RevokeMessage","32_17":"v2RevokeSuperTeamMessage","7_14":"onRevokeMessage","7_15":"syncRevokeMessage","21_18":"onRevokeMessage","21_117":"onRevokeMessage","30_23":"v2DeleteMessage","30_24":"v2DeleteMessages","4_21":"syncOnDeleteMessages","7_123":"onDeleteMessage","7_124":"onDeleteMessages","29_17":"v2DownloadLocalAntiSpamVocabs"},Hg={conversationType:{id:0,converter:Xg,retConverter:$g},receiverId:1,senderId:2,fromClientType:4,fromDeviceId:5,fromNick:6,createTime:{id:7,retType:"number"},messageType:{id:8,retType:"number"},text:9,attachment:{id:10,converter:function(e,t){return Bg(t.messageType,e)},retConverter:function(e,t){return Fg(e,Number(t[8]))}},messageClientId:11,messageServerId:12,resend:{id:13,converter:Th,retType:"boolean"},userUpdateTime:{id:14,retType:"number"},serverExtension:15,pushPayload:{id:16,access:"pushConfig.pushPayload"},pushContent:{id:17,access:"pushConfig.pushContent"},forcePushAccountIds:{id:18,access:"pushConfig.forcePushAccountIds",def:function(e){if(e["pushConfig.forcePush"])return"#%@all@%#"},converter:function(e,t){if(t["pushConfig.forcePush"]){if(0===e.length)return"#%@all@%#";try{return _i(e)}catch(e){return"#%@all@%#"}}},retConverter:function(e){if("#%@all@%#"===e)return e;if(e)try{return JSON.parse(e)}catch(e){return[]}}},forcePushContent:{id:19,access:"pushConfig.forcePushContent"},forcePush:{id:20,access:"pushConfig.forcePush",converter:Th,retType:"boolean"},antispamCustomMessageEnabled:{id:21,def:function(e){return Zp(e,"antispamConfig.antispamCustomMessage")?1:void 0},retConverter:function(){}},antispamCustomMessage:{id:22,access:"antispamConfig.antispamCustomMessage"},antispamBusinessId:{id:23,access:"antispamConfig.antispamBusinessId"},clientAntispamHit:{id:24,access:"clientAntispamHit",converter:Th,retType:"boolean"},antispamEnabled:{id:25,access:"antispamConfig.antispamEnabled",converter:Th,retType:"boolean"},needAck:{id:26,access:"messageConfig.readReceiptEnabled",converter:Th,retType:"boolean"},lastMessageUpdateEnabled:{id:28,access:"messageConfig.lastMessageUpdateEnabled",converter:Th,retType:"boolean"},threadReplySenderId:{id:29,access:"threadReply.senderId"},threadReplyReceiverId:{id:30,access:"threadReply.receiverId"},threadReplyTime:{id:31,access:"threadReply.createTime",retType:"number"},threadReplyServerId:{id:32,access:"threadReply.messageServerId"},threadReplyClientId:{id:33,access:"threadReply.messageClientId"},threadRootSenderId:{id:34,access:"threadRoot.senderId"},threadRootReceiverId:{id:35,access:"threadRoot.receiverId"},threadRootTime:{id:36,access:"threadRoot.createTime",retType:"number"},threadRootServerId:{id:37,access:"threadRoot.messageServerId"},threadRootClientId:{id:38,access:"threadRoot.messageClientId"},callbackExtension:40,subType:{id:41,retType:"number"},antispamCheating:{id:42,access:"antispamConfig.antispamCheating"},routeEnvironment:{id:43,access:"routeConfig.routeEnvironment"},antispamExtension:{id:44,access:"antispamConfig.antispamExtension"},antispamResult:45,__clientExt:{id:46,converter:bh,retConverter:Ch},robotFunction:{id:47,access:"robotConfig.function"},robotTopic:{id:48,access:"robotConfig.topic"},robotCustomContent:{id:49,access:"robotConfig.customContent"},robotAccount:{id:50,access:"robotConfig.accountId"},_conversationOnlineSyncNotify:{id:51},_conversationOnlineSyncData:{id:52},aiAgentMsgDirection:{id:55,access:"aiConfig.aiStatus",retAccess:"aiConfig.aiStatus",retType:"number"},aiAgentAccount:{id:56,access:"aiConfig.accountId",retAccess:"aiConfig.accountId"},aiAgentContent:{id:57,access:"aiConfig.content",converter:bh,retConverter:Op},aiAgentMessages:{id:58,access:"aiConfig.messages",converter:bh,retConverter:Op},aiAgentPromptVariables:{id:59,access:"aiConfig.promptVariables",retConverter:Op},aiAgentModelConfigParams:{id:60,access:"aiConfig.modelConfigParams",converter:bh,retConverter:Op},errorCode:{id:61,access:"messageStatus.errorCode",retType:"number"},modifyTime:{id:62,retType:"number"},modifyAccountId:63,historyEnabled:{id:100,access:"messageConfig.historyEnabled",converter:Th,retType:"boolean"},roamingEnabled:{id:101,access:"messageConfig.roamingEnabled",converter:Th,retType:"boolean"},onlineSyncEnabled:{id:102,access:"messageConfig.onlineSyncEnabled",converter:Th,retType:"boolean"},routeEnabled:{id:105,access:"routeConfig.routeEnabled",converter:Th,retType:"boolean"},pushEnable:{id:107,access:"pushConfig.pushEnabled",converter:Th,retType:"boolean"},offlineEnabled:{id:108,access:"messageConfig.offlineEnabled",converter:Th,retType:"boolean"},unreadEnabled:{id:109,access:"messageConfig.unreadEnabled",converter:Th,retType:"boolean"},pushNickEnabled:{id:110,access:"pushConfig.pushNickEnabled",converter:Th,retType:"boolean"},msgAckSnapshot:{id:112,retType:"number"},receiverIds:{id:154,access:"targetConfig.receiverIds",converter:bh,retConverter:function(){}},inclusive:{id:155,access:"targetConfig.inclusive",converter:function(e){return e?1:2},retConverter:function(){}},newMemberVisible:{id:156,access:"targetConfig.newMemberVisible",converter:function(e){return e?1:2},retConverter:function(){}}},Wg=Sh(Hg),Kg={conversationType:{id:1,access:"messageRefer.conversationType",retType:"number"},senderId:{id:2,access:"messageRefer.senderId"},receiverId:{id:3,access:"messageRefer.receiverId"},messageServerId:{id:4,access:"messageRefer.messageServerId"},messageClientId:{id:5,access:"messageRefer.messageClientId"},createTime:{id:6,access:"messageRefer.createTime",retType:"number"},deleteTime:{id:7,retType:"number"},serverExtension:8};Sh(Kg);var Yg={version:1,md5:2,nosurl:3,thesaurus:4},Qg={createTime:{id:0,retType:"number"},sysMsgType:1,receiverId:2,senderId:3,postscript:4,attach:5,pushContent:8,pushPayload:9,messageClientId:10,messageServerId:11,deleteMsgCreatetime:{id:14,retType:"number"},opeAccount:16,env:21,callbackExtension:22},Jg={receiverId:0,messageServerId:1,readCount:{id:100,retType:"number"},unreadCount:{id:101,retType:"number"},messageClientId:102,latestReadAccount:103},zg={v2BatchMarkRead:{sid:4,cid:5,service:Gg,hasPacketResponse:!1,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]},v2SendP2pMessage:{sid:30,cid:1,service:Gg,params:[{type:"Property",name:"tag",reflectMapper:Hg}],response:[{type:"Property",name:"data",reflectMapper:Sh(Hg)}]},onMsg:{sid:7,cid:2,service:Gg,response:[{type:"Property",name:"msg",reflectMapper:Sh(Hg)}]},syncOfflineMsgs:{sid:4,cid:4,service:Gg,response:[{type:"PropertyArray",name:"datas",reflectMapper:Sh(Hg)}]},syncRoamingMsgs:{sid:4,cid:9,service:Gg,response:[{type:"PropertyArray",name:"datas",reflectMapper:Sh(Hg)}]},v2SendP2PMessageReceipt:{sid:30,cid:11,service:Gg,params:[{type:"Property",name:"tag",reflectMapper:Hg}],response:[{type:"Property",name:"data",reflectMapper:Sh(Hg)}]},v2RevokeMessage:{sid:30,cid:13,service:Gg,params:[{type:"Property",name:"tag",reflectMapper:Qg}]},v2DeleteMessage:{sid:30,cid:23,service:Gg,params:[{type:"Property",name:"tag",reflectMapper:Kg}],response:[{type:"Long",name:"timetag"}]},v2DeleteMessages:{sid:30,cid:24,service:Gg,params:[{type:"PropertyArray",name:"tag",reflectMapper:Kg}],response:[{type:"Long",name:"timetag"}]},v2SendTeamMessage:{sid:31,cid:2,service:Gg,params:[{type:"Property",name:"tag",reflectMapper:Hg}],response:[{type:"Property",name:"data",reflectMapper:Sh(Hg)}]},v2SendTeamMessageReceipts:{sid:31,cid:28,service:Gg,params:[{type:"PropertyArray",name:"tag",reflectMapper:Jg}],response:[{type:"PropertyArray",name:"tag",reflectMapper:Sh(Jg)}]},v2SendSuperTeamMessage:{sid:32,cid:2,service:Gg,params:[{type:"Property",name:"tag",reflectMapper:Hg}],response:[{type:"Property",name:"data",reflectMapper:Sh(Hg)}]},v2RevokeSuperTeamMessage:{sid:32,cid:17,service:Gg,params:[{type:"Property",name:"tag",reflectMapper:Qg}]},syncP2PMessagReceipts:{sid:4,cid:12,service:Gg,response:[{type:"PropertyArray",name:"data",reflectMapper:Sh(Hg)}]},onP2PMessageReceipts:{sid:7,cid:12,service:Gg,response:[{type:"Property",name:"data",reflectMapper:Sh(Hg)}]},v2GetTeamMessageReceipts:{sid:31,cid:29,service:Gg,params:[{type:"PropertyArray",name:"tag",reflectMapper:Jg}],response:[{type:"PropertyArray",name:"data",reflectMapper:Sh(Jg)}]},v2GetTeamMessageReceiptDetail:{sid:31,cid:30,service:Gg,params:[{type:"Property",name:"tag",reflectMapper:Jg,select:["receiverId","messageServerId"]}],response:[{type:"Property",name:"data",reflectMapper:Sh(Jg)},{type:"StrArray",name:"readAccountList"},{type:"StrArray",name:"unreadAccountList"}]},onTeamMessageReceipts:{sid:8,cid:31,service:Gg,response:[{type:"PropertyArray",name:"data",reflectMapper:Sh(Jg)}]},onRevokeMessage:{sid:7,cid:14,service:Gg,response:[{type:"Property",name:"data",reflectMapper:Sh(Qg)}]},syncRevokeMessage:{sid:7,cid:15,service:Gg,response:[{type:"PropertyArray",name:"datas",reflectMapper:Sh(Qg)}]},syncOnDeleteMessages:{sid:4,cid:21,service:Gg,response:[{type:"PropertyArray",name:"datas",reflectMapper:Sh(Kg)}]},onDeleteMessage:{sid:7,cid:123,service:Gg,response:[{type:"Property",name:"data",reflectMapper:Sh(Kg)}]},onDeleteMessages:{sid:7,cid:124,service:Gg,response:[{type:"PropertyArray",name:"data",reflectMapper:Sh(Kg)}]},v2DownloadLocalAntiSpamVocabs:{sid:29,cid:17,service:Gg,params:[{type:"Property",name:"tag",reflectMapper:Yg}],response:[{type:"Property",name:"data",reflectMapper:Sh(Yg)}]},v2MessageP2pModify:{sid:30,cid:31,service:Gg,params:[{type:"Property",name:"tag",reflectMapper:Hg}],response:[{type:"Property",name:"data",reflectMapper:Sh(Hg)}]},v2MessageTeamModify:{sid:31,cid:37,service:Gg,params:[{type:"Property",name:"tag",reflectMapper:Hg}],response:[{type:"Property",name:"data",reflectMapper:Sh(Hg)}]},v2MessageSuperTeamModify:{sid:32,cid:38,service:Gg,params:[{type:"Property",name:"tag",reflectMapper:Hg}],response:[{type:"Property",name:"data",reflectMapper:Sh(Hg)}]},v2MessageOnModified:{sid:7,cid:33,service:Gg,response:[{type:"Property",name:"data",reflectMapper:Sh(Hg)}]},v2MessageSyncModified:{sid:4,cid:27,service:Gg,response:[{type:"PropertyArray",name:"datas",reflectMapper:Sh(Hg)},{type:"Long",name:"time"}]},v2MessageSuperTeamSyncModified:{sid:4,cid:28,service:Gg,response:[{type:"PropertyArray",name:"datas",reflectMapper:Sh(Hg)},{type:"Long",name:"time"}]}};function Xg(e){return 1===e?0:2===e?1:3===e?5:void 0}function $g(e){var t=$p(e);return 0===t?1:1===t?2:5===t?3:0}var Zg,ev={type:{type:"number"},lastMessageState:{type:"number"},unreadCount:{type:"number"},stickTop:{type:"boolean"},sortOrder:{type:"number"},version:{type:"number"},deleteFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}};function tv(e,t){return t&&t.length>0?du(t).call(t,(function(t){return nv(e,t)})):[]}function rv(e,t,r,n){var i,o;void 0===r&&(r=0);var a=t=qg(t,e),s=a.messageType,c=a.subType,u=a.text,d=a.attachment,l=a.serverExtension,p="";if(t.senderId!==e.account){p=Zp(t,"fromNick");var m=null===(o=null===(i=e.V2NIMFriendService)||void 0===i?void 0:i.model)||void 0===o?void 0:o.getFriend(t.senderId);m&&m.alias&&(p=m.alias)}return JSON.parse(_i({lastMessageState:r,messageRefer:Lg(e,t),messageType:s,subType:c,text:u,attachment:d,serverExtension:l,callbackExtension:t.callbackExtension,sendingState:n,senderName:p}))}function nv(e,t){var r=Ph(ev,t);if(r.groupIds?r.groupIds=JSON.parse(r.groupIds):delete r.groupIds,"string"==typeof r.lastMessage)if(""===r.lastMessage);else if(1===r.lastMessageState){var n=Vg(e,yh(JSON.parse(r.lastMessage),Sh(Qg)));r.lastMessage=function(e,t){var r=t.messageRefer,n=t.revokeAccountId,i=t.revokeType,o=t.callbackExtension,a=t.serverExtension,s=t.postscript,c=function(e,t,r,n){var i,o,a,s,c,u,d,l;if(t!==e.account){var p=null===(o=null===(i=e.V2NIMFriendService)||void 0===i?void 0:i.model)||void 0===o?void 0:o.getFriend(t);if(p&&p.alias)return p.alias;if(2===r){var m=null===(s=null===(a=e.V2NIMTeamService)||void 0===a?void 0:a.memberModel)||void 0===s?void 0:s.getById(n,1,t);if(m&&m.teamNick)return m.teamNick}else if(3===r){var h=null===(u=null===(c=e.V2NIMTeamService)||void 0===c?void 0:c.memberModel)||void 0===u?void 0:u.getById(n,1,t);if(h&&h.teamNick)return h.teamNick}var f=null===(l=null===(d=e.V2NIMUserService)||void 0===d?void 0:d.model)||void 0===l?void 0:l.getUser(t);return f&&f.name?f.name:void 0}}(e,t.revokeAccountId,t.messageRefer.conversationType,t.messageRefer.receiverId)||"";return JSON.parse(_i({lastMessageState:1,messageRefer:r,revokeAccountId:n,revokeType:i,callbackExtension:o,serverExtension:a,text:s||"",senderName:c}))}(e,n)}else if(0===r.lastMessageState){var i=yh(JSON.parse(r.lastMessage),Sh(Hg));r.lastMessage=rv(e,i,r.lastMessageState,i.senderId===e.account?1:void 0)}else 2===r.lastMessageState&&delete r.lastMessage;return r}function iv(e){var t=e.version,r=e.deleteFlag;return{conversation:Jl(e,["version","deleteFlag"]),version:t,deleteFlag:r}}!function(e){e[e.createConversation=1]="createConversation",e[e.deleteConversation=2]="deleteConversation",e[e.updateConversation=3]="updateConversation",e[e.setConversationTop=4]="setConversationTop",e[e.clearConversationUnread=5]="clearConversationUnread",e[e.addConversationToGroup=6]="addConversationToGroup",e[e.removeConversationFromGroup=7]="removeConversationFromGroup",e[e.modifyConversationOnSendMessage=8]="modifyConversationOnSendMessage",e[e.modifyConversationOnDeleteMessage=9]="modifyConversationOnDeleteMessage",e[e.modifyConversationOnRecallMessage=10]="modifyConversationOnRecallMessage",e[e.modifyConversationOnClearMessage=11]="modifyConversationOnClearMessage",e[e.oneClickClearConversationUnread=12]="oneClickClearConversationUnread",e[e.modifyConversationOnUpdateMessage=13]="modifyConversationOnUpdateMessage"}(Zg||(Zg={}));var ov={type:{type:"number"},oneClickClearUnreadType:{type:"number"},oneClickClearUnreadConversationType:{type:"object"},oneClickClearUnreadVersion:{type:"number"},deleteConversationClearMessage:{type:"boolean"}};function av(e){return Ph(ov,e)}var sv=function(){function e(e,t){this.fieldVersion={},this.conversationIdsForBackFill={},this.tempPacket=[],this.isSyncing=!1,this.nextCursor=0,this.core=e,this.service=t}var t=e.prototype;return t.reset=function(){this.tempPacket=[],this.fieldVersion={},this.conversationIdsForBackFill={},this.isSyncing=!1,this.nextCursor=0},t.doSync=function(){return zl(this,void 0,void 0,Ql.mark((function e(){var t,r,n,i;return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.isSyncing=!0,this.service.emit("onSyncStarted"),e.prev=2,e.next=5,this.core.sendCmd("v2ConversationSync",{tag:{cursor:this.nextCursor}});case 5:t=e.sent,e.next=18;break;case 8:if(e.prev=8,e.t0=e.catch(2),(r=e.t0).code!==Tl.V2NIM_ERROR_CODE_CANCELLED){e.next=13;break}return e.abrupt("return");case 13:return this.isSyncing=!1,this.service.emit("onSyncFailed",r),this.core.V2NIMLoginService.dataSync.switchDataSync({type:1,state:3,error:r,subType:"conversationSync"}),this.processTempPacket(),e.abrupt("return");case 18:n=0===$p(Zp(t,"content.info.syncType")),i=Zp(t,"content.info.nextCursor"),this.doSyncAndSuccess(n,i);case 21:case"end":return e.stop()}}),e,this,[[2,8]])})))},t.doSyncAndSuccess=function(e,t){var r;e&&Vm(r=this.service.model).call(r),this.isSyncing=!1,this.nextCursor=$p(t)||0,this.service.unread.resetTotalAfterSyncDone(),this.service.unread.digestUnreadCountChange(),this.service.emit("onSyncFinished"),this.core.V2NIMLoginService.dataSync.switchDataSync({type:1,state:3,subType:"conversationSync"}),this.processTempPacket()},t.setBackFillIds=function(e){var t=this;return jn(e).call(e,(function(e){if(2===e.lastMessageState&&t.service.hasMessageService){t.conversationIdsForBackFill[e.conversationId]=!0;var r=t.core.V2NIMMessageService.model.getLastMessageOfConversation(e.conversationId);e.lastMessage=r?rv(t.core,r,e.lastMessageState,r.sendingState):""}else t.conversationIdsForBackFill[e.conversationId]=!1;delete e.lastMessageState})),e},t.recvConversationFromSyncAction=function(e){var t=this,r=Zp(e,"content.info").syncType,n=tv(this.core,Zp(e,"content.datas"));0===(r=$p(r))?(jn(n).call(n,(function(e){t.initFieldVersion(e.conversationId,e.version)})),n=this.setBackFillIds(n),this.setModel(n)):(n=this.setBackFillIds(n),this.recvConversationForCreated(n)<n.length&&this.recvConversationForChanged(n))},t.recvConversation=function(e){var t=this;if(this.isSyncing)this.tempPacket.push(e);else{var r=tv(this.core,Zp(e,"content.datas")),n=fu(r).call(r,(function(e){return!!e.conversationId})),i=av(Zp(e,"content.info")),o=du(n).call(n,(function(e){return"id:"+e.conversationId+", ver:"+e.version})).join(";");if(this.core.logger.getDebugMode()?this.core.logger.debug("V2NIMConversation::recvConversation: "+o+".",i,n):this.core.logger.log("V2NIMConversation::recvConversation: "+o+".",i),2===i.type){var a=du(n).call(n,(function(e){return delete t.fieldVersion[e.conversationId],t.service.model.deleteById(e.conversationId),e.conversationId}));return this.service.emit("onConversationDeleted",a),void this.service.unread.digestUnreadCountChange()}12!==i.type?(i.type,n=this.setBackFillIds(n),this.recvConversationForCreated(n)<n.length&&this.recvConversationForChanged(n)):this.compareAndClearUnreadInModel(i.oneClickClearUnreadVersion,i.oneClickClearUnreadType,{conversationGroupIds:i.oneClickClearUnreadGroupId?[i.oneClickClearUnreadGroupId]:void 0,conversationTypes:i.oneClickClearUnreadConversationType})}},t.recvConversationForCreated=function(e){var t=this,r=fu(e).call(e,(function(e){return!t.fieldVersion[e.conversationId]})),n=Ml(r).call(r,(function(e,r){if(!t.fieldVersion[r.conversationId]){t.initFieldVersion(r.conversationId,r.version),e=!!t.updateModel(r)||e;var n=t.service.model.getById(r.conversationId);return n&&t.service.triggerConversationCreated(n),e}return e}),!1);return n&&this.service.unread.digestUnreadCountChange(),r.length},t.recvConversationForChanged=function(e){var t,r=this,n=this.bulkCompare(e);if(0!==n.length){this.bulkUpdateModel(n);var i=fu(t=du(n).call(n,(function(e){return r.service.model.getById(e.conversationId)}))).call(t,(function(e){return!!e}));this.service.triggerConversationChanged(i)}},t.processTempPacket=function(){var e,t=this;jn(e=this.tempPacket).call(e,(function(e){t.recvConversation(e)})),this.tempPacket=[]},t.bulkCompare=function(e){var t,r=this;return fu(t=du(e).call(e,(function(e){return r.compare(e)}))).call(t,(function(e){return!!e}))},t.compare=function(e){var t=this,r=e.version,n=e.conversationId,i=e.deleteFlag,o=e.type,a=["stickTop","groupIds","serverExtension","localExtension","lastMessage","lastMessageState","unreadCount","sortOrder","createTime","updateTime"],s={},c=0;return jn(a).call(a,(function(i){var o=i;if(void 0!==e[o]){var a=t.fieldVersion[n];a&&"number"==typeof a[o]&&a[o]>=r||(t.fieldVersion[n]=t.fieldVersion[n]||{},t.fieldVersion[n][o]=r,s[o]=e[o],c+=1)}})),c?dr(dr({},s),{conversationId:n,deleteFlag:i,version:r,type:o}):void 0},t.bulkUpdateModel=function(e){var t=this,r=!1;jn(e).call(e,(function(e){t.updateModel(e)&&(r=!0)})),r&&this.service.unread.digestUnreadCountChange()},t.initFieldVersion=function(e,t){this.fieldVersion[e]={stickTop:t,groupIds:t,serverExtension:t,lastMessage:t,lastMessageState:t,unreadCount:t,sortOrder:t,createTime:t,updateTime:t}},t.initConversation=function(e,t){var r=_s();return dr({conversationId:e,type:this.core.V2NIMConversationIdUtil.parseConversationType(e),stickTop:!1,localExtension:"",serverExtension:"",unreadCount:0,createTime:r,updateTime:r,sortOrder:r},t)},t.updateModel=function(e){var t=iv(e),r=t.deleteFlag,n=t.conversation;if(r){var i=this.service.model.deleteById(n.conversationId);return!!(i&&i.unreadCount>0)}return this.service.model.upsert(n)},t.setModel=function(e){var t,r=du(t=fu(e).call(e,(function(e){return!e.deleteFlag}))).call(t,(function(e){return iv(e).conversation}));this.service.model.set(r)},t.updateModelWithLastMessage=function(e,t,r,n){var i=this.service.model.getById(e),o=t?rv(this.core,t,r,n):void 0;if(!Ig(null==i?void 0:i.lastMessage,o))if(i){var a=dr(dr({},i),{sortOrder:o?i.stickTop?o.messageRefer.createTime+1e15:o.messageRefer.createTime:i.sortOrder,lastMessage:o});this.service.model.upsert(a),this.service.triggerConversationChanged([a])}else{this.initFieldVersion(e,-1);var s=this.initConversation(e,{lastMessage:o});this.service.model.upsert(s),this.service.triggerConversationCreated(s)}},t.updateModelByRevoke=function(e){var t=this,r=[];jn(e).call(e,(function(e){var n=e.postscript,i=e.messageRefer,o=Jl(e,["postscript","messageRefer"]),a=i.conversationId,s=t.service.model.getById(a);s&&s.lastMessage&&s.lastMessage.messageRefer.messageClientId===i.messageClientId&&1!==s.lastMessage.lastMessageState&&(s.lastMessage.lastMessageState=1,n&&(s.lastMessage.text=n),dr(s.lastMessage,o),t.service.model.upsert(s),r.push(s))})),r.length>0&&this.service.triggerConversationChanged(r)},t.compareAndUpdateModel=function(e){var t=this;this.core.logger.log("V2NIMConversation::compareAndUpdateModel",du(e).call(e,(function(e){return e.conversationId})));var r=!1,n=[];jn(e).call(e,(function(e){var i=t.compare(e);if(i){var o=t.service.model.getById(e.conversationId);t.updateModel(i)&&(r=!0);var a=t.service.model.getById(e.conversationId);a&&(o?n.push(a):t.service.triggerConversationCreated(a))}})),n.length>0&&this.service.triggerConversationChanged(n),r&&this.service.unread.digestUnreadCountChange()},t.compareAndDeleteModel=function(e){var t=this;this.core.logger.log("V2NIMConversation::compareAndDeleteModel",e);var r=Ml(e).call(e,(function(e,r){delete t.fieldVersion[r];var n=t.service.model.deleteById(r);return!!(n&&n.unreadCount>0)||e}),!1);this.service.emit("onConversationDeleted",e),r&&this.service.unread.digestUnreadCountChange()},t.compareAndDeleteGroupInModel=function(e,t){var r,n=this;this.core.logger.log("V2NIMConversation::compareAndDeleteGroupInModel",e,t);var i=[];jn(r=fr(this.fieldVersion)).call(r,(function(r){var o=n.fieldVersion[r];if(void 0===o.groupIds||e>o.groupIds){o.groupIds=e;var a=n.service.model.getById(r);if(a&&a.groupIds&&a.groupIds.length>0){var s,c=fu(s=a.groupIds).call(s,(function(e){return e!==t}));if(c.length!==a.groupIds.length){var u=dr(dr({},a),{groupIds:c});n.service.model.upsert(u),u&&i.push(u)}}}})),i.length>0&&this.service.triggerConversationChanged(i)},t.compareAndClearUnreadInModel=function(e,t,r){var n=this;this.core.logger.log("V2NIMConversation::compareAndClearUnreadInModel",e,t,r);var i=[],o=[];if(1===t)o=this.service.model.getAll();else if(r){var a=this.service.model.count();o=this.service.model.getByOption(0,a,r).conversationList}jn(o).call(o,(function(t){var r=t.conversationId,o=n.fieldVersion[r];if(void 0===o.unreadCount||e>o.unreadCount){o.unreadCount=e;var a=t.unreadCount,s=dr(dr({},t),{unreadCount:0});n.service.model.upsert(s),a>0&&i.push(s)}})),i.length>0&&this.service.triggerConversationChanged(i),this.service.unread.digestUnreadCountChange()},t.backfillLastMsg=function(e,t){var r=this,n=e=zh(e);(t||0!==(n=fu(e).call(e,(function(e){return r.conversationIdsForBackFill[e]}))).length)&&jn(n).call(n,(function(e){var t=Zp(r.service.model.getById(e),"lastMessage.messageRefer.messageClientId"),n=r.service.hasMessageService?r.core.V2NIMMessageService.model.getLastMessageOfConversation(e):void 0;(n&&n.messageClientId)!==t&&(r.conversationIdsForBackFill[e]=!1,n?r.updateModelWithLastMessage(e,n,2,n.sendingState):r.updateModelWithLastMessage(e,void 0,2,0))}))},e}(),cv={"28_1":"v2ConversationCreate","28_2":"v2ConversationDelete","28_3":"v2ConversationUpdate","28_4":"v2ConversationSetTop","28_5":"v2ConversationUnreadClear","28_6":"v2ConversationGet","28_7":"v2ConversationGetByIds","28_8":"v2ConversationGetList","28_17":"v2ConversationsDelete","28_18":"v2ConversationsUnreadClear","28_19":"v2ConversationSync","28_20":"v2ConversationNotifySync","28_21":"v2ConversationNotifySyncOnline","28_23":"v2ConversationClearTotalUnread","28_24":"v2ConversationClearTypeUnread","28_25":"v2ConversationClearGroupUnread","4_14":"syncConversationReadTime","4_20":"syncSuperTeamReadTime","4_22":"v2SyncSessionsWithMoreRoaming","4_25":"v2SyncSessionReliableInfo","30_16":"v2MarkConversationReadTime","32_25":"v2MarkSuperTeamReadTime","7_116":"v2MultiDeviceConversationReadTime","21_125":"v2MultiDeviceSuperTeamReadTime"},uv="V2NIMConversationService",dv={conversationId:1,type:2,serverExtension:3,groupIds:4,lastMessage:5,lastMessageState:6,unreadCount:7,stickTop:8,sortOrder:9,version:10,deleteFlag:11,createTime:12,updateTime:13},lv={type:1,oneClickClearUnreadType:2,oneClickClearUnreadConversationType:3,oneClickClearUnreadGroupId:4,oneClickClearUnreadVersion:5,deleteConversationClearMessage:6},pv={v2ConversationCreate:{sid:28,cid:1,service:uv,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1}}],response:[{type:"Property",name:"data",reflectMapper:mf(dv)}]},v2ConversationDelete:{sid:28,cid:2,service:uv,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1,clearMessage:2}}],response:[{type:"Property",name:"data",reflectMapper:mf(dv)}]},v2ConversationUpdate:{sid:28,cid:3,service:uv,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1,serverExtension:2}}],response:[{type:"Property",name:"data",reflectMapper:mf(dv)}]},v2ConversationSetTop:{sid:28,cid:4,service:uv,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1,stickTop:2}}],response:[{type:"Property",name:"data",reflectMapper:mf(dv)}]},v2ConversationUnreadClear:{sid:28,cid:5,service:uv,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1}}],response:[{type:"Property",name:"data",reflectMapper:mf(dv)}]},v2ConversationGet:{sid:28,cid:6,service:uv,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1}}],response:[{type:"Property",name:"data",reflectMapper:mf(dv)}]},v2ConversationGetByIds:{sid:28,cid:7,service:uv,params:[{type:"Property",name:"tag",reflectMapper:{conversationIds:1}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:mf(dv)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGetList:{sid:28,cid:8,service:uv,params:[{type:"Property",name:"tag",reflectMapper:{cursor:1,limit:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:mf(dv)},{type:"Property",name:"info",reflectMapper:{1:"hasMore",2:"offset"}}]},v2ConversationsDelete:{sid:28,cid:17,service:uv,params:[{type:"Property",name:"tag",reflectMapper:{conversationIds:1,clearMessage:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:mf(dv)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationsUnreadClear:{sid:28,cid:18,service:uv,params:[{type:"Property",name:"tag",reflectMapper:{conversationIds:1}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:mf(dv)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationSync:{sid:28,cid:19,service:uv,params:[{type:"Property",name:"tag",reflectMapper:{cursor:1}}],response:[{type:"Property",name:"info",reflectMapper:{1:"nextCursor",2:"syncType"}}]},v2ConversationNotifySync:{sid:28,cid:20,service:uv,response:[{type:"Property",name:"info",reflectMapper:{1:"nextCursor",2:"syncType"}},{type:"PropertyArray",name:"datas",reflectMapper:mf(dv)}]},v2ConversationNotifySyncOnline:{sid:28,cid:21,service:uv,response:[{type:"Property",name:"info",reflectMapper:mf(lv)},{type:"PropertyArray",name:"datas",reflectMapper:mf(dv)}]},v2ConversationClearTotalUnread:{sid:28,cid:23,service:uv,response:[{type:"Property",name:"info",reflectMapper:mf(lv)}]},v2ConversationClearTypeUnread:{sid:28,cid:24,service:uv,params:[{type:"Property",name:"tag",reflectMapper:{conversationType:1}}],response:[{type:"Property",name:"info",reflectMapper:mf(lv)}]},v2ConversationClearGroupUnread:{sid:28,cid:25,service:uv,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1}}],response:[{type:"Property",name:"info",reflectMapper:mf(lv)}]},syncConversationReadTime:{sid:4,cid:14,service:uv,response:[{type:"StrLongMap",name:"p2p"},{type:"LongLongMap",name:"team"},{type:"Long",name:"timetag"}]},syncSuperTeamReadTime:{sid:4,cid:20,service:uv,response:[{type:"LongLongMap",name:"superTeam"}]},v2SyncSessionsWithMoreRoaming:{sid:4,cid:22,service:uv,response:[]},v2SyncSessionReliableInfo:{sid:4,cid:25,service:uv,response:[]},v2MarkConversationReadTime:{sid:30,cid:16,service:uv,params:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},v2MarkSuperTeamReadTime:{sid:32,cid:25,service:uv,params:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},v2MultiDeviceConversationReadTime:{sid:30,cid:116,service:uv,response:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},v2MultiDeviceSuperTeamReadTime:{sid:21,cid:125,service:uv,response:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]}},mv=function(){function e(e,t){this.totalUnreadCount=void 0,this.unreadCountByFilter={},this.core=e,this.service=t}var t=e.prototype;return t.reset=function(){this.totalUnreadCount=void 0,this.unreadCountByFilter={}},t.getTotalUnreadCount=function(){return this.totalUnreadCount},t.resetTotalAfterSyncDone=function(){var e,t=Ml(e=this.service.model.getAll()).call(e,(function(e,t){return e+(t.unreadCount||0)}),0),r=this.totalUnreadCount;return void 0!==r&&r===t||(this.totalUnreadCount=t,this.service.emit("onTotalUnreadCountChanged",t)),t},t.digestUnreadCountChange=function(){this._digest()},t._digest=function(){var e,t=this,r=this.totalUnreadCount,n=Ml(e=this.service.model.getAll()).call(e,(function(e,t){return e+(t.unreadCount||0)}),0);this.core.logger.log("V2NIMConversation::digestUnreadCountChange:oldUnreadCount "+r+", newUnreadCount "+n),r!==n&&(this.totalUnreadCount=n,this.service.emit("onTotalUnreadCountChanged",n));var i=fr(this.unreadCountByFilter);jn(i).call(i,(function(e){var r=JSON.parse(e),n=t.getUnreadCountByFilter(r),i=t.unreadCountByFilter[e];t.unreadCountByFilter[e]=n,r.equals=tr(fv).call(fv,r),i!==n&&t.service.emit("onUnreadCountChangedByFilter",r,n)}))},t.getUnreadCountByIds=function(e){var t=this;return Ml(e).call(e,(function(e,r){var n=t.service.model.getById(r);return e+(n&&n.unreadCount||0)}),0)},t.getUnreadCountByFilter=function(e){var t,r=this.service.model.count(),n=this.service.model.getByOption(0,r,{conversationTypes:e.conversationTypes,conversationGroupIds:e.conversationGroupId?[e.conversationGroupId]:void 0,ignoreMuted:e.ignoreMuted});return Ml(t=n.conversationList).call(t,(function(e,t){return e+(t.unreadCount||0)}),0)},t.addFilter=function(e){var t=hv(e);if(void 0!==this.unreadCountByFilter[t])throw new _l({code:Tl.V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST});var r=JSON.parse(t),n=this.getUnreadCountByFilter(r);this.unreadCountByFilter[t]=n,this.service.emit("onUnreadCountChangedByFilter",r,n)},t.deleteFilter=function(e){var t=hv(e);if(void 0===this.unreadCountByFilter[t])throw new _l({code:Tl.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});delete this.unreadCountByFilter[t]},e}();function hv(e){var t=e.conversationTypes;return t&&(t=Vm(t).call(t)),_i({conversationGroupId:e.conversationGroupId,conversationTypes:t,ignoreMuted:e.ignoreMuted})}function fv(e){return _i(this)===hv(e)}var gv={createTime:{type:"number"},updateTime:{type:"number"}};function vv(e){return e&&e.length>0?du(e).call(e,(function(e){return yv(e)})):[]}function yv(e){return Ph(gv,e)}function Mv(e){var t,r=JSON.parse(e);return du(t=fr(r)).call(t,(function(e){return{conversationId:e,error:new _l({code:r[e]})}}))}var Iv,Sv={type:{type:"number"},deleteVersion:{type:"number"},conversationIds:{type:"object"}};function Tv(e){return Ph(Sv,e)}!function(e){e[e.createConversationGroup=1]="createConversationGroup",e[e.deleteConversationGroup=2]="deleteConversationGroup",e[e.updateConversationGroup=3]="updateConversationGroup",e[e.addConversationToGroup=4]="addConversationToGroup",e[e.removeConversationFromGroup=5]="removeConversationFromGroup"}(Iv||(Iv={}));var bv=function(e){function t(t,r){var n;return void 0===r&&(r={}),(n=e.call(this,"V2NIMConversationService",t)||this).config={},n.model=new lg,n.versionCache=new sv(n.core,ut(n)),n.unread=new mv(n.core,ut(n)),n.core._registerDep(Mg,"V2NIMConversationIdUtil"),"v2"!==n.core.options.apiVersion?ut(n):(Mh({cmdMap:cv,cmdConfig:pv}),n.setOptions(r),n.setListener(),n)}nr(t,e);var r=t.prototype;return r.setOptions=function(e){this.config=dr(this.config,e)},r.setListener=function(){var e=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(){e.versionCache.doSync()})),this.core.eventBus.on("V2NIMConversationService/conversationOnlineSyncNotify",(function(t,r){var n;!1!==(null===(n=null==r?void 0:r.messageConfig)||void 0===n?void 0:n.lastMessageUpdateEnabled)&&(t.content.info=yh(t.content.info,mf(lv)),t.content.data=yh(t.content.data,mf(dv)),r&&(t.content.data.lastMessage=rv(e.core,r,0)),t.content.datas=[t.content.data],e.v2ConversationNotifySyncOnlineHandler.call(e,t))})),this.core.eventBus.on("V2NIMConversationService/sendMessage",(function(t,r){var n,i;1===r&&!0===(null===(n=t.messageConfig)||void 0===n?void 0:n.historyEnabled)||!1!==(null===(i=null==t?void 0:t.messageConfig)||void 0===i?void 0:i.lastMessageUpdateEnabled)&&e.versionCache.updateModelWithLastMessage(t.conversationId,t,2,r)})),this.core.eventBus.on("V2NIMConversationService/deleteMessages",(function(t){var r=du(t).call(t,(function(e){return e.messageRefer.conversationId}));e.versionCache.backfillLastMsg(r,!0)})),this.core.eventBus.on("V2NIMConversationService/revokeMessages",(function(t){e.versionCache.updateModelByRevoke(t)})),this.core.eventBus.on("V2NIMConversationService/checkBackFill",(function(t){e.versionCache.backfillLastMsg(t,!1)})),this.core.eventBus.on("V2NIMConversationService/setMute",(function(t,r){var n=e.model.getById(t);n&&n.mute!==r&&(n.mute=r,e.model.upsert(n),e.emit("onConversationChanged",[n]))}))},r.reset=function(){this.versionCache.reset(),this.model.reset(),this.unread.reset()},r.emit=function(t){for(var r,n,i,o,a=this.name+"::emit "+t.toString(),s=arguments.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=arguments[u];if("onConversationCreated"===t){var d=c[0];this.logger.log(""+a,"id:"+d.conversationId+";unread:"+d.unreadCount+";lastMsg:"+(null===(i=d.lastMessage)||void 0===i?void 0:i.messageRefer.messageClientId)+"/"+(null===(o=d.lastMessage)||void 0===o?void 0:o.messageRefer.messageServerId))}else if("onConversationChanged"===t){var l=c[0];this.logger.log(""+a,du(l).call(l,(function(e){var t,r;return"id:"+e.conversationId+";unread:"+e.unreadCount+";lastMsg:"+(null===(t=e.lastMessage)||void 0===t?void 0:t.messageRefer.messageClientId)+"/"+(null===(r=e.lastMessage)||void 0===r?void 0:r.messageRefer.messageServerId)})))}else{var p,m;(p=this.logger).log.apply(p,xs(m=[""+a]).call(m,c))}return(r=e.prototype.emit).call.apply(r,xs(n=[this,t]).call(n,c))},r.getConversationList=function(e,t){this.checkV2(),Pl({offset:{type:"number",min:0}},{offset:e},"",!0),Pl({limit:{type:"number",min:1}},{limit:t},"",!0),this.core.V2NIMLoginService.checkIllegalState();var r=this.model.getByOption(e,t,{});return r.conversationList=this.computedFieldForConversations(r.conversationList),fs.resolve(r)},r.getConversationListByOption=function(e,t,r){this.checkV2(),Pl({offset:{type:"number",min:0}},{offset:e},"",!0),Pl({limit:{type:"number",min:1}},{limit:t},"",!0),Pl({option:{type:"object",required:!0,rules:{conversationTypes:{type:"array",itemType:"number",required:!1},onlyUnread:{type:"boolean",required:!1},conversationGroupIds:{type:"array",itemType:"string",required:!1}}}},{option:r},"",!0),this.core.V2NIMLoginService.checkIllegalState();var n=this.model.getByOption(e,t,r);return n.conversationList=this.computedFieldForConversations(n.conversationList),fs.resolve(n)},r.getConversation=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),Vl(this.core.account,e),this.core.V2NIMLoginService.checkIllegalState(),!(r=this.model.getById(e))){t.next=8;break}return t.abrupt("return",this.computedFieldForConversation(r));case 8:throw new _l({code:Tl.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});case 9:case"end":return t.stop()}}),t,this)})))},r.getConversationListByIds=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Pl({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0),this.core.V2NIMLoginService.checkIllegalState(),n=fu(r=du(e).call(e,(function(e){return i.model.getById(e)}))).call(r,(function(e){return!!e})),n=this.computedFieldForConversations(n),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t,this)})))},r.createConversation=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Vl(this.core.account,e),t.next=4,this.core.sendCmd("v2ConversationCreate",{tag:{conversationId:e}});case 4:if(r=t.sent,n=Zp(r,"content.data"),i=nv(this.core,n),this.versionCache.compareAndUpdateModel([i]),!(o=this.model.getById(e))){t.next=13;break}return t.abrupt("return",this.computedFieldForConversation(o));case 13:throw new _l({code:Tl.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});case 14:case"end":return t.stop()}}),t,this)})))},r.deleteConversation=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Vl(this.core.account,e),Pl({clearMessage:{type:"boolean",required:!1}},{clearMessage:t},"",!0),r.prev=3,r.next=6,this.core.sendCmd("v2ConversationDelete",{tag:{conversationId:e,clearMessage:Number(t||!1)}});case 6:r.next=11;break;case 8:r.prev=8,r.t0=r.catch(3),this.logger.warn("V2NIMConversationService:deleteConversation: delete conversation failed: "+e);case 11:this.model.getById(e)&&(t&&this.core.eventBus.emit("V2NIMConversationService/deleteConversation",[e]),this.versionCache.compareAndDeleteModel([e]));case 12:case"end":return r.stop()}}),r,this,[[3,8]])})))},r.deleteConversationListByIds=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o,a=this;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Pl({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0),Pl({clearMessage:{type:"boolean",required:!1}},{clearMessage:t},"",!0),r.next=5,this.core.sendCmd("v2ConversationsDelete",{tag:{conversationIds:_i(e),clearMessage:Number(t||!1)}});case 5:return n=r.sent,i=Mv(Zp(n,"content.info.failedMap")),(o=fu(i).call(i,(function(e){return e.error.code!==Tl.V2NIM_ERROR_CODE_CONVERSATION_NOT_EXIST||!a.model.getById(e.conversationId)}))).length<e.length&&(t&&this.core.eventBus.emit("V2NIMConversationService/deleteConversation",e),this.versionCache.compareAndDeleteModel(e)),r.abrupt("return",o);case 10:case"end":return r.stop()}}),r,this)})))},r.stickTopConversation=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Vl(this.core.account,e),Pl({stickTop:{type:"boolean"}},{stickTop:t},"",!0),r.next=5,this.core.sendCmd("v2ConversationSetTop",{tag:{conversationId:e,stickTop:Number(t)}});case 5:n=r.sent,i=Zp(n,"content.data"),o=nv(this.core,i),this.versionCache.compareAndUpdateModel([o]);case 9:case"end":return r.stop()}}),r,this)})))},r.updateConversation=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Vl(this.core.account,e),Pl({updateInfo:{type:"object",required:!0,rules:{serverExtension:{type:"string"}}}},{updateInfo:t},"",!0),r.next=5,this.core.sendCmd("v2ConversationUpdate",{tag:dr({conversationId:e},t)});case 5:n=r.sent,i=Zp(n,"content.data"),o=nv(this.core,i),this.versionCache.compareAndUpdateModel([o]);case 9:case"end":return r.stop()}}),r,this)})))},r.updateConversationLocalExtension=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n,i;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),Vl(this.core.account,e),Pl({localExtension:{type:"string"}},{localExtension:t},"",!0),n=this.model.getById(e)){r.next=6;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST});case 6:if(n.localExtension!==t){r.next=8;break}return r.abrupt("return");case 8:i=dr(dr({},n),{localExtension:t}),this.model.upsert(i),this.triggerConversationChanged([i]);case 11:case"end":return r.stop()}}),r,this)})))},r.getTotalUnreadCount=function(){return this.checkV2(),this.unread.getTotalUnreadCount()||0},r.getUnreadCountByIds=function(e){this.checkV2(),Pl({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0);var t=this.unread.getUnreadCountByIds(e);return fs.resolve(t)},r.getUnreadCountByFilter=function(e){this.checkV2(),this.valiteFilter(e);var t=this.unread.getUnreadCountByFilter(e);return fs.resolve(t)},r.clearTotalUnreadCount=function(){return zl(this,void 0,void 0,Ql.mark((function e(){var t,r;return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkV2(),e.next=3,this.core.sendCmd("v2ConversationClearTotalUnread");case 3:t=e.sent,r=av(Zp(t,"content.info")),this.versionCache.compareAndClearUnreadInModel(r.oneClickClearUnreadVersion,r.oneClickClearUnreadType);case 6:case"end":return e.stop()}}),e,this)})))},r.clearUnreadCountByIds=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Pl({conversationIds:{type:"array",itemType:"string",min:1}},{conversationIds:e},"",!0),t.next=4,this.core.sendCmd("v2ConversationsUnreadClear",{tag:{conversationIds:_i(e)}});case 4:return r=t.sent,n=tv(this.core,Zp(r,"content.datas")),i=Mv(Zp(r,"content.info.failedMap")),this.versionCache.compareAndUpdateModel(n),t.abrupt("return",i);case 9:case"end":return t.stop()}}),t,this)})))},r.clearUnreadCountByGroupId=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Pl({groupId:{type:"string"}},{groupId:e},"",!0),t.next=4,this.core.sendCmd("v2ConversationClearGroupUnread",{tag:{groupId:e}});case 4:case"end":return t.stop()}}),t,this)})))},r.clearUnreadCountByTypes=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Pl({types:{type:"array",itemType:"number",min:1}},{types:e},"",!0),t.next=4,this.core.sendCmd("v2ConversationClearTypeUnread",{tag:{conversationType:_i(e)}});case 4:r=t.sent,n=av(Zp(r,"content.info")),this.versionCache.compareAndClearUnreadInModel(n.oneClickClearUnreadVersion,n.oneClickClearUnreadType,{conversationTypes:n.oneClickClearUnreadConversationType});case 7:case"end":return t.stop()}}),t,this)})))},r.markConversationRead=function(e){var t,r;return zl(this,void 0,void 0,Ql.mark((function n(){var i,o,a,s,c;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.checkV2(),this.checkLogin(),Vl(this.core.account,e),i=this.model.getById(e)){n.next=6;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Conversation not exist"}});case 6:if(o=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e),a=this.core.V2NIMConversationIdUtil.parseConversationType(e),s=this.model.getReadTime(e),!(null===(r=null===(t=null==i?void 0:i.lastMessage)||void 0===t?void 0:t.messageRefer)||void 0===r?void 0:r.createTime)){n.next=13;break}c=i.lastMessage.messageRefer.createTime,n.next=19;break;case 13:if(!this.core.timeOrigin.checkNodeReliable()){n.next=17;break}c=this.core.timeOrigin.getNTPTime(),n.next=19;break;case 17:return this.logger.log("markConversationRead","NTP time is not reliable",e),n.abrupt("return",s||0);case 19:if(!(s>=c)){n.next=22;break}return this.logger.log("markConversationRead","currentReadTime >= readTime",e,s,c),n.abrupt("return",s);case 22:if(3!==a){n.next=27;break}return n.next=25,this.core.sendCmd("v2MarkSuperTeamReadTime",{timetag:c,to:o});case 25:n.next=29;break;case 27:return n.next=29,this.core.sendCmd("v2MarkConversationReadTime",{scene:1===a?0:2===a?1:2,timetag:c,to:o});case 29:return this.model.updateReadTime(e,c),n.abrupt("return",c);case 31:case"end":return n.stop()}}),n,this)})))},r.getConversationReadTime=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Vl(this.core.account,e),t.abrupt("return",this.model.getReadTime(e));case 3:case"end":return t.stop()}}),t,this)})))},r.subscribeUnreadCountByFilter=function(e){var t;this.checkV2(),this.checkLogin(),this.valiteFilter(e),0===(null===(t=e.conversationTypes)||void 0===t?void 0:t.length)&&delete e.conversationTypes,this.unread.addFilter(e)},r.unsubscribeUnreadCountByFilter=function(e){var t;this.checkV2(),this.checkLogin(),this.valiteFilter(e),0===(null===(t=e.conversationTypes)||void 0===t?void 0:t.length)&&delete e.conversationTypes,this.unread.deleteFilter(e)},r.v2ConversationNotifySyncHandler=function(e){this.versionCache.recvConversationFromSyncAction(e)},r.v2ConversationNotifySyncOnlineHandler=function(e){this.versionCache.recvConversation(e)},r.syncConversationReadTimeHandler=function(e){var t,r,n;if(null===(t=null==e?void 0:e.content)||void 0===t?void 0:t.p2p)for(var i=0,o=dg(e.content.p2p);i<o.length;i++){var a=o[i],s=a[0],c=a[1];this.model.updateReadTime(this.core.V2NIMConversationIdUtil.p2pConversationId(s),c),this.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.p2pConversationId(s),c)}if(null===(n=null===(r=null==e?void 0:e.content)||void 0===r?void 0:r.team)||void 0===n?void 0:n.m_map)for(var u=0,d=dg(e.content.team.m_map);u<d.length;u++){var l=d[u],p=l[0],m=l[1];this.model.updateReadTime(this.core.V2NIMConversationIdUtil.teamConversationId(p),m),this.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.teamConversationId(p),m)}},r.syncSuperTeamReadTimeHandler=function(e){var t,r;if(null===(r=null===(t=null==e?void 0:e.content)||void 0===t?void 0:t.superTeam)||void 0===r?void 0:r.m_map)for(var n=0,i=dg(e.content.superTeam.m_map);n<i.length;n++){var o=i[n],a=o[0],s=o[1];this.model.updateReadTime(this.core.V2NIMConversationIdUtil.superTeamConversationId(a),s),this.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.superTeamConversationId(a),s)}},r.v2MultiDeviceConversationReadTimeHandler=function(e){var t;(null===(t=null==e?void 0:e.content)||void 0===t?void 0:t.to)&&(0===e.content.scene?(this.model.updateReadTime(this.core.V2NIMConversationIdUtil.p2pConversationId(e.content.to),e.content.timetag),this.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.p2pConversationId(e.content.to),e.content.timetag)):(this.model.updateReadTime(this.core.V2NIMConversationIdUtil.teamConversationId(e.content.to),e.content.timetag),this.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.teamConversationId(e.content.to),e.content.timetag)))},r.v2MultiDeviceSuperTeamReadTimeHandler=function(e){var t;(null===(t=null==e?void 0:e.content)||void 0===t?void 0:t.to)&&(this.model.updateReadTime(this.core.V2NIMConversationIdUtil.superTeamConversationId(e.content.to),e.content.timetag),this.emit("onConversationReadTimeUpdated",this.core.V2NIMConversationIdUtil.superTeamConversationId(e.content.to),e.content.timetag))},r.valiteFilter=function(e){if(Pl({filter:{type:"object",required:!0,rules:{conversationTypes:{type:"array",itemType:"number",required:!1},conversationGroupId:{type:"string",allowEmpty:!1,required:!1},ignoreMuted:{type:"boolean",required:!1}}}},{filter:e},"",!0),void 0===e.conversationTypes&&void 0===e.conversationGroupId&&!0!==e.ignoreMuted)throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Filter cannot be empty"}})},r.computedFieldForConversations=function(e){var t=this;return du(e).call(e,(function(e){return t.computedFieldForConversation(e)}))},r.computedFieldForConversation=function(e){var t,r,n,i,o;if(0===e.type)return e;var a=this.core.V2NIMConversationIdUtil.parseConversationType(e.conversationId),s=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e.conversationId),c={};if((null===(t=this.core.V2NIMSettingService)||void 0===t?void 0:t.name)&&(c.mute=this.core.V2NIMSettingService.getConversationMuteStatus(e.conversationId)),1===a&&this.hasUserService){var u,d=this.core.V2NIMUserService.model.getUser(s),l=this.hasFriendService?this.core.V2NIMFriendService.model.getFriend(s):void 0;e.conversationId!==(null===(r=e.lastMessage)||void 0===r?void 0:r.messageRefer.conversationId)||0!==(null===(n=e.lastMessage)||void 0===n?void 0:n.lastMessageState)&&2!==(null===(i=e.lastMessage)||void 0===i?void 0:i.lastMessageState)||(u=null===(o=e.lastMessage)||void 0===o?void 0:o.senderName),c.name=(null==l?void 0:l.alias)||(null==d?void 0:d.name)||u||s,c.avatar=(null==d?void 0:d.avatar)||""}else if(2===a&&this.hasTeamService){var p=this.core.V2NIMTeamService.model.getById(s,1);c.name=(null==p?void 0:p.name)||s,c.avatar=(null==p?void 0:p.avatar)||""}else if(3===a&&this.hasTeamService){var m=this.core.V2NIMTeamService.model.getById(s,2);c.name=(null==m?void 0:m.name)||s,c.avatar=(null==m?void 0:m.avatar)||""}return dr(e,c),e},r.triggerConversationChanged=function(e){e=this.computedFieldForConversations(e),e=JSON.parse(_i(e)),jn(e).call(e,(function(e){e.lastMessage||(e.lastMessage=void 0),delete e.lastMessageState})),this.emit("onConversationChanged",e)},r.triggerConversationCreated=function(e){e=this.computedFieldForConversation(e),delete(e=JSON.parse(_i(e))).lastMessageState,this.emit("onConversationCreated",e)},ct(t,[{key:"hasUserService",get:function(){var e;return!!(null===(e=this.core.V2NIMUserService)||void 0===e?void 0:e.name)}},{key:"hasFriendService",get:function(){var e;return!!(null===(e=this.core.V2NIMFriendService)||void 0===e?void 0:e.name)}},{key:"hasTeamService",get:function(){var e;return!!(null===(e=this.core.V2NIMTeamService)||void 0===e?void 0:e.name)}},{key:"hasMessageService",get:function(){var e;return!!(null===(e=this.core.V2NIMMessageService)||void 0===e?void 0:e.name)}}]),t}(rf),Cv={"28_9":"v2ConversationGroupCreate","28_10":"v2ConversationGroupDelete","28_11":"v2ConversationGroupUpdate","28_12":"v2ConversationGroupGet","28_13":"v2ConversationGroupsGet","28_14":"v2ConversationGroupListGet","28_15":"v2ConversationGroupAddTo","28_16":"v2ConversationGroupRemoveFrom","28_22":"v2ConversationGroupNotifySyncOnline"},_v="V2NIMConversationGroupService",Ev={groupId:1,name:2,serverExtension:3,createTime:4,updateTime:5},wv={v2ConversationGroupCreate:{sid:28,cid:9,service:_v,params:[{type:"Property",name:"tag",reflectMapper:{conversationIds:1,name:2,serverExtension:3}}],response:[{type:"Property",name:"data",reflectMapper:mf(Ev)},{type:"PropertyArray",name:"conversations",reflectMapper:mf(dv)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGroupDelete:{sid:28,cid:10,service:_v,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1}}],response:[{type:"Property",name:"info",reflectMapper:{1:"type",2:"deleteVersion",3:"groupList"}}]},v2ConversationGroupUpdate:{sid:28,cid:11,service:_v,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1,name:2,serverExtension:3}}],response:[{type:"Property",name:"data",reflectMapper:mf(Ev)}]},v2ConversationGroupGet:{sid:28,cid:12,service:_v,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1}}],response:[{type:"Property",name:"data",reflectMapper:mf(Ev)}]},v2ConversationGroupsGet:{sid:28,cid:13,service:_v,params:[{type:"Property",name:"tag",reflectMapper:{groupIds:1}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:mf(Ev)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGroupListGet:{sid:28,cid:14,service:_v,response:[{type:"PropertyArray",name:"datas",reflectMapper:mf(Ev)}]},v2ConversationGroupAddTo:{sid:28,cid:15,service:_v,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1,conversationIds:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:mf(dv)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGroupRemoveFrom:{sid:28,cid:16,service:_v,params:[{type:"Property",name:"tag",reflectMapper:{groupId:1,conversationIds:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:mf(dv)},{type:"Property",name:"info",reflectMapper:{1:"failedMap"}}]},v2ConversationGroupNotifySyncOnline:{sid:28,cid:22,service:_v,response:[{type:"Property",name:"info",reflectMapper:{1:"type",2:"deleteVersion",3:"conversationIds"}},{type:"Property",name:"data",reflectMapper:mf(Ev)}]}},Rv=function(e){function t(t,r){var n;return void 0===r&&(r={}),(n=e.call(this,"V2NIMConversationGroupService",t)||this).config={},n.core._registerDep(bv,"V2NIMConversationService"),"v2"!==n.core.options.apiVersion?ut(n):(Mh({cmdMap:Cv,cmdConfig:wv}),n.setOptions(r),n)}nr(t,e);var r=t.prototype;return r.setOptions=function(e){this.config=dr(this.config,e)},r.emit=function(t){for(var r,n,i=this.name+"::emit "+t.toString(),o=arguments.length,a=new Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];if("onConversationsAddedToGroup"===t){var c=a[0],u=a[1];this.logger.log(""+i,"groupId:"+c,"conversations:"+du(u).call(u,(function(e){return e.conversationId})).join(","))}else{var d,l;(d=this.logger).log.apply(d,xs(l=[""+i]).call(l,a))}return(r=e.prototype.emit).call.apply(r,xs(n=[this,t]).call(n,a))},r.createConversationGroup=function(e,t,r){return zl(this,void 0,void 0,Ql.mark((function n(){var i,o,a,s,c,u=this;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Pl({name:{type:"string",allowEmpty:!1}},{name:e},"",!0),Pl({serverExtension:{type:"string",required:!1}},{serverExtension:t},"",!0),Pl({conversationIds:{type:"array",itemType:"string",required:!1}},{conversationIds:r},"",!0),n.next=6,this.core.sendCmd("v2ConversationGroupCreate",{tag:{name:e,serverExtension:t||"",conversationIds:r&&_i(r)}});case 6:return i=n.sent,o=yv(Zp(i,"content.data")),a=tv(this.core,Zp(i,"content.conversations")),s=Mv(Zp(i,"content.info.failedMap")),this.emit("onConversationGroupCreated",o),a.length>0&&(this.core.V2NIMConversationService.versionCache.compareAndUpdateModel(a),this.emit("onConversationsAddedToGroup",o.groupId,fu(c=du(a).call(a,(function(e){return u.core.V2NIMConversationService.model.getById(e.conversationId)}))).call(c,(function(e){return!!e})))),n.abrupt("return",{group:o,failedList:s});case 13:case"end":return n.stop()}}),n,this)})))},r.deleteConversationGroup=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Pl({groupId:{type:"string",allowEmpty:!1}},{groupId:e},"",!0),t.next=4,this.core.sendCmd("v2ConversationGroupDelete",{tag:{groupId:e}});case 4:r=t.sent,n=Tv(Zp(r,"content.info")),this.core.V2NIMConversationService.versionCache.compareAndDeleteGroupInModel(n.deleteVersion,e),this.emit("onConversationGroupDeleted",e);case 8:case"end":return t.stop()}}),t,this)})))},r.updateConversationGroup=function(e,t,r){return zl(this,void 0,void 0,Ql.mark((function n(){var i,o;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.checkV2(),Pl({groupId:{type:"string",allowEmpty:!1}},{groupId:e},"",!0),Pl({name:{type:"string",required:!1}},{name:t},"",!0),Pl({serverExtension:{type:"string",required:!1}},{serverExtension:r},"",!0),void 0!==t||void 0!==r){n.next=6;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER});case 6:return n.next=8,this.core.sendCmd("v2ConversationGroupUpdate",{tag:{groupId:e,name:t,serverExtension:r}});case 8:i=n.sent,o=yv(Zp(i,"content.data")),this.emit("onConversationGroupChanged",o);case 11:case"end":return n.stop()}}),n,this)})))},r.addConversationsToGroup=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o,a,s,c,u=this;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Pl({groupId:{type:"string",allowEmpty:!1}},{groupId:e},"",!0),Pl({conversationIds:{type:"array",itemType:"string",min:1,allowEmpty:!1}},{conversationIds:t},"",!0),r.next=5,this.core.sendCmd("v2ConversationGroupAddTo",{tag:{groupId:e,conversationIds:_i(t)}});case 5:return i=r.sent,o=Zp(i,"content.info.failedMap")||"",a=[],o&&(a=Mv(o)),s=tv(this.core,Zp(i,"content.datas")),this.core.V2NIMConversationService.versionCache.compareAndUpdateModel(s),(c=fu(n=du(s).call(s,(function(e){return u.core.V2NIMConversationService.model.getById(e.conversationId)}))).call(n,(function(e){return!!e}))).length>0&&this.emit("onConversationsAddedToGroup",e,c),r.abrupt("return",a);case 14:case"end":return r.stop()}}),r,this)})))},r.removeConversationsFromGroup=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o,a;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Pl({groupId:{type:"string",allowEmpty:!1}},{groupId:e},"",!0),Pl({conversationIds:{type:"array",itemType:"string",min:1,allowEmpty:!1}},{conversationIds:t},"",!0),r.next=5,this.core.sendCmd("v2ConversationGroupRemoveFrom",{tag:{groupId:e,conversationIds:_i(t)}});case 5:return n=r.sent,i=Zp(n,"content.info.failedMap")||"",o=[],i&&(o=Mv(i)),a=tv(this.core,Zp(n,"content.datas")),this.core.V2NIMConversationService.versionCache.compareAndUpdateModel(a),this.emit("onConversationsRemovedFromGroup",e,du(a).call(a,(function(e){return e.conversationId}))),r.abrupt("return",o);case 13:case"end":return r.stop()}}),r,this)})))},r.getConversationGroup=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Pl({groupId:{type:"string",allowEmpty:!1}},{groupId:e},"",!0),t.next=4,this.core.sendCmd("v2ConversationGroupGet",{tag:{groupId:e}});case 4:return r=t.sent,t.abrupt("return",yv(Zp(r,"content.data")));case 6:case"end":return t.stop()}}),t,this)})))},r.getConversationGroupList=function(){return zl(this,void 0,void 0,Ql.mark((function e(){var t;return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkV2(),e.next=3,this.core.sendCmd("v2ConversationGroupListGet");case 3:return t=e.sent,e.abrupt("return",vv(Zp(t,"content.datas")));case 5:case"end":return e.stop()}}),e,this)})))},r.getConversationGroupListByIds=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Pl({groupIds:{type:"array",itemType:"string",min:1}},{groupIds:e},"",!0),t.next=4,this.core.sendCmd("v2ConversationGroupsGet",{tag:{groupIds:e&&_i(e)}});case 4:return n=t.sent,i=vv(Zp(n,"content.datas")),t.abrupt("return",fu(r=du(e).call(e,(function(e){return fu(i).call(i,(function(t){return t.groupId===e}))[0]}))).call(r,(function(e){return!!e})));case 7:case"end":return t.stop()}}),t,this)})))},r.v2ConversationGroupNotifySyncOnlineHandler=function(e){var t,r=this,n=Tv(Zp(e,"content.info")),i=n.type,o=n.deleteVersion,a=n.conversationIds,s=yv(Zp(e,"content.data"));if(this.core.logger.log("v2ConversationGroupNotifySyncOnlineHandler",n,s),1===i)this.emit("onConversationGroupCreated",s),a&&a.length>0&&this.emit("onConversationsAddedToGroup",s.groupId,fu(t=du(a).call(a,(function(e){return r.core.V2NIMConversationService.model.getById(e)}))).call(t,(function(e){return!!e})));else if(2===i)this.emit("onConversationGroupDeleted",s.groupId),this.core.V2NIMConversationService.versionCache.compareAndDeleteGroupInModel(o,s.groupId);else if(3===i)this.emit("onConversationGroupChanged",s);else if(4===i){var c,u=fu(c=du(a).call(a,(function(e){return r.core.V2NIMConversationService.model.getById(e)}))).call(c,(function(e){return!!e}));this.emit("onConversationsAddedToGroup",s.groupId,u)}else 5===i&&this.emit("onConversationsRemovedFromGroup",s.groupId,a)},t}(rf),kv=function(){function e(){this.messages=new ad,this.maxSize=2e3}var t=e.prototype;return t.reset=function(){this.messages.clear()},t.getMessageById=function(e){if(e)return this.messages.get(e)},t.getMessagesByConversationId=function(e){var t,r=[];return jn(t=this.messages).call(t,(function(t){t.conversationId===e&&r.push(t)})),r},t.getLastMessageOfConversation=function(e){var t=this.getMessagesByConversationId(e);if(0!==t.length)return Ml(t).call(t,(function(e,t){return t.createTime>e.createTime?t:e}),t[0])},t.upsertMessages=function(e){var t,r,n,i=this;jn(e).call(e,(function(e){i.messages.set(e.messageClientId,e)}));var o=this.messages.size;if(!(o<=this.maxSize))for(var a=Vm(t=fu(r=Bl(Iu(n=this.messages).call(n))).call(r,(function(e){return 3!==e.sendingState}))).call(t,(function(e,t){return e.createTime-t.createTime})),s=o-this.maxSize>100?o-this.maxSize:100,c=0;c<s;c++){var u=a[c];u&&this.messages.delete(u.messageClientId)}},t.deleteMessage=function(e){this.messages.delete(e)},t.deleteMessages=function(e,t){var r,n=this;jn(r=this.messages).call(r,(function(r){e===r.conversationId&&(!t||t&&r.createTime<t)&&n.messages.delete(r.messageClientId)}))},e}(),Av={accountId:{type:"string",allowEmpty:!1},content:{type:"object",required:!1,rules:{msg:{type:"string",allowEmpty:!1},type:{type:"number",allowEmpty:!1}}},messages:{type:"array",required:!1,rules:{msg:{type:"string",allowEmpty:!1},type:{type:"number"},role:{type:"enum",values:["assistant","user","system"]}}},promptVariables:{type:"jsonstr",required:!1},modelConfigParams:{type:"object",required:!1,rules:{prompt:{type:"string",required:!1},maxTokens:{type:"number",required:!1},topP:{type:"number",required:!1},temperature:{type:"number",required:!1}}}},Nv=dr({requestId:{type:"string",allowEmpty:!1}},Av),xv=[1,3,2,0],Ov=[2,7,12,100,6,1,-1,4,5,11,0,10,3],Pv={routeEnabled:{type:"boolean",required:!1},routeEnvironment:{type:"string",required:!1}},Lv={pushEnabled:{type:"boolean",required:!1},pushNickEnabled:{type:"boolean",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},forcePush:{type:"boolean",required:!1},forceContent:{type:"string",required:!1},forcePushAccountIds:{type:"array",required:!1,itemType:"string"}},Vv={antispamEnabled:{type:"boolean",required:!1},antispamBusinessId:{type:"string",required:!1},antispamCustomMessage:{type:"string",required:!1},antispamCheating:{type:"string",required:!1},antispamExtension:{type:"string",required:!1}},Uv={messageConfig:{type:"object",required:!1,rules:{readReceiptEnabled:{type:"boolean",required:!1},lastMessageUpdateEnabled:{type:"boolean",required:!1},historyEnabled:{type:"boolean",required:!1},roamingEnabled:{type:"boolean",required:!1},onlineSyncEnabled:{type:"boolean",required:!1},offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1}}},routeConfig:{type:"object",required:!1,rules:Pv},pushConfig:{type:"object",required:!1,rules:Lv},antiSpamConfig:{type:"object",required:!1,rules:Vv},robotConfig:{type:"object",required:!1,rules:{accountId:{type:"string",required:!1},topic:{type:"string",required:!1},function:{type:"string",required:!1},customContent:{type:"string",required:!1}}},aiConfig:{type:"object",required:!1,rules:Av},targetConfig:{type:"object",required:!1,rules:{receiverIds:{type:"array",itemType:"string"},inclusive:{type:"boolean"},newMemberVisible:{type:"boolean",required:!1}}},clientAntispamEnabled:{type:"boolean",required:!1},clientAntispamReplace:{type:"string",required:!1}},Dv={message:{type:"object",rules:{text:{type:"string",required:!1},messageType:{type:"enum",values:Ov},messageClientId:{type:"string",allowEmpty:!1}}},params:{type:"object",rules:Uv,required:!1},replyMessage:{type:"object",rules:{conversationType:{type:"enum",values:[1,3,2,0]},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}}},qv={conversationId:{type:"string",allowEmpty:!1},message:{type:"object",rules:{text:{type:"string",required:!1},messageType:{type:"enum",values:Ov},messageClientId:{type:"string",allowEmpty:!1},attachment:{type:"object",required:!1,rules:{file:{type:"file",required:!1}}}}},params:{type:"object",required:!1,rules:Uv}},Bv={message:{type:"object",rules:{messageClientId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:xv},createTime:{type:"number"}}},params:{type:"object",rules:{postscript:{type:"string",required:!1},serverExtension:{type:"string",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},env:{type:"string",required:!1}},required:!1}},Fv={conversationId:{type:"string",allowEmpty:!1},messageTypes:{type:"array",required:!1,itemType:"enum",values:Ov},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},limit:{type:"number",min:1,required:!1},direction:{type:"enum",values:[1,0],required:!1},anchorMessage:{type:"object",required:!1,rules:{messageServerId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}}},Gv={conversationType:{type:"enum",values:xv},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1}},jv={messageRefers:{type:"array",required:!0,rules:Gv}},Hv={conversationId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:xv},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1},createTime:{type:"number"}},Wv={messages:{type:"array",rules:Hv}},Kv={conversationId:{type:"string",allowEmpty:!1},serverExtension:{type:"string",required:!1},onlineSync:{type:"boolean",required:!1},deleteRoam:{type:"boolean",required:!1}},Yv={serverExtension:{type:"string",required:!1}},Qv={messageClientId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:[1]},receiverId:{type:"string",allowEmpty:!1},createTime:{type:"number"}},Jv={messages:{type:"array",rules:{messageClientId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:[2]},receiverId:{type:"string",allowEmpty:!1},createTime:{type:"number"}},min:1}},zv={voiceUrl:{type:"string",required:!1,allowEmpty:!1},file:{type:"file",required:!1},voicePath:{type:"string",required:!1,allowEmpty:!1},mimeType:{type:"string",required:!1,allowEmpty:!1},sampleRate:{type:"string",required:!1,allowEmpty:!1},duration:{type:"number",required:!0,min:0},sceneName:{type:"string",required:!1}},Xv={message:{type:"object",rules:{conversationType:{type:"enum",values:xv},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}},index:{type:"number",min:1},serverExtension:{type:"string",required:!1},pushConfig:{type:"object",required:!1,rules:{pushEnabled:{type:"boolean",required:!1},needBadge:{type:"boolean",required:!1},title:{type:"string",required:!1,allowEmpty:!1},content:{type:"string",required:!1,allowEmpty:!1},pushPayload:{type:"string",required:!1,allowEmpty:!1}}}},$v={messages:{type:"array",rules:{conversationType:{type:"enum",values:[1,3,2,0]},receiverId:{type:"string",allowEmpty:!1},senderId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},messageClientId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}}},Zv={params:{type:"object",rules:{collectionType:{type:"number",min:1},collectionData:{type:"string",allowEmpty:!1},serverExtension:{type:"string",required:!1},uniqueId:{type:"string",required:!1}}}},ey={collections:{type:"array",min:1,rules:{collectionId:{type:"string",allowEmpty:!1},createTime:{type:"number"}}}},ty={serverExtension:{type:"string",required:!1},collection:{type:"object",rules:{collectionId:{type:"string",allowEmpty:!1},collectionType:{type:"number"},createTime:{type:"number"}}}},ry={beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},limit:{type:"number",min:1,required:!1},direction:{type:"enum",required:!1,values:[1,0]},collectionType:{type:"number",required:!1},anchorCollection:{type:"object",required:!1,rules:{collectionId:{type:"string",allowEmpty:!1,required:!1},createTime:{type:"number",required:!1}}}},ny={keyword:{type:"string",allowEmpty:!1},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},sortOrder:{type:"enum",values:[1,0],required:!1},conversationLimit:{type:"number",min:0,required:!1},messageLimit:{type:"number",min:1,required:!1},p2pAccountIds:{type:"array",required:!1,itemType:"string"},teamIds:{type:"array",required:!1,itemType:"string"},senderAccountIds:{type:"array",required:!1,itemType:"string"},messageTypes:{type:"array",required:!1,itemType:"enum",values:Ov},messageSubtypes:{type:"array",required:!1,itemType:"number"}},iy={message:{type:"object",rules:{receiverId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:[2]}}}},oy={messages:{type:"array",rules:{receiverId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1},conversationType:{type:"enum",values:[2]}},min:1}},ay={sceneName:{type:"string",required:!1},name:{type:"string",required:!1}},sy=dr(dr({},ay),{duration:{type:"number",required:!1}}),cy=dr(dr({},sy),{width:{type:"number",required:!1},height:{type:"number",required:!1}}),uy=dr(dr({},ay),{width:{type:"number",required:!1},height:{type:"number",required:!1}}),dy={messageRefer:{type:"object",required:!0,rules:Gv},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},limit:{type:"number",min:1,required:!1},direction:{type:"enum",values:[1,0],required:!1},excludeMessageServerId:{type:"string",required:!1,allowEmpty:!1}},ly={senderId:{type:"string",allowEmpty:!1},receiverId:{type:"string",allowEmpty:!1},createTime:{type:"number"},messageClientId:{type:"string",allowEmpty:!1},messageServerId:{type:"string",allowEmpty:!1}},py={subType:{type:"number",min:0,required:!1},text:{type:"string",required:!1},attachment:{type:"object",required:!1},serverExtension:{type:"string",required:!1},routeConfig:{type:"object",required:!1,rules:Pv},pushConfig:{type:"object",required:!1,rules:Lv},antiSpamConfig:{type:"object",required:!1,rules:Vv},clientAntispamEnabled:{type:"boolean",required:!1},clientAntispamReplace:{type:"string",required:!1}},hy=function(){function e(e,t){this.p2pMessageReceipts={},this.core=e,this.service=t}var t=e.prototype;return t.sendP2PMessageReceipt=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Pl(Qv,e,"",!0),e.senderId!==this.core.account){t.next=3;break}throw new wl({detail:{reason:"sendP2PMessageReceipt. sender: "+e.senderId+" is not allowed to send msg receipt"}});case 3:if(!(this.p2pMessageReceipts[e.conversationId]>e.createTime)){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,this.core.sendCmd("v2SendP2PMessageReceipt",{tag:{receiverId:e.senderId,messageClientId:e.messageClientId,createTime:e.createTime}});case 7:this.p2pMessageReceipts[e.conversationId]=e.createTime;case 8:case"end":return t.stop()}}),t,this)})))},t.isPeerRead=function(e){if(1!==e.conversationType)return!1;if(e.senderId!==this.core.account)return!1;if(e.senderId===this.core.account&&e.receiverId===this.core.account)return!0;var t=this.core.V2NIMConversationIdUtil.messageConversationId(e),r=this.p2pMessageReceipts[t]||0;return e.createTime<=r},t.getP2PMessageReceipt=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Vl(this.core.account,e),1===this.core.V2NIMConversationIdUtil.parseConversationType(e)){t.next=4;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getP2PMessageReceipt: conversationId is not p2p conversationId"}});case 4:return t.abrupt("return",{conversationId:e,timestamp:this.p2pMessageReceipts[e]||0});case 5:case"end":return t.stop()}}),t,this)})))},t.getTeamMessageReceipts=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Pl(oy,{messages:e},"",!0),!Gm(e).call(e,(function(e){return e.senderId!==i.core.account}))){t.next=3;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getTeamMessageReceipts: exist messages senderId is not current user"}});case 3:if(!Gm(e).call(e,(function(t){return t.receiverId!==e[0].receiverId}))){t.next=5;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getTeamMessageReceipts: exist messages receiverId is not same"}});case 5:return t.next=7,this.core.sendCmd("v2GetTeamMessageReceipts",{tag:e});case 7:return n=t.sent,t.abrupt("return",du(r=n.content.data).call(r,(function(e){return dr(dr({},e),{conversationId:i.core.V2NIMConversationIdUtil.teamConversationId(e.receiverId)})})));case 9:case"end":return t.stop()}}),t,this)})))},t.getTeamMessageReceiptDetail=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Pl(iy,{message:e},"",!0),e.senderId===this.core.account){t.next=3;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getTeamMessageReceiptDetail::senderId "+e.senderId+" incorrect"}});case 3:return t.next=5,this.core.sendCmd("v2GetTeamMessageReceiptDetail",{tag:e});case 5:return r=t.sent,t.abrupt("return",{readReceipt:{conversationId:this.core.V2NIMConversationIdUtil.teamConversationId(e.receiverId),messageClientId:e.messageClientId,messageServerId:e.messageServerId,readCount:r.content.readAccountList.length,unreadCount:r.content.unreadAccountList.length},readAccountList:r.content.readAccountList,unreadAccountList:r.content.unreadAccountList});case 7:case"end":return t.stop()}}),t,this)})))},t.sendTeamMessageReceipts=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Gm(e).call(e,(function(t){return t.conversationId!==e[0].conversationId}))){t.next=2;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getTeamMessageReceipts: conversationId not same"}});case 2:if(Pl(Jv,{messages:e},"",!0),!Gm(e).call(e,(function(e){return e.senderId===r.core.account}))){t.next=5;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getTeamMessageReceipts: exist messages senderId is not current user"}});case 5:return t.next=7,this.core.sendCmd("v2SendTeamMessageReceipts",{tag:e});case 7:return t.abrupt("return");case 8:case"end":return t.stop()}}),t,this)})))},t.syncP2PMessagReceiptsHandler=function(e){var t,r=this,n=du(t=e.content.data).call(t,(function(e){var t=r.core.V2NIMConversationIdUtil.p2pConversationId(e.senderId),n=e.createTime;return r.p2pMessageReceipts[t]=n,{conversationId:t,timestamp:n}}));this.service.emit("onReceiveP2PMessageReadReceipts",n)},t.onP2PMessageReceiptsHandler=function(e){var t=this.core.V2NIMConversationIdUtil.p2pConversationId(e.content.data.senderId),r=e.content.data.createTime;this.p2pMessageReceipts[t]=r,this.service.emit("onReceiveP2PMessageReadReceipts",[{conversationId:t,timestamp:r}])},t.onTeamMessageReceiptsHandler=function(e){var t,r=this,n=du(t=e.content.data).call(t,(function(e){return{conversationId:r.core.V2NIMConversationIdUtil.teamConversationId(e.receiverId),messageServerId:e.messageServerId,messageClientId:e.messageClientId,readCount:e.readCount,unreadCount:e.unreadCount,latestReadAccount:e.latestReadAccount}}));this.service.emit("onReceiveTeamMessageReadReceipts",n)},e}(),fy=function(){function e(e){this.core=e}var t=e.prototype;return t.doSendFile=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o,a,s,c,u,d;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.attachment,r.prev=1,r.next=4,this.core.V2NIMStorageService._uploadFile({taskId:e.messageClientId,uploadParams:{fileObj:(null==n?void 0:n.file)||(null==n?void 0:n.path),sceneName:null==n?void 0:n.sceneName}},t,{fileType:e.messageType});case 4:for(u in(o=r.sent)[0],a=o[1],s=dr(dr({},n),{uploadState:1}),void 0!==a.w&&(s.width=s.width||a.w),void 0!==a.h&&(s.height=s.height||a.h),void 0!==a.dur&&(s.duration=s.duration||a.dur),s.ext=s.ext&&-1===wu(i=s.ext).call(i,".")?"."+s.ext:s.ext,c=["w","h","dur","ext","name"],a)ou(c).call(c,u)||(s[u]=a[u]);s.raw,s.file,s.path,d=Jl(s,["raw","file","path"]),e.attachment=JSON.parse(_i(d)),e.attachment&&(e.attachment.raw=Bg(e.messageType,e.attachment)),r.next=23;break;case 19:throw r.prev=19,r.t0=r.catch(1),e.attachment&&(e.attachment.uploadState=2),r.t0;case 23:case"end":return r.stop()}}),r,this,[[1,19]])})))},t.cancelMessageAttachmentUpload=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Pl({messageClientId:{type:"string",allowEmpty:!1}},e,"",!0),ou(r=[2,6,1,3]).call(r,e.messageType)){t.next=3;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"cancelMessageAttachmentUpload: messageType "+e.messageType+" incorrect"}});case 3:if(2!==e.sendingState&&1!==e.sendingState){t.next=5;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST,detail:{reason:"cancelMessageAttachmentUpload: message is already failed or succeeded"}});case 5:return t.next=7,this.core.V2NIMStorageService._cancelUploadFile(e.messageClientId);case 7:case"end":return t.stop()}}),t,this)})))},e}(),gy="V2NIMNotificationService",vy={"30_7":"v2SendCustomNotification","32_16":"v2SendCustomNotificationWithSuperTeam","7_3":"onSysNotification","21_19":"onSysNotification","4_6":"v2SyncOfflineSysNotifications","4_18":"v2SyncOfflineSysNotifications","7_14":"v2NotificationRevoke","21_18":"v2NotificationRevoke","21_117":"v2NotificationRevoke","4_19":"v2NotificationSyncRevoke","7_15":"v2NotificationSyncRevoke","4_16":"syncBroadcastMsg","7_17":"onBroadcastMsg"},yy={timestamp:{id:0,retType:"number"},type:{id:1,retType:"number"},receiverId:2,senderId:3,postscript:4,content:5,idServer:6,offlineEnabled:{id:7,converter:Th,retConverter:function(e,t){return"0"!==t[6]&&!!$p(e)},access:"notificationConfig.offlineEnabled"},pushContent:{id:8,access:"pushConfig.pushContent"},pushPayload:{id:9,access:"pushConfig.pushPayload"},deletedIdClient:10,deletedIdServer:11,antispamEnabled:{id:12,converter:Th,retType:"boolean",access:"antispamConfig.antispamEnabled"},antispamCustomNotification:{id:13,access:"antispamConfig.antispamCustomNotification"},deletedMsgCreateTime:14,deletedMsgFromNick:15,opeAccount:16,forcePushAccountIds:{id:18,access:"pushConfig.forcePushAccountIds",def:function(e){if(101===e.type&&e["pushConfig.forcePush"])return"#%@all@%#"},converter:function(e,t){if(t["pushConfig.forcePush"])return e?_i(e):"#%@all@%#"}},forcePushContent:{id:19,access:"pushConfig.forcePushContent"},forcePush:{id:20,converter:Th,retType:"boolean",access:"pushConfig.forcePush"},routeEnvironment:{id:21,access:"routeConfig.routeEnvironment"},callbackExt:22,clientNotificationId:{id:23,access:"notificationConfig.clientNotificationId"},conversationOnlineSyncNotify:24,conversationOnlineSyncData:25,routeEnabled:{id:105,converter:Th,retType:"boolean",access:"routeConfig.routeEnabled"},pushEnabled:{id:107,converter:Th,retType:"boolean",access:"pushConfig.pushEnabled"},unreadEnabled:{id:109,converter:Th,retType:"boolean",access:"notificationConfig.unreadEnabled"},pushNickEnabled:{id:110,converter:Th,retType:"boolean",access:"pushConfig.pushNickEnabled"}},My={id:1,senderId:2,timestamp:{id:4,retType:"number"},content:5},Iy={v2SendCustomNotification:{sid:30,cid:7,service:gy,params:[{type:"Property",name:"tag",reflectMapper:yy}]},v2SendCustomNotificationWithSuperTeam:{sid:32,cid:16,service:gy,params:[{type:"Property",name:"tag",reflectMapper:yy}]},onSysNotification:{sid:7,cid:3,service:gy,response:[{type:"Property",name:"data",reflectMapper:Sh(yy)}]},syncBroadcastMsg:{sid:4,cid:16,service:gy,response:[{type:"PropertyArray",name:"datas",reflectMapper:Sh(My)}]},onBroadcastMsg:{sid:7,cid:17,service:gy,response:[{type:"Property",name:"data",reflectMapper:Sh(My)}]},v2SyncOfflineSysNotifications:{sid:4,cid:9,service:gy,response:[{type:"PropertyArray",name:"datas",reflectMapper:Sh(yy)}]},v2NotificationRevoke:{sid:7,cid:14,service:gy,response:[{type:"Property",name:"data",reflectMapper:Sh(yy)}]},v2NotificationSyncRevoke:{sid:7,cid:15,service:gy,response:[{type:"PropertyArray",name:"datas",reflectMapper:Sh(yy)},{type:"Long",name:"timetag"},{type:"Byte",name:"type"}]}},Sy="YSFService",Ty={"4_5":"ysfBatchMarkRead","101_1":"ysfSendMessage","101_2":"ysfOnMsg","4_100":"ysfSyncOfflineMsgs","101_3":"ysfOnSysNotification","101_7":"ysfSendCustomNotification","4_101":"ysfSyncSysNotification"},by={ysfBatchMarkRead:{sid:4,cid:5,service:Sy,hasPacketResponse:!1,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]},ysfSendMessage:{sid:101,cid:1,service:Sy,params:[{type:"Property",name:"tag",reflectMapper:Hg}],response:[{type:"Property",name:"data",reflectMapper:Sh(Hg)}]},ysfOnMsg:{sid:101,cid:2,service:Sy,response:[{type:"Property",name:"data",reflectMapper:Sh(Hg)}]},ysfSyncOfflineMsgs:{sid:4,cid:100,service:Sy,response:[{type:"PropertyArray",name:"datas",reflectMapper:Sh(Hg)}]},ysfOnSysNotification:{sid:101,cid:3,service:Sy,response:[{type:"Property",name:"data",reflectMapper:Sh(yy)}]},ysfSendCustomNotification:{sid:101,cid:7,service:Sy,params:[{type:"Property",name:"tag",reflectMapper:yy}]},ysfSyncSysNotification:{sid:4,cid:101,service:Sy,response:[{type:"PropertyArray",name:"datas",reflectMapper:Sh(yy)}]}},Cy={content:{type:"string",allowEmpty:!1},params:{type:"object",required:!1,rules:{notificationConfig:{type:"object",required:!1,rules:{offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1}}},pushConfig:{type:"object",required:!1,rules:{pushEnabled:{type:"boolean",required:!1},pushNickEnabled:{type:"boolean",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},forcePush:{type:"boolean",required:!1},forcePushContent:{type:"string",required:!1},forcePushAccounts:{type:"array",required:!1,itemType:"string"}}},antispamConfig:{type:"object",required:!1,rules:{antispamEnabled:{type:"boolean",required:!1},antispamCustomNotification:{type:"string",required:!1}}},routeConfig:{type:"object",required:!1,rules:{routeEnabled:{type:"boolean",required:!1},routeEnvironment:{type:"string",required:!1}}}}}},_y=function(){function e(e){this.core=e}return e.prototype.generateNotificationTag=function(e,t,r){var n;void 0===r&&(r={});var i=this.core.V2NIMConversationIdUtil.parseConversationType(e),o=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e),a=_s(),s=((n={})[1]=100,n[2]=101,n[3]=103,n);return dr(dr({},r),{notificationConfig:dr({unreadEnabled:!0,offlineEnabled:!0},null==r?void 0:r.notificationConfig),pushConfig:dr({pushEnabled:!0,pushNickEnabled:!0},null==r?void 0:r.pushConfig),antispamConfig:dr({antispamEnabled:!0},null==r?void 0:r.antispamConfig),routeConfig:dr({routeEnabled:!0},null==r?void 0:r.routeConfig),timestamp:a,type:s[i],receiverId:o,content:t})},e}();function Ey(e){var t="object"==typeof e?e:void 0,r="string"==typeof e?e:void 0;if(!t&&!r)throw new _l({code:Tl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getFileOrPath::incorrect file and path"}});if("string"==typeof r)if(0===wu(r).call(r,"nim-external")){var n=document.getElementById(r);if(!(n&&n.files&&n.files[0]))throw new _l({code:Tl.V2NIM_ERROR_CODE_FILE_NOT_FOUND,detail:{reason:"getFileOrPath::file not exist: "+r}});t=n.files[0]}else if("BROWSER"===Zl.platform)throw new _l({code:Tl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getFileOrPath::incorrect path: "+r}});if("object"==typeof t&&void 0===t.size)throw new _l({code:Tl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"getFileOrPath::file no size"}});return{file:t,path:r}}var wy,Ry,ky={attachment:{type:"object",rules:{url:{type:"string",allowEmpty:!1}}},thumbSize:{type:"object",rules:{width:{type:"number",required:!1,min:0},height:{type:"number",required:!1,min:0}}}},Ay=function(e){function t(t){var r;return(r=e.call(this,"V2NIMStorageUtil",t)||this).core=t,r}nr(t,e);var r=t.prototype;return r.imageThumbUrl=function(e,t){return e+"?imageView&thumbnail="+t+"z"+t},r.videoCoverUrl=function(e,t){return e+"?vframe&offset="+t},r.getImageThumbUrl=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n,i;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Pl(ky,{attachment:n=e,thumbSize:t},"",!0),t.width=t.width||0,t.height=t.height||0,0===t.width&&0===t.height&&(t.width=150),i=n.url,r.prev=7,r.next=10,this.core.V2NIMStorageService.shortUrlToLong(n.url);case 10:i=r.sent,r.next=16;break;case 13:r.prev=13,r.t0=r.catch(7),this.core.logger.warn("shortUrlToLong error:",r.t0);case 16:return r.abrupt("return",{url:this.core.cloudStorage.getThumbUrl(i,t)});case 17:case"end":return r.stop()}}),r,this,[[7,13]])})))},r.getVideoCoverUrl=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n,i;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Pl(ky,{attachment:n=e,thumbSize:t},"",!0),t.width=t.width||0,t.height=t.height||0,0===t.width&&0===t.height&&(t.width=150),i=n.url,r.prev=7,r.next=10,this.core.V2NIMStorageService.shortUrlToLong(n.url);case 10:i=r.sent,r.next=16;break;case 13:r.prev=13,r.t0=r.catch(7),this.core.logger.warn("shortUrlToLong error:",r.t0);case 16:return r.abrupt("return",{url:this.core.cloudStorage.getVideoCoverUrl(i,t)});case 17:case"end":return r.stop()}}),r,this,[[7,13]])})))},t}(rf),Ny={file:{md5:"$(Etag)",size:"$(ObjectSize)"},image:{md5:"$(Etag)",size:"$(ObjectSize)",w:"$(ImageInfo.Width)",h:"$(ImageInfo.Height)",orientation:"$(ImageInfo.Orientation)"},audio:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Audio.Duration)"},video:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Video.Duration)",w:"$(AVinfo.Video.Width)",h:"$(AVinfo.Video.Height)"}},xy={accessKeyId:"",secretAccessKey:"",sessionToken:"",region:"",maxRetries:0,bucket:"",objectName:"",token:"",shortUrl:""};function Oy(e){return void 0===e&&(e="file"),_i(Ny[e]||{}).replace(/"/gi,'\\"')}!function(e){e[e.nos=1]="nos",e[e.s3=2]="s3"}(wy||(wy={})),function(e){e[e.dontNeed=-1]="dontNeed",e[e.time=2]="time",e[e.urls=3]="urls"}(Ry||(Ry={}));var Py={chunkUploadHost:"https://wannos-web.127.net",chunkUploadHostBackupList:["https://fileup.chatnos.com","https://oss.chatnos.com"],commonUploadHost:"https://fileup.chatnos.com",commonUploadHostBackupList:["https://oss.chatnos.com"],chunkMaxSize:4194304e4,commonMaxSize:104857600,uploadReplaceFormat:"https://{host}/{object}",cdn:{defaultCdnDomain:"nim-nosdn.netease.im",cdnDomain:"",bucket:"",objectNamePrefix:""},downloadUrl:"https://{bucket}-nosdn.netease.im/{object}",downloadHostList:["nos.netease.com"],nosCdnEnable:!0,isNeedToGetUploadPolicyFromServer:!0};function Ly(e,t){e=e||{},t=t||function(){return!0};var r={};for(var n in e)t(e[n])&&(r[n]=e[n]);return r}var Vy=function(){function e(e,t){this.nosCdnHostTimer=0,this.nosErrorCount=0,this.core=e,this.cloudStorage=t}var t=e.prototype;return t.reset=function(){this.nosErrorCount=0},t.getNosAccessToken=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("getNosAccessToken",{tag:e});case 2:return r=t.sent,n=Zp(r,"content.nosAccessTokenTag.token"),i=e.url,t.abrupt("return",{token:n,url:-1!==wu(i).call(i,"?")?i+"&token="+n:i+"?token="+n});case 6:case"end":return t.stop()}}),t,this)})))},t.deleteNosAccessToken=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("deleteNosAccessToken",{tag:e});case 2:case"end":return t.stop()}}),t,this)})))},t.nosUpload=function(e,t){var r,n,i,o,a,s,c,u;return zl(this,void 0,void 0,Ql.mark((function d(){var l,p,m,h,f,g,v,y,M,I,S,T,b,C,_,E,w,R;return Ql.wrap((function(d){for(;;)switch(d.prev=d.next){case 0:if(l=Zp(this.core,"config.cdn.bucket"),p={tag:e.nosScenes||l||"nim"},e.nosSurvivalTime&&(p.expireSec=e.nosSurvivalTime),m=this.core.adapters.getFileUploadInformation(e),t||m){d.next=18;break}return d.prev=6,d.next=9,this.core.sendCmd("getNosToken",{responseBody:Oy(e.type),nosToken:p});case 9:h=d.sent,d.next=18;break;case 12:if(d.prev=12,d.t0=d.catch(6),this.core.logger.error("uploadFile:: getNosToken error",d.t0),!(d.t0 instanceof _l)){d.next=17;break}throw d.t0;case 17:throw new kl({code:"v2"===Zp(this.core,"options.apiVersion")?Tl.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"getNosToken error",rawError:d.t0,curProvider:1}});case 18:return f=this.config.uploadReplaceFormat.replace("{host}",this.config.cdn.cdnDomain||this.config.cdn.defaultCdnDomain).replace("{object}",m?null===(r=m.uploadInfo)||void 0===r?void 0:r.objectName:t?null==t?void 0:t.objectName:h.content.nosToken.objectName),g="",t&&t.shortUrl&&(g=t.shortUrl),(null===(o=null===(i=null===(n=null==m?void 0:m.uploadInfo)||void 0===n?void 0:n.payload)||void 0===i?void 0:i.mixStoreToken)||void 0===o?void 0:o.shortUrl)&&(g=m.uploadInfo.payload.mixStoreToken.shortUrl),v=g||f,d.prev=23,M=m?{token:null===(a=null==m?void 0:m.uploadInfo)||void 0===a?void 0:a.token,bucket:null===(s=null==m?void 0:m.uploadInfo)||void 0===s?void 0:s.bucketName,objectName:null===(c=null==m?void 0:m.uploadInfo)||void 0===c?void 0:c.objectName}:t||h.content.nosToken,this.core.logger.log("uploadFile:: uploadFile params",{nosToken:M,chunkUploadHost:this.config.chunkUploadHost,chunkUploadHostBackupList:this.config.chunkUploadHostBackupList,commonUploadHost:this.config.commonUploadHost,commonUploadHostBackupList:this.config.commonUploadHostBackupList,platform:Zl.platform}),I="BROWSER"===Zl.platform?this.config.chunkUploadHost:this.config.commonUploadHost+"/"+(M&&M.bucket),this.core.reporterHookCloudStorage.update({remote_addr:I,operation_type:t?2:0}),d.next=30,this.core.adapters.uploadFile(dr(dr(dr({},e),{nosToken:M,chunkUploadHost:this.config.chunkUploadHost,chunkUploadHostBackupList:this.config.chunkUploadHostBackupList,commonUploadHost:this.config.commonUploadHost,commonUploadHostBackupList:this.config.commonUploadHostBackupList,maxSize:e.maxSize||this.config.chunkMaxSize}),t?{payload:{mixStoreToken:t}}:{}));case 30:y=d.sent,d.next=65;break;case 33:if(d.prev=33,d.t1=d.catch(23),this.core.logger.error("uploadFile::nos uploadFile error:",d.t1),S="v2"===Zp(this.core,"options.apiVersion"),d.t1.code!==Tl.V2NIM_ERROR_CODE_CANCELLED&&10499!==d.t1.errCode){d.next=39;break}throw new kl({code:S?Tl.V2NIM_ERROR_CODE_CANCELLED:400,detail:{reason:Zp(d.t1,"message")||"Request abort",rawError:d.t1,curProvider:1}});case 39:if(!S||d.t1.errCode!==Tl.V2NIM_ERROR_CODE_FILE_OPEN_FAILED){d.next=41;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_FILE_OPEN_FAILED,detail:{reason:Zp(d.t1,"message")||"Read file failed",rawError:d.t1,curProvider:1}});case 41:return d.next=43,Zl.net.getNetworkStatus();case 43:if(!1!==d.sent.net_connect){d.next=47;break}throw new kl({code:"v2"===Zp(this.core,"options.apiVersion")?Tl.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"No network",rawError:d.t1,curProvider:1}});case 47:if(!t){d.next=64;break}if(!(this.nosErrorCount<=0)){d.next=60;break}d.prev=49,this.cloudStorage.mixStorage._addCircuitTimer(),d.next=56;break;case 53:throw d.prev=53,d.t2=d.catch(49),new kl({code:"v2"===Zp(this.core,"options.apiVersion")?Tl.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"All upload attempts failed",rawError:d.t2,curProvider:this.cloudStorage.mixStorage.curProvider,mixStorePolicy:this.cloudStorage.mixStorage.mixStorePolicy,file:e.file||e.filePath}});case 56:return this.nosErrorCount=Zp(this.cloudStorage,"mixStorePolicy.nosPolicy.uploadConfig.retryPolicy.retry"),d.abrupt("return",this.cloudStorage._uploadFile(e));case 60:return this.nosErrorCount--,d.abrupt("return",this.nosUpload(e,t));case 62:d.next=65;break;case 64:throw new kl({code:"v2"===Zp(this.core,"options.apiVersion")?Tl.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"NOS attempts failed",rawError:d.t1,curProvider:1}});case 65:if(T=null==y?void 0:y.type,(b=T&&wu(T).call(T,"/")>-1?Wc(T).call(T,0,wu(T).call(T,"/")):"")||(b=e.type||""),(C={image:"imageInfo",video:"vinfo",audio:"vinfo"})[b]){d.next=71;break}return d.abrupt("return",dr({url:v},y));case 71:return d.prev=71,d.next=74,this.core.adapters.request(f+"?"+C[b],{method:"GET",dataType:"json",timeout:5e3},{exception_service:3});case 74:_=d.sent,d.next=81;break;case 77:return d.prev=77,d.t3=d.catch(71),this.core.logger.error("uploadFile:: fetch file info error",d.t3),d.abrupt("return",dr({url:v},y));case 81:if(!_){d.next=88;break}return E=_.data,w="imageInfo"===C[b]?E:null===(u=null==E?void 0:E.GetVideoInfo)||void 0===u?void 0:u.VideoInfo,R={url:v,name:y.name,size:y.size,ext:y.ext,w:null==w?void 0:w.Width,h:null==w?void 0:w.Height,orientation:null==w?void 0:w.Orientation,dur:null==w?void 0:w.Duration,audioCodec:null==w?void 0:w.AudioCodec,videoCodec:null==w?void 0:w.VideoCodec,container:null==w?void 0:w.Container},d.abrupt("return",Ly(R,(function(e){return void 0!==e})));case 88:return d.abrupt("return",dr({url:v},y));case 89:case"end":return d.stop()}}),d,this,[[6,12],[23,33],[49,53],[71,77]])})))},t._getNosCdnHost=function(){var e;return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.core.sendCmd("getNosCdnHost");case 3:r=t.sent,t.next=10;break;case 6:return t.prev=6,t.t0=t.catch(0),this.core.logger.error("getNosCdnHost::error",t.t0),t.abrupt("return");case 10:if(r){t.next=12;break}return t.abrupt("return");case 12:n=null===(e=null==r?void 0:r.content)||void 0===e?void 0:e.nosConfigTag,0!==(i=$p(null==n?void 0:n.expire))&&n.cdnDomain?-1===i?(this.config.cdn.bucket=n.bucket,this.config.cdn.cdnDomain=n.cdnDomain,this.config.cdn.objectNamePrefix=n.objectNamePrefix):(this.config.cdn.bucket=n.bucket,this.config.cdn.cdnDomain=n.cdnDomain,this.config.cdn.objectNamePrefix=n.objectNamePrefix,this.nosCdnHostTimer=this.core.timerManager.addTimer((function(){o._getNosCdnHost()}),1e3*i)):(this.config.cdn.bucket="",this.config.cdn.cdnDomain="",this.config.cdn.objectNamePrefix="");case 15:case"end":return t.stop()}}),t,this,[[0,6]])})))},ct(e,[{key:"config",get:function(){return this.cloudStorage.config}}]),e}(),Uy={"6_2":"getNosToken","6_22":"getOriginUrl","6_24":"getNosAccessToken","6_25":"deleteNosAccessToken","6_26":"getNosCdnHost","6_27":"getGrayscaleConfig","6_28":"getMixStorePolicy","6_29":"getMixStoreToken","6_30":"getFileAuthToken"},Dy={nosToken:{objectName:1,token:2,bucket:3,expireTime:4,expireSec:7,tag:8,shortUrl:9},mixStoreTokenReqTag:{provider:0,tokenCount:1,nosSurvivalTime:2,tag:3,returnBody:4,policyVersion:5},nosConfigTag:{bucket:1,cdnDomain:2,expire:3,objectNamePrefix:4},grayConfigTag:{config:0,ttl:1},mixStorePolicyTag:{providers:0,ttl:1,mixEnable:2,nosPolicy:3,s3Policy:4,policyVersion:5},mixStoreTokenResTag:{provider:0,accessKeyId:1,secretAccessKey:2,sessionToken:3,token:4,expireTime:5,bucket:6,objectName:7,fileExpireSec:8,tag:9,shortUrl:10,region:11},nosSafeUrlTag:{safeUrl:0,originUrl:1},mixStoreAuthTokenReqTag:{type:1,urls:2},mixStoreAuthTokenResTag:{type:1,tokens:2,token:3,ttl:4},nosAccessTokenTag:{token:0,url:1,userAgent:2,ext:3}},qy={getNosToken:{sid:6,cid:2,service:"cloudStorage",params:[{type:"String",name:"responseBody"},{type:"Property",name:"nosToken",entity:"nosToken",reflectMapper:Dy.nosToken}],response:[{type:"Property",name:"nosToken",reflectMapper:mf(Dy.nosToken)}]},getOriginUrl:{sid:6,cid:22,service:"cloudStorage",params:[{type:"Property",name:"nosSafeUrlTag",reflectMapper:Dy.nosSafeUrlTag}],response:[{type:"Property",name:"nosSafeUrlTag",reflectMapper:mf(Dy.nosSafeUrlTag)}]},getNosCdnHost:{sid:6,cid:26,service:"cloudStorage",response:[{type:"Property",name:"nosConfigTag",reflectMapper:mf(Dy.nosConfigTag)}]},getGrayscaleConfig:{sid:6,cid:27,service:"cloudStorage",params:[{type:"Property",name:"config"}],response:[{type:"Property",name:"grayConfigTag",reflectMapper:mf(Dy.grayConfigTag)}]},getMixStorePolicy:{sid:6,cid:28,service:"cloudStorage",params:[{type:"LongArray",name:"supportType"}],response:[{type:"Property",name:"mixStorePolicyTag",reflectMapper:mf(Dy.mixStorePolicyTag)}]},getMixStoreToken:{sid:6,cid:29,service:"cloudStorage",params:[{type:"Property",name:"mixStoreTokenReqTag",reflectMapper:Dy.mixStoreTokenReqTag}],response:[{type:"Property",name:"mixStoreTokenResTag",reflectMapper:mf(Dy.mixStoreTokenResTag)}]},getFileAuthToken:{sid:6,cid:30,service:"cloudStorage",params:[{type:"Property",name:"mixStoreAuthTokenReqTag",reflectMapper:Dy.mixStoreAuthTokenReqTag}],response:[{type:"Property",name:"mixStoreAuthTokenResTag",reflectMapper:mf(Dy.mixStoreAuthTokenResTag)}]},getNosAccessToken:{sid:6,cid:24,service:"cloudStorage",params:[{type:"Property",name:"tag",reflectMapper:Dy.nosAccessTokenTag}],response:[{type:"Property",name:"tag",reflectMapper:mf(Dy.nosAccessTokenTag)}]},deleteNosAccessToken:{sid:6,cid:25,service:"cloudStorage",params:[{type:"Property",name:"tag",reflectMapper:Dy.nosAccessTokenTag}]}},By=function(){function e(e,t){this.GRAYKEY="AllGrayscaleConfig",this.MIXSTOREKEY="AllMixStorePolicy",this.grayConfig={mixStoreEnable:!1,timeStamp:0,ttl:0},this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null,policyVersion:void 0},this.curProvider=1,this.mixStoreErrorCount=10,this.circuitTimer=0,this.core=e,this.cloudStorage=t,this.logger=e.logger}var t=e.prototype;return t.reset=function(){this.grayConfig=null,this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null,policyVersion:void 0},this.curProvider=1,this.mixStoreErrorCount=10},t.getGrayscaleConfig=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){var n,i;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(Zl.localStorage)try{Zl.localStorage.getItem&&Zl.localStorage.getItem(this.GRAYKEY)&&(this.grayConfig=JSON.parse(Zl.localStorage.getItem(this.GRAYKEY))[e])}catch(e){Zl.localStorage.getItem(this.GRAYKEY)&&this.core.logger.error("uploadFile:: JSON.parse grayscaleConfig error ",e)}if(this.grayConfig&&!(this.grayConfig.timeStamp+1e3*this.grayConfig.ttl<(new Date).getTime())){r.next=17;break}return r.next=4,this.core.sendCmd("getGrayscaleConfig",{config:{}});case 4:if(!(n=r.sent).content||!n.content.grayConfigTag){r.next=16;break}this.logger.log("uploadFile::getAppGrayConfigRequest success ");try{this.grayConfig=JSON.parse(n.content.grayConfigTag.config),this.grayConfig.ttl=JSON.parse(n.content.grayConfigTag.ttl)}catch(e){this.logger.error("getGrayscaleConfig error",e)}if(this.grayConfig){r.next=10;break}return r.abrupt("return");case 10:i=Zl.localStorage.getItem(this.GRAYKEY)?JSON.parse(Zl.localStorage.getItem(this.GRAYKEY)):{},this.grayConfig.timeStamp=(new Date).getTime(),i[e]=this.grayConfig,Zl.localStorage.setItem(this.GRAYKEY,_i(i)),r.next=17;break;case 16:this.logger.log("uploadFile:: result grayConfig:",n.content);case 17:if(!(null===(t=this.grayConfig)||void 0===t?void 0:t.mixStoreEnable)){r.next=20;break}return r.next=20,this._getMixStorePolicy(e);case 20:case"end":return r.stop()}}),r,this)})))},t._getMixStorePolicy=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a,s,c;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=(new Date).getTime(),Zl.localStorage)try{this.mixStorePolicy=JSON.parse(Zl.localStorage.getItem(this.MIXSTOREKEY))[e],this.curProvider=$p(this.mixStorePolicy.providers[0]),this.mixStorePolicy.timeStamp&&this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl>r&&(i=this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl-r,this.core.timerManager.addTimer(tr(n=this._getMixStorePolicy).call(n,this,e),i))}catch(t){Zl.localStorage.getItem(this.MIXSTOREKEY)&&JSON.parse(Zl.localStorage.getItem(this.MIXSTOREKEY))[e]&&this.core.logger.error("uploadFile:: JSON.parse mixStorePolicy error ",t)}if(this.mixStorePolicy&&!(this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl<=r)){t.next=31;break}return t.prev=3,t.next=6,this.core.sendCmd("getMixStorePolicy",{supportType:this.cloudStorage.aws.s3?[1,2]:[1]});case 6:a=t.sent,s=a.content.mixStorePolicyTag,this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null,policyVersion:void 0},this.mixStorePolicy.policyVersion=s.policyVersion,this.mixStorePolicy.ttl=Number(s.ttl),this.mixStorePolicy.providers=s.providers.split(","),this.circuitTimer&&this.core.timerManager.deleteTimer(this.circuitTimer),this.curProvider=$p(this.mixStorePolicy.providers[0]),this.mixStorePolicy.nosPolicy=s.nosPolicy?JSON.parse(s.nosPolicy):null,this.mixStorePolicy.s3Policy=s.s3Policy?JSON.parse(s.s3Policy):null,null===this.mixStorePolicy.s3Policy?this.mixStorePolicy.providers=["1"]:null===this.mixStorePolicy.nosPolicy?this.mixStorePolicy.providers=["2"]:this.mixStorePolicy.providers=this.mixStorePolicy.s3Policy.priority<this.mixStorePolicy.nosPolicy.priority?["2","1"]:["1","2"],this.core.timerManager.addTimer(tr(o=this._getMixStorePolicy).call(o,this,e),1e3*this.mixStorePolicy.ttl),c=Zl.localStorage.getItem(this.MIXSTOREKEY)?JSON.parse(Zl.localStorage.getItem(this.MIXSTOREKEY)):{},this.mixStorePolicy.timeStamp=(new Date).getTime(),c[e]=this.mixStorePolicy,Zl.localStorage.setItem(this.MIXSTOREKEY,_i(c)),t.next=31;break;case 24:if(t.prev=24,t.t0=t.catch(3),this.logger.error("getMixStorePolicy error",t.t0),0!==this.mixStoreErrorCount){t.next=29;break}throw new Error("getMixStorePolicy all count error");case 29:this._getMixStorePolicy(e),this.mixStoreErrorCount--;case 31:this.mixStorePolicy.nosPolicy&&(this.cloudStorage.nos.nosErrorCount=this.mixStorePolicy.nosPolicy.uploadConfig.retryPolicy.retry);case 32:case"end":return t.stop()}}),t,this,[[3,24]])})))},t._addCircuitTimer=function(){var e=this,t=this.mixStorePolicy.providers,r=t[(wu(t).call(t,String(this.curProvider))+1)%t.length];if(!r)throw new Error("uploadFile nextProvider error");if(r===t[0])throw new Error("uploadFile all policy fail");if(this.logger.log("uploadFile:: upload policy will change,now policy:"+this.curProvider+" nextProvider:"+r),this.curProvider=$p(r),this.mixStorePolicy.nosPolicy&&this.mixStorePolicy.s3Policy){var n=this.mixStorePolicy[1===this.curProvider?"nosPolicy":"s3Policy"].uploadConfig.retryPolicy.circuit;if(!n||0===n)throw new Error("uploadFile circuit error");this.circuitTimer=this.core.timerManager.addTimer((function(){e.logger.log("uploadFile:: upload policy will change,now policy:"+e.curProvider+" nextProvider:"+$p(e.mixStorePolicy.providers[0])),e.curProvider=$p(e.mixStorePolicy.providers[0]),e.core.timerManager.deleteTimer(e.circuitTimer)}),1e3*n)}throw new Error("uploadFile will not retry again")},t.getFileAuthToken=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("getFileAuthToken",{mixStoreAuthTokenReqTag:e});case 2:return r=t.sent,t.abrupt("return",r.content.mixStoreAuthTokenResTag);case 4:case"end":return t.stop()}}),t,this)})))},e}(),Fy=Mp.trim,Gy=M("".charAt),jy=c.parseFloat,Hy=c.Symbol,Wy=Hy&&Hy.iterator,Ky=1/jy(mp+"-0")!=-1/0||Wy&&!u((function(){jy(Object(Wy))}))?function(e){var t=Fy(Xi(e)),r=jy(t);return 0===r&&"-"==Gy(t,0)?-0:r}:jy;nt({global:!0,forced:parseFloat!=Ky},{parseFloat:Ky});var Yy,Qy,Jy,zy,Xy=B.parseFloat,$y=-1,Zy=function(){function e(e,t){this.s3=null,this.core=e,this.cloudStorage=t,this.logger=e.logger}var t=e.prototype;return t.s3Upload=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o,a,s,c,u,d,l,p,m,h,f,g,v=this;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if($y+=1,!e.file){r.next=5;break}n=e.file,r.next=20;break;case 5:if("string"!=typeof e.fileInput){r.next=15;break}if(this.logger.warn("fileInput will abandon,Please use file or filepath"),!((i=document.getElementById(e.fileInput))&&i.files&&i.files[0])){r.next=12;break}n=i.files[0],r.next=13;break;case 12:throw new Error("Can not get file from fileInput");case 13:r.next=20;break;case 15:if(!(e.fileInput&&e.fileInput.files&&e.fileInput.files[0])){r.next=19;break}n=e.fileInput.files[0],r.next=20;break;case 19:throw new Error("Can not get file from fileInput "+e.fileInput);case 20:if(this.mixStorePolicy.s3Policy){r.next=22;break}throw new Error("dont get s3 policy");case 22:return o={accessKeyId:t.accessKeyId,secretAccessKey:t.secretAccessKey,sessionToken:t.sessionToken,region:t.region,maxRetries:this.mixStorePolicy.s3Policy.uploadConfig.retryPolicy.retry},a=this.s3,s=decodeURIComponent(t.bucket),c=decodeURIComponent(t.objectName),u=n,d="https://"+s+".s3.amazonaws.com/"+c,l={},(p=this.mixStorePolicy.s3Policy)&&p.uploadConfig&&Ei(p.uploadConfig.uploadUrl)&&p.uploadConfig.uploadUrl.length>0&&(m=p.uploadConfig.uploadUrl.length,$y%=m,l.endpoint=p.uploadConfig.uploadUrl[$y],l.s3ForcePathStyle=!0,d=l.endpoint+"/"+s+"/"+c),this.core.reporterHookCloudStorage.update({remote_addr:d,operation_type:1}),(h=new a(l)).config.update(o),f={Bucket:s,Key:c,Body:u,Metadata:{token:t.token},ContentType:u.type||"application/octet-stream"},this.core.logger.log("uploadFile:: s3 upload params:",f),(g=h.upload(f)).on("httpUploadProgress",(function(t){var r=Xy((t.loaded/t.total).toFixed(2));e.onUploadProgress&&e.onUploadProgress({total:t.total,loaded:t.loaded,percentage:r,percentageText:Math.round(100*r)+"%"})})),r.abrupt("return",new fs((function(r,n){var i=(new Date).getTime();g.send((function(o,a){return zl(v,void 0,void 0,Ql.mark((function d(){var l,p,m,h,f,g,v;return Ql.wrap((function(d){for(;;)switch(d.prev=d.next){case 0:if(!o||"RequestAbortedError"!==o.code){d.next=5;break}this.logger.error("uploadFile:","api::s3:upload file abort.",o),n(new kl({code:"v2"===Zp(this.core,"options.apiVersion")?Tl.V2NIM_ERROR_CODE_CANCELLED:400,detail:{reason:"S3RequestAbortedError",rawError:o,curProvider:2}})),d.next=41;break;case 5:if(!o){d.next=26;break}return this.logger.error("uploadFile:","api::s3:upload file failed.",o),this.core.reporter.reportTraceStart("exceptions",{user_id:this.core.options.account||(null===(p=null===(l=this.core)||void 0===l?void 0:l.auth)||void 0===p?void 0:p.account),trace_id:null===(m=this.core.clientSocket.socket)||void 0===m?void 0:m.sessionId,start_time:i,action:1,exception_service:4}),this.core.reporter.reportTraceUpdateV2("exceptions",{code:"number"==typeof o.status?o.status:"number"==typeof o.code?o.code:0,description:o.message||""+o.code,operation_type:1,target:_i({bucket:s,object:c})},{asyncParams:Zl.net.getNetworkStatus()}),this.core.reporter.reportTraceEnd("exceptions",1),d.next=12,Zl.net.getNetworkStatus();case 12:if(!1!==d.sent.net_connect){d.next=16;break}return d.abrupt("return",n(new kl({code:"v2"===Zp(this.core,"options.apiVersion")?Tl.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"No network",rawError:o,curProvider:this.cloudStorage.mixStorage.curProvider}})));case 16:d.prev=16,this.cloudStorage.mixStorage._addCircuitTimer(),d.next=23;break;case 20:return d.prev=20,d.t0=d.catch(16),d.abrupt("return",n(new kl({code:"v2"===Zp(this.core,"options.apiVersion")?Tl.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"All upload attempts failed",rawError:d.t0,curProvider:this.cloudStorage.mixStorage.curProvider,mixStorePolicy:this.mixStorePolicy,file:e.file||e.filePath}})));case 23:r(this.cloudStorage._uploadFile(e)),d.next=41;break;case 26:if(h=(h=(h=this.mixStorePolicy.s3Policy.cdnSchema).replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn)).replace("{objectName}",a.Key),f={size:u.size,name:u.name,url:t.shortUrl?t.shortUrl:h,ext:u.name.split(".")[1]||"unknown"},g=e.type||"",(v={image:"imageInfo"})[g]){d.next=36;break}return d.abrupt("return",r(f));case 36:return d.t1=r,d.next=39,this.getS3FileInfo({url:h,infoSuffix:v[g],s3Result:f});case 39:return d.t2=d.sent,d.abrupt("return",(0,d.t1)(d.t2));case 41:case"end":return d.stop()}}),d,this,[[16,20]])})))})),e.onUploadStart&&e.onUploadStart(g)})));case 39:case"end":return r.stop()}}),r,this)})))},t.getS3FileInfo=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o,a,s,c,u;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.url,i=e.infoSuffix,o=e.s3Result,r.prev=1,r.next=4,this.core.adapters.request(n+"?"+i,{method:"GET",dataType:"text",timeout:5e3},{exception_service:3});case 4:a=r.sent,r.next=11;break;case 7:return r.prev=7,r.t0=r.catch(1),this.core.logger.error("uploadFile:: fetch file info error",r.t0),r.abrupt("return",o);case 11:if(!a){r.next=18;break}return s=a.data,c="imageInfo"===i?s:null===(t=null==s?void 0:s.GetVideoInfo)||void 0===t?void 0:t.VideoInfo,u=dr(dr({},o),{w:null==c?void 0:c.Width,h:null==c?void 0:c.Height,orientation:null==c?void 0:c.Orientation,dur:null==c?void 0:c.Duration,audioCodec:null==c?void 0:c.AudioCodec,videoCodec:null==c?void 0:c.VideoCodec,container:null==c?void 0:c.Container}),r.abrupt("return",Ly(u,(function(e){return void 0!==e})));case 18:return this.core.logger.error("uploadFile:: fetch s3 file info no result",n+"?"+i),r.abrupt("return",o);case 20:case"end":return r.stop()}}),r,this,[[1,7]])})))},ct(e,[{key:"mixStorePolicy",get:function(){return this.cloudStorage.mixStorage.mixStorePolicy}}]),e}(),eM=function(){function e(e,t){void 0===t&&(t={}),this.config={},this.uploadTaskMap={},this.name="cloudStorage",this.logger=e.logger,this.core=e,this.nos=new Vy(e,this),this.mixStorage=new By(e,this),this.aws=new Zy(e,this),Mh({cmdMap:Uy,cmdConfig:qy}),this.setOptions(t),this.setListeners()}var t=e.prototype;return t.setOptions=function(e){void 0===e&&(e={});var t=e.storageKeyPrefix||"NIMClient";this.mixStorage.GRAYKEY=t+"-AllGrayscaleConfig",this.mixStorage.MIXSTOREKEY=t+"-AllMixStorePolicy";var r=e.s3,n=Jl(e,["s3"]),i=dr({},Py,this.config);if(n&&Object.prototype.hasOwnProperty.call(n,"cdn")){var o=dr(dr({},i.cdn),n.cdn);this.config=dr({},i,n),this.config.cdn=o}else this.config=dr({},i,n);r&&(this.aws.s3=r)},t.setListeners=function(){var e,t,r,n;this.core.eventBus.on("kicked",tr(e=this._clearUnCompleteTask).call(e,this)),this.core.eventBus.on("disconnect",tr(t=this._clearUnCompleteTask).call(t,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLogout",tr(r=this._clearUnCompleteTask).call(r,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleKicked",tr(n=this._clearUnCompleteTask).call(n,this))},t._clearUnCompleteTask=function(){var e,t=this;jn(e=fr(this.uploadTaskMap)).call(e,(function(e){var r=t.uploadTaskMap[e];r&&r.abort&&r.abort()})),this.uploadTaskMap={}},t.init=function(){return zl(this,void 0,void 0,Ql.mark((function e(){return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mixStorage.reset(),this.nos.reset(),!this.config.isNeedToGetUploadPolicyFromServer){e.next=5;break}return e.next=5,this.mixStorage.getGrayscaleConfig(this.core.options.appkey);case 5:return e.next=7,this.nos._getNosCdnHost();case 7:case"end":return e.stop()}}),e,this)})))},t.processCallback=function(e,t){var r=this,n=e.onUploadProgress,i=e.onUploadDone,o=e.onUploadStart;return{onUploadStart:"function"==typeof o?function(e){r.uploadTaskMap[t]=e;try{o(e)}catch(e){r.logger.error("CloudStorage::uploadFile:options.onUploadStart execute error",e)}}:function(e){r.uploadTaskMap[t]=e},onUploadProgress:"function"==typeof n?function(e){r.core.reporterHookCloudStorage.update({transferred_size:e.loaded,full_size:e.total});try{n(e)}catch(e){r.logger.error("CloudStorage::uploadFile:options.onUploadProgress execute error",e)}}:function(e){r.core.reporterHookCloudStorage.update({transferred_size:e.loaded,full_size:e.total})},onUploadDone:"function"==typeof i?function(e){r.core.reporterHookCloudStorage.end(0);try{i(e)}catch(e){r.logger.error("CloudStorage::uploadFile:options.onUploadDone execute error",e)}}:function(){r.core.reporterHookCloudStorage.end(0)},taskKey:t}},t.uploadFile=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a,s,c,u;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Pl({maxSize:{type:"number",required:!1},type:{type:"enum",values:["file","image","audio","video"]}},e),e.fileInput||e.file||e.filePath){t.next=3;break}throw new Error("uploadFile needs target file object or a filePath");case 3:if(!e.type||"file"===e.type){t.next=7;break}if(!(r=Zp(e,"file.type"))||"string"!=typeof r||-1!==wu(r).call(r,e.type)){t.next=7;break}throw new Error('The meta type "'+r+'" does not match "'+e.type+'"');case 7:return this.core.reporterHookCloudStorage.start(),e.file?this.core.reporterHookCloudStorage.update({full_size:e.file.size}):"string"==typeof e.fileInput?(n=document.getElementById(e.fileInput))&&n.files&&n.files[0]&&this.core.reporterHookCloudStorage.update({full_size:n.files[0].size}):e.fileInput&&e.fileInput.files&&e.fileInput.files[0]&&this.core.reporterHookCloudStorage.update({full_size:e.fileInput.files[0].size}),i=Ep(),o=this.processCallback(e,i),a=o.onUploadStart,s=o.onUploadProgress,c=o.onUploadDone,e.onUploadStart=a,e.onUploadProgress=s,e.onUploadDone=c,u=null,t.prev=15,t.next=18,this._uploadFile(e);case 18:u=t.sent,e.md5&&(u.md5=e.md5),delete this.uploadTaskMap[i],t.next=28;break;case 23:throw t.prev=23,t.t0=t.catch(15),delete this.uploadTaskMap[i],this.core.reporterHookCloudStorage.end((t.t0&&t.t0.code)===Tl.V2NIM_ERROR_CODE_CANCELLED?3:1),t.t0;case 28:return u&&(u.size=void 0===u.size?void 0:Number(u.size),u.w=void 0===u.w?void 0:Number(u.w),u.h=void 0===u.h?void 0:Number(u.h),u.dur=void 0===u.dur?void 0:Number(u.dur)),u.url=decodeURIComponent(u.url),e.onUploadDone({size:u.size,name:u.name,url:u.url,ext:u.name.split(".")[1]||"unknown"}),t.abrupt("return",u);case 32:case"end":return t.stop()}}),t,this,[[15,23]])})))},t._uploadFile=function(e){var t,r;return zl(this,void 0,void 0,Ql.mark((function n(){var i,o,a,s;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(Zp(this.mixStorage,"grayConfig.mixStoreEnable")&&Zp(this.mixStorage,"mixStorePolicy.providers.length")){n.next=3;break}return this.logger.log("uploadFile:: uploadFile begin, use old nos"),n.abrupt("return",this.nos.nosUpload(e));case 3:if(this.logger.log("uploadFile::_uploadFile, grayConfig enable:"+Zp(this.mixStorage,"grayConfig.mixStoreEnable")+" curProvider:"+Zp(this.mixStorage,"curProvider")),i=this.core.adapters.getFileUploadInformation(e),o=!0,i?!1===i.complete&&2===this.mixStorage.curProvider&&(o=!1):o=!1,this.aws.s3||(this.mixStorage.curProvider=1),a=xy,o){n.next=23;break}return n.prev=10,n.next=13,this.core.sendCmd("getMixStoreToken",{mixStoreTokenReqTag:{provider:this.mixStorage.curProvider,tokenCount:1,tag:"qchat",nosSurvivalTime:e.nosSurvivalTime,returnBody:Oy(e.type),policyVersion:this.mixStorage.mixStorePolicy.policyVersion}});case 13:s=n.sent,a=s.content.mixStoreTokenResTag,n.next=23;break;case 17:if(n.prev=17,n.t0=n.catch(10),this.core.logger.error("uploadFile:: getMixStoreToken error",n.t0),!(n.t0 instanceof _l)){n.next=22;break}throw n.t0;case 22:throw new kl({code:"v2"===Zp(this.core,"options.apiVersion")?Tl.V2NIM_ERROR_CODE_FILE_UPLOAD_FAILED:400,detail:{reason:"getMixStoreToken error",rawError:n.t0,curProvider:this.mixStorage.curProvider,mixStorePolicy:this.mixStorage.mixStorePolicy}});case 23:if(o){n.next=27;break}return n.abrupt("return",2===this.mixStorage.curProvider?this.aws.s3Upload(e,a):this.nos.nosUpload(e,a));case 27:return n.abrupt("return",this.nos.nosUpload(e,null===(r=null===(t=null==i?void 0:i.uploadInfo)||void 0===t?void 0:t.payload)||void 0===r?void 0:r.mixStoreToken));case 28:case"end":return n.stop()}}),n,this,[[10,17]])})))},t.getThumbUrl=function(e,t){var r,n,i,o,a;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(e))return this.logger.error("illegal file url:"+e),e;var s=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(e);s[0],s[1],s[2],s[3],s[4];var c=s[5];if(s[6],s[7],null===(r=this.grayConfig)||void 0===r?void 0:r.mixStoreEnable){var u=this._getUrlType(e);if(2===u&&this.mixStorePolicy.s3Policy&&Zp(this.mixStorePolicy,"s3Policy.thumbPolicy.imagethumb"))return(null===(i=null===(n=this.mixStorePolicy.s3Policy)||void 0===n?void 0:n.thumbPolicy)||void 0===i?void 0:i.imagethumb).replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",c).replace("{x}",t.width.toString()).replace("{y}",t.height.toString());if(1===u&&this.mixStorePolicy.nosPolicy&&Zp(this.mixStorePolicy,"nosPolicy.thumbPolicy.imagethumb"))return(null===(a=null===(o=this.mixStorePolicy.nosPolicy)||void 0===o?void 0:o.thumbPolicy)||void 0===a?void 0:a.imagethumb).replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",c).replace("{x}",t.width.toString()).replace("{y}",t.height.toString())}return ou(e).call(e,"?")?e+"&imageView&thumbnail="+t.width+"x"+t.height:e+"?imageView&thumbnail="+t.width+"x"+t.height},t.getVideoCoverUrl=function(e,t){var r,n,i,o,a;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(e))return this.logger.error("illegal file url:"+e),e;var s=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(e);s[0],s[1],s[2],s[3],s[4];var c=s[5];if(s[6],s[7],null===(r=this.grayConfig)||void 0===r?void 0:r.mixStoreEnable){var u=this._getUrlType(e);if(2===u&&this.mixStorePolicy.s3Policy&&Zp(this.mixStorePolicy,"s3Policy.thumbPolicy.vframe"))return(null===(i=null===(n=this.mixStorePolicy.s3Policy)||void 0===n?void 0:n.thumbPolicy)||void 0===i?void 0:i.vframe).replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",c).replace("{x}",t.width.toString()).replace("{y}",t.height.toString()).replace("{offset}","0").replace("{type}","png");if(1===u&&this.mixStorePolicy.nosPolicy&&Zp(this.mixStorePolicy,"nosPolicy.thumbPolicy.vframe"))return(null===(a=null===(o=this.mixStorePolicy.nosPolicy)||void 0===o?void 0:o.thumbPolicy)||void 0===a?void 0:a.vframe).replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",c).replace("{x}",t.width.toString()).replace("{y}",t.height.toString()).replace("{offset}","0").replace("{type}","png")}return ou(e).call(e,"?")?e+"&vframe&offset=0&resize="+t.width+"x"+t.height+"&type=png":e+"?vframe&offset=0&resize="+t.width+"x"+t.height+"&type=png"},t.getPrivateUrl=function(e){var t;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(e))return this.logger.error("illegal file url:"+e),"";var r=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(e);r[0];var n=r[1];r[2];var i=r[3];r[4];var o=r[5];if(r[6],r[7],null===(t=this.grayConfig)||void 0===t?void 0:t.mixStoreEnable){var a=this._getUrlType(e);return 2===a&&this.mixStorePolicy.s3Policy&&(e=this.mixStorePolicy.s3Policy.cdnSchema.replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",o)),1===a&&this.mixStorePolicy.nosPolicy&&(e=this.mixStorePolicy.nosPolicy.cdnSchema.replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",o)),e}var s=this.config,c=s.downloadUrl,u=s.downloadHostList,d=s.nosCdnEnable,l=this.config.cdn.cdnDomain,p=this.config.cdn.objectNamePrefix?decodeURIComponent(this.config.cdn.objectNamePrefix):"",m=decodeURIComponent(o),h=wu(m).call(m,p);if(l&&h>-1&&d)return""+n+l+"/"+Wc(m).call(m,h);if(ou(u).call(u,i)&&ou(o).call(o,"/")){var f=wu(o).call(o,"/"),g=o.substring(0,f),v=o.substring(f+1);return c.replace("{bucket}",g).replace("{object}",v)}var y=fu(u).call(u,(function(e){return"string"==typeof i&&ou(i).call(i,e)}))[0],M=y?i.replace(y,"").replace(/\W/g,""):null;return M?c.replace("{bucket}",M).replace("{object}",o):e},t.getOriginUrl=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e&&ou(e).call(e,"_im_url=1")){t.next=2;break}return t.abrupt("return",e);case 2:return t.next=4,this.core.sendCmd("getOriginUrl",{nosSafeUrlTag:{safeUrl:e}});case 4:return r=t.sent,t.abrupt("return",r.content.nosSafeUrlTag.originUrl);case 6:case"end":return t.stop()}}),t,this)})))},t.getFileToken=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a,s=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Pl({type:{type:"number",min:2,max:3},urls:{type:"array",required:!1,itemType:"string"}},e),r=this.mixStorePolicy.nosPolicy?this.mixStorePolicy.nosPolicy.authPolicy.policyType:null,n=this.mixStorePolicy.s3Policy?this.mixStorePolicy.s3Policy.authPolicy.policyType:null,r!==String(-1)||n!==String(-1)){t.next=8;break}throw this.logger.error("don't need token"),new Error("don't need token");case 8:if(2!==e.type){t.next=17;break}if(!(r&&wu(r).call(r,String(2))>=0||n&&wu(n).call(n,String(2))>0)){t.next=13;break}return t.abrupt("return",this.mixStorage.getFileAuthToken(e));case 13:throw this.logger.error("don't support time token "),new Error("don't support type time token ");case 15:t.next=33;break;case 17:if(e.urls&&e.urls.length){t.next=20;break}throw this.logger.error("urls is required when urls token"),new Error("urls is required when urls token");case 20:if(o=[],a=[],jn(i=e.urls).call(i,(function(e){var t=s._getUrlType(e);1===t&&a.push(e),2===t&&o.push(e)})),(!n||0!==o.length&&wu(n).call(n,String(3))<0)&&(this.logger.warn("s3 url don't support url token"),o=[]),(!r||0!==a.length&&wu(r).call(r,String(3))<0)&&(this.logger.warn("nos url don't support url token"),a=[]),0!==o.length||0!==a.length){t.next=30;break}throw this.logger.error("not support urls"),new Error("not support urls");case 30:if(0!==o.length&&0!==a.length){t.next=33;break}return e.urls=_i(e.urls),t.abrupt("return",this.mixStorage.getFileAuthToken(e));case 33:case"end":return t.stop()}}),t,this)})))},t._getUrlType=function(e){var t,r;return this.mixStorePolicy.nosPolicy&&Gm(t=this.mixStorePolicy.nosPolicy.dlcdns).call(t,(function(t){return wu(e).call(e,t)>=0}))?1:this.mixStorePolicy.s3Policy&&Gm(r=this.mixStorePolicy.s3Policy.dlcdns).call(r,(function(t){return wu(e).call(e,t)>=0}))?2:null},t.getNosAccessToken=function(e){return Pl({url:{type:"string",allowEmpty:!1}},e),this.nos.getNosAccessToken(e)},t.deleteNosAccessToken=function(e){return Pl({token:{type:"string",allowEmpty:!1}},e),this.nos.deleteNosAccessToken(e)},t.process=function(e){var t=Zp(e,"error.detail.ignore");return e.error&&!t?fs.reject(e.error):fs.resolve(e)},ct(e,[{key:"grayConfig",get:function(){return this.mixStorage.grayConfig}},{key:"mixStorePolicy",get:function(){return this.mixStorage.mixStorePolicy}}]),e}(),tM=function(e){function t(t){var r;return(r=e.call(this,"V2NIMStorageService",t)||this).sceneMap={nim_default_profile_icon:{sceneName:"nim_default_profile_icon",expireTime:0},nim_default_im:{sceneName:"nim_default_im",expireTime:0},nim_system_nos_scene:{sceneName:"nim_system_nos_scene",expireTime:0},nim_security:{sceneName:"nim_security",expireTime:0}},r.uploadingMessageInfo={},r.core=t,r.core._registerDep(eM,"cloudStorage"),r.core._registerDep(Ay,"V2NIMStorageUtil"),r}nr(t,e);var r=t.prototype;return r.addCustomStorageScene=function(e,t){return this.checkV2(),Pl({sceneName:{type:"string",allowEmpty:!1},expireTime:{type:"number",min:0}},{sceneName:e,expireTime:t},"",!0),this.sceneMap[e]={sceneName:e,expireTime:t},{sceneName:e,expireTime:t}},r.getStorageSceneList=function(){return this.checkV2(),Ts(this.sceneMap)},r.getStorageScene=function(e){return e&&this.sceneMap[e]||this.sceneMap.nim_default_im},r.hasStorageScene=function(e){return void 0!==this.sceneMap[e]},r.createUploadFileTask=function(e){var t;if(this.checkV2(),"string"==typeof e.fileObj&&0===wu(t=e.fileObj).call(t,"nim-external")){var r=document.getElementById(e.fileObj);r&&r.files&&r.files[0]&&(e.fileObj=r.files[0])}return{taskId:Ep(),uploadParams:e}},r.uploadFile=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Pl({taskId:{type:"string",allowEmpty:!1}},e,"fileTask",!0),r.next=4,this._uploadFile(e,t);case 4:return n=r.sent,r.abrupt("return",n[0]);case 6:case"end":return r.stop()}}),r,this)})))},r.uploadFileWithMetaInfo=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Pl({taskId:{type:"string",allowEmpty:!1}},e,"fileTask",!0),r.next=4,this._uploadFile(e,t);case 4:return n=r.sent,r.abrupt("return",(o=void 0,a=void 0,s=void 0,c=void 0,u=void 0,d=void 0,l=void 0,p=void 0,m=void 0,h=void 0,f=void 0,g=void 0,o=(i=n[1]).url,a=i.name,s=i.size,c=i.ext,u=i.md5,d=i.h,l=i.w,p=i.orientation,m=i.dur,h=i.audioCodec,f=i.videoCodec,g=i.container,JSON.parse(_i({url:o,name:a,size:s,ext:c,md5:u,height:d,width:l,orientation:p,duration:m,audioCodec:h,videoCodec:f,container:g}))));case 6:case"end":return r.stop()}var i,o,a,s,c,u,d,l,p,m,h,f,g}),r,this)})))},r._uploadFile=function(e,t,r){var n;return zl(this,void 0,void 0,Ql.mark((function i(){var o,a,s,c,u,d,l,p,m,h,f=this;return Ql.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(this.core.cloudStorage&&this.core.cloudStorage.uploadFile){i.next=2;break}throw new Error('Service "cloudStorage" does not exist');case 2:if(o=e.uploadParams,a=e.taskId,s=Ey(o.fileObj),c=s.file,u=s.path,d=(r||{}).fileType,!this.uploadingMessageInfo[a]){i.next=7;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_RESOURCE_ALREADY_EXIST,detail:{reason:"V2NIMStorageService.uploadFile: repeat upload"}});case 7:if(i.prev=7,l={},c?l.file=c:u&&(0===(null==u?void 0:wu(u).call(u,"nim-external"))?l.fileInput=u:l.filePath=u),p=this.getStorageScene(o.sceneName),l.nosScenes=p.sceneName,l.nosSurvivalTime=p.expireTime,l.type=1===d?"image":2===d?"audio":3===d?"video":"file",!l.file||!this.core.pluginMap["browser-md5-file"]){i.next=19;break}return i.next=17,this.getFileMd5(this.core.pluginMap["browser-md5-file"],a,l.file);case 17:m=i.sent,l.md5=m;case 19:return l.onUploadProgress=function(e){"function"==typeof t&&t(Math.round(100*e.percentage))},l.onUploadStart=function(e){var t;if(null===(t=f.uploadingMessageInfo[a])||void 0===t?void 0:t.abort)return e.abort(),void delete f.uploadingMessageInfo[a];f.uploadingMessageInfo[a]={abort:!1,task:e}},this.uploadingMessageInfo[a]={abort:!1},i.next=24,this.core.cloudStorage.uploadFile(l);case 24:if(h=i.sent,!(null===(n=this.uploadingMessageInfo[a])||void 0===n?void 0:n.abort)){i.next=27;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:"upload file aborted"}});case 27:return delete this.uploadingMessageInfo[a],i.abrupt("return",[h.url,h]);case 31:throw i.prev=31,i.t0=i.catch(7),delete this.uploadingMessageInfo[a],this.core.logger.error("sendFile:: upload File error or abort.",i.t0),i.t0;case 36:case"end":return i.stop()}}),i,this,[[7,31]])})))},r.cancelUploadFile=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),t.next=3,this._cancelUploadFile(e.taskId);case 3:case"end":return t.stop()}}),t,this)})))},r._cancelUploadFile=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),!(null==(r=this.uploadingMessageInfo[e])?void 0:r.task)){t.next=16;break}return t.prev=3,this.logger.log("V2NIMStorageService.cancelUploadFile: uploadInfo task exist"),t.next=7,r.task.abort();case 7:delete this.uploadingMessageInfo[e],t.next=14;break;case 10:t.prev=10,t.t0=t.catch(3),delete this.uploadingMessageInfo[e],this.core.logger.error("cancelMessageAttachmentUpload::abort error.",t.t0);case 14:t.next=22;break;case 16:if(!r){t.next=21;break}this.logger.log("V2NIMStorageService.cancelUploadFile: uploadInfo task not exist"),r.abort=!0,t.next=22;break;case 21:throw new _l({code:Tl.V2NIM_ERROR_CODE_RESOURCE_NOT_EXIST,detail:{reason:"V2NIMStorageService.cancelUploadFile: uploadInfo not exist"}});case 22:case"end":return t.stop()}}),t,this,[[3,10]])})))},r.getFileMd5=function(e,t,r){return zl(this,void 0,void 0,Ql.mark((function n(){var i=this;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",new fs((function(n,o){var a,s=new e;(null===(a=i.uploadingMessageInfo[t])||void 0===a?void 0:a.abort)?o(new _l({code:Tl.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:"upload file aborted"}})):i.uploadingMessageInfo[t]={abort:!1,task:s};try{s.md5(r,(function(e,t){"aborted"===e?o(new _l({code:Tl.V2NIM_ERROR_CODE_CANCELLED,detail:{reason:e}})):e?o(new _l({code:Tl.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"md5 calculate error in callback",rawError:e}})):n(t)}))}catch(e){o(new _l({code:Tl.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"md5 calculate error",rawError:e}}))}})));case 1:case"end":return n.stop()}}),n)})))},r.shortUrlToLong=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),t.abrupt("return",this.core.cloudStorage.getOriginUrl(e));case 2:case"end":return t.stop()}}),t,this)})))},r.getImageThumbUrl=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.core.V2NIMStorageUtil.getImageThumbUrl(e,t));case 1:case"end":return r.stop()}}),r,this)})))},r.getVideoCoverUrl=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.core.V2NIMStorageUtil.getVideoCoverUrl(e,t));case 1:case"end":return r.stop()}}),r,this)})))},t}(rf),rM=function(e){function t(t){var r;return(r=e.call(this,"V2NIMMessageCreator",t)||this).name="V2NIMMessageCreator",r.defaultNosSceneName="nim_default_im",r.core=t,r}nr(t,e);var r=t.prototype;return r.createMessage=function(e,t){return dr(dr(dr({messageClientId:Ep(),messageType:e,createTime:_s(),sendingState:0,messageStatus:{errorCode:200},isSelf:!0},t),t.attachment?{attachment:dr(dr({},t.attachment),{raw:Bg(e,t.attachment)})}:{}),{senderId:"",receiverId:"",conversationType:0,conversationId:"",messageServerId:"",messageConfig:dr({unreadEnabled:!0,roamingEnabled:!0,readReceiptEnabled:!1,lastMessageUpdateEnabled:!0,historyEnabled:!0,onlineSyncEnabled:!0,offlineEnabled:!0},t.messageConfig),pushConfig:dr({pushEnabled:!0,pushNickEnabled:!0,forcePush:!1},t.pushConfig),routeConfig:dr({routeEnabled:!0},t.routeConfig),antispamConfig:dr({antispamEnabled:!0},t.antispamConfig)})},r.createTextMessage=function(e){return this.checkV2(),Pl({text:{type:"string",allowEmpty:!1}},{text:e},"",!0),this.createMessage(0,{text:e})},r.createImageMessage=function(e,t,r,n,i){this.checkV2(),Pl(uy,{name:t,sceneName:r,width:n,height:i},"",!0);var o=this.createGenericFileMessageAttachment(e,t,r,void 0,n,i,"jpeg");return this.createMessage(1,{attachment:o,attachmentUploadState:0})},r.createAudioMessage=function(e,t,r,n){this.checkV2(),Pl(sy,{name:t,sceneName:r,duration:n},"",!0);var i=this.createGenericFileMessageAttachment(e,t,r,n,void 0,void 0,"aac");return this.createMessage(2,{attachment:i,attachmentUploadState:0})},r.createVideoMessage=function(e,t,r,n,i,o){this.checkV2(),Pl(cy,{name:t,sceneName:r,duration:n,width:i,height:o},"",!0);var a=this.createGenericFileMessageAttachment(e,t,r,n,i,o,"mp4");return this.createMessage(3,{attachment:a,attachmentUploadState:0})},r.createFileMessage=function(e,t,r){this.checkV2(),Pl(ay,{name:t,sceneName:r},"",!0);var n=this.createGenericFileMessageAttachment(e,t,r,void 0,void 0,void 0,"txt");return this.createMessage(6,{attachment:n,attachmentUploadState:0})},r.createGenericFileMessageAttachment=function(e,t,r,n,i,o,a){if(r=r||this.defaultNosSceneName,!this.core.V2NIMStorageService.hasStorageScene)throw new _l({code:Tl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"V2NIMStorageService not exist"}});if(!this.core.V2NIMStorageService.hasStorageScene(r))throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"sceneName: "+r+" has not been added"}});var s=Ey(e),c=s.file,u=s.path,d=dr(dr(dr({name:t,uploadState:0,sceneName:r||this.defaultNosSceneName},n?{duration:n}:{}),i?{width:i}:{}),o?{height:o}:{});if(c){var l,p=pp(l=c.name).call(l,"."),m=-1===p?c.name:c.name.substring(0,p);d.name=d.name||m,d.size=c.size,d.ext="."+(Pp(c.name)||Pp(t||"")||a)}else if(u){var h=pp(u).call(u,"/"),f=pp(u).call(u,"."),g=-1===f?u.substring(h+1):u.substring(h+1,f);d.name=d.name||g,d.ext="."+(Pp(u)||Pp(t||"")||a)}return d=JSON.parse(_i(d)),u?d.path=u:c&&(d.file=c),d},r.createLocationMessage=function(e,t,r){return this.checkV2(),Pl({latitude:{type:"number",allowEmpty:!1},longitude:{type:"number",allowEmpty:!1},address:{type:"string",allowEmpty:!1}},{latitude:e,longitude:t,address:r},"",!0),this.createMessage(4,{attachment:{latitude:e,longitude:t,address:r}})},r.createCustomMessage=function(e,t){return this.checkV2(),Pl({text:{type:"string"}},{text:e},"",!0),Pl({rawAttachment:{type:"string"}},{rawAttachment:t},"",!0),this.createMessage(100,{text:e,attachment:{raw:t}})},r.createCustomMessageWithAttachment=function(e,t){return this.checkV2(),Pl({raw:{type:"string"}},e,"attachment",!0),Pl({subType:{type:"number",min:0,required:!1}},{subType:t},"",!0),this.createMessage(100,t?{attachment:e,subType:t}:{attachment:e})},r.createCallMessage=function(e,t,r,n,i){return this.checkV2(),Pl({type:{type:"number",allowEmpty:!1}},{type:e},"",!0),Pl({channelId:{type:"string",allowEmpty:!1}},{channelId:t},"",!0),Pl({status:{type:"number",allowEmpty:!1}},{status:r},"",!0),Pl({durations:{type:"array",allowEmpty:!1}},{durations:n},"",!0),this.createMessage(12,{text:i||"",attachment:{type:e,channelId:t,durations:n,status:r}})},r.createForwardMessage=function(e){this.checkV2();var t=[11,5,7,10];if(!e||ou(t).call(t,e.messageType))return null;var r={messageClientId:Ep(),messageType:e.messageType};return e.text&&(r.text=e.text),e.attachment&&(r.attachment=e.attachment),e.attachment&&"uploadState"in e.attachment&&(r.attachmentUploadState=e.attachment.uploadState),this.createMessage(e.messageType,r)},r.createTipsMessage=function(e){return this.checkV2(),Pl({text:{type:"string",allowEmpty:!1}},{text:e},"",!0),this.createMessage(10,{text:e})},t}(rf),nM=function(){function e(){this.name="V2NIMMessageAttachmentCreator"}var t=e.prototype;return t.createLocationMessageAttachment=function(e,t,r){return{latitude:"number"==typeof e?e:0,longitude:"number"==typeof t?t:0,address:"string"==typeof r?r:""}},t.createCustomMessageAttachment=function(e){return{raw:"string"==typeof e?e:""}},e}(),iM=$t("Array").keys,oM=Array.prototype,aM={DOMTokenList:!0,NodeList:!0},sM=function(e){var t=e.keys;return e===oM||j(oM,e)&&t===oM.keys||me(aM,zr(e))?iM:t},cM=function(){function e(e){this.config={enable:!0},this.name="V2NIMClientAntispamUtil",this.core=e}var t=e.prototype;return t.setOptions=function(e){this.config=dr(this.config,e)},t.reset=function(e){"destroy"===e&&(this.vocabInfo=void 0)},t.downloadLocalAntiSpamVocabs=function(){return zl(this,void 0,void 0,Ql.mark((function e(){var t;return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.config.enable){e.next=2;break}return e.abrupt("return");case 2:if(!this.vocabInfo){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,e.next=7,this.core.sendCmd("v2DownloadLocalAntiSpamVocabs",{tag:{version:0,md5:""}});case 7:t=e.sent,this.vocabInfo=dr(dr({},t.content.data),{thesaurus:JSON.parse(t.content.data.thesaurus).thesaurus}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),this.core.logger.warn("V2NIMLocalAntispamUtil::downloadLocalAntiSpamVocabs error",e.t0);case 14:case"end":return e.stop()}}),e,this,[[4,11]])})))},t.checkTextAntispam=function(e,t){if(void 0===t&&(t="**"),!this.config.enable)return{operateType:0,replacedText:e};if(Pl({text:{type:"string",required:!0,allowEmpty:!1},replace:{type:"string"}},{text:e,replace:t},"",!0),!this.vocabInfo)return{operateType:0,replacedText:e};for(var r=e,n=0;n<this.vocabInfo.thesaurus.length;n++){var i=this.filterContent(r,this.vocabInfo.thesaurus[n],t);if(r=i.replacedText,2===i.operateType||3===i.operateType)return i}return{operateType:r===e?0:1,replacedText:r}},t.filterContent=function(e,t,r){for(var n=0;n<sM(t).length;n++){var i=sM(t)[n],o=i.match||t.match,a=i.operate||t.operate,s=void 0;try{s=this.matchContent(e,i.key,o,a,r)}catch(e){}if(s&&(e=s.replacedText,2===s.operateType||3===s.operateType))return s}return{operateType:1,replacedText:e}},t.matchContent=function(e,t,r,n,i){var o=!1,a="";if(1===r?wu(e).call(e,t)>=0&&(o=!0,a=t):2===r&&new RegExp(t,"g").test(e)&&(o=!0),o&&""!==a)switch(n){case 1:return{operateType:1,replacedText:e.replace(a,i)};case 2:return{operateType:2,replacedText:e};case 3:return{operateType:3,replacedText:e}}return{operateType:0,replacedText:e}},e}(),uM=function(e){function t(t){var r;return(r=e.call(this,"YSFService",t)||this).core._registerDep(Mg,"V2NIMConversationIdUtil"),r.core._registerDep(rM,"V2NIMMessageCreator"),r.core._registerDep(nM,"V2NIMMessageAttachmentCreator"),r.core._registerDep(cM,"V2NIMClientAntispamUtil"),r.core._registerDep(tM,"V2NIMStorageService"),r.sendUtil=new dM(r.core,ut(r)),r.fileUtil=new fy(r.core),r.model=new kv,r.notificationUtil=new _y(r.core),Mh({cmdMap:Ty,cmdConfig:by}),r}nr(t,e);var r=t.prototype;return r.emit=function(t){for(var r,n,i,o=this.name+"::emit "+t.toString(),a=arguments.length,s=new Array(a>1?a-1:0),c=1;c<a;c++)s[c-1]=arguments[c];if("onSendMessage"===t){var u=s[0];this.logger.log(""+o,u.messageClientId+"/"+u.messageServerId+";createTime:"+u.createTime+";","sendingState:"+u.sendingState+";attachmentUploadState:"+(u.attachmentUploadState||0)+";messageStatus:"+(null===(i=u.messageStatus)||void 0===i?void 0:i.errorCode))}else if("onReceiveMessages"===t){var d=s[0];this.logger.log(""+o,du(d).call(d,(function(e){return e.messageClientId+"/"+e.messageServerId+";createTime:"+e.createTime})))}else if("onReceiveCustomNotifications"===t){var l=s[0];this.logger.log(""+o,du(l).call(l,(function(e){return"sender:"+e.senderId+";receiver:"+e.receiverId+";ctype:"+e.conversationType+";time:"+e.timestamp})))}else{var p,m;(p=this.logger).log.apply(p,xs(m=[""+o]).call(m,s))}return(r=e.prototype.emit).call.apply(r,xs(n=[this,t]).call(n,s))},r.sendMessage=function(e,t,r,n){return void 0===r&&(r={}),zl(this,void 0,void 0,Ql.mark((function i(){var o,a,s,c,u,d;return Ql.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return Pl({message:{type:"object"}},{message:e},"",!0),e.messageClientId=e.messageClientId||Ep(),Pl(qv,{conversationId:t,message:e,params:r},"",!0),Vl(this.core.account,t),o=this.core.timeOrigin.getTimeNode(),a=this.sendUtil.prepareMessage(e,t,r),s=a.messageBeforeSend,c=a.clientAntispamResult,u=a.hiddenParams,i.next=8,this.sendUtil.doSendMessage({apiCallingTimeNode:o,messageBeforeSend:s,clientAntispamResult:c,hiddenParams:u,progress:n});case 8:return(d=i.sent).message.senderId===d.message.receiverId&&this.markMsgsAck([d.message]),i.abrupt("return",d);case 11:case"end":return i.stop()}}),i,this)})))},r.sendCustomNotification=function(e,t,r){return zl(this,void 0,void 0,Ql.mark((function n(){var i;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Vl(this.core.account,e),Pl(Cy,{content:t,params:r},"",!0),(i=this.notificationUtil.generateNotificationTag(e,t,r)).type=100,n.next=7,this.core.sendCmd("ysfSendCustomNotification",{tag:i});case 7:case"end":return n.stop()}}),n,this)})))},r.sendMessageHandler=function(e){},r.cancelMessageAttachmentUpload=function(e){return this.fileUtil.cancelMessageAttachmentUpload(e)},r.markMsgsAck=function(e){var t;if(e&&e.length>0){var r=fu(t=du(e).call(e,(function(e){return e.messageServerId}))).call(t,(function(e){return e&&"0"!==e}));0!==r.length&&this.core.sendCmd("ysfBatchMarkRead",{sid:101,cid:2,ids:r})}},r.markNotificationAck=function(e){var t;if(e&&e.length>0){var r=fu(t=du(e).call(e,(function(e){return e.idServer}))).call(t,(function(e){return e&&"0"!==e}));0!==r.length&&this.core.sendCmd("ysfBatchMarkRead",{sid:101,cid:3,ids:r})}},r.ysfOnMsgHandler=function(e){var t=e.content.data,r=qg(Og(this.core,t),this.core);delete r.__clientExt,this.emit("onReceiveMessages",[r]),this.model.upsertMessages([r]),this.markMsgsAck([r])},r.ysfSyncOfflineMsgsHandler=function(e){var t=this,r=e.content.datas;r=du(r).call(r,(function(e){return qg(Og(t.core,e),t.core)})),this.markMsgsAck(r),this.emit("onReceiveMessages",r),this.model.upsertMessages(r)},r.ysfOnSysNotificationHandler=function(e){this.markNotificationAck([e.content.data]);var t=this.processSystemNotification(e.content.data);t&&this.emit("onReceiveCustomNotifications",[t])},r.processSystemNotification=function(e){var t=dr(dr({},e),{conversationType:1});return delete t.type,t},r.ysfSyncSysNotificationHandler=function(e){var t,r,n,i=this;this.markNotificationAck(e.content.datas);var o=fu(t=du(r=Vm(n=e.content.datas).call(n,(function(e,t){return e.timestamp-t.timestamp}))).call(r,(function(e){return i.processSystemNotification(e)}))).call(t,(function(e){return e}));o&&this.emit("onReceiveCustomNotifications",o)},t}(rf),dM=function(){function e(e,t){this.uploadingMessageInfo={},this.core=e,this.service=t}var t=e.prototype;return t.prepareMessage=function(e,t,r,n){var i=this.checkIfResend(e),o=this.generateSendMessage({message:e,params:r,resend:i,conversationId:t,replyMessage:n}),a=dr({},r.targetConfig?{targetConfig:r.targetConfig}:{}),s=this.checkIfAntispam(r,o),c=s.clientAntispamResult,u=s.text;return o.text=u,o.clientAntispamHit=!!c&&3===c.operateType,{messageBeforeSend:o,clientAntispamResult:c,hiddenParams:a}},t.checkIfAntispam=function(e,t){var r,n=t.text;if(e.clientAntispamEnabled&&(0===t.messageType||10===t.messageType))if(1===(r=this.core.V2NIMClientAntispamUtil.checkTextAntispam?this.core.V2NIMClientAntispamUtil.checkTextAntispam(t.text||"",e.clientAntispamReplace):{operateType:0,replacedText:""}).operateType)n=r.replacedText;else if(2===r.operateType)throw this.service.emit("onSendMessage",dr(dr({},t),{sendingState:2,messageStatus:{errorCode:Tl.V2NIM_ERROR_CODE_CLIENT_ANTISPAM}})),new _l({code:Tl.V2NIM_ERROR_CODE_CLIENT_ANTISPAM,detail:{reason:"sendMessage: text intercepted by client antispam"}});return{clientAntispamResult:r,text:n}},t.doMsgReceiveReport=function(e,t){if(e.senderId!==this.core.account){var r=Zp(e,"__clientExt.statistics.apiCallingTime")||0,n=Zp(e,"__clientExt.statistics.sendTime")||0,i=Zp(e,"__clientExt.statistics.attachUploadDuration")||0,o=this.core.timeOrigin.getNTPTime(),a=e.createTime,s=this.core.timeOrigin.checkNodeReliable(t.__receiveTimeNode)?this.core.timeOrigin.getNTPTime(t.__receiveTimeNode):o;this.core.reporter.report("msgReceive",{msgId:e.messageServerId,clientId:e.messageClientId,serverTime:e.createTime,receiveTime:s,fromAccid:1===e.conversationType?e.senderId:"",toAccid:e.receiverId,type:Xg(e.conversationType),tid:1===e.conversationType?"":e.receiverId,apiCallingTime:r,sendTime:n,attachUploadDuration:i,callbackTime:o,preHandleTime:o,result:200,failReason:"",rt:o-a})}},t.checkIfResend=function(e){var t=this.service.model.getMessageById(e.messageClientId),r=!1;if(e.messageServerId||1===e.sendingState)throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"sendMessage: message has already been sent"}});if(1===(null==t?void 0:t.sendingState))throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"sendMessage: message has already been sent"}});return t&&(r=!0),r},t.doSendMessage=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a,s,c,u,d,l,p,m,h;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.apiCallingTimeNode,n=e.messageBeforeSend,i=e.clientAntispamResult,o=e.hiddenParams,a=e.progress,s={},!(c=this.service instanceof uM)){t.next=7;break}u="ysfSendMessage",t.next=20;break;case 7:if(1!==n.conversationType){t.next=11;break}u="v2SendP2pMessage",t.next=20;break;case 11:if(2!==n.conversationType){t.next=15;break}u="v2SendTeamMessage",t.next=20;break;case 15:if(3!==n.conversationType){t.next=19;break}u="v2SendSuperTeamMessage",t.next=20;break;case 19:throw new wl({detail:{reason:"conversationType: "+n.conversationType+" is not supported"}});case 20:if(this.service.sendMessageHandler(n),!c&&this.core.eventBus.emit("forwardSend/V2NIMMessageService/sendMsg",n),!n.attachment||!("uploadState"in n.attachment)||n.attachment.url||0!==n.attachment.uploadState&&2!==n.attachment.uploadState){t.next=48;break}return d=_s(),t.prev=24,n.attachmentUploadState=3,n.attachment.uploadState=3,this.service.emit("onSendMessage",n),t.next=30,this.service.fileUtil.doSendFile(n,a);case 30:n.attachmentUploadState=1,n.attachment.uploadState=1,this.service.emit("onSendMessage",n),t.next=45;break;case 35:throw t.prev=35,t.t0=t.catch(24),n.attachmentUploadState=2,n.attachment.uploadState=2,n.sendingState=2,n.messageStatus={errorCode:t.t0.code||Tl.V2NIM_ERROR_CODE_UNKNOWN},this.service.emit("onSendMessage",n),s.attachUploadDuration=_s()-d,this.doSendMessageFailed(r,s,n,t.t0),t.t0;case 45:s.attachUploadDuration=_s()-d,t.next=49;break;case 48:this.service.emit("onSendMessage",n);case 49:return this.core.timeOrigin.checkNodeReliable(r)&&(s.apiCallingTime=this.core.timeOrigin.getNTPTime(r),s.sendTime=this.core.timeOrigin.getNTPTime(),n.__clientExt={statistics:s}),t.prev=50,t.next=53,this.core.sendCmd(u,{tag:dr({},n,o)});case 53:l=t.sent,t.next=63;break;case 56:throw t.prev=56,t.t1=t.catch(50),this.doSendMessageFailed(r,s,n,t.t1),n.sendingState=2,n.messageStatus={errorCode:t.t1.code||Tl.V2NIM_ERROR_CODE_UNKNOWN},this.service.emit("onSendMessage",n),t.t1;case 63:return p=Zp(l,"content.data.errorCode"),m=dr(dr(dr({},n),l.content.data),{sendingState:1,messageStatus:{errorCode:p&&200!==p?p:200}}),this.service.sendMessageHandler(m),!c&&this.core.eventBus.emit("forwardSend/V2NIMMessageService/sendMsg",m),this.doMsgSendReport(r,s,n),(h=m.antispamResult)&&(m.messageStatus.errorCode=Tl.V2NIM_ERROR_CODE_SERVER_ANTISPAM),delete m.antispamResult,this.service.emit("onSendMessage",m),t.abrupt("return",dr(dr({message:m},h?{antispamResult:h}:{}),i?{clientAntispamResult:i}:{}));case 73:case"end":return t.stop()}}),t,this,[[24,35],[50,56]])})))},t.doSendMessageFailed=function(e,t,r,n){var i=dr(dr({},r),{sendingState:2});this.core.eventBus.emit("forwardSend/V2NIMMessageService/sendMsg",i),this.service.sendMessageHandler(i),this.doMsgSendReport(e,t,r,n)},t.doMsgSendReport=function(e,t,r,n){t.apiCallingTime=this.core.timeOrigin.getNTPTime(e),t.sendTime=this.core.timeOrigin.getNTPTime();var i=this.core.timeOrigin.getNTPTime(),o=Zp(n,"detail.reason");this.core.reporter.report("msgSend",{msgId:r.messageServerId,clientId:r.messageClientId,msgTime:r.createTime,fromAccid:1===r.conversationType?r.senderId:"",toAccid:r.receiverId,type:Xg(r.conversationType),tid:1===r.conversationType?"":r.receiverId,result:n?n.code:200,failReason:o||(null==n?void 0:n.message)||"",rt:i-t.apiCallingTime,apiCallingTime:t.apiCallingTime,sendTime:t.sendTime,attachUploadDuration:t.attachUploadDuration,apiCallbackTime:i})},t.generateSendMessage=function(e){var t,r,n=e.conversationId,i=e.replyMessage,o=e.resend,a=e.message,s=e.params,c={};if(i){var u=i.threadRoot;c={threadReply:{senderId:i.senderId,receiverId:i.receiverId,messageServerId:i.messageServerId,createTime:i.createTime,messageClientId:i.messageClientId,conversationType:i.conversationType,conversationId:i.conversationId},threadRoot:{senderId:u?u.senderId:i.senderId,receiverId:u?u.receiverId:i.receiverId,messageServerId:u?u.messageServerId:i.messageServerId,createTime:u?u.createTime:i.createTime,messageClientId:u?u.messageClientId:i.messageClientId,conversationType:u?u.conversationType:i.conversationType,conversationId:u?u.conversationId:i.conversationId}}}var d=this.core.V2NIMConversationIdUtil.parseConversationType(n),l=this.core.V2NIMConversationIdUtil.parseConversationTargetId(n);s.pushConfig&&!0!==s.pushConfig.forcePush&&(delete s.pushConfig.forcePushContent,delete s.pushConfig.forcePushAccountIds);var p={},m={};if(s.aiConfig){var h=Zp(s,"aiConfig.content.msg"),f=Zp(s,"aiConfig.content.type")||0;h?m={msg:h,type:f}:void 0===h&&0===a.messageType&&(m={msg:a.text||"",type:f}),(p=dr({},s.aiConfig)).aiStatus=1,void 0!==m.msg&&(p.content=m)}var g=null===(r=null===(t=this.core.V2NIMUserService)||void 0===t?void 0:t.model)||void 0===r?void 0:r.getUser(this.core.account),v=(null==g?void 0:g.updateTime)||0;return dr(dr(dr(dr(dr(dr(dr(dr({},a),c),{messageConfig:dr(dr({},a.messageConfig),s.messageConfig),routeConfig:dr(dr({},a.routeConfig),s.routeConfig),pushConfig:dr(dr({},a.pushConfig),s.pushConfig),antispamConfig:dr(dr({},a.antispamConfig),s.antispamConfig),robotConfig:dr(dr({},a.robotConfig),s.robotConfig)}),p&&p.accountId?{aiConfig:p}:{}),a.attachment?{attachment:dr({},a.attachment)}:{}),{resend:o,senderId:this.core.account,conversationType:d,receiverId:l,conversationId:this.core.V2NIMConversationIdUtil.messageConversationId({conversationType:d,senderId:this.core.account,receiverId:l})}),v?{userUpdateTime:v}:{}),{sendingState:3})},e}(),lM=function(){function e(e,t){this.core=e,this.service=t}var t=e.prototype;return t.checkIfModify=function(e,t){var r,n;if("0"===e.messageServerId)throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"modifyMessage: messageServerId cannot be empty"}});if(1===e.conversationType&&e.senderId!==this.core.account)throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"modifyMessage: senderId should be self"}});if(!ou(r=[0,1,2,3,4,6,10,12,100]).call(r,e.messageType))throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"modifyMessage: messageType "+e.messageType+" not correct"}});if(ou(n=[0,1,2,3,6,10,12]).call(n,e.messageType)&&t.attachment)throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"modifyMessage: messageType "+e.messageType+" can not modify attachment"}});var i=["subType","text","serverExtension","attachment"];if(!Gm(i).call(i,(function(e){return void 0!==Zp(t,e)})))throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"modifyMessage: missing modified params"}});if(xu(i).call(i,(function(r){return"attachment"===r?e.attachment&&t.attachment?Bg(e.messageType,e.attachment)===Bg(e.messageType,t.attachment):!t.attachment:Zp(e,r)===Zp(t,r)})))throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"modifyMessage: no change"}})},t.prepareMessage=function(e,t){var r=this.generateSendMessage(e,t),n=this.checkIfAntispam(t,r),i=n.clientAntispamResult,o=n.text;return r.text=o,r.clientAntispamHit=!!i&&3===i.operateType,{messageBeforeSend:r,clientAntispamResult:i}},t.modifyMessage=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o,a,s;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(1!==e.conversationType){r.next=4;break}n="v2MessageP2pModify",r.next=13;break;case 4:if(2!==e.conversationType){r.next=8;break}n="v2MessageTeamModify",r.next=13;break;case 8:if(3!==e.conversationType){r.next=12;break}n="v2MessageSuperTeamModify",r.next=13;break;case 12:throw new wl({detail:{reason:"conversationType: "+e.conversationType+" is not supported"}});case 13:return r.next=15,this.core.sendCmd(n,{tag:e});case 15:if(i=r.sent,!t||3!==t.operateType){r.next=18;break}return r.abrupt("return",{errorCode:Tl.V2NIM_ERROR_CODE_CLIENT_ANTISPAM,clientAntispamResult:t});case 18:if(o=dr(dr({},e),i.content.data),!(a=o.antispamResult)){r.next=22;break}return r.abrupt("return",dr({errorCode:Tl.V2NIM_ERROR_CODE_SERVER_ANTISPAM,antispamResult:a},t?{clientAntispamResult:t}:{}));case 22:return delete o.antispamResult,s=Og(this.core,o),this.service.model.upsertMessages([s]),this.core.eventBus.emit("forwardSend/V2NIMMessageService/modifyMsg",s),r.abrupt("return",dr(dr({errorCode:200,message:s},a?{antispamResult:a}:{}),t?{clientAntispamResult:t}:{}));case 27:case"end":return r.stop()}}),r,this)})))},t.checkIfAntispam=function(e,t){var r,n=t.text;if(e.clientAntispamEnabled&&(0===t.messageType||10===t.messageType))if(1===(r=this.core.V2NIMClientAntispamUtil.checkTextAntispam?this.core.V2NIMClientAntispamUtil.checkTextAntispam(t.text||"",e.clientAntispamReplace):{operateType:0,replacedText:""}).operateType)n=r.replacedText;else if(2===r.operateType)throw new _l({code:Tl.V2NIM_ERROR_CODE_CLIENT_ANTISPAM,detail:{reason:"sendMessage: text intercepted by client antispam"}});return{clientAntispamResult:r,text:n}},t.generateSendMessage=function(e,t){var r;return dr(dr({messageConfig:{lastMessageUpdateEnabled:null===(r=e.messageConfig)||void 0===r?void 0:r.lastMessageUpdateEnabled},routeConfig:dr({routeEnabled:!0},t.routeConfig),pushConfig:dr({pushEnabled:!0,pushNickEnabled:!0,forcePush:!1},t.pushConfig),antispamConfig:dr({antispamEnabled:!0},t.antispamConfig)},t.attachment?{attachment:t.attachment}:{}),{conversationType:e.conversationType,senderId:e.senderId,receiverId:e.receiverId,createTime:e.createTime,messageClientId:e.messageClientId,messageServerId:e.messageServerId,messageType:e.messageType,subType:t.subType,text:t.text,serverExtension:t.serverExtension})},e}(),pM=function(e){function t(t,r){var n;return void 0===r&&(r={}),(n=e.call(this,"V2NIMMessageService",t)||this).customAttachmentParsers=[],n.config={compatibleWithV1:!0},n.emitRevokeMessage=function(e){var t=du(e).call(e,(function(e){return Vg(n.core,e)}));jn(t).call(t,(function(e){n.model.deleteMessage(e.messageRefer.messageClientId)})),n.emit("onMessageRevokeNotifications",t),n.core.eventBus.emit("V2NIMConversationService/revokeMessages",t)},n.sendMessageHandler=function(e){if(e.msgAckSnapshot){var t=e.msgAckSnapshot,r={conversationId:e.conversationId,messageServerId:e.messageServerId,messageClientId:e.messageClientId,readCount:0,unreadCount:Number(t)};delete e.msgAckSnapshot,n.emit("onReceiveTeamMessageReadReceipts",[r])}e=qg(e,n.core),n.model.upsertMessages([e]),n.core.eventBus.emit("V2NIMConversationService/sendMessage",e,e.sendingState)},n.revokeMessagesHandler=function(e){jn(e).call(e,(function(e){n.model.deleteMessage(e.messageRefer.messageClientId)})),n.emit("onMessageRevokeNotifications",e),n.core.eventBus.emit("V2NIMConversationService/revokeMessages",e)},n.deleteMessagesHandler=function(e){jn(e).call(e,(function(e){n.model.deleteMessage(e.messageRefer.messageClientId)})),n.emit("onMessageDeletedNotifications",e),n.core.eventBus.emit("V2NIMConversationService/deleteMessages",e)},n.core._registerDep(Mg,"V2NIMConversationIdUtil"),n.core._registerDep(rM,"V2NIMMessageCreator"),n.core._registerDep(nM,"V2NIMMessageAttachmentCreator"),n.core._registerDep(cM,"V2NIMClientAntispamUtil"),n.receiptUtil=new hy(n.core,ut(n)),n.fileUtil=new fy(n.core),n.sendUtil=new dM(n.core,ut(n)),n.modifyUtil=new lM(n.core,ut(n)),n.model=new kv,"v2"!==n.core.options.apiVersion?ut(n):(Mh({cmdMap:jg,cmdConfig:zg}),n.setOptions(r),n.setListener(),n)}nr(t,e);var r=t.prototype;return r.setOptions=function(e){var t;(null===(t=this.core.msg)||void 0===t?void 0:t.name)?this.config.compatibleWithV1=!0:this.config.compatibleWithV1=!1,this.config=dr(this.config,e)},r.setListener=function(){var e=this;this.core.eventBus.on("forwardReceive/V2NIMMessageService/sendMsg",this.sendMessageHandler),this.core.eventBus.on("forwardReceive/V2NIMMessageService/revokeMessages",this.emitRevokeMessage),this.core.eventBus.on("forwardReceive/V2NIMMessageService/deleteMessages",this.deleteMessagesHandler),this.core.eventBus.on("V2NIMConversationService/deleteConversation",(function(t){jn(t).call(t,(function(t){return e.model.deleteMessages(t)}))}))},r.reset=function(){this.model.reset()},r.emit=function(t){for(var r,n,i,o=this.name+"::emit "+t.toString(),a=arguments.length,s=new Array(a>1?a-1:0),c=1;c<a;c++)s[c-1]=arguments[c];if("onSendMessage"===t){var u=s[0];this.logger.log(""+o,u.messageClientId+"/"+u.messageServerId+"/"+u.createTime+";","sendingState:"+u.sendingState+";attachmentUploadState:"+(u.attachmentUploadState||0)+";messageStatus:"+(null===(i=u.messageStatus)||void 0===i?void 0:i.errorCode))}else if("onReceiveMessages"===t||"onReceiveMessagesModified"===t){var d=s[0];this.logger.log(""+o,du(d).call(d,(function(e){return e.messageClientId+"/"+e.messageServerId+"/"+e.createTime})))}else if("onMessageRevokeNotifications"===t){var l=s[0];this.logger.log(""+o,du(l).call(l,(function(e){return"msg:"+e.messageRefer.messageClientId+"/"+e.messageRefer.messageServerId+";revokeAccountId:"+e.revokeAccountId})))}else if("onMessageDeletedNotifications"===t){var p=s[0];this.logger.log(""+o,du(p).call(p,(function(e){return"msg:"+e.messageRefer.messageClientId+"/"+e.messageRefer.messageServerId})))}else{var m,h;(m=this.logger).log.apply(m,xs(h=[""+o]).call(h,s))}return(r=e.prototype.emit).call.apply(r,xs(n=[this,t]).call(n,s))},r.checkExtendUtil=function(){var e;if(!(null===(e=this.core.V2NIMMessageExtendUtil)||void 0===e?void 0:e.name))throw new _l({code:Tl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"V2NIMMessageLogUtil is not registered"}})},r.checkLogUtil=function(){var e;if(!(null===(e=this.core.V2NIMMessageLogUtil)||void 0===e?void 0:e.name))throw new _l({code:Tl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"V2NIMMessageExtendUtil is not registered"}})},r.getMessageList=function(e){return this.checkV2(),this.checkLogUtil(),this.core.V2NIMMessageLogUtil.getMessageList(e)},r.getMessageListByRefers=function(e){return this.checkV2(),this.checkLogUtil(),this.core.V2NIMMessageLogUtil.getMessageListByRefers(e)},r.clearHistoryMessage=function(e){return this.checkV2(),this.checkLogUtil(),this.core.V2NIMMessageLogUtil.clearHistoryMessage(e)},r.pinMessage=function(e,t){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.pinMessage(e,t)},r.unpinMessage=function(e,t){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.unpinMessage(e,t)},r.updatePinMessage=function(e,t){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.updatePinMessage(e,t)},r.voiceToText=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.voiceToText(e)},r.getPinnedMessageList=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.getPinnedMessageList(e)},r.addQuickComment=function(e,t,r,n){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.addQuickComment(e,t,r,n)},r.removeQuickComment=function(e,t,r){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.removeQuickComment(e,t,r)},r.getQuickCommentList=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.getQuickCommentList(e)},r.addCollection=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.addCollection(e)},r.removeCollections=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.removeCollections(e)},r.updateCollectionExtension=function(e,t){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.updateCollectionExtension(e,t)},r.getCollectionListByOption=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.getCollectionListByOption(e)},r.getCollectionListExByOption=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.getCollectionListExByOption(e)},r.searchCloudMessages=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.searchCloudMessages(e)},r.getThreadMessageList=function(e){return this.checkV2(),this.checkExtendUtil(),this.core.V2NIMMessageExtendUtil.getThreadMessageList(e)},r.registerCustomAttachmentParser=function(e){var t;"function"==typeof e&&-1===wu(t=this.customAttachmentParsers).call(t,e)&&this.customAttachmentParsers.unshift(e)},r.unregisterCustomAttachmentParser=function(e){var t,r,n=wu(t=this.customAttachmentParsers).call(t,e);n>-1&&di(r=this.customAttachmentParsers).call(r,n,1)},r.sendP2PMessageReceipt=function(e){return this.checkV2(),this.receiptUtil.sendP2PMessageReceipt(e)},r.isPeerRead=function(e){return this.checkV2(),this.receiptUtil.isPeerRead(e)},r.getP2PMessageReceipt=function(e){return this.checkV2(),this.receiptUtil.getP2PMessageReceipt(e)},r.getTeamMessageReceipts=function(e){return this.checkV2(),this.receiptUtil.getTeamMessageReceipts(e)},r.getTeamMessageReceiptDetail=function(e){return this.checkV2(),this.receiptUtil.getTeamMessageReceiptDetail(e)},r.sendTeamMessageReceipts=function(e){return this.checkV2(),this.receiptUtil.sendTeamMessageReceipts(e)},r.revokeMessage=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o,a,s,c,u;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),Pl(Bv,{message:e,params:t},"",!0),Vl(this.core.account,e.conversationId),1!==e.conversationType||e.senderId===this.core.account){r.next=7;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"revokeMessage: p2p message senderId is not current user"}});case 7:if(e.messageServerId&&"0"!==e.messageServerId){r.next=9;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"revokeMessage: cannot revoke message with invalid messageServerId: "+e.messageServerId}});case 9:return o=3===e.conversationType?"v2RevokeSuperTeamMessage":"v2RevokeMessage",(n={})[1]=7,n[2]=8,n[3]=12,a=n,s=dr(dr(dr({},e),t),{attach:t&&t.serverExtension,sysMsgType:a[e.conversationType],opeAccount:this.core.account}),r.next=14,this.core.sendCmd(o,{tag:s});case 14:(i={})[1]=1,i[2]=2,i[3]=3,c=i,u=[JSON.parse(_i({postscript:t&&t.postscript,revokeType:c[e.conversationType],revokeAccountId:this.core.account,serverExtension:t&&t.serverExtension,messageRefer:Lg(this.core,e)}))],this.revokeMessagesHandler(u),this.core.eventBus.emit("forwardSend/V2NIMMessageService/revokeMessage",s);case 18:case"end":return r.stop()}}),r,this)})))},r.deleteMessage=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o,a;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),Pl(Hv,e,"",!0),3!==e.sendingState){r.next=6;break}this.fileUtil.cancelMessageAttachmentUpload(e),r.next=8;break;case 6:if(!e.sendingState||1===e.sendingState){r.next=8;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"deleteMessage: cannot delete unsent message"}});case 8:if(n={messageRefer:Lg(this.core,e),serverExtension:t},i=_s(),!e.messageServerId||"0"===e.messageServerId){r.next=15;break}return r.next=13,this.core.sendCmd("v2DeleteMessage",{tag:n});case 13:o=r.sent,i=o.content.timetag;case 15:a=[{serverExtension:t,messageRefer:Lg(this.core,e),deleteTime:i}],this.core.eventBus.emit("forwardSend/V2NIMMessageService/deleteSelfMsgs",[dr(dr({},n),{deleteTime:i})]),this.deleteMessagesHandler(a);case 18:case"end":return r.stop()}}),r,this)})))},r.deleteMessages=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o,a,s,c,u,d,l,p,m=this;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),Pl(Wv,{messages:e},"",!0),i=[],o=[],0!==e.length){r.next=8;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"deleteMessages: message array length is 0"}});case 8:a=e[0].conversationId,s=0;case 10:if(!(s<e.length)){r.next=23;break}if(3!==e[s].sendingState){r.next=15;break}this.fileUtil.cancelMessageAttachmentUpload(e[s]),r.next=17;break;case 15:if(!e[s].sendingState||1===e[s].sendingState){r.next=17;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"deleteMessage: sendingState should be succeeded, please check message at index: "+s}});case 17:if(!(s>=1&&e[s].conversationId!==a)){r.next=19;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"deleteMessages: only allow to delete messages from same conversation"}});case 19:e[s].messageServerId&&"0"!==e[s].messageServerId?i.push(e[s]):o.push(e[s]);case 20:s++,r.next=10;break;case 23:if(c=_s(),u=xs(n=[]).call(n,o),r.prev=25,!(i.length>0)){r.next=32;break}return r.next=29,this.core.sendCmd("v2DeleteMessages",{tag:du(i).call(i,(function(e){return{messageRefer:e,serverExtension:t}}))});case 29:l=r.sent,c=l.content.timetag,u=xs(d=[]).call(d,u,i);case 32:r.next=41;break;case 34:if(r.prev=34,r.t0=r.catch(25),0!==o.length){r.next=40;break}throw r.t0;case 40:this.logger.warn("V2NIMMessageService:deleteMessages: delete messages with serverId failed");case 41:p=du(u).call(u,(function(e){return{serverExtension:t,messageRefer:Lg(m.core,e),deleteTime:c}})),this.core.eventBus.emit("forwardSend/V2NIMMessageService/deleteSelfMsgs",du(u).call(u,(function(e){return{messageRefer:e,serverExtension:t,deleteTime:c}}))),this.deleteMessagesHandler(p);case 44:case"end":return r.stop()}}),r,this,[[25,34]])})))},r.cancelMessageAttachmentUpload=function(e){return this.checkV2(),this.fileUtil.cancelMessageAttachmentUpload(e)},r.markMsgsAck=function(e){var t=this;if(e&&e.length>0){var r=[],n=[];jn(e).call(e,(function(e){e.senderId===t.core.account&&e.senderId!==e.receiverId||(1===e.conversationType?r.push(e):2===e.conversationType&&n.push(e))})),r.length>0&&this.core.sendCmd("v2BatchMarkRead",{sid:7,cid:2,ids:du(r).call(r,(function(e){return e.messageServerId}))}),n.length>0&&this.core.sendCmd("v2BatchMarkRead",{sid:8,cid:3,ids:du(n).call(n,(function(e){return e.messageServerId}))})}},r.onMsgHandler=function(e){var t=e.content.msg,r=t._conversationOnlineSyncNotify,n=t._conversationOnlineSyncData,i=Jl(t,["_conversationOnlineSyncNotify","_conversationOnlineSyncData"]),o=Og(this.core,i),a=qg(o,this.core);this.logger.log("v2OnMsgHandler::recvMsg "+a.messageClientId+" "+a.messageServerId),5!==a.messageType&&this.core.V2NIMUserService.checkUserUpdate&&this.core.V2NIMUserService.checkUserUpdate(a,a.userUpdateTime),!this.config.compatibleWithV1&&this.sendUtil.doMsgReceiveReport(a,e),delete a.__clientExt,this.emit("onReceiveMessages",[a]),this.model.upsertMessages([a]),!this.config.compatibleWithV1&&this.markMsgsAck([a]),r&&this.core.eventBus.emit("V2NIMConversationService/conversationOnlineSyncNotify",{content:{info:JSON.parse(r),data:JSON.parse(n)}},a),5===a.messageType&&this.core.eventBus.emit("V2NIMTeamService/notification",o)},r.syncOfflineMsgsHandler=function(e){var t=this,r=e.content.datas,n=du(r).call(r,(function(e){return qg(Og(t.core,e),t.core)}));!this.config.compatibleWithV1&&this.markMsgsAck(n),this.emit("onReceiveMessages",n),this.model.upsertMessages(n),this.core.eventBus.emit("V2NIMConversationService/checkBackFill",du(n).call(n,(function(e){return e.conversationId})))},r.syncRoamingMsgsHandler=function(e){var t=this,r=e.content.datas;r=du(r).call(r,(function(e){return qg(Og(t.core,e),t.core)})),this.emit("onReceiveMessages",r),this.model.upsertMessages(r),this.core.eventBus.emit("V2NIMConversationService/checkBackFill",du(r).call(r,(function(e){return e.conversationId})))},r.onP2PMessageReceiptsHandler=function(e){this.receiptUtil.onP2PMessageReceiptsHandler(e)},r.onTeamMessageReceiptsHandler=function(e){this.receiptUtil.onTeamMessageReceiptsHandler(e)},r.syncP2PMessagReceiptsHandler=function(e){this.receiptUtil.syncP2PMessagReceiptsHandler(e)},r.syncRevokeMessageHandler=function(e){this.emitRevokeMessage(e.content.datas)},r.onRevokeMessageHandler=function(e){this.emitRevokeMessage([e.content.data])},r.onDeleteMessageHandler=function(e){var t=e.content.data,r={serverExtension:t.serverExtension,deleteTime:t.deleteTime,messageRefer:Pg(this.core,t.messageRefer)};this.deleteMessagesHandler([r])},r.onDeleteMessagesHandler=function(e){var t,r=this,n=du(t=e.content.data).call(t,(function(e){return{serverExtension:e.serverExtension,deleteTime:e.deleteTime,messageRefer:Pg(r.core,e.messageRefer)}}));this.deleteMessagesHandler(n)},r.syncOnDeleteMessagesHandler=function(e){var t=this,r=e.content.datas,n=du(r).call(r,(function(e){return{serverExtension:e.serverExtension,deleteTime:e.deleteTime,messageRefer:Pg(t.core,e.messageRefer)}}));this.emit("onMessageDeletedNotifications",n)},r.sendMessage=function(e,t,r,n){return void 0===r&&(r={}),zl(this,void 0,void 0,Ql.mark((function i(){var o,a,s,c,u,d,l,p,m=this;return Ql.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(this.checkV2(),Pl({message:{type:"object"}},{message:e},"",!0),e.messageClientId=e.messageClientId||Ep(),!e.conversationId||e.conversationId===t){i.next=5;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"sendMessage: message.conversationId is not equal to conversationId"}});case 5:if(Pl(qv,{conversationId:t,message:e,params:r},"",!0),Vl(this.core.account,t),2!==(o=this.core.V2NIMConversationIdUtil.parseConversationType(t))&&3!==o||!r.robotConfig||r.robotConfig.accountId){i.next=10;break}throw new wl({detail:{reason:"When conversationType is team or superTeam, account is required in robotInfo account is required"}});case 10:if(2!==o&&3!==o||!r.targetConfig){i.next=20;break}if(a=r.targetConfig.receiverIds,3!==o||!1!==r.targetConfig.inclusive){i.next=14;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"setting inclusive to false for super teams is not allowed"}});case 14:if(a=fu(a).call(a,(function(e){return e&&e!==m.core.account})),0!==a.length){i.next=17;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"receiverIds cannot be empty or only contain yourself"}});case 17:r.targetConfig.receiverIds=a,i.next=21;break;case 20:r.targetConfig=void 0;case 21:return s=this.core.timeOrigin.getTimeNode(),c=this.sendUtil.prepareMessage(e,t,r),u=c.messageBeforeSend,d=c.clientAntispamResult,l=c.hiddenParams,this.logger.log("V2SendMessage start:"+u.messageClientId+"/"+u.createTime+";conversation:"+t+";","NTPTime:"+this.core.timeOrigin.getNTPTime(s)),i.prev=24,i.next=27,this.sendUtil.doSendMessage({apiCallingTimeNode:s,messageBeforeSend:u,clientAntispamResult:d,hiddenParams:l,progress:n});case 27:p=i.sent,i.next=34;break;case 30:throw i.prev=30,i.t0=i.catch(24),this.logger.warn("V2SendMessage end:"+u.messageClientId+".",i.t0 instanceof _l?"failed:"+i.t0.code:"failed"),i.t0;case 34:return p.message.senderId===p.message.receiverId&&this.markMsgsAck([p.message]),this.logger.log("V2SendMessage end:"+p.message.messageClientId+"/"+p.message.messageServerId+"/"+p.message.createTime),i.abrupt("return",p);case 37:case"end":return i.stop()}}),i,this,[[24,30]])})))},r.replyMessage=function(e,t,r,n){return void 0===r&&(r={}),zl(this,void 0,void 0,Ql.mark((function i(){var o,a,s,c,u,d;return Ql.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(this.checkV2(),Pl({message:{type:"object"}},{message:e},"",!0),e.messageClientId=e.messageClientId||Ep(),Pl(Dv,{message:e,replyMessage:t,params:r},"",!0),Vl(this.core.account,t.conversationId),2!==e.conversationType&&3!==e.conversationType||!r.robotConfig||r.robotConfig.accountId){i.next=7;break}throw new wl({detail:{reason:"When conversationType is team or superTeam, account is required in robotInfo account is required"}});case 7:return o=this.core.timeOrigin.getTimeNode(),a=this.sendUtil.prepareMessage(e,t.conversationId,r,t),s=a.messageBeforeSend,c=a.clientAntispamResult,u=a.hiddenParams,i.next=11,this.sendUtil.doSendMessage({apiCallingTimeNode:o,messageBeforeSend:s,clientAntispamResult:c,hiddenParams:u,progress:n});case 11:return(d=i.sent).message.senderId===d.message.receiverId&&this.markMsgsAck([d.message]),i.abrupt("return",d);case 14:case"end":return i.stop()}}),i,this)})))},r.modifyMessage=function(e,t){this.checkV2(),this.checkLogin(),Pl(ly,e,"message",!0),Pl(py,t,"params",!0),this.modifyUtil.checkIfModify(e,t);var r=this.modifyUtil.prepareMessage(e,t),n=r.messageBeforeSend,i=r.clientAntispamResult;return this.modifyUtil.modifyMessage(n,i)},r.v2MessageOnModifiedHandler=function(e){var t=Og(this.core,e.content.data);this.model.upsertMessages([t]),this.core.eventBus.emit("forwardSend/V2NIMMessageService/modifyMsg",t),this.emit("onReceiveMessagesModified",[t])},r.v2MessageSyncModifiedHandler=function(e){var t,r,n=this,i=fu(t=du(r=e.content.datas).call(r,(function(e){return Og(n.core,e)}))).call(t,(function(e){var t,r=(null===(t=n.model.getMessageById(e.messageClientId))||void 0===t?void 0:t.modifyTime)||0;return(e.modifyTime||0)>r}));i.length>0&&(this.model.upsertMessages(i),jn(i).call(i,(function(e){return n.core.eventBus.emit("forwardSend/V2NIMMessageService/modifyMsg",e)})),this.emit("onReceiveMessagesModified",i))},r.v2MessageSyncSuperTeamModifiedHandler=function(e){this.v2MessageSyncModifiedHandler(e)},t}(rf),mM="V2NIMMessageLogUtil",hM={"30_6":"v2GetMessageList","33_2":"v2GetMessageListByRefers","30_18":"v2ClearHistoryMessage","7_118":"onClearHistoryMessage","4_24":"syncClearHistoryMessage","31_23":"v2GetTeamMessageList","32_14":"v2GetSuperTeamMessageList"},fM={conversationType:{id:0,retType:"number"},receiverId:1,deleteRoam:{id:2,converter:Th},teamId:3,onlineSync:{id:4,converter:Th},deleteTime:{id:6,retType:"number"},serverExtension:7},gM=[{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"direction"},{type:"LongArray",name:"msgTypes"}],vM={v2GetMessageList:{sid:30,cid:6,service:mM,params:xs(Yy=[{type:"String",name:"to"}]).call(Yy,gM),response:[{type:"PropertyArray",name:"msgs",reflectMapper:Sh(Hg)}]},v2GetMessageListByRefers:{sid:33,cid:2,service:mM,params:[{type:"PropertyArray",name:"tag",reflectMapper:Hg,select:["conversationType","senderId","receiverId","createTime","messageServerId"]}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:Sh(Hg)}]},v2ClearHistoryMessage:{sid:30,cid:18,service:mM,params:[{type:"Property",name:"tag",reflectMapper:fM}],response:[{type:"Long",name:"timetag"}]},v2GetTeamMessageList:{sid:31,cid:23,service:mM,params:xs(Qy=[{type:"Long",name:"to"}]).call(Qy,gM),response:[{type:"PropertyArray",name:"msgs",reflectMapper:Sh(Hg)}]},v2GetSuperTeamMessageList:{sid:32,cid:14,service:mM,params:xs(Jy=[{type:"Long",name:"to"}]).call(Jy,gM),response:[{type:"PropertyArray",name:"msgs",reflectMapper:Sh(Hg)}]},onClearHistoryMessage:{sid:7,cid:118,service:mM,response:[{type:"Property",name:"data",reflectMapper:Sh(fM)}]},syncClearHistoryMessage:{sid:4,cid:24,service:mM,response:[{type:"PropertyArray",name:"data",reflectMapper:Sh(fM)}]}},yM=function(e){function t(t){var r;return(r=e.call(this,"V2NIMMessageLogUtil",t)||this).clearHistoryMessageHandler=function(e){var t=Ug(r.core,e);r.emitClearHistoryMessage([t])},r.core=t,r.service=r.core.V2NIMMessageService,"v2"!==r.core.options.apiVersion?ut(r):(Mh({cmdMap:hM,cmdConfig:vM}),r.setListener(),r)}nr(t,e);var r=t.prototype;return r.setListener=function(){this.core.eventBus.on("forwardReceive/V2NIMMessageLogService/clearHistoryMessage",this.clearHistoryMessageHandler)},r.getMessageListByRefers=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a,s,c=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),Pl(jv,{messageRefers:e},"",!0),0!==e.length){t.next=4;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getMessageListByRefers: messageRefers cannot be an empty array"}});case 4:if(i=[],o=du(e).call(e,(function(e){var t=c.service.model.getMessageById(e.messageClientId);return!t&&e.messageServerId&&"0"!==e.messageServerId&&i.push(e),t})),a=[],!(i.length>0)){t.next=12;break}return t.next=10,this.core.sendCmd("v2GetMessageListByRefers",{tag:i});case 10:s=t.sent,a=s.content.msgs;case 12:return t.abrupt("return",du(r=fu(n=du(o).call(o,(function(t,r){if(t)return t;var n=e[r],i=oh(a).call(a,(function(e){return e.messageServerId===n.messageServerId}));return i?Og(c.core,i):void 0}))).call(n,(function(e){return void 0!==e}))).call(r,(function(e){return qg(e,c.core)})));case 13:case"end":return t.stop()}}),t,this)})))},r.getMessageList=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o,a,s,c,u,d,l,p,m,h,f,g=this;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),this.core.V2NIMConversationIdUtil&&this.core.V2NIMConversationIdUtil.parseConversationType){r.next=3;break}throw new Error('Service "V2NIMConversationService" does not exist');case 3:if(Pl(Fv,e,"",!0),Vl(this.core.account,e.conversationId),a=this.core.V2NIMConversationIdUtil.parseConversationType(e.conversationId),s=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e.conversationId),c=1===a?"v2GetMessageList":2===a?"v2GetTeamMessageList":"v2GetSuperTeamMessageList",u=e.beginTime||0,d=e.endTime||0,!(0!==u&&0!==d&&u>d)){r.next=12;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getMessageList: beginTime cannot be greater than endTime"}});case 12:if(l=void 0===e.direction?0:e.direction,!e.anchorMessage){r.next=29;break}if(0!==e.direction){r.next=23;break}if(0!==d){r.next=19;break}d=e.anchorMessage.createTime,r.next=21;break;case 19:if(d===e.anchorMessage.createTime){r.next=21;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getMessageList: When providing anchorMessage, when sorting in descending order, endTime does not need to be provided, or endTime should be equal to anchorMessage.createTime"}});case 21:r.next=29;break;case 23:if(0!==u){r.next=27;break}u=e.anchorMessage.createTime,r.next=29;break;case 27:if(u===e.anchorMessage.createTime){r.next=29;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getMessageList: When providing anchorMessage, when sorting in ascending order, there is no need to provide beginTime, or beginTime should be equal to anchorMessage.createTime"}});case 29:return p=null===(t=e.anchorMessage)||void 0===t?void 0:t.messageServerId,r.next=32,this.core.sendCmd(c,{beginTime:u,endTime:d,lastMsgId:p||0,limit:e.limit||50,direction:l,msgTypes:e.messageTypes?Wc(n=e.messageTypes).call(n):[],to:s});case 32:return m=r.sent,h=m.content,f=[],f=du(i=h.msgs).call(i,(function(e){return Og(g.core,e)})),p&&(f=fu(f).call(f,(function(e){return e.messageServerId!==p}))),r.abrupt("return",du(o=this.getMessageListMonkeyPatch(f,e)).call(o,(function(e){return qg(e,g.core)})));case 38:case"end":return r.stop()}}),r,this)})))},r.getMessageListMonkeyPatch=function(e,t){var r=t.conversationId,n=e,i=Ml(n).call(n,(function(e,t){return e[t.messageClientId]=!0,e}),{}),o=this.service.model.getMessagesByConversationId(r);o=Vm(o).call(o,(function(e,r){return 1===t.direction?e.createTime-r.createTime:r.createTime-e.createTime}));var a=0,s=t.beginTime||0,c=t.endTime||0;t.anchorMessage&&(0===t.direction?c=t.anchorMessage.createTime:s=t.anchorMessage.createTime,a=Qn(o).call(o,(function(e){var r;return e.messageClientId===(null===(r=t.anchorMessage)||void 0===r?void 0:r.messageClientId)})),a+=1);for(var u=a;u<o.length;u++){var d,l=o[u],p=!i[l.messageClientId],m=void 0===l.sendingState||1===l.sendingState,h=l.conversationId===r,f=l.createTime>s&&(l.createTime<c||0===c),g=!t.messageTypes||ou(d=t.messageTypes).call(d,l.messageType);p&&m&&h&&f&&g&&n.push(o[u])}return n=Vm(n).call(n,(function(e,r){return 1===t.direction?e.createTime-r.createTime:r.createTime-e.createTime})),Wc(n).call(n,0,t.limit||50)},r.clearHistoryMessage=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a,s,c,u;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Pl(Kv,e,"",!0),Vl(this.core.account,e.conversationId),r=e.conversationId,n=e.deleteRoam,i=e.onlineSync,o=e.serverExtension,a=this.core.V2NIMConversationIdUtil.parseConversationType(r),s=this.core.V2NIMConversationIdUtil.parseConversationTargetId(r),c={deleteRoam:n,onlineSync:i,serverExtension:o,conversationType:a},1===a?c.receiverId=s:c.teamId=s,t.next=10,this.core.sendCmd("v2ClearHistoryMessage",{tag:c});case 10:u=t.sent,this.core.eventBus.emit("forwardSend/V2NIMMessageLogService/clearHistoryMessage",dr(dr({},c),{deleteTime:u.content.timetag})),this.emitClearHistoryMessage([{deleteTime:u.content.timetag,serverExtension:o,conversationId:r}]);case 13:case"end":return t.stop()}}),t,this)})))},r.syncClearHistoryMessageHandler=function(e){var t,r=this,n=du(t=e.content.data).call(t,(function(e){return Ug(r.core,e)}));this.emitClearHistoryMessage(n)},r.onClearHistoryMessageHandler=function(e){var t=Ug(this.core,e.content.data);this.emitClearHistoryMessage([t])},r.emitClearHistoryMessage=function(e){var t=this;jn(e).call(e,(function(e){t.service.model.deleteMessages(e.conversationId,e.deleteTime)})),this.service.emit("onClearHistoryNotifications",e)},t}(rf),MM="V2NIMMessageExtendUtil",IM={"29_5":"v2VoiceToText","33_15":"v2PinMessage","33_16":"v2UpdatePinMessage","33_17":"v2UnpinMessage","23_18":"onPinMessage","23_19":"onUpdatePinMessage","23_20":"onUnpinMessage","23_115":"onPinMessage","23_116":"onUpdatePinMessage","23_117":"onUnpinMessage","33_21":"v2GetPinMessageList","33_3":"v2AddQuickComment","33_4":"v2RemoveQuickComment","33_7":"v2GetQuickComment","23_5":"onAddQuickComment","23_6":"onRemoveQuickComment","23_103":"onAddQuickComment","23_104":"onRemoveQuickComment","33_8":"v2AddCollection","33_9":"v2RemoveCollections","33_10":"v2UpdateCollectionExtension","33_11":"v2GetCollectionListByOption","30_26":"v2SearchCloudMessagesGroupByConversation","30_27":"v2SearchCloudMessages","33_1":"v2GetThreadMessageList"},SM={conversationType:{id:1,converter:Xg,retConverter:$g,access:"messageRefer.conversationType"},senderId:{id:2,access:"messageRefer.senderId"},receiverId:{id:3,access:"messageRefer.receiverId"},createTime:{id:4,retType:"number",access:"messageRefer.createTime"},messageServerId:{id:5,access:"messageRefer.messageServerId"},messageClientId:{id:6,access:"messageRefer.messageClientId"},detail:7,modify:{id:8,retType:"number"}},TM={conversationType:{id:1,access:"messageRefer.conversationType",retConverter:$g},senderId:{id:2,access:"messageRefer.senderId"},receiverId:{id:3,access:"messageRefer.receiverId"},time:{id:4,access:"messageRefer.createTime",converter:Th,retType:"number"},messageServerId:{id:5,access:"messageRefer.messageServerId"},messageClientId:{id:6,access:"messageRefer.messageClientId"},operatorId:7,serverExtension:8,createTime:{id:9,converter:Th,retType:"number"},updateTime:{id:10,converter:Th,retType:"number"}},bM={operatorId:1,index:{id:2,retType:"number"},createTime:{id:3,retType:"number"},serverExtension:4,pushEnabled:{id:5,access:"pushConfig.pushEnabled",converter:Th},needBadge:{id:6,access:"pushConfig.needBadge",converter:Th},title:{id:7,access:"pushConfig.title"},pushContent:{id:8,access:"pushConfig.pushContent"},pushPayload:{id:9,access:"pushConfig.pushPayload"}},CM={accid:1,serverExtension:2,createTime:{id:3,retType:"number"},updateTime:{id:4,retType:"number"}},_M={collectionId:1,collectionType:{id:2,retType:"number"},collectionData:3,serverExtension:4,uniqueId:5,createTime:{id:6,retType:"number"},updateTime:{id:7,retType:"number"}},EM={keyword:1,beginTime:2,endTime:3,messageLimit:5,sortOrder:{id:6,converter:function(e){return 0===e?2:1}},p2pAccountIds:{id:7,converter:function(e){return e.join(",")}},teamIds:{id:8,converter:function(e){return e.join(",")}},senderAccountIds:{id:9,converter:function(e){return e.join(",")}},messageTypes:{id:10,converter:function(e){return e.join(",")}},messageSubtypes:{id:11,converter:function(e){return e.join(",")}}},wM=dr(dr({},EM),{conversationLimit:4}),RM={v2PinMessage:{sid:33,cid:15,service:MM,params:[{type:"Property",name:"msg",reflectMapper:Hg,select:["conversationType","receiverId","senderId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"msgPin",reflectMapper:CM}],response:[{type:"Long",name:"timetag"}]},v2UnpinMessage:{sid:33,cid:17,service:MM,params:[{type:"Property",name:"msg",reflectMapper:Hg,select:["conversationType","receiverId","senderId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"msgPin",reflectMapper:CM}],response:[{type:"Long",name:"timetag"}]},v2UpdatePinMessage:{sid:33,cid:16,service:MM,params:[{type:"Property",name:"msg",reflectMapper:Hg,select:["conversationType","receiverId","senderId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"msgPin",reflectMapper:CM}],response:[{type:"Long",name:"timetag"}]},v2GetPinMessageList:{sid:33,cid:21,service:MM,params:[{type:"Property",name:"tag",reflectMapper:{conversationId:1,timetag:2}}],response:[{type:"Long",name:"timetag"},{type:"Bool",name:"changed"},{type:"PropertyArray",name:"data",reflectMapper:Sh(TM)}]},v2VoiceToText:{sid:29,cid:5,service:MM,params:[{type:"Property",name:"tag",reflectMapper:{mimeType:0,sampleRate:1,voiceUrl:2,duration:3}}],response:[{type:"String",name:"data"}]},v2AddQuickComment:{sid:33,cid:3,service:MM,params:[{type:"Property",name:"message",reflectMapper:Hg,select:["conversationType","senderId","receiverId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"quickComment",reflectMapper:bM}],response:[{type:"Long",name:"timetag"}]},v2RemoveQuickComment:{sid:33,cid:4,service:MM,params:[{type:"Property",name:"message",reflectMapper:Hg,select:["conversationType","senderId","receiverId","createTime","messageClientId","messageServerId"]},{type:"Property",name:"quickComment",reflectMapper:bM}],response:[{type:"Long",name:"timetag"}]},onAddQuickComment:{sid:23,cid:5,service:MM,response:[{type:"Property",name:"message",reflectMapper:Sh(Hg)},{type:"Property",name:"quickComment",reflectMapper:Sh(bM)}]},onRemoveQuickComment:{sid:23,cid:6,service:MM,response:[{type:"Property",name:"message",reflectMapper:Sh(Hg)},{type:"Property",name:"quickComment",reflectMapper:Sh(bM)}]},v2GetQuickComment:{sid:33,cid:7,service:MM,params:[{type:"PropertyArray",name:"tag",reflectMapper:SM}],response:[{type:"PropertyArray",name:"data",reflectMapper:Sh(SM)}]},onPinMessage:{sid:23,cid:18,service:MM,response:[{type:"Property",name:"msg",reflectMapper:Sh(Hg)},{type:"Property",name:"pinInfo",reflectMapper:Sh(CM)}]},onUpdatePinMessage:{sid:23,cid:19,service:MM,response:[{type:"Property",name:"msg",reflectMapper:Sh(Hg)},{type:"Property",name:"pinInfo",reflectMapper:Sh(CM)}]},onUnpinMessage:{sid:23,cid:20,service:MM,response:[{type:"Property",name:"msg",reflectMapper:Sh(Hg)},{type:"Property",name:"pinInfo",reflectMapper:Sh(CM)}]},v2AddCollection:{sid:33,cid:8,service:MM,params:[{type:"Property",name:"tag",reflectMapper:_M}],response:[{type:"Property",name:"data",reflectMapper:Sh(_M)}]},v2RemoveCollections:{sid:33,cid:9,service:MM,params:[{type:"PropertyArray",name:"tag",reflectMapper:_M,select:["collectionId","createTime"]}],response:[{type:"Int",name:"data"}]},v2UpdateCollectionExtension:{sid:33,cid:10,service:MM,params:[{type:"Property",name:"tag",reflectMapper:_M}],response:[{type:"Property",name:"data",reflectMapper:Sh(_M)}]},v2GetCollectionListByOption:{sid:33,cid:11,service:MM,params:[{type:"Property",name:"tag",reflectMapper:{beginTime:1,endTime:2,excludeId:3,limit:4,direction:5,collectionType:6}}],response:[{type:"Long",name:"total"},{type:"PropertyArray",name:"data",reflectMapper:Sh(_M)}]},v2SearchCloudMessagesGroupByConversation:{sid:30,cid:26,service:MM,params:[{type:"Property",name:"tag",reflectMapper:wM}],response:[{type:"PropertyArray",name:"data",reflectMapper:Sh(Hg)}]},v2SearchCloudMessages:{sid:30,cid:27,service:MM,params:[{type:"Property",name:"tag",reflectMapper:EM}],response:[{type:"PropertyArray",name:"data",reflectMapper:Sh(Hg)}]},v2GetThreadMessageList:{sid:33,cid:1,service:MM,params:[{type:"Property",name:"messageRefer",reflectMapper:Hg},{type:"Property",name:"tag",reflectMapper:{beginTime:1,endTime:2,excludeMessageServerId:3,limit:4,reverse:5}}],response:[{type:"Property",name:"message",reflectMapper:Sh(Hg)},{type:"Property",name:"replyResult",reflectMapper:Sh({total:{id:1,retType:"number"},timestamp:{id:2,retType:"number"}})},{type:"PropertyArray",name:"replyList",reflectMapper:Sh(Hg)}]}},kM=function(e){function t(t){var r;return(r=e.call(this,"V2NIMMessageExtendUtil",t)||this).core=t,"v2"!==r.core.options.apiVersion?ut(r):(Mh({cmdMap:IM,cmdConfig:RM}),r)}nr(t,e);var r=t.prototype;return r.pinMessage=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Pl(Gv,e,"message",!0),Pl(Yv,{serverExtension:t},"",!0),r.next=5,this.core.sendCmd("v2PinMessage",{msg:e,msgPin:{serverExtension:t}});case 5:n=r.sent,this.emitPinNotification({pinState:1,message:e,serverExtension:t,createTime:n.content.timetag,updateTime:n.content.timetag,operatorId:this.core.account});case 7:case"end":return r.stop()}}),r,this)})))},r.unpinMessage=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Pl(Gv,e,"messageRefer",!0),Pl(Yv,{serverExtension:t},"",!0),r.next=5,this.core.sendCmd("v2UnpinMessage",{msg:e,msgPin:{serverExtension:t}});case 5:n=r.sent,this.emitPinNotification({pinState:0,message:e,serverExtension:t,updateTime:n.content.timetag,operatorId:this.core.account});case 7:case"end":return r.stop()}}),r,this)})))},r.updatePinMessage=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Pl(Gv,e,"message",!0),Pl(Yv,{serverExtension:t},"",!0),r.next=5,this.core.sendCmd("v2UpdatePinMessage",{msg:e,msgPin:{serverExtension:t}});case 5:n=r.sent,this.emitPinNotification({pinState:2,message:e,serverExtension:t,updateTime:n.content.timetag,operatorId:this.core.account});case 7:case"end":return r.stop()}}),r,this)})))},r.getPinnedMessageList=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),this.core.V2NIMConversationIdUtil&&this.core.V2NIMConversationIdUtil.parseConversationType){t.next=3;break}throw new Error('Service "V2NIMConversationService" does not exist');case 3:return Vl(this.core.account,e),i=(i=this.core.V2NIMConversationIdUtil.convertToV1ConversationId(e)).replace("superTeam","super_team"),t.next=8,this.core.sendCmd("v2GetPinMessageList",{tag:{conversationId:i,timetag:0}});case 8:return o=t.sent,t.abrupt("return",Vm(r=du(n=o.content.data).call(n,(function(e){return dr(dr({},e),{messageRefer:dr(dr({},e.messageRefer),{conversationId:a.core.V2NIMConversationIdUtil.messageConversationId(e.messageRefer)})})}))).call(r,(function(e,t){return t.updateTime-e.updateTime})));case 10:case"end":return t.stop()}}),t,this)})))},r.addQuickComment=function(e,t,r,n){return zl(this,void 0,void 0,Ql.mark((function i(){var o,a;return Ql.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return this.checkV2(),Pl(Xv,{message:e,index:t,serverExtension:r,pushConfig:n},"",!0),i.next=4,this.core.sendCmd("v2AddQuickComment",{message:e,quickComment:{index:t,serverExtension:r,pushConfig:n}});case 4:o=i.sent,a={operationType:1,quickComment:{messageRefer:Lg(this.core,e),createTime:o.content.timetag,index:t,serverExtension:r||"",operatorId:this.core.account}},this.core.V2NIMMessageService.emit("onMessageQuickCommentNotification",a);case 7:case"end":return i.stop()}}),i,this)})))},r.removeQuickComment=function(e,t,r){return zl(this,void 0,void 0,Ql.mark((function n(){var i,o;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Pl(Gv,e,"messageRefer",!0),Pl({index:{type:"number",min:1}},{index:t},"",!0),Pl({serverExtension:{type:"string",required:!1}},{serverExtension:r},"",!0),n.next=6,this.core.sendCmd("v2RemoveQuickComment",{message:e,quickComment:{index:t,serverExtension:r}});case 6:i=n.sent,o={operationType:2,quickComment:{messageRefer:Lg(this.core,e),createTime:i.content.timetag,index:t,serverExtension:r||"",operatorId:this.core.account}},this.core.V2NIMMessageService.emit("onMessageQuickCommentNotification",o);case 9:case"end":return n.stop()}}),n,this)})))},r.getQuickCommentList=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Pl($v,{messages:e},"",!0),n={},t.next=5,this.core.sendCmd("v2GetQuickComment",{tag:du(e).call(e,(function(e){return{messageRefer:e}}))});case 5:return i=t.sent,jn(r=i.content.data).call(r,(function(e){var t,r;try{if(!e.detail)return void(n[t=e.messageRefer.messageClientId]||(n[t]=[]));var i=JSON.parse(e.detail);n[r=e.messageRefer.messageClientId]||(n[r]=[]),jn(i).call(i,(function(t){n[e.messageRefer.messageClientId].push({messageRefer:dr(dr({},e.messageRefer),{conversationId:o.core.V2NIMConversationIdUtil.messageConversationId(e.messageRefer)}),operatorId:t[1],index:$p(t[2]),createTime:$p(t[3]),serverExtension:t[4]})}))}catch(t){o.logger.error("getQuickCommentList JSON Parse Error",e.detail,t)}})),t.abrupt("return",n);case 8:case"end":return t.stop()}}),t,this)})))},r.voiceToText=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a,s,c,u,d,l,p;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),Pl(zv,e,"",!0),e.voicePath||e.voiceUrl||e.file){t.next=4;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"voiceToText: voicePath、voiceUrl、file cannot be empty at the same time"}});case 4:if(r=e.voicePath,n=e.file,i=e.mimeType,o=e.sampleRate,a=e.duration,s=e.sceneName,c=s?this.core.V2NIMStorageService.getStorageScene(s):null,u=e.voiceUrl){t.next=14;break}return d={},n?d.file=n:0===(null==r?void 0:wu(r).call(r,"nim-external"))?d.fileInput=r:d.filePath=r,t.next=12,this.core.cloudStorage.uploadFile(dr({type:"audio",nosScenes:c?c.sceneName:void 0,nosSurvivalTime:c?c.expireTime:void 0},d));case 12:l=t.sent,u=l.url;case 14:return t.next=16,this.core.sendCmd("v2VoiceToText",{tag:{voiceUrl:u,mimeType:i,sampleRate:o,duration:a}},{timeout:3e4});case 16:return p=t.sent,t.abrupt("return",p.content.data);case 18:case"end":return t.stop()}}),t,this)})))},r.onPinMessageHandler=function(e){return this.pinMessageChangeHandler(e,1)},r.onUnpinMessageHandler=function(e){return this.pinMessageChangeHandler(e,0)},r.onUpdatePinMessageHandler=function(e){return this.pinMessageChangeHandler(e,2)},r.pinMessageChangeHandler=function(e,t){var r=e.content.msg,n=e.content.pinInfo;r.conversationId=this.core.V2NIMConversationIdUtil.messageConversationId(r),this.emitPinNotification({pinState:t,message:r,serverExtension:n.serverExtension,createTime:n.createTime,updateTime:n.updateTime,operatorId:n.accid})},r.emitPinNotification=function(e){var t={pinState:e.pinState,pin:dr(dr({serverExtension:e.serverExtension||"",operatorId:e.operatorId},e.createTime?{createTime:e.createTime}:{}),{updateTime:e.updateTime,messageRefer:Lg(this.core,e.message)})};this.core.V2NIMMessageService.emit("onMessagePinNotification",t)},r.onAddQuickCommentHandler=function(e){return this.onQuickCommentNotificationHandler(e,1)},r.onRemoveQuickCommentHandler=function(e){return this.onQuickCommentNotificationHandler(e,2)},r.onQuickCommentNotificationHandler=function(e,t){var r={operationType:t,quickComment:dr({messageRefer:dr(dr({},e.content.message),{conversationId:this.core.V2NIMConversationIdUtil.messageConversationId(e.content.message)})},e.content.quickComment)};this.core.V2NIMMessageService.emit("onMessageQuickCommentNotification",r)},r.addCollection=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Pl(Zv,{params:e},"",!0),t.next=4,this.core.sendCmd("v2AddCollection",{tag:e});case 4:return r=t.sent,t.abrupt("return",r.content.data);case 6:case"end":return t.stop()}}),t,this)})))},r.removeCollections=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Pl(ey,{collections:e},"",!0),t.next=4,this.core.sendCmd("v2RemoveCollections",{tag:e});case 4:return r=t.sent,t.abrupt("return",r.content.data);case 6:case"end":return t.stop()}}),t,this)})))},r.updateCollectionExtension=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Pl(ty,{collection:e,serverExtension:t},"",!0),r.next=4,this.core.sendCmd("v2UpdateCollectionExtension",{tag:dr(dr({},e),{serverExtension:t})});case 4:return n=r.sent,r.abrupt("return",n.content.data);case 6:case"end":return r.stop()}}),r,this)})))},r.getCollectionListByOption=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Pl(ry,e,"",!0),t.next=4,this.getCollectionListExByOption(e);case 4:return r=t.sent,t.abrupt("return",r.collectionList);case 6:case"end":return t.stop()}}),t,this)})))},r.getCollectionListExByOption=function(e){var t,r;return zl(this,void 0,void 0,Ql.mark((function n(){var i,o,a,s,c;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.checkV2(),Pl(ry,e,"",!0),i=e.beginTime||0,o=e.endTime||0,a=void 0===e.direction?0:e.direction,void 0===(null===(t=e.anchorCollection)||void 0===t?void 0:t.collectionId)){n.next=21;break}if(0!==e.direction){n.next=15;break}if(0!==o){n.next=11;break}o=e.anchorCollection.createTime,n.next=13;break;case 11:if(o===e.anchorCollection.createTime){n.next=13;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getCollectionListExByOption: When providing anchorCollection, when sorting in descending order, endTime does not need to be provided, or endTime should be equal to anchorCollection.createTime"}});case 13:n.next=21;break;case 15:if(0!==i){n.next=19;break}i=e.anchorCollection.createTime,n.next=21;break;case 19:if(i===e.anchorCollection.createTime){n.next=21;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getCollectionListExByOption: When providing anchorCollection, when sorting in ascending order, there is no need to provide beginTime, or beginTime should be equal to anchorCollection.createTime"}});case 21:if(!(0!==i&&0!==o&&i>=o)){n.next=23;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getCollectionListExByOption: beginTime cannot be greater than endTime"}});case 23:return(s={beginTime:i,endTime:o,direction:a,limit:e.limit,collectionType:e.collectionType,excludeId:(null===(r=e.anchorCollection)||void 0===r?void 0:r.collectionId)?e.anchorCollection.collectionId:0}).collectionType||delete s.collectionType,n.next=27,this.core.sendCmd("v2GetCollectionListByOption",{tag:s});case 27:return c=n.sent,n.abrupt("return",{totalCount:c.content.total,collectionList:c.content.data});case 29:case"end":return n.stop()}}),n,this)})))},r.searchCloudMessages=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a,s,c,u,d=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),Pl(ny,e,"",!0),n=e.beginTime||0,i=e.endTime||0,!(0!==n&&0!==i&&n>i)){t.next=6;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"searchCloudMessages: beginTime cannot be greater than endTime"}});case 6:return o=void 0===e.sortOrder?0:e.sortOrder,a=e.conversationLimit||0,s=e.messageLimit||10,c=a>0?"v2SearchCloudMessagesGroupByConversation":"v2SearchCloudMessages",t.next=12,this.core.sendCmd(c,{tag:dr(dr({},e),{beginTime:n,endTime:i,sortOrder:o,conversationLimit:a,messageLimit:s})});case 12:return u=t.sent,t.abrupt("return",du(r=u.content.data).call(r,(function(e){return Og(d.core,e)})));case 14:case"end":return t.stop()}}),t,this)})))},r.getThreadMessageList=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a,s=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Pl(dy,e,"getThreadMessageList",!0),e.beginTime=e.beginTime||0,!(e.endTime&&e.beginTime>e.endTime)){t.next=4;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"getThreadMessageList: beginTime cannot be greater than endTime"}});case 4:return t.next=6,this.core.sendCmd("v2GetThreadMessageList",{messageRefer:e.messageRefer,tag:{beginTime:e.beginTime,endTime:e.endTime,limit:e.limit,reverse:1===e.direction?1:0,excludeMessageServerId:e.excludeMessageServerId}});case 6:return r=t.sent,n=r.content,i=n.message,o=n.replyResult,a=n.replyList,t.abrupt("return",{message:Og(this.core,i),timestamp:o.timestamp,replyCount:o.total,replyList:du(a).call(a,(function(e){return Og(s.core,e)}))});case 9:case"end":return t.stop()}}),t,this)})))},t}(rf),AM={joinMode:{type:"enum",values:[1,0,2],required:!1},agreeMode:{type:"enum",values:[0,1],required:!1},inviteMode:{type:"enum",values:[1,0],required:!1},updateInfoMode:{type:"enum",values:[1,0],required:!1},updateExtensionMode:{type:"enum",values:[1,0],required:!1},chatBannedMode:{type:"enum",values:[0,1],required:!1}},NM={type:"object",required:!0,rules:dr({name:{type:"string",allowEmpty:!1},teamType:{type:"enum",values:[1,2]},memberLimit:{type:"number",min:1,required:!1}},AM)},xM={type:"array",min:1,itemType:"string"},OM={type:"boolean"},PM={type:"string"},LM={type:"string",allowEmpty:!1},VM={type:"object",rules:{antispamBusinessId:{type:"string",required:!1}},required:!1},UM={teamId:{type:"string",regExp:/^[1-9]\d*$/,allowEmpty:!1}},DM={teamIds:{type:"array",itemType:"string",regExp:/^[1-9]\d*$/,min:1,allowEmpty:!1}},qM={teamType:{type:"enum",values:[1,2]}},BM={teamTypes:{type:"array",itemType:"enum",values:[1,2],required:!1}},FM={updateTeamInfoParams:{type:"object",required:!0,rules:dr({name:{type:"string",allowEmpty:!1,required:!1},memberLimit:{type:"number",min:1,required:!1}},AM)}},GM={type:"enum",values:[0,2]},jM={memberInfoParams:{type:"object",rules:{teamNick:{type:"string",required:!1},serverExtension:{type:"string",required:!1}}}},HM={chatBannedMode:{type:"enum",values:[0,1]}},WM={queryOption:{type:"object",rules:{roleQueryType:{type:"enum",values:[0,2,1]},onlyChatBanned:{type:"boolean",required:!1},direction:{type:"enum",values:[1,0],required:!1},limit:{type:"number",min:1,required:!1},nextToken:{type:"string",required:!1}}}},KM={teamId:UM.teamId,teamType:{type:"enum",values:[1,2]},operatorAccountId:{type:"string",allowEmpty:!1}},YM={actionType:{type:"enum",values:[2,0,1,3]}},QM={actionType:{type:"enum",values:[2]}},JM={actionType:{type:"enum",values:[0]}},zM={types:{type:"array",itemType:"enum",values:[0,2,1,3],required:!1},status:{type:"array",itemType:"enum",values:[1,3,0,2],required:!1},offset:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},XM={teamId:UM.teamId,teamType:qM.teamType,accountIds:xM},$M=function(){function e(){this.teamMap=new ad,this.superTeamMap=new ad}var t=e.prototype;return t.set=function(e){var t=this;jn(e).call(e,(function(e){t.chooseMap(e.teamType).set(e.teamId,e)}))},t.reset=function(){this.teamMap.clear(),this.superTeamMap.clear()},t.count=function(e,t){void 0===t&&(t=!0);var r=this.chooseMap(e),n=0;return jn(r).call(r,(function(e){t&&e.isValidTeam&&n++,t||n++})),n},t.chooseMap=function(e){return 2===e?this.superTeamMap:1===e?this.teamMap:new ad},t.getById=function(e,t,r){void 0===r&&(r=!0);var n=this.chooseMap(t).get(e);if(n){if(r&&n.isValidTeam)return n;if(!r)return n}},t.getAll=function(e,t){void 0===t&&(t=!0);var r=this.chooseMap(e),n=Bl(Iu(r).call(r)),i=fu(n).call(n,(function(e){return!(!t||!e.isValidTeam)||!t||void 0}));return Vm(i).call(i,(function(e,t){return t.updateTime-e.updateTime}))},t.upsert=function(e){var t=e.teamId,r=e.teamType,n=this.chooseMap(r),i=n.get(t)||{},o=dr({},i,e);return n.set(t,o),o},t.deleteById=function(e,t){var r=this.getById(e,t);if(r)return r.isValidTeam=!1,r},t.searchTeamByKeyword=function(e){var t,r,n=[];return jn(t=this.teamMap).call(t,(function(t){var r;ou(r=t.name).call(r,e)&&n.push(t)})),jn(r=this.superTeamMap).call(r,(function(t){var r;ou(r=t.name).call(r,e)&&n.push(t)})),n},e}(),ZM=function(){function e(){this.teamMembers=[],this.superTeamMembers=[],this.maxSize=2e3}var t=e.prototype;return t.reset=function(){this.teamMembers=[],this.superTeamMembers=[]},t.setData=function(e){var t=this;jn(e).call(e,(function(e){t.chooseList(e.teamType).push(e)}))},t.chooseList=function(e){return 2===e?this.superTeamMembers:1===e?this.teamMembers:[]},t.getById=function(e,t,r){var n=this.chooseList(t);return oh(n).call(n,(function(t){return t.teamId===e&&t.accountId===r}))},t.upsert=function(e){var t=e.teamType,r=e.teamId,n=this.chooseList(t),i=Qn(n).call(n,(function(t){return t.teamId===r&&t.accountId===e.accountId}));-1===i?n.push(e):n[i]=dr(dr({},n[i]),e),n.length>this.maxSize&&n.shift()},t.deleteByAccount=function(e,t,r){var n=this.chooseList(t),i=Qn(n).call(n,(function(t){return t.teamId===e&&t.accountId===r}));if(-1!==i){var o=n[i];return o.inTeam=!1,di(n).call(n,i,1),o}},t.deleteByTeamId=function(e,t){var r=this.chooseList(t),n=fu(r).call(r,(function(t){return t.teamId!==e}));2===t?this.superTeamMembers=n:this.teamMembers=n},e}(),eI=function(){function e(e,t){this.core=e,this.service=t}var t=e.prototype;return t.processNotification=function(e){var t=this,r=e.attachment,n=e.senderId,i=e.receiverId,o=r.id,a=r.data,s=o>400?2:1,c=kg(a,s),u=c.id,d=c.ids,l=c.tinfo,p=c.mute,m=this.service.model.getById(i,s);switch(this.core.logger.log("v2Team::processNotification, notificationType:"+o+", teamId:"+i,a),o){case zy.SUPER_TEAM_INVITATION:case zy.TEAM_INVITATION:ou(d).call(d,this.core.account)&&this.onTeamJoined(l),this.onTeamMembersJoined(l,fu(d).call(d,(function(e){return e!==t.core.account})));break;case zy.SUPER_TEAM_INVITE_ACCEPT:case zy.TEAM_INVITE_ACCEPT:n===this.core.account?this.onTeamJoined(l):this.onTeamMemberJoined(l,n);break;case zy.SUPER_TEAM_APPLY_ACCEPT:case zy.TEAM_APPLY_ACCEPT:u===this.core.account?this.onTeamJoined(l):this.onTeamMemberJoined(l,u);break;case zy.SUPER_TEAM_ADD_MANAGER:case zy.TEAM_ADD_MANAGER:this.updateTeamMemberRole(i,s,d,{memberRole:2});break;case zy.SUPER_TEAM_REMOVE_MANAGER:case zy.TEAM_REMOVE_MANAGER:this.updateTeamMemberRole(i,s,d,{memberRole:0});break;case zy.SUPER_TEAM_KICK:case zy.TEAM_KICK:this.onTeamInfoUpdated(l),jn(d).call(d,(function(e){e===t.core.account?t.onTeamLeft(i,s,!0):t.onTeamMemberKicked(n,l.teamId,l.teamType,e)}));break;case zy.SUPER_TEAM_LEAVE:case zy.TEAM_LEAVE:l?this.onTeamInfoUpdated(l):m&&n===this.core.account&&(m.isValidTeam=!1,this.onTeamInfoUpdated(m)),n===this.core.account?this.onTeamLeft(i,s,!1):this.onTeamMemberLeft(i,s,n);break;case zy.SUPER_TEAM_DISMISS:case zy.TEAM_DISMISS:this.onTeamDismissed(i,s);break;case zy.SUPER_TEAM_UPDATE:case zy.TEAM_UPDATED:this.onTeamInfoUpdated(l);break;case zy.SUPER_TEAM_TRANSFER_OWNER:case zy.TEAM_TRANSFER_OWNER:this.onTeamInfoUpdated(l),this.updateTeamMemberRole(i,s,[n,l.ownerAccountId],[{memberRole:0},{memberRole:1}]);break;case zy.SUPER_TEAM_MEMBER_MUTE:case zy.TEAM_MEMBER_MUTE:this.service.model.upsert(l),this.updateTeamMemberRole(i,s,u?[u]:d,{chatBanned:0!==p})}},t.onTeamJoined=function(e){var t=this;this.service.model.upsert(e),this.service.emit("onTeamJoined",e),this.service.getTeamMemberListByIds(e.teamId,e.teamType,[this.core.account]).catch((function(e){t.core.logger.error("Get Member error after onTeamJoined",e)}))},t.onTeamLeft=function(e,t,r){var n=this.service.model.deleteById(e,t)||Ag(e,t,{isValidTeam:!1});this.service.memberModel.deleteByAccount(e,t,this.core.account),this.service.emit("onTeamLeft",n,r)},t.onTeamDismissed=function(e,t){var r=this.service.model.deleteById(e,t);r||(r=Ag(e,t,{isValidTeam:!1})),this.service.memberModel.deleteByTeamId(e,t),this.service.emit("onTeamDismissed",r)},t.onTeamInfoUpdated=function(e){var t=this.service.model.upsert(e);this.service.emit("onTeamInfoUpdated",t)},t.onTeamMemberJoined=function(e,t){this.service.model.upsert(e),this.service.emit("onTeamInfoUpdated",e);var r=e.updateTime||e.createTime,n=Ng(e.teamId,e.teamType,t,{joinTime:r,updateTime:r});this.service.emit("onTeamMemberJoined",[n])},t.onTeamMembersJoined=function(e,t){var r=e.updateTime||e.createTime,n=du(t).call(t,(function(t){return Ng(e.teamId,e.teamType,t,{joinTime:r,updateTime:r})}));0!==n.length&&(this.service.model.upsert(e),this.service.emit("onTeamInfoUpdated",e),this.service.emit("onTeamMemberJoined",n))},t.onTeamMemberLeft=function(e,t,r){var n=this.service.memberModel.deleteByAccount(e,t,r);n||(n=Ng(e,t,r,{inTeam:!1})),this.service.emit("onTeamMemberLeft",[n])},t.onTeamMemberKicked=function(e,t,r,n){var i=this.service.memberModel.deleteByAccount(t,r,n);i||(i=Ng(t,r,n,{inTeam:!1})),this.service.emit("onTeamMemberKicked",e,[i])},t.onTeamMemberInfoUpdated=function(e){var t=this;jn(e).call(e,(function(e){if(e.accountId===t.core.account&&t.core.V2NIMSettingService.name&&t.core.V2NIMConversationIdUtil.name){var r=1===e.teamType?t.core.V2NIMConversationIdUtil.teamConversationId(e.teamId):t.core.V2NIMConversationIdUtil.superTeamConversationId(e.teamId),n=t.core.V2NIMSettingService.getConversationMuteStatus(r);t.core.eventBus.emit("V2NIMConversationService/setMute",r,n)}})),this.service.emit("onTeamMemberInfoUpdated",e)},t.updateTeamMemberRole=function(e,t,r,n){return zl(this,void 0,void 0,Ql.mark((function i(){var o,a,s,c,u=this;return Ql.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!((a=fu(r).call(r,(function(r,i){var o=u.service.memberModel.getById(e,t,r);return o&&u.service.memberModel.upsert(dr(dr({},o),Ei(n)?n[i]:n)),!o}))).length>0)){i.next=12;break}return i.prev=2,i.next=5,this.service.getTeamMemberListByIds(e,t,a);case 5:s=i.sent,jn(s).call(s,(function(e){return u.service.memberModel.upsert(e)})),i.next=12;break;case 9:i.prev=9,i.t0=i.catch(2),this.core.logger.warn("v2Team::processNotification, getTeamMemberListByIds failed",i.t0);case 12:(c=fu(o=du(r).call(r,(function(r){return u.service.memberModel.getById(e,t,r)}))).call(o,(function(e){return!!e}))).length>0&&this.onTeamMemberInfoUpdated(c);case 14:case"end":return i.stop()}}),i,this,[[2,9]])})))},t.processSysNotification=function(e){var t=e.receiverId,r=e.postscript,n=e.senderId,i=e.timestamp;e.idServer;var o={actionType:{0:0,1:1,2:2,3:3,15:0,16:1,17:2,18:3}[e.type],teamId:t,teamType:e.type>=15?2:1,operatorAccountId:n,postscript:r,timestamp:i,actionStatus:0};this.core.logger.log("v2Team::processSysNotification, type:",e.type,o),this.service.notificationModel.create(o),this.service.emit("onReceiveTeamJoinActionInfo",o)},t.updateTeamActionStatus=function(e,t){this.service.notificationModel.update({teamId:e.teamId,teamType:e.teamType,operatorAccountId:e.operatorAccountId,actionType:e.actionType,actionStatus:t})},t.checkIfExpired=function(e){return!(!e||509!==e&&(e>=500&&e<=599||e>=19e4))},e}();!function(e){e[e.TEAM_INVITATION=0]="TEAM_INVITATION",e[e.TEAM_KICK=1]="TEAM_KICK",e[e.TEAM_LEAVE=2]="TEAM_LEAVE",e[e.TEAM_UPDATED=3]="TEAM_UPDATED",e[e.TEAM_DISMISS=4]="TEAM_DISMISS",e[e.TEAM_APPLY_ACCEPT=5]="TEAM_APPLY_ACCEPT",e[e.TEAM_TRANSFER_OWNER=6]="TEAM_TRANSFER_OWNER",e[e.TEAM_ADD_MANAGER=7]="TEAM_ADD_MANAGER",e[e.TEAM_REMOVE_MANAGER=8]="TEAM_REMOVE_MANAGER",e[e.TEAM_INVITE_ACCEPT=9]="TEAM_INVITE_ACCEPT",e[e.TEAM_MEMBER_MUTE=10]="TEAM_MEMBER_MUTE",e[e.SUPER_TEAM_INVITATION=401]="SUPER_TEAM_INVITATION",e[e.SUPER_TEAM_KICK=402]="SUPER_TEAM_KICK",e[e.SUPER_TEAM_LEAVE=403]="SUPER_TEAM_LEAVE",e[e.SUPER_TEAM_UPDATE=404]="SUPER_TEAM_UPDATE",e[e.SUPER_TEAM_DISMISS=405]="SUPER_TEAM_DISMISS",e[e.SUPER_TEAM_TRANSFER_OWNER=406]="SUPER_TEAM_TRANSFER_OWNER",e[e.SUPER_TEAM_ADD_MANAGER=407]="SUPER_TEAM_ADD_MANAGER",e[e.SUPER_TEAM_REMOVE_MANAGER=408]="SUPER_TEAM_REMOVE_MANAGER",e[e.SUPER_TEAM_MEMBER_MUTE=409]="SUPER_TEAM_MEMBER_MUTE",e[e.SUPER_TEAM_APPLY_ACCEPT=410]="SUPER_TEAM_APPLY_ACCEPT",e[e.SUPER_TEAM_INVITE_ACCEPT=411]="SUPER_TEAM_INVITE_ACCEPT"}(zy||(zy={}));var tI=function(){function e(){this.list=[],this.maxCount=1e3}var t=e.prototype;return t.reset=function(){this.list=[]},t.create=function(e){this.list.push(e),this.list.length>this.maxCount&&this.list.shift()},t.update=function(e){var t;jn(t=this.list).call(t,(function(t){t.teamId===e.teamId&&t.teamType===e.teamType&&t.actionType===e.actionType&&t.operatorAccountId===e.operatorAccountId&&0===t.actionStatus&&dr(t,e)}))},t.delete=function(e){var t,r;this.list=fu(t=du(r=this.list).call(r,(function(t){if(t.teamId!==e.teamId||t.teamType!==e.teamType||t.operatorAccountId!==e.operatorAccountId||t.actionType!==e.actionType||t.timestamp!==e.timestamp)return t}))).call(t,(function(e){return e}))},t.getByOption=function(e){var t,r=e.types,n=e.status,i=e.offset,o=void 0===i?0:i,a=e.limit,s=void 0===a?50:a,c=[];jn(t=this.list).call(t,(function(e){r&&r.length>0&&!ou(r).call(r,e.actionType)||n&&n.length>0&&!ou(n).call(n,e.actionStatus)||c.push(e)})),c=Vm(c).call(c,(function(e,t){return t.timestamp-e.timestamp}));var u=0;o>0&&(u=Lp(c,"timestamp",o),c[u]&&c[u].timestamp===o&&(u+=1));var d=Wc(c).call(c,u).length;return(c=Wc(c).call(c,u,u+s)).length>0?{offset:d>s?c[c.length-1].timestamp:0,finished:!(d>s),infos:c}:{offset:0,finished:!0,infos:c}},e}(),rI=function(e){function t(t){var r;return(r=e.call(this,"V2NIMTeamService",t)||this).core._registerDep(Mg,"V2NIMConversationIdUtil"),r.notification=new eI(t,ut(r)),r.model=new $M,r.memberModel=new ZM,r.notificationModel=new tI,"v2"!==r.core.options.apiVersion?ut(r):(Mh({cmdMap:Sg,cmdConfig:Rg}),r.setListener(),r)}nr(t,e);var r=t.prototype;return r.setListener=function(){var e,t,r,n=this;this.core.eventBus.on("forwardReceive/V2NIMTeamService/created",(function(e){n.model.upsert(e);var t=Ng(e.teamId,e.teamType,n.core.account,{memberRole:1});n.memberModel.upsert(t),n.emit("onTeamCreated",e)})),this.core.eventBus.on("forwardReceive/V2NIMTeamService/updateSelfTeamMemberInfo",(function(e){n.memberModel.upsert(e),n.emit("onTeamInfoUpdated",[e])})),this.core.eventBus.on("forwardReceive/V2NIMTeamService/updateTeamActionStatus",tr(e=this.notification.updateTeamActionStatus).call(e,this.notification)),this.core.eventBus.on("V2NIMTeamService/sysNotification",tr(t=this.notification.processSysNotification).call(t,this.notification)),this.core.eventBus.on("V2NIMTeamService/notification",tr(r=this.notification.processNotification).call(r,this.notification)),this.core.eventBus.on("V2NIMTeamService/onSyncStarted",(function(){n.emit("onSyncStarted")})),this.core.eventBus.on("V2NIMTeamService/onSyncFinished",(function(){n.emit("onSyncFinished")})),this.core.eventBus.on("V2NIMTeamService/onSyncFailed",(function(e){n.emit("onSyncFailed",e)}))},r.reset=function(){this.model.reset(),this.memberModel.reset(),this.notificationModel.reset()},r.emit=function(t){for(var r,n,i=this.name+"::emit "+t.toString(),o=arguments.length,a=new Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];if("onTeamCreated"===t||"onTeamDismissed"===t||"onTeamJoined"===t||"onTeamLeft"===t||"onTeamInfoUpdated"===t){var c=a[0];this.logger.log(""+i,"team:"+c.teamId+"_"+c.teamType+";updateTime:"+c.updateTime)}else if("onTeamMemberJoined"===t||"onTeamMemberLeft"===t||"onTeamMemberInfoUpdated"===t){var u=a[0];this.logger.log(""+i,du(u).call(u,(function(e){return"team:"+e.teamId+"_"+e.teamType+";account:"+e.accountId})))}else if("onTeamMemberKicked"===t){var d=a[0],l=a[1];this.logger.log(""+i,"operator"+d,du(l).call(l,(function(e){return"team:"+e.teamId+"_"+e.teamType+";account:"+e.accountId})))}else{var p,m;(p=this.logger).log.apply(p,xs(m=[""+i]).call(m,a))}return(r=e.prototype.emit).call.apply(r,xs(n=[this,t]).call(n,a))},r.createTeam=function(e,t,r,n){return zl(this,void 0,void 0,Ql.mark((function i(){var o,a,s,c=this;return Ql.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return this.checkV2(),Pl({createTeamParams:NM},{createTeamParams:e},"",!0),Pl({inviteeAccountIds:dr(dr({},xM),{min:0,required:!1})},{inviteeAccountIds:t},"",!0),Pl({antispamConfig:VM},{antispamConfig:n},"",!0),o=2===e.teamType?"v2SuperTeamCreate":"v2TeamCreate",i.next=7,this.core.sendCmd(o,{team:e,inviteeAccountIds:t||[],postscript:r||"",antispamConfig:n});case 7:return a=i.sent,s=a.content.team,this.model.upsert(s),this.getTeamMemberListByIds(s.teamId,s.teamType,[this.core.account]).catch((function(e){c.core.logger.error("Get Member error after createTeam",e)})),this.emit("onTeamCreated",s),i.abrupt("return",{team:s,failedList:a.content.failedList});case 13:case"end":return i.stop()}}),i,this)})))},r.updateTeamInfo=function(e,t,r,n){return zl(this,void 0,void 0,Ql.mark((function i(){var o,a;return Ql.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return this.checkV2(),Pl(UM,{teamId:e},"",!0),Pl(qM,{teamType:t},"",!0),Pl(FM,{updateTeamInfoParams:r},"",!0),Pl({antispamConfig:VM},{antispamConfig:n},"",!0),o=dr({teamId:e,teamType:t},r),a=2===t?"v2SuperTeamUpdateInfo":"v2TeamUpdateInfo",i.next=9,this.core.sendCmd(a,{team:o,antispamConfig:n});case 9:this.model.upsert(o);case 10:case"end":return i.stop()}}),i,this)})))},r.leaveTeam=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Pl(UM,{teamId:e},"",!0),Pl(qM,{teamType:t},"",!0),n=2===t?"v2SuperTeamLeave":"v2TeamLeave",r.next=6,this.core.sendCmd(n,{teamId:e});case 6:this.model.deleteById(e,t);case 7:case"end":return r.stop()}}),r,this)})))},r.getTeamInfo=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o,a;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),Pl(UM,{teamId:e},"",!0),Pl(qM,{teamType:t},"",!0),n=2===t?"v2SuperTeamGetInfo":"v2TeamGetInfo",!(i=this.model.getById(e,t,!1))){r.next=7;break}return r.abrupt("return",i);case 7:return r.next=9,this.core.sendCmd(n,{teamId:e});case 9:return o=r.sent,a=o.content.team,this.model.upsert(a),r.abrupt("return",a);case 13:case"end":return r.stop()}}),r,this)})))},r.getJoinedTeamList=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Pl(BM,{teamTypes:e},"",!0),this.core.V2NIMLoginService.checkIllegalState(),e&&0!==e.length||(e=[1,2]),r=[],jn(e).call(e,(function(e){r=xs(r).call(r,n.model.getAll(e))})),t.abrupt("return",Vm(r).call(r,(function(e,t){return e.createTime-t.createTime})));case 7:case"end":return t.stop()}}),t,this)})))},r.getJoinedTeamCount=function(e){var t=this;this.checkV2(),Pl(BM,{teamTypes:e},"",!0),this.core.V2NIMLoginService.checkIllegalState(),e&&0!==e.length||(e=[1,2]);var r=0;return jn(e).call(e,(function(e){r+=t.model.count(e)})),r},r.getTeamInfoByIds=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o,a,s,c,u=this;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),Pl(DM,{teamIds:e},"",!0),Pl(qM,{teamType:t},"",!0),i=2===t?"v2SuperTeamGetByIds":"v2TeamGetByIds",o=du(e).call(e,(function(e){return u.model.getById(e,t,!1)})),0!==(a=fu(e).call(e,(function(e,t){return!o[t]}))).length){r.next=8;break}return r.abrupt("return",o);case 8:return r.next=10,this.core.sendCmd(i,{teamIds:a});case 10:return s=r.sent,c=s.content.teams,r.abrupt("return",fu(n=du(o).call(o,(function(t,r){if(t)return t;var n=e[r],i=oh(c).call(c,(function(e){return e.teamId===n}));return i&&u.model.upsert(i),i}))).call(n,(function(e){return!!e})));case 13:case"end":return r.stop()}}),r,this)})))},r.dismissTeam=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Pl(UM,{teamId:e},"",!0),Pl(qM,{teamType:t},"",!0),n=2===t?"v2SuperTeamDismiss":"v2TeamDismiss",r.next=6,this.core.sendCmd(n,{teamId:e});case 6:case"end":return r.stop()}}),r,this)})))},r.inviteMember=function(e,t,r,n){return zl(this,void 0,void 0,Ql.mark((function i(){var o,a;return Ql.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return this.checkV2(),Pl(UM,{teamId:e},"",!0),Pl(qM,{teamType:t},"",!0),Pl({inviteeAccountIds:xM},{inviteeAccountIds:r},"",!0),Pl({postscript:dr(dr({},PM),{required:!1})},{postscript:n},"",!0),o=2===t?"v2SuperTeamInviteMembers":"v2TeamInviteMembers",i.next=8,this.core.sendCmd(o,{teamId:e,accounts:r,ps:n||""});case 8:return a=i.sent,i.abrupt("return",a.content.abortedAccidList);case 10:case"end":return i.stop()}}),i,this)})))},r.acceptInvitation=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a,s;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Pl(KM,e,"invitationInfo",!0),Pl(QM,e,"invitationInfo",!0),r=e.teamType,n=e.teamId,i=e.operatorAccountId,o=2===r?"v2SuperTeamAcceptInvitation":"v2TeamAcceptInvitation",t.prev=5,t.next=8,this.core.sendCmd(o,{teamId:n,from:i});case 8:return a=t.sent,this.notification.updateTeamActionStatus(e,1),t.abrupt("return",a.content.team);case 13:throw t.prev=13,t.t0=t.catch(5),s=t.t0,this.notification.checkIfExpired(s.code)&&this.notification.updateTeamActionStatus(e,3),t.t0;case 18:case"end":return t.stop()}}),t,this,[[5,13]])})))},r.rejectInvitation=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o,a,s;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Pl(KM,e,"invitationInfo",!0),Pl(QM,e,"invitationInfo",!0),Pl({postscript:dr(dr({},PM),{required:!1})},{postscript:t},"",!0),n=e.teamType,i=e.teamId,o=e.operatorAccountId,a=2===n?"v2SuperTeamRejectInvite":"v2TeamRejectInvite",r.prev=6,r.next=9,this.core.sendCmd(a,{teamId:i,from:o,ps:t||""});case 9:this.notification.updateTeamActionStatus(e,2),r.next=17;break;case 12:throw r.prev=12,r.t0=r.catch(6),s=r.t0,this.notification.checkIfExpired(s.code)&&this.notification.updateTeamActionStatus(e,3),r.t0;case 17:case"end":return r.stop()}}),r,this,[[6,12]])})))},r.kickMember=function(e,t,r){return zl(this,void 0,void 0,Ql.mark((function n(){var i;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Pl(UM,{teamId:e},"",!0),Pl(qM,{teamType:t},"",!0),Pl({memberAccountIds:xM},{memberAccountIds:r},"",!0),i=2===t?"v2SuperTeamKickMembers":"v2TeamKickMembers",n.next=7,this.core.sendCmd(i,{teamId:e,accounts:r});case 7:case"end":return n.stop()}}),n,this)})))},r.applyJoinTeam=function(e,t,r){return zl(this,void 0,void 0,Ql.mark((function n(){var i,o,a,s;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Pl(UM,{teamId:e},"",!0),Pl(qM,{teamType:t},"",!0),i=2===t?"v2SuperTeamApplyToJoin":"v2TeamApplyToJoin",n.next=6,this.core.sendCmd(i,{teamId:e,ps:r||""});case 6:return o=n.sent,a=o.content.team,s=o.content.isInTeam,a.isValidTeam=!!a.isValidTeam&&!!s,n.abrupt("return",a);case 11:case"end":return n.stop()}}),n,this)})))},r.acceptJoinApplication=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Pl(KM,e,"applicationInfo",!0),Pl(JM,e,"applicationInfo",!0),r=e.teamType,n=e.teamId,i=e.operatorAccountId,o=2===r?"v2SuperTeamAcceptJoinApplication":"v2TeamAcceptJoinApplication",t.prev=5,t.next=8,this.core.sendCmd(o,{teamId:n,from:i});case 8:this.notification.updateTeamActionStatus(e,1),t.next=16;break;case 11:throw t.prev=11,t.t0=t.catch(5),a=t.t0,this.notification.checkIfExpired(a.code)&&this.notification.updateTeamActionStatus(e,3),t.t0;case 16:case"end":return t.stop()}}),t,this,[[5,11]])})))},r.rejectJoinApplication=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o,a,s;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Pl(KM,e,"applicationInfo",!0),Pl(JM,e,"applicationInfo",!0),Pl({postscript:dr(dr({},PM),{required:!1})},{postscript:t},"",!0),n=e.teamType,i=e.teamId,o=e.operatorAccountId,a=2===n?"v2SuperTeamRejectJoinApplication":"v2TeamRejectJoinApplication",r.prev=6,r.next=9,this.core.sendCmd(a,{teamId:i,from:o,ps:t||""});case 9:this.notification.updateTeamActionStatus(e,2),r.next=17;break;case 12:throw r.prev=12,r.t0=r.catch(6),s=r.t0,this.notification.checkIfExpired(s.code)&&this.notification.updateTeamActionStatus(e,3),r.t0;case 17:case"end":return r.stop()}}),r,this,[[6,12]])})))},r.updateTeamMemberRole=function(e,t,r,n){return zl(this,void 0,void 0,Ql.mark((function i(){var o;return Ql.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return this.checkV2(),Pl(UM,{teamId:e},"",!0),Pl(qM,{teamType:t},"",!0),Pl({memberAccountIds:xM},{memberAccountIds:r},"",!0),Pl({memberRole:GM},{memberRole:n},"",!0),o=2===n?"AddManagers":"RemoveManagers",o=2===t?"v2SuperTeam"+o:"v2Team"+o,i.next=9,this.core.sendCmd(o,{teamId:e,accounts:zh(r)});case 9:case"end":return i.stop()}}),i,this)})))},r.transferTeamOwner=function(e,t,r,n){return zl(this,void 0,void 0,Ql.mark((function i(){var o;return Ql.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return this.checkV2(),Pl(UM,{teamId:e},"",!0),Pl(qM,{teamType:t},"",!0),Pl({accountId:LM},{accountId:r},"",!0),Pl({leave:{type:"boolean",required:!1}},{leave:n},"",!0),o=2===t?"v2SuperTeamTransferOwner":"v2TeamTransferOwner",i.next=8,this.core.sendCmd(o,{teamId:e,account:r,leave:n||!1});case 8:case"end":return i.stop()}}),i,this)})))},r.updateSelfTeamMemberInfo=function(e,t,r){return zl(this,void 0,void 0,Ql.mark((function n(){var i,o,a,s,c;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.checkV2(),Pl(UM,{teamId:e},"",!0),Pl(qM,{teamType:t},"",!0),Pl(jM,{memberInfoParams:r},"",!0),void 0!==r.teamNick||void 0!==r.serverExtension){n.next=6;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER});case 6:return i=2===t?"v2SuperTeamUpdateSelfMemberInfo":"v2TeamUpdateSelfMemberInfo",o=dr(dr({},r),{teamId:e,accountId:this.core.account}),n.next=10,this.core.sendCmd(i,{teamMember:o});case 10:return n.next=12,this.notification.updateTeamMemberRole(e,t,[this.core.account],o);case 12:a=this.memberModel.getById(e,t,this.core.account),this.core.V2NIMSettingService.name&&this.core.V2NIMConversationIdUtil.name&&(s=1===t?this.core.V2NIMConversationIdUtil.teamConversationId(e):this.core.V2NIMConversationIdUtil.superTeamConversationId(e),c=this.core.V2NIMSettingService.getConversationMuteStatus(s),this.core.eventBus.emit("V2NIMConversationService/setMute",s,c)),this.core.eventBus.emit("forwardSend/V2NIMTeamService/updateSelfTeamMemberInfo",a);case 15:case"end":return n.stop()}}),n,this)})))},r.updateTeamMemberNick=function(e,t,r,n){return zl(this,void 0,void 0,Ql.mark((function i(){var o;return Ql.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(this.checkV2(),Pl(UM,{teamId:e},"",!0),Pl(qM,{teamType:t},"",!0),Pl({accountId:LM},{accountId:r},"",!0),Pl({nick:PM},{nick:n},"",!0),r!==this.core.account){i.next=7;break}return i.abrupt("return",this.updateSelfTeamMemberInfo(e,t,{teamNick:n}));case 7:return o=2===t?"v2SuperTeamUpdateMember":"v2TeamUpdateMember",i.next=10,this.core.sendCmd(o,{teamMember:{teamNick:n,teamId:e,accountId:r}});case 10:case"end":return i.stop()}}),i,this)})))},r.setTeamChatBannedMode=function(e,t,r){return zl(this,void 0,void 0,Ql.mark((function n(){var i;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Pl(UM,{teamId:e},"",!0),Pl(qM,{teamType:t},"",!0),Pl(HM,{chatBannedMode:r},"",!0),i=2===t?"v2SuperTeamSetChatBannedMode":"v2TeamSetChatBannedMode",n.next=7,this.core.sendCmd(i,{teamId:e,chatBannedMode:r});case 7:this.model.upsert({teamId:e,teamType:t,chatBannedMode:r});case 8:case"end":return n.stop()}}),n,this)})))},r.setTeamMemberChatBannedStatus=function(e,t,r,n){return zl(this,void 0,void 0,Ql.mark((function i(){var o;return Ql.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return this.checkV2(),Pl(UM,{teamId:e},"",!0),Pl(qM,{teamType:t},"",!0),Pl({accountId:LM},{accountId:r},"",!0),Pl({chatBanned:OM},{chatBanned:n},"",!0),o=2===t?"v2SuperTeamMemberSetChatBannedStatus":"v2TeamMemberSetChatBannedStatus",i.next=8,this.core.sendCmd(o,{teamId:e,accountId:2===t?[r]:r,chatBanned:n?1:0});case 8:case"end":return i.stop()}}),i,this)})))},r.getTeamMemberList=function(e,t,r){return zl(this,void 0,void 0,Ql.mark((function n(){var i,o,a,s;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Pl(UM,{teamId:e},"",!0),Pl(qM,{teamType:t},"",!0),Pl(WM,{queryOption:r},"",!0),i=0===(i=void 0===r.direction?0:r.direction)?1:0,n.next=8,this.core.sendCmd("v2TeamMemberGetList",{tag:dr(dr({teamId:e,teamType:t,onlyChatBanned:!1,nextToken:"",limit:100},r),{direction:i})});case 8:return o=n.sent,a=o.content.datas,s=Zp(o,"raw.r.0"),2===t&&s&&du(s)&&(a=du(s).call(s,(function(e){return yh(e,Sh(Eg))}))),n.abrupt("return",{nextToken:o.content.pageInfo.nextToken||"",finished:!+o.content.pageInfo.hasMore,memberList:xg(a,t)});case 13:case"end":return n.stop()}}),n,this)})))},r.getTeamMemberListByIds=function(e,t,r){return zl(this,void 0,void 0,Ql.mark((function n(){var i,o,a,s,c,u,d=this;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:this.checkV2(),Pl(UM,{teamId:e},"",!0),Pl(qM,{teamType:t},"",!0),Pl({accountIds:xM},{accountIds:r},"",!0),i=2===t?"v2SuperTeamMemberGetListByIds":"v2TeamMemberGetListByIds",o=du(r).call(r,(function(t){return e+"|"+t})),a=[],s=0;case 8:if(!(s<o.length)){n.next=18;break}return n.next=11,this.core.sendCmd(i,{tag:Wc(o).call(o,s,s+20)});case 11:c=n.sent,u=xg(c.content.datas,t),a=xs(a).call(a,u),jn(u).call(u,(function(e){return d.memberModel.upsert(e)}));case 15:s+=20,n.next=8;break;case 18:return n.abrupt("return",a);case 19:case"end":return n.stop()}}),n,this)})))},r.getTeamMemberInvitor=function(e,t,r){return zl(this,void 0,void 0,Ql.mark((function n(){var i,o;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Pl(UM,{teamId:e},"",!0),Pl(qM,{teamType:t},"",!0),Pl({accountIds:xM},{accountIds:r},"",!0),i=2===t?"v2SuperTeamGetMemberInvitor":"v2TeamGetMemberInvitor",n.next=7,this.core.sendCmd(i,{teamId:e,accounts:r});case 7:return o=n.sent,n.abrupt("return",o.content.accountsMap);case 9:case"end":return n.stop()}}),n,this)})))},r.searchTeamByKeyword=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),this.checkLogin(),Pl({keyword:LM},{keyword:e},"",!0),t.abrupt("return",this.model.searchTeamByKeyword(e));case 4:case"end":return t.stop()}}),t,this)})))},r.addTeamMembersFollow=function(e,t,r){return zl(this,void 0,void 0,Ql.mark((function n(){var i,o,a,s,c;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Pl(XM,{teamId:e,teamType:t,accountIds:r},"",!0),i=2===t?"v2SuperTeamUpdateSelfMemberInfo":"v2TeamUpdateSelfMemberInfo",n.next=5,this.getTeamMemberListByIds(e,t,[this.core.account]);case 5:return o=n.sent,a=o[0],n.next=9,this.core.sendCmd(i,{teamMember:{teamId:e},specialFollowUpdate:{accountIds:r,operation:1}});case 9:s=n.sent,c=s.content.data,fr(c).length>0&&(dr(a,c),this.emit("onTeamMemberInfoUpdated",[a]),this.memberModel.upsert(a));case 12:case"end":return n.stop()}}),n,this)})))},r.removeTeamMembersFollow=function(e,t,r){return zl(this,void 0,void 0,Ql.mark((function n(){var i,o,a,s,c;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Pl(XM,{teamId:e,teamType:t,accountIds:r},"",!0),n.next=4,this.getTeamMemberListByIds(e,t,[this.core.account]);case 4:return i=n.sent,o=i[0],a=2===t?"v2SuperTeamUpdateSelfMemberInfo":"v2TeamUpdateSelfMemberInfo",n.next=9,this.core.sendCmd(a,{teamMember:{teamId:e},specialFollowUpdate:{accountIds:r,operation:0}});case 9:s=n.sent,c=s.content.data,fr(c).length>0&&(dr(o,c),this.emit("onTeamMemberInfoUpdated",[o]),this.memberModel.upsert(o));case 12:case"end":return n.stop()}}),n,this)})))},r.getTeamJoinActionInfoList=function(e){return this.checkV2(),Pl(zM,e,"option",!0),this.core.V2NIMLoginService.checkIllegalState(),fs.resolve(this.notificationModel.getByOption(e))},r.clearAllTeamJoinActionInfo=function(){return zl(this,void 0,void 0,Ql.mark((function e(){return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),this.notificationModel.reset();case 3:case"end":return e.stop()}}),e,this)})))},r.deleteTeamJoinActionInfo=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),Pl(KM,e,"",!0),Pl(YM,e,"",!0),Pl({timestamp:{type:"number",min:1}},e,"",!0),this.notificationModel.delete(e);case 6:case"end":return t.stop()}}),t,this)})))},r.v2TeamSyncHandler=function(e){this.model.set(e.content.datas)},r.v2SuperTeamSyncHandler=function(e){this.model.set(e.content.datas)},r.v2TeamCreateMultiSyncHandler=function(e){var t=e.content.data;this.model.upsert(t);var r=Ng(t.teamId,t.teamType,this.core.account,{memberRole:1});this.memberModel.upsert(r),this.emit("onTeamCreated",t)},r.v2SuperTeamCreateMultiSyncHandler=function(e){var t=e.content.data;this.model.upsert(t);var r=Ng(t.teamId,t.teamType,this.core.account,{memberRole:1});this.memberModel.upsert(r),this.emit("onTeamCreated",t)},r.v2TeamMemberUpdateMultiSyncHandler=function(e){var t=e.content.data;t.teamType=1;var r=this.memberModel.getById(t.teamId,t.teamType,t.accountId);this.notification.updateTeamMemberRole(t.teamId,t.teamType,[t.accountId],t),t.accountId===this.core.account&&r&&r.bits!==t.bits&&this.core.eventBus.emit("V2NIMSettingService/updateBits",t.teamId,t.teamType,t.bits)},r.v2SuperTeamMemberUpdateMultiSyncHandler=function(e){var t=e.content.data;t.teamType=2;var r=this.memberModel.getById(t.teamId,t.teamType,t.accountId);this.notification.updateTeamMemberRole(t.teamId,t.teamType,[t.accountId],t),t.accountId===this.core.account&&r&&r.bits!==t.bits&&this.core.eventBus.emit("V2NIMSettingService/updateBits",t.teamId,t.teamType,t.bits)},r.v2TeamMembersOfSelfInSyncHandler=function(e){var t=e.content.datas;jn(t).call(t,(function(e){e.teamType=1})),this.memberModel.setData(t)},r.v2SuperTeamMembersOfSelfInSyncHandler=function(e){var t=e.content.datas;jn(t).call(t,(function(e){e.teamType=2})),this.memberModel.setData(t)},t}(rf),nI="V2NIMUserService",iI={"34_3":"v2UpdateBlockList","34_7":"v2GetUserList","34_10":"v2UpdateSelfUserProfile","3_109":"v2SyncSelfUserInfo","3_110":"onUpdateUserProfile","3_103":"onUpdateBlockList","3_8":"syncBlockAndMuteList","34_5":"v2SetP2PMessageMuteMode","3_105":"v2OnUpdateMuteList"},oI={accountId:1,name:3,avatar:4,sign:5,gender:{id:6,retType:"number"},email:7,birthday:8,mobile:9,serverExtension:10,createTime:{id:12,retType:"number"},updateTime:{id:13,retType:"number"}},aI={v2UpdateBlockList:{sid:34,cid:3,service:nI,params:[{type:"String",name:"accountId"},{type:"Bool",name:"addToBlockList"}]},v2GetUserList:{sid:34,cid:7,service:nI,params:[{type:"StrArray",name:"accountIds"}],response:[{type:"PropertyArray",name:"data",reflectMapper:Sh(oI)}]},v2UpdateSelfUserProfile:{sid:34,cid:10,service:nI,params:[{type:"Property",name:"tag",reflectMapper:oI}],response:[{type:"Long",name:"updateTime"}]},onUpdateUserProfile:{sid:3,cid:110,service:nI,response:[{type:"Property",name:"data",reflectMapper:Sh(oI)}]},onUpdateBlockList:{sid:3,cid:103,service:nI,response:[{type:"String",name:"accountId"},{type:"Bool",name:"addToBlockList"}]},syncBlockAndMuteList:{sid:3,cid:8,service:nI,response:[{type:"PropertyArray",name:"data",reflectMapper:Sh({accountId:0,isMute:{id:1,retType:"boolean"},isBlock:{id:2,retType:"boolean"}})},{type:"Long",name:"timetag"}]},v2SyncSelfUserInfo:{sid:3,cid:109,service:nI,response:[{type:"Property",name:"user",reflectMapper:Sh(oI)}]},v2SetP2PMessageMuteMode:{sid:34,cid:5,service:nI,params:[{type:"String",name:"accountId"},{type:"Bool",name:"muteMode"}]},v2OnUpdateMuteList:{sid:3,cid:105,service:nI,response:[{type:"String",name:"accountId"},{type:"Bool",name:"mute"}]}};Gu("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Qu);var sI=B.Set;nt({target:"Set",stat:!0,forced:!0},{from:Xu}),nt({target:"Set",stat:!0,forced:!0},{of:$u}),nt({target:"Set",proto:!0,real:!0,forced:!0},{addAll:function(){for(var e=We(this),t=ne(e.add),r=0,n=arguments.length;r<n;r++)b(t,e,arguments[r]);return e}}),nt({target:"Set",proto:!0,real:!0,forced:!0},{deleteAll:Zu});var cI=Hi;nt({target:"Set",proto:!0,real:!0,forced:!0},{every:function(e){var t=We(this),r=cI(t),n=Fe(e,arguments.length>1?arguments[1]:void 0);return!Ji(r,(function(e,r){if(!n(e,e,t))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),nt({target:"Set",proto:!0,real:!0,forced:!0},{difference:function(e){var t=We(this),r=new(yo(t,G("Set")))(t),n=ne(r.delete);return Ji(e,(function(e){b(n,r,e)})),r}}),nt({target:"Set",proto:!0,real:!0,forced:!0},{filter:function(e){var t=We(this),r=cI(t),n=Fe(e,arguments.length>1?arguments[1]:void 0),i=new(yo(t,G("Set"))),o=ne(i.add);return Ji(r,(function(e){n(e,e,t)&&b(o,i,e)}),{IS_ITERATOR:!0}),i}}),nt({target:"Set",proto:!0,real:!0,forced:!0},{find:function(e){var t=We(this),r=cI(t),n=Fe(e,arguments.length>1?arguments[1]:void 0);return Ji(r,(function(e,r){if(n(e,e,t))return r(e)}),{IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),nt({target:"Set",proto:!0,real:!0,forced:!0},{intersection:function(e){var t=We(this),r=new(yo(t,G("Set"))),n=ne(t.has),i=ne(r.add);return Ji(e,(function(e){b(n,t,e)&&b(i,r,e)})),r}}),nt({target:"Set",proto:!0,real:!0,forced:!0},{isDisjointFrom:function(e){var t=We(this),r=ne(t.has);return!Ji(e,(function(e,n){if(!0===b(r,t,e))return n()}),{INTERRUPTED:!0}).stopped}}),nt({target:"Set",proto:!0,real:!0,forced:!0},{isSubsetOf:function(e){var t=Hi(this),r=We(e),n=r.has;return I(n)||(r=new(G("Set"))(e),n=ne(r.has)),!Ji(t,(function(e,t){if(!1===b(n,r,e))return t()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),nt({target:"Set",proto:!0,real:!0,forced:!0},{isSupersetOf:function(e){var t=We(this),r=ne(t.has);return!Ji(e,(function(e,n){if(!1===b(r,t,e))return n()}),{INTERRUPTED:!0}).stopped}});var uI=M([].join),dI=[].push;nt({target:"Set",proto:!0,real:!0,forced:!0},{join:function(e){var t=We(this),r=cI(t),n=void 0===e?",":Xi(e),i=[];return Ji(r,dI,{that:i,IS_ITERATOR:!0}),uI(i,n)}}),nt({target:"Set",proto:!0,real:!0,forced:!0},{map:function(e){var t=We(this),r=cI(t),n=Fe(e,arguments.length>1?arguments[1]:void 0),i=new(yo(t,G("Set"))),o=ne(i.add);return Ji(r,(function(e){b(o,i,n(e,e,t))}),{IS_ITERATOR:!0}),i}});var lI=TypeError;nt({target:"Set",proto:!0,real:!0,forced:!0},{reduce:function(e){var t=We(this),r=cI(t),n=arguments.length<2,i=n?void 0:arguments[1];if(ne(e),Ji(r,(function(r){n?(n=!1,i=r):i=e(i,r,r,t)}),{IS_ITERATOR:!0}),n)throw lI("Reduce of empty set with no initial value");return i}}),nt({target:"Set",proto:!0,real:!0,forced:!0},{some:function(e){var t=We(this),r=cI(t),n=Fe(e,arguments.length>1?arguments[1]:void 0);return Ji(r,(function(e,r){if(n(e,e,t))return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),nt({target:"Set",proto:!0,real:!0,forced:!0},{symmetricDifference:function(e){var t=We(this),r=new(yo(t,G("Set")))(t),n=ne(r.delete),i=ne(r.add);return Ji(e,(function(e){b(n,r,e)||b(i,r,e)})),r}}),nt({target:"Set",proto:!0,real:!0,forced:!0},{union:function(e){var t=We(this),r=new(yo(t,G("Set")))(t);return Ji(e,ne(r.add),{that:r}),r}});var pI=sI,mI=function(){function e(){this.muteList=new pI,this.userMap=new ad,this.blockList=[]}var t=e.prototype;return t.reset=function(){this.muteList.clear(),this.userMap.clear(),this.blockList=[]},t.setAccountMuteMode=function(e,t){1===t?this.muteList.add(e):this.muteList.delete(e)},t.setUser=function(e){this.userMap.set(e.accountId,e)},t.getUser=function(e){return this.userMap.get(e)},t.getUserListBySearchOption=function(e){var t,r;return fu(t=Bl(Iu(r=this.userMap).call(r))).call(t,(function(t){var r,n,i;return!(void 0!==e.searchName&&!e.searchName||!ou(r=t.name).call(r,e.keyword))||!(!e.searchAccountId||!ou(n=t.accountId).call(n,e.keyword))||!!(t.mobile&&e.searchMobile&&ou(i=t.mobile).call(i,e.keyword))}))},t.addToBlockList=function(e){var t=this;jn(e).call(e,(function(e){var r;ou(r=t.blockList).call(r,e)||t.blockList.push(e)}))},t.removeFromBlockList=function(e){var t=this;jn(e).call(e,(function(e){var r,n,i=wu(r=t.blockList).call(r,e);-1!==i&&di(n=t.blockList).call(n,i,1)}))},e}(),hI={type:"string",required:!0,allowEmpty:!1},fI={type:"string",required:!1,allowEmpty:!0},gI={name:{type:"string",required:!1,allowEmpty:!0},avatar:fI,sign:fI,email:fI,birthday:fI,mobile:fI,gender:{type:"number",required:!1},serverExtension:fI};function vI(e,t){var r,n=void 0!==Nc&&Fl(e)||e["@@iterator"];if(n)return tr(r=(n=n.call(e)).next).call(r,n);if(Ei(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return yI(e,t);var n=Wc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Bl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?yI(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function yI(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var MI=function(e){function t(t){var r;return r=e.call(this,"V2NIMUserService",t)||this,Mh({cmdMap:iI,cmdConfig:aI}),r.model=new mI,"v2"!==r.core.options.apiVersion?ut(r):(r.setListener(),r)}nr(t,e);var r=t.prototype;return r.reset=function(){this.model.reset()},r.setListener=function(){var e,t=this;this.core.eventBus.on("V2NIMUserService/refreshUserInfo",tr(e=this.refreshUserInfo).call(e,this)),this.core.eventBus.on("forwardReceive/V2NIMUserService/updateBlockList",(function(e,r){r?t.model.addToBlockList([e]):t.model.removeFromBlockList([e]),r?t.emitBlockListAdded(e):t.emit("onBlockListRemoved",e)})),this.core.eventBus.on("forwardReceive/V2NIMUserService/updateUserProfile",(function(e){t.updateUserProfileInMemory(e)}))},r.emit=function(t){for(var r,n,i=this.name+"::emit "+t.toString(),o=arguments.length,a=new Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];if("onUserProfileChanged"===t){var c=a[0];this.logger.log(""+i,du(c).call(c,(function(e){return"id:"+e.accountId+";name:"+e.name+";updateTime:"+e.updateTime})))}else if("onBlockListAdded"===t){var u=a[0];this.logger.log(""+i,"id:"+u.accountId+";name:"+u.name+";updateTime:"+u.updateTime)}else{var d,l;(d=this.logger).log.apply(d,xs(l=[""+i]).call(l,a))}return(r=e.prototype.emit).call.apply(r,xs(n=[this,t]).call(n,a))},r.getUserList=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),t.abrupt("return",this._getUserList(e));case 2:case"end":return t.stop()}}),t,this)})))},r._getUserList=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o,a,s=this;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(Pl({accountIds:xM},{accountIds:e},"",!0),n=[],jn(e).call(e,(function(e){s.model.getUser(e)||n.push(e)})),i=null,!(n.length>0)){r.next=8;break}return r.next=7,this.core.sendCmd("v2GetUserList",{accountIds:n});case 7:i=r.sent;case 8:return o=(null===(t=null==i?void 0:i.content)||void 0===t?void 0:t.data)||[],jn(o).call(o,(function(e){s.model.setUser(e)})),a=[],jn(e).call(e,(function(e){var t=s.model.getUser(e);t&&a.push(t)})),r.abrupt("return",a);case 13:case"end":return r.stop()}}),r,this)})))},r.getUserListFromCloud=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Pl({accountIds:{type:"array",min:1,max:500,itemType:"string"}},{accountIds:e},"",!0),t.next=4,this.core.sendCmd("v2GetUserList",{accountIds:e});case 4:return r=t.sent,n=r.content.data||[],i=[],jn(n).call(n,(function(e){var t=a.model.getUser(e.accountId);a.compareUserForUpdate(t,e)&&i.push(e),a.model.setUser(e)})),o=Ml(e).call(e,(function(e,t){var r=a.model.getUser(t);return r&&e.push(r),e}),[]),i.length>0&&this.emit("onUserProfileChanged",i),t.abrupt("return",o);case 11:case"end":return t.stop()}}),t,this)})))},r.compareUserForUpdate=function(e,t){return!e||!("number"==typeof e.updateTime&&"number"==typeof t.updateTime&&e.updateTime>=t.updateTime)},r.updateSelfUserProfile=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Pl(gI,e,"",!0),t.next=4,this.core.sendCmd("v2UpdateSelfUserProfile",{tag:dr(dr({},e),{accountId:this.core.account})});case 4:return r=t.sent,t.next=7,this.updateUserProfileInMemory(dr({updateTime:r.content.updateTime},e));case 7:case"end":return t.stop()}}),t,this)})))},r.addUserToBlockList=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),e!==this.core.account){t.next=3;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot block yourself"}});case 3:return Pl({accountId:hI},{accountId:e},"",!0),t.next=6,this.core.sendCmd("v2UpdateBlockList",{accountId:e,addToBlockList:!0});case 6:this.model.addToBlockList([e]),this.emitBlockListAdded(e);case 8:case"end":return t.stop()}}),t,this)})))},r.removeUserFromBlockList=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),e!==this.core.account){t.next=3;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot unblock yourself"}});case 3:return Pl({accountId:hI},{accountId:e},"",!0),t.next=6,this.core.sendCmd("v2UpdateBlockList",{accountId:e,addToBlockList:!1});case 6:this.model.removeFromBlockList([e]),this.emit("onBlockListRemoved",e);case 8:case"end":return t.stop()}}),t,this)})))},r.searchUserByOption=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),Pl({keyword:{type:"string",allowEmpty:!1},searchName:{type:"boolean",required:!1},searchAccountId:{type:"boolean",required:!1},searchMobile:{type:"boolean",required:!1}},e,"",!0),!1!==(void 0===e.searchName||e.searchName)||e.searchAccountId||e.searchMobile){t.next=6;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"one of searchName, searchAccountId, searchMobile must be true"}});case 6:return t.abrupt("return",this.model.getUserListBySearchOption(e));case 7:case"end":return t.stop()}}),t,this)})))},r.getBlockList=function(){return this.checkV2(),fs.resolve(this.model.blockList)},r.updateUserProfileInMemory=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r=this.model.getUser(this.core.account))){t.next=6;break}dr(r,e),this.model.setUser(r),t.next=10;break;case 6:return t.next=8,this._getUserList([this.core.account]);case 8:n=t.sent,r=n[0];case 10:r&&this.emit("onUserProfileChanged",[r]);case 11:case"end":return t.stop()}}),t,this)})))},r.onUpdateUserProfileHandler=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.content.data,t.next=3,this.updateUserProfileInMemory(r);case 3:case"end":return t.stop()}}),t,this)})))},r.onUpdateBlockListHandler=function(e){var t=e.content.accountId;e.content.addToBlockList?(this.model.addToBlockList([t]),this.emitBlockListAdded(t)):(this.model.removeFromBlockList([t]),this.emit("onBlockListRemoved",t))},r.syncBlockAndMuteListHandler=function(e){var t=this,r=e.content.data;jn(r).call(r,(function(e){e.isBlock?t.model.addToBlockList([e.accountId]):t.model.setAccountMuteMode(e.accountId,e.isMute?1:0)}))},r.v2SyncSelfUserInfoHandler=function(e){var t=e.content.user;this.model.setUser(t)},r.checkUserUpdate=function(e,t){var r=e.senderId;r!==this.core.account&&this.refreshUserInfo(r,t)},r.refreshUserInfo=function(e,t){return void 0===t&&(t=0),zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o,a,s,c;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e&&"string"==typeof e){r.next=2;break}return r.abrupt("return");case 2:if(n=this.model.getUser(e),i=[],!(!n||n&&"number"==typeof n.updateTime&&"number"==typeof t&&!isNaN(n.updateTime)&&!isNaN(t)&&n.updateTime<t)){r.next=15;break}return r.prev=5,r.next=8,this.core.sendCmd("v2GetUserList",{accountIds:[e]});case 8:o=r.sent,i=o.content.data,r.next=15;break;case 12:r.prev=12,r.t0=r.catch(5),this.logger.warn("V2NIMUserService:refreshUserInfo: failed for "+e);case 15:for(a=vI(i);!(s=a()).done;)c=s.value,this.model.setUser(c),this.emit("onUserProfileChanged",[c]);case 16:case"end":return r.stop()}}),r,this,[[5,12]])})))},r.emitBlockListAdded=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._getUserList([e]);case 2:1===(r=t.sent).length&&this.emit("onBlockListAdded",r[0]);case 4:case"end":return t.stop()}}),t,this)})))},r.v2OnUpdateMuteListHandler=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=e.content,n=r.accountId,i=r.mute,o=i?1:0,this.core.eventBus.emit("v2NIMUserService/updateMuteList",n,o);case 3:case"end":return t.stop()}}),t,this)})))},t}(rf),II="V2NIMFriendService",SI={"35_1":"v2AddFriend","35_2":"v2DeleteFriend","35_3":"v2SetFriendInfo","35_4":"v2IncFriendInfo","12_101":"v2OnAddFriend","12_102":"v2OnDeleteFriend","12_103":"v2OnUpdateFriendInfo","12_5":"v2SyncFriendList","12_6":"v2SyncFriendUserList"},TI={accountId:4,source:{id:7,retType:"number"},alias:8,serverExtension:10,createTime:{id:11,retType:"number"},updateTime:{id:12,retType:"number"},customerExtension:13},bI={v2AddFriend:{sid:35,cid:1,service:II,params:[{type:"String",name:"accountId"},{type:"Byte",name:"verifyType"},{type:"String",name:"postscript"}],response:[]},v2DeleteFriend:{sid:35,cid:2,service:II,params:[{type:"String",name:"accountId"},{type:"Property",name:"params",reflectMapper:{deleteAlias:{id:1,converter:Th}}}]},v2SetFriendInfo:{sid:35,cid:3,service:II,params:[{type:"Property",name:"tag",reflectMapper:TI}]},v2OnAddFriend:{sid:12,cid:101,service:II,response:[{type:"String",name:"accountId"},{type:"Byte",name:"verifyType"},{type:"String",name:"postscript"},{type:"Property",name:"ext",reflectMapper:Sh({serverExt:1})}]},v2OnDeleteFriend:{sid:12,cid:102,service:II,response:[{type:"String",name:"accountId"}]},v2OnUpdateFriendInfo:{sid:12,cid:103,service:II,response:[{type:"Property",name:"data",reflectMapper:Sh(TI)}]},v2SyncFriendList:{sid:12,cid:5,service:II,response:[{type:"PropertyArray",name:"friends",reflectMapper:Sh(TI)},{type:"Long",name:"timetag"}]},v2SyncFriendUserList:{sid:12,cid:6,service:II,response:[{type:"PropertyArray",name:"users",reflectMapper:Sh(oI)}]},v2IncFriendInfo:{sid:35,cid:4,service:II,params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"friends",reflectMapper:Sh(TI)},{type:"Long",name:"timetag"}]}},CI={accountId:{type:"string",required:!0,allowEmpty:!1},params:{type:"object",required:!0,rules:{addMode:{type:"enum",required:!0,values:[1,2]},postscript:{type:"string",required:!1,allowEmpty:!0}}}},_I={accountId:{type:"string",required:!0,allowEmpty:!1},params:{type:"object",required:!1,rules:{deleteAlias:{type:"boolean",required:!1}}}},EI={accountId:{type:"string",required:!0,allowEmpty:!1},params:{type:"object",required:!1,rules:{alias:{type:"string",required:!1,allowEmpty:!0},serverExtension:{type:"string",required:!1,allowEmpty:!0}}}},wI={applicantAccountId:{type:"string",required:!0,allowEmpty:!1},recipientAccountId:{type:"string",required:!0,allowEmpty:!1},operatorAccountId:{type:"string",required:!1,allowEmpty:!1},postscript:{type:"string",required:!1,allowEmpty:!0},status:{type:"enum",required:!0,values:[1,4,3,0,2]},timestamp:{type:"number",min:1}},RI={offset:{type:"number",required:!1},limit:{type:"number",required:!1},status:{type:"array",itemType:"enum",required:!1,values:[1,4,3,0,2]}},kI=function(){function e(e,t){this.core=e,this.service=t}return e.prototype.processSysNotification=function(e){if(6===e.type){var t=e.senderId;this.core.V2NIMFriendService.handleDeleteFriend(t,2)}else if(5===e.type)try{var r=JSON.parse(e.content);if(1===(null==r?void 0:r.vt)){this.core.V2NIMFriendService.handleAddFriend(e.senderId,e.timestamp);var n={applicantAccountId:e.senderId,recipientAccountId:e.receiverId,operatorAccountId:e.senderId,postscript:e.postscript,timestamp:e.timestamp,status:4,read:!0};this.service.model.appendFriendAddApplication(n),this.service.model.updateFriendAddApplicationStatus(n.applicantAccountId,4,n.applicantAccountId)}else if(2===(null==r?void 0:r.vt)){var i={applicantAccountId:e.senderId,recipientAccountId:e.receiverId,operatorAccountId:e.senderId,postscript:e.postscript,timestamp:e.timestamp,status:0,read:!1};this.service.handleApplyFriend(i),this.service.model.appendFriendAddApplication(i)}else if(3===(null==r?void 0:r.vt)){this.core.V2NIMFriendService.handleAddFriend(e.senderId,e.timestamp);var o={applicantAccountId:e.receiverId,recipientAccountId:e.senderId,operatorAccountId:e.senderId,timestamp:e.timestamp,postscript:e.postscript,status:1,read:!0};this.service.model.appendFriendAddApplication(o)}else if(4===(null==r?void 0:r.vt)){var a={applicantAccountId:e.receiverId,recipientAccountId:e.senderId,operatorAccountId:e.senderId,timestamp:e.timestamp,postscript:e.postscript,status:2,read:!0};this.service.model.appendFriendAddApplication(a),this.service.emit("onFriendAddRejected",a)}}catch(e){this.core.logger.warn("V2NIMFriendNotificationImpl::processSysNotification, parse content error:",e)}},e}();function AI(e,t){var r,n=void 0!==Nc&&Fl(e)||e["@@iterator"];if(n)return tr(r=(n=n.call(e)).next).call(r,n);if(Ei(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return NI(e,t);var n=Wc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Bl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?NI(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function NI(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var xI=function(){function e(){this.validFriendIds=new pI,this.friendMap=new ad,this.applicationInfoList=[],this.friendTimetag=0}var t=e.prototype;return t.getAddApplicationList=function(e){var t,r,n=void 0===e.offset?0:e.offset,i=Dc(t=fu(r=this.applicationInfoList).call(r,(function(t){var r=e.status||[];return 0===r.length||!!ou(r).call(r,t.status)}))).call(t),o=e.limit||50,a=Wc(i).call(i,n,n+o),s=n+o>=i.length;return{infos:a,finished:s,offset:s?0:n+o}},t.reset=function(){this.friendMap.clear(),this.validFriendIds.clear(),this.applicationInfoList=[]},t.setAddApplicationRead=function(){for(var e,t=AI(this.applicationInfoList);!(e=t()).done;)e.value.read=!0},t.getAddApplicationUnreadCount=function(){for(var e,t=new pI,r=AI(this.applicationInfoList);!(e=r()).done;){var n=e.value;n.read||0!==n.status||t.add(n.applicantAccountId)}return t.size},t.appendFriendAddApplication=function(e){this.applicationInfoList.push(e)},t.clearApplicationList=function(){this.applicationInfoList=[]},t.deleteApplication=function(e){var t,r;this.applicationInfoList=fu(t=du(r=this.applicationInfoList).call(r,(function(t){if(t.applicantAccountId!==e.applicantAccountId||t.recipientAccountId!==e.recipientAccountId||t.timestamp!==e.timestamp)return t}))).call(t,(function(e){return e}))},t.updateFriendAddApplicationStatus=function(e,t,r){if(0!==t)for(var n,i=AI(this.applicationInfoList);!(n=i()).done;){var o=n.value;o.applicantAccountId===e&&0===o.status&&(o.status=t,o.operatorAccountId=r,o.read=!0)}},t.upsertFriend=function(e,t){var r=this.friendMap.get(e)||{},n=dr({accountId:e},r,t);return this.friendMap.set(e,n),this.validFriendIds.add(e),n},t.addFriend=function(e){this.validFriendIds.add(e)},t.deleteFriend=function(e){this.validFriendIds.delete(e)},t.getFriend=function(e){return this.validFriendIds.has(e)?this.friendMap.get(e):void 0},t.getFriendList=function(){var e,t,r,n=this;return fu(e=du(t=Bl(Iu(r=this.validFriendIds).call(r))).call(t,(function(e){return n.getFriend(e)}))).call(e,(function(e){return!!e}))},t.getFriendListBySearchOption=function(e){var t,r,n,i=this;return fu(t=du(r=Bl(Iu(n=this.validFriendIds).call(n))).call(r,(function(e){return i.getFriend(e)}))).call(t,(function(t){var r,n,i=void 0===e.searchAlias||e.searchAlias;return!(void 0===t||!(i&&t.alias&&ou(r=t.alias).call(r,e.keyword)||e.searchAccountId&&ou(n=t.accountId).call(n,e.keyword)))}))},t.getFriendByIds=function(e){var t,r=this;return fu(t=du(e).call(e,(function(e){return r.getFriend(e)}))).call(t,(function(e){return!!e}))},t.setFriendTimetag=function(e){this.friendTimetag=e},t.getFriendTimetag=function(){return this.friendTimetag},e}(),OI=function(e){function t(t){var r;return(r=e.call(this,"V2NIMFriendService",t)||this).notification=new kI(r.core,ut(r)),r.model=new xI,"v2"!==r.core.options.apiVersion?ut(r):(Mh({cmdMap:SI,cmdConfig:bI}),r.setListener(),r)}nr(t,e);var r=t.prototype;return r.reset=function(){this.model.reset()},r.setListener=function(){var e,t,r,n,i,o;this.core.eventBus.on("V2NIMFriendService/sysNotification",tr(e=this.notification.processSysNotification).call(e,this.notification)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/addFriend",tr(t=this.handleAddFriend).call(t,this)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/deleteFriend",tr(r=this.handleDeleteFriend).call(r,this)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/setFriendInfo",tr(n=this.handleSetFriendInfo).call(n,this)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/acceptAddApplication",tr(i=this.handlePassFriendApply).call(i,this)),this.core.eventBus.on("forwardReceive/V2NIMFriendService/rejectAddApplication",tr(o=this.handleRejectFriendApply).call(o,this))},r.emit=function(t){for(var r,n,i=this.name+"::emit "+t.toString(),o=arguments.length,a=new Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];if("onFriendAdded"===t||"onFriendInfoChanged"===t){var c=a[0];this.logger.log(""+i,c.accountId+";updateTime:"+c.updateTime)}else{var u,d;(u=this.logger).log.apply(u,xs(d=[""+i]).call(d,a))}return(r=e.prototype.emit).call.apply(r,xs(n=[this,t]).call(n,a))},r.addFriend=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),e!==this.core.account){r.next=3;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot add yourself"}});case 3:return Pl(CI,{accountId:e,params:t},"",!0),r.next=6,this.core.sendCmd("v2AddFriend",{accountId:e,verifyType:t.addMode,postscript:t.postscript||""});case 6:if(1!==t.addMode){r.next=9;break}return r.next=9,this.handleAddFriend(e);case 9:case"end":return r.stop()}}),r,this)})))},r.deleteFriend=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),e!==this.core.account){r.next=3;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot delete yourself"}});case 3:return Pl(_I,{accountId:e,params:t},"",!0),r.next=6,this.core.sendCmd("v2DeleteFriend",{accountId:e,params:t});case 6:t.deleteAlias&&this.model.upsertFriend(e,{alias:""}),this.handleDeleteFriend(e);case 8:case"end":return r.stop()}}),r,this)})))},r.acceptAddApplication=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Pl(wI,e,"",!0),t.prev=2,t.next=5,this.core.sendCmd("v2AddFriend",{accountId:e.applicantAccountId,verifyType:3,postscript:""});case 5:this.handlePassFriendApply(e.applicantAccountId),t.next=12;break;case 8:throw t.prev=8,t.t0=t.catch(2),this.handlePassFriendApply(e.applicantAccountId,t.t0),t.t0;case 12:case"end":return t.stop()}}),t,this,[[2,8]])})))},r.rejectAddApplication=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Pl(wI,e,"",!0),r.prev=2,r.next=5,this.core.sendCmd("v2AddFriend",{accountId:e.applicantAccountId,verifyType:4,postscript:t||""});case 5:this.handleRejectFriendApply({applicantAccountId:e.applicantAccountId,recipientAccountId:e.recipientAccountId,operatorAccountId:this.core.account,postscript:t||"",timestamp:this.core.timeOrigin.getNTPTime(),read:!0,status:2}),r.next=12;break;case 8:throw r.prev=8,r.t0=r.catch(2),this.handleRejectFriendApply({applicantAccountId:e.applicantAccountId,recipientAccountId:e.recipientAccountId,operatorAccountId:this.core.account,postscript:t||"",timestamp:this.core.timeOrigin.getNTPTime(),read:!0,status:3},r.t0),r.t0;case 12:case"end":return r.stop()}}),r,this,[[2,8]])})))},r.setFriendInfo=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),Pl(EI,{accountId:e,params:t},"",!0),e!==this.core.account){r.next=4;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"Cannot set yourself"}});case 4:return r.next=6,this.core.sendCmd("v2SetFriendInfo",{tag:dr({accountId:e},t)});case 6:this.handleSetFriendInfo(e,t);case 7:case"end":return r.stop()}}),r,this)})))},r.getFriendList=function(){return zl(this,void 0,void 0,Ql.mark((function e(){return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),e.abrupt("return",this.computedFields(this.model.getFriendList()));case 3:case"end":return e.stop()}}),e,this)})))},r.getFriendByIds=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),Pl({accountIds:{type:"array",itemType:"string",required:!0,min:1}},{accountIds:e},"",!0),t.abrupt("return",this.computedFields(this.model.getFriendByIds(e)));case 4:case"end":return t.stop()}}),t,this)})))},r.checkFriend=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),Pl({accountIds:{type:"array",itemType:"string",required:!0,min:1}},{accountIds:e},"",!0),r={},jn(e).call(e,(function(e){r[e]=!!n.model.getFriend(e)})),t.abrupt("return",r);case 6:case"end":return t.stop()}}),t,this)})))},r.getAddApplicationList=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),Pl(RI,e,"",!0),t.abrupt("return",this.model.getAddApplicationList(e));case 4:case"end":return t.stop()}}),t,this)})))},r.setAddApplicationRead=function(){return zl(this,void 0,void 0,Ql.mark((function e(){return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),this.model.setAddApplicationRead();case 3:case"end":return e.stop()}}),e,this)})))},r.getAddApplicationUnreadCount=function(){return zl(this,void 0,void 0,Ql.mark((function e(){return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),e.abrupt("return",this.model.getAddApplicationUnreadCount());case 3:case"end":return e.stop()}}),e,this)})))},r.clearAllAddApplication=function(){return zl(this,void 0,void 0,Ql.mark((function e(){return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),this.model.clearApplicationList();case 3:case"end":return e.stop()}}),e,this)})))},r.deleteAddApplication=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),Pl(wI,e,"",!0),e.applicantAccountId===this.core.account||e.recipientAccountId===this.core.account){t.next=5;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"The applicant and recipient are not youself"}});case 5:this.model.deleteApplication(e);case 6:case"end":return t.stop()}}),t,this)})))},r.searchFriendByOption=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkV2(),this.core.V2NIMLoginService.checkIllegalState(),Pl({keyword:{type:"string",allowEmpty:!1},searchAccountId:{type:"boolean",required:!1}},e,"",!0),void 0===e.searchAlias||e.searchAlias||e.searchAccountId){t.next=6;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"searchAlias and searchAccountId cannot be false at the same time"}});case 6:return t.abrupt("return",this.computedFields(this.model.getFriendListBySearchOption(e)));case 7:case"end":return t.stop()}}),t,this)})))},r.v2OnAddFriendHandler=function(e){var t=e.content,r=t.accountId,n=t.verifyType,i=t.postscript;if(1===n)this.handleAddFriend(r);else if(2===n){var o={applicantAccountId:this.core.account,recipientAccountId:r,operatorAccountId:this.core.account,postscript:i,timestamp:this.core.timeOrigin.getNTPTime(),status:0,read:!1};this.handleApplyFriend(o)}else if(3===n)this.handlePassFriendApply(r);else if(4===n){var a={applicantAccountId:r,recipientAccountId:this.core.account,operatorAccountId:this.core.account,postscript:i,timestamp:this.core.timeOrigin.getNTPTime(),status:2,read:!0};this.handleRejectFriendApply(a)}},r.v2OnDeleteFriendHandler=function(e){var t=e.content.accountId;this.handleDeleteFriend(t)},r.v2OnUpdateFriendInfoHandler=function(e){var t=e.content.data,r=this.model.upsertFriend(t.accountId,t);this.emit("onFriendInfoChanged",r)},r.v2SyncFriendListHandler=function(e){var t=this,r=e.content,n=r.friends,i=r.timetag;this.model.setFriendTimetag(i),jn(n).call(n,(function(e){e.serverExtension||(e.serverExtension=""),e.customerExtension||(e.customerExtension=""),t.model.upsertFriend(e.accountId,e)}))},r.v2SyncFriendUserListHandler=function(e){var t=this,r=e.content.users;this.hasUserService&&jn(r).call(r,(function(e){t.core.V2NIMUserService.model.setUser(e)}))},r.handleApplyFriend=function(e){this.emit("onFriendAddApplication",e)},r.handleAddFriend=function(e,t){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.model.addFriend(e),t.next=3,this.incrementSyncFriend();case 3:this.core.eventBus.emit("V2NIMUserService/refreshUserInfo",e),(r=this.model.getFriend(e))&&this.emit("onFriendAdded",this.computedField(r));case 6:case"end":return t.stop()}}),t,this)})))},r.handleDeleteFriend=function(e,t){t=void 0===t?1:t,this.emit("onFriendDeleted",e,t),this.model.deleteFriend(e)},r.handleSetFriendInfo=function(e,t){var r=this.model.upsertFriend(e,t);this.emit("onFriendInfoChanged",this.computedField(r))},r.handlePassFriendApply=function(e,t){var r=t?null==t?void 0:t.code:200;if(!(r>=19e4||r===Tl.V2NIM_ERROR_CODE_FRIEND_OPERATION_RATE_LIMIT))if(200===r||r===Tl.V2NIM_ERROR_CODE_FRIEND_ALREADY_EXIST)this.model.updateFriendAddApplicationStatus(e,1,this.core.account),this.handleAddFriend(e);else{if(r>=500&&r<=599&&509!==r)return;this.model.updateFriendAddApplicationStatus(e,3,this.core.account)}},r.handleRejectFriendApply=function(e,t){var r=t?null==t?void 0:t.code:200;if(!(r>=19e4||r===Tl.V2NIM_ERROR_CODE_FRIEND_OPERATION_RATE_LIMIT))if(200===r)this.emit("onFriendAddRejected",e),this.model.updateFriendAddApplicationStatus(e.applicantAccountId,2,this.core.account);else if(r===Tl.V2NIM_ERROR_CODE_FRIEND_ALREADY_EXIST)this.model.updateFriendAddApplicationStatus(e.applicantAccountId,1,this.core.account);else{if(r>=500&&r<=599&&509!==r)return;this.model.updateFriendAddApplicationStatus(e.applicantAccountId,3,this.core.account)}},r.incrementSyncFriend=function(){return zl(this,void 0,void 0,Ql.mark((function e(){var t,r,n,i,o=this;return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.sendCmd("v2IncFriendInfo",{timetag:this.model.getFriendTimetag()});case 2:t=e.sent,r=t.content,n=r.friends,i=r.timetag,this.model.setFriendTimetag(i),jn(n).call(n,(function(e){o.model.upsertFriend(e.accountId,e)}));case 6:case"end":return e.stop()}}),e,this)})))},r.computedFields=function(e){var t=this;return du(e).call(e,(function(e){return t.computedField(e)}))},r.computedField=function(e){var t,r,n=null===(r=null===(t=this.core.V2NIMUserService)||void 0===t?void 0:t.model)||void 0===r?void 0:r.getUser(e.accountId);return n?dr({},e,{userProfile:n}):e},ct(t,[{key:"hasUserService",get:function(){var e;return!!(null===(e=this.core.V2NIMUserService)||void 0===e?void 0:e.name)}}]),t}(rf),PI={muteMode:{type:"enum",values:[2,0,1]}},LI={accountId:{type:"string",required:!0,allowEmpty:!1},muteMode:{type:"enum",required:!0,values:[2,0,1]}},VI={type:"object",required:!1,rules:{certificateName:{type:"string",required:!0,allowEmpty:!1},appId:{type:"string",required:!1,allowEmpty:!1},appKey:{type:"string",required:!1,allowEmpty:!1},secret:{type:"string",required:!1,allowEmpty:!1}}},UI={config:{type:"object",required:!0,rules:{apns:VI,hwPush:VI,miPush:VI,vivoPush:VI,oppoPush:VI,honorPush:VI,fcmPush:VI,mzPush:VI}}},DI="V2NIMSettingService",qI={"34_1":"v2SetDeviceToken","34_2":"v2SetAppBackground","34_15":"v2SetPushMobileOnDesktopOnline"},BI={v2SetDeviceToken:{sid:34,cid:1,service:DI,params:[{type:"String",name:"certificateName"},{type:"String",name:"pushDeviceToken"},{type:"Int",name:"pushkit"}]},v2SetAppBackground:{sid:34,cid:2,service:DI,params:[{type:"Bool",name:"isBackground"},{type:"Int",name:"badge"}]},v2SetPushMobileOnDesktopOnline:{sid:34,cid:15,service:DI,params:[{type:"Property",name:"tag",reflectMapper:{need:{id:1,converter:function(e){return e?2:1}}}}]}},FI=FI||function(e){var t;"undefined"!=typeof window&&window.crypto&&(t=window.crypto),"undefined"!=typeof self&&self.crypto&&(t=self.crypto),void 0!==Fs&&Fs.crypto&&(t=Fs.crypto),!t&&"undefined"!=typeof window&&window.msCrypto&&(t=window.msCrypto),!t&&void 0!==o&&o.crypto&&(t=o.crypto);var r=function(){if(t){if("function"==typeof t.getRandomValues)try{return t.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof t.randomBytes)try{return t.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},n=Bt||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),i={},a=i.lib={},s=a.Base={extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=a.WordArray=s.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||d).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,i=e.sigBytes;if(this.clamp(),n%4)for(var o=0;o<i;o++){var a=r[o>>>2]>>>24-o%4*8&255;t[n+o>>>2]|=a<<24-(n+o)%4*8}else for(var s=0;s<i;s+=4)t[n+s>>>2]=r[s>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e,t=s.clone.call(this);return t.words=Wc(e=this.words).call(e,0),t},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(r());return new c.init(t,e)}}),u=i.enc={},d=u.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=$p(e.substr(n,2),16)<<24-n%8*4;return new c.init(r,t/2)}},l=u.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(o))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new c.init(r,t)}},p=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(l.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return l.parse(unescape(encodeURIComponent(e)))}},m=a.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){var t;"string"==typeof e&&(e=p.parse(e)),xs(t=this._data).call(t,e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,n=this._data,i=n.words,o=n.sigBytes,a=this.blockSize,s=o/(4*a),u=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*a,d=e.min(4*u,o);if(u){for(var l=0;l<u;l+=a)this._doProcessBlock(i,l);r=di(i).call(i,0,u),n.sigBytes-=d}return new c.init(r,d)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});a.Hasher=m.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){m.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new h.HMAC.init(e,r).finalize(t)}}});var h=i.algo={};return i}(Math),GI=FI.enc.Utf8,jI=FI,HI=jI.lib,WI=HI.Base,KI=HI.WordArray,YI=jI.algo,QI=YI.MD5,JI=YI.EvpKDF=WI.extend({cfg:WI.extend({keySize:4,hasher:QI,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r,n=this.cfg,i=n.hasher.create(),o=KI.create(),a=o.words,s=n.keySize,c=n.iterations;a.length<s;){r&&i.update(r),r=i.update(e).finalize(t),i.reset();for(var u=1;u<c;u++)r=i.finalize(r),i.reset();xs(o).call(o,r)}return o.sigBytes=4*s,o}});jI.EvpKDF=function(e,t,r){return JI.create(r).compute(e,t)},FI.EvpKDF;var zI=FI,XI=zI.lib.WordArray;zI.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp();for(var i=[],o=0;o<r;o+=3)for(var a=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,s=0;s<4&&o+.75*s<r;s++)i.push(n.charAt(a>>>6*(3-s)&63));var c=n.charAt(64);if(c)for(;i.length%4;)i.push(c);return i.join("")},parse:function(e){var t=e.length,r=this._map,n=this._reverseMap;if(!n){n=this._reverseMap=[];for(var i=0;i<r.length;i++)n[r.charCodeAt(i)]=i}var o=r.charAt(64);if(o){var a=wu(e).call(e,o);-1!==a&&(t=a)}return function(e,t,r){for(var n=[],i=0,o=0;o<t;o++)if(o%4){var a=r[e.charCodeAt(o-1)]<<o%4*2|r[e.charCodeAt(o)]>>>6-o%4*2;n[i>>>2]|=a<<24-i%4*8,i++}return XI.create(n,i)}(e,t,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},FI.enc.Base64,function(e){e.lib.Cipher||function(){var t=e,r=t.lib,n=r.Base,i=r.WordArray,o=r.BufferedBlockAlgorithm,a=t.enc;a.Utf8;var s=a.Base64,c=t.algo.EvpKDF,u=r.Cipher=o.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){o.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?y:g}return function(t){return{encrypt:function(r,n,i){return e(n).encrypt(t,r,n,i)},decrypt:function(r,n,i){return e(n).decrypt(t,r,n,i)}}}}()});r.StreamCipher=u.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var d=t.mode={},l=r.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),p=d.CBC=function(){var e=l.extend();function t(e,t,r){var n,i=this._iv;i?(n=i,this._iv=void 0):n=this._prevBlock;for(var o=0;o<r;o++)e[t+o]^=n[o]}return e.Encryptor=e.extend({processBlock:function(e,r){var n=this._cipher,i=n.blockSize;t.call(this,e,r,i),n.encryptBlock(e,r),this._prevBlock=Wc(e).call(e,r,r+i)}}),e.Decryptor=e.extend({processBlock:function(e,r){var n=this._cipher,i=n.blockSize,o=Wc(e).call(e,r,r+i);n.decryptBlock(e,r),t.call(this,e,r,i),this._prevBlock=o}}),e}(),m=(t.pad={}).Pkcs7={pad:function(e,t){for(var r=4*t,n=r-e.sigBytes%r,o=n<<24|n<<16|n<<8|n,a=[],s=0;s<n;s+=4)a.push(o);var c=i.create(a,n);xs(e).call(e,c)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}};r.BlockCipher=u.extend({cfg:u.cfg.extend({mode:p,padding:m}),reset:function(){var e;u.reset.call(this);var t=this.cfg,r=t.iv,n=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=n.createEncryptor:(e=n.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,r&&r.words):(this._mode=e.call(n,this,r&&r.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4});var h=r.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),f=(t.format={}).OpenSSL={stringify:function(e){var t,r,n=e.ciphertext,o=e.salt;return(o?xs(t=xs(r=i.create([1398893684,1701076831])).call(r,o)).call(t,n):n).toString(s)},parse:function(e){var t,r=s.parse(e),n=r.words;return 1398893684==n[0]&&1701076831==n[1]&&(t=i.create(Wc(n).call(n,2,4)),di(n).call(n,0,4),r.sigBytes-=16),h.create({ciphertext:r,salt:t})}},g=r.SerializableCipher=n.extend({cfg:n.extend({format:f}),encrypt:function(e,t,r,n){n=this.cfg.extend(n);var i=e.createEncryptor(r,n),o=i.finalize(t),a=i.cfg;return h.create({ciphertext:o,key:r,iv:a.iv,algorithm:e,mode:a.mode,padding:a.padding,blockSize:e.blockSize,formatter:n.format})},decrypt:function(e,t,r,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),e.createDecryptor(r,n).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),v=(t.kdf={}).OpenSSL={execute:function(e,t,r,n){var o;n||(n=i.random(8));var a=c.create({keySize:t+r}).compute(e,n),s=i.create(Wc(o=a.words).call(o,t),4*r);return a.sigBytes=4*t,h.create({key:a,iv:s,salt:n})}},y=r.PasswordBasedCipher=g.extend({cfg:g.cfg.extend({kdf:v}),encrypt:function(e,t,r,n){var i=(n=this.cfg.extend(n)).kdf.execute(r,e.keySize,e.ivSize);n.iv=i.iv;var o=g.encrypt.call(this,e,t,i.key,n);return o.mixIn(i),o},decrypt:function(e,t,r,n){n=this.cfg.extend(n),t=this._parse(t,n.format);var i=n.kdf.execute(r,e.keySize,e.ivSize,t.salt);return n.iv=i.iv,g.decrypt.call(this,e,t,i.key,n)}})}()}(FI);var $I=FI,ZI=$I.lib.StreamCipher,eS=$I.algo,tS=eS.RC4=ZI.extend({_doReset:function(){for(var e=this._key,t=e.words,r=e.sigBytes,n=this._S=[],i=0;i<256;i++)n[i]=i;i=0;for(var o=0;i<256;i++){var a=i%r,s=t[a>>>2]>>>24-a%4*8&255;o=(o+n[i]+s)%256;var c=n[i];n[i]=n[o],n[o]=c}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=rS.call(this)},keySize:8,ivSize:0});function rS(){for(var e=this._S,t=this._i,r=this._j,n=0,i=0;i<4;i++){r=(r+e[t=(t+1)%256])%256;var o=e[t];e[t]=e[r],e[r]=o,n|=e[(e[t]+e[r])%256]<<24-8*i}return this._i=t,this._j=r,n}$I.RC4=ZI._createHelper(tS);var nS=eS.RC4Drop=tS.extend({cfg:tS.cfg.extend({drop:192}),_doReset:function(){tS._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)rS.call(this)}});$I.RC4Drop=ZI._createHelper(nS);var iS=FI.RC4,oS=function(e){function t(t){var r;return(r=e.call(this,"V2NIMSettingService",t)||this).offlinePushPlugin=void 0,r.offlinePushConfig=void 0,r.authConfig=void 0,r.aosPushInfo=void 0,r.appBackgroundOptions={badge:0,isBackground:!1},r.p2pMessageMuteModeChangeHandler=function(e,t){r.emit("onP2PMessageMuteModeChanged",e,t),r.hasUserService&&r.core.V2NIMUserService.model.setAccountMuteMode(e,t);var n=r.core.V2NIMConversationIdUtil.p2pConversationId(e),i=1===t;r.core.eventBus.emit("V2NIMConversationService/setMute",n,i)},r.setTokenAndBackgroundStateAfterLogin=function(e){r.aosPushInfo=e,r.logger.log("OfflinePushService: setTokenAndBackgroundStateAfterLogin"),r.offlinePushPlugin&&(r.logger.log("OfflinePushService: setTokenAndBackgroundStateAfterLogin plugin is provided"),r.logger.log("OfflinePushService: setTokenAndBackgroundStateAfterLogin pushType is: ",e&&e.pushType),r.regToken(),r.core.sendCmd("v2SetAppBackground",{isBackground:r.appBackgroundOptions.isBackground,badge:r.appBackgroundOptions.badge||0}))},r.core._registerDep(Mg,"V2NIMConversationIdUtil"),"v2"!==r.core.options.apiVersion?ut(r):(r.setListener(),Mh({cmdMap:qI,cmdConfig:BI}),r)}nr(t,e);var r=t.prototype;return r.setListener=function(){var e=this;this.core.eventBus.on("V2NIMSettingService/updateBits",(function(t,r,n){e.emit("onTeamMessageMuteModeChanged",t,r,n)})),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",this.setTokenAndBackgroundStateAfterLogin),this.core.eventBus.on("v2NIMUserService/updateMuteList",this.p2pMessageMuteModeChangeHandler),this.core.eventBus.on("forwardReceive/v2NIMSettingService/setP2PMessageMuteMode",this.p2pMessageMuteModeChangeHandler)},r.emit=function(t){for(var r,n,i,o,a=this.name+"::emit "+t.toString(),s=arguments.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=arguments[u];return(r=this.logger).log.apply(r,xs(n=[""+a]).call(n,c)),(i=e.prototype.emit).call.apply(i,xs(o=[this,t]).call(o,c))},r.getConversationMuteStatus=function(e){if("string"!=typeof e)return!1;var t=this.core.V2NIMConversationIdUtil.parseConversationType(e),r=this.core.V2NIMConversationIdUtil.parseConversationTargetId(e);return 3===t?0!==this.getTeamMessageMuteMode(r,2):2===t?0!==this.getTeamMessageMuteMode(r,1):!(1!==t||!this.hasUserService||!this.core.V2NIMUserService.model.muteList.has(r))},r.setTeamMessageMuteMode=function(e,t,r){return zl(this,void 0,void 0,Ql.mark((function n(){var i,o,a,s;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.hasTeamService){n.next=2;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_MISUSE,detail:{reason:"setTeamMessageMuteMode: no team service"}});case 2:return this.checkV2(),Pl(UM,{teamId:e},"",!0),Pl(qM,{teamType:t},"",!0),Pl(PI,{muteMode:r},"",!0),i=2===t?"v2SuperTeamUpdateSelfMemberInfo":"v2TeamUpdateSelfMemberInfo",o={teamId:e,teamType:t,accountId:this.core.account,bits:r},n.next=10,this.core.sendCmd(i,{teamMember:o});case 10:this.core.V2NIMTeamService.memberModel.upsert(o),this.emit("onTeamMessageMuteModeChanged",e,t,r),a=1===t?this.core.V2NIMConversationIdUtil.teamConversationId(e):this.core.V2NIMConversationIdUtil.superTeamConversationId(e),s=this.getConversationMuteStatus(a),this.core.eventBus.emit("V2NIMConversationService/setMute",a,s);case 15:case"end":return n.stop()}}),n,this)})))},r.getTeamMessageMuteMode=function(e,t){var r;return"string"!=typeof e||"number"!=typeof t?0:this.hasTeamService?3&((null===(r=this.core.V2NIMTeamService.memberModel.getById(e,t,this.core.account))||void 0===r?void 0:r.bits)||0):0},r.setP2PMessageMuteMode=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),Pl(LI,{accountId:e,muteMode:t},"",!0),e!==this.core.account){r.next=4;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"can not set mute mode for self"}});case 4:return r.next=6,this.core.sendCmd("v2SetP2PMessageMuteMode",{accountId:e,muteMode:1===t});case 6:this.p2pMessageMuteModeChangeHandler(e,t);case 7:case"end":return r.stop()}}),r,this)})))},r.getP2PMessageMuteMode=function(e){return Pl({accountId:{type:"string",required:!0,allowEmpty:!1}},{accountId:e},"",!0),this.hasUserService&&this.core.V2NIMUserService.model.muteList.has(e)?1:0},r.getRNDeviceInfo=function(){var e;return zl(this,void 0,void 0,Ql.mark((function t(){var r=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.logger.log("OfflinePushService:getDeviceInfo start"),null===(e=this.offlinePushPlugin)||void 0===e||e.init(_i(this.authConfig),(function(e,t,n){if(r.logger.log("OfflinePushService:: type: "+e+", tokenName: "+t+", token: "+n),n){var i="",o=Zl.getSystemInfo()||{},a=o.os?o.os.toLowerCase():"";r.aosPushInfo&&r.aosPushInfo.pushType?i=r.aosPushInfo.pushType:"ios"===a?i="":"android"===a&&(i="8"),r.pushTokenToServer(i,n)}else r.logger.warn("OfflinePushService:: token is empty. Please check your parameters")})),t.abrupt("return",new fs((function(e,t){var n;null===(n=r.offlinePushPlugin)||void 0===n||n.getDeviceInfo((function(n){try{r.logger.log("OfflinePushService:getDeviceInfo result "+(n?_i(n):"")),e(JSON.parse(n))}catch(e){t(new _l({code:Tl.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"OfflinePushService:getDeviceInfo error"}}))}})),qs((function(){t(new _l({code:Tl.V2NIM_ERROR_CODE_INTERNAL,detail:{reason:"OfflinePushService:getDeviceInfo timeout"}}))}),2e3)})));case 3:case"end":return t.stop()}}),t,this)})))},r.getP2PMessageMuteList=function(){return zl(this,void 0,void 0,Ql.mark((function e(){return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasUserService){e.next=4;break}return e.abrupt("return",fs.resolve(Bl(this.core.V2NIMUserService.model.muteList)));case 4:return e.abrupt("return",fs.resolve([]));case 5:case"end":return e.stop()}}),e,this)})))},r.setAppBackground=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Pl({isBackground:{type:"boolean"},badge:{type:"number",required:!1}},{isBackground:e,badge:t},"",!0),this.appBackgroundOptions={isBackground:e,badge:t||0},r.next=5,this.core.sendCmd("v2SetAppBackground",{isBackground:e,badge:t||0});case 5:case"end":return r.stop()}}),r,this)})))},r.setPushMobileOnDesktopOnline=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Pl({need:{type:"boolean",required:!1}},{need:e},"",!0),e=void 0===e||e,t.next=5,this.core.sendCmd("v2SetPushMobileOnDesktopOnline",{tag:{need:e}});case 5:case"end":return t.stop()}}),t,this)})))},r.setOfflinePushConfig=function(e,t){var r,n,i,o,a,s,c,u,d,l,p,m,h,f,g,v,y,M,I,S,T,b,C,_,E,w,R,k,A,N,x,O,P,L,V,U;Pl(UI,{config:t},"",!0),this.logger.log("setOfflinePushConfig","plugin",e,"config",t),this.offlinePushPlugin=e,this.offlinePushConfig=t,this.authConfig={xmAppId:null===(n=null===(r=this.offlinePushConfig)||void 0===r?void 0:r.miPush)||void 0===n?void 0:n.appId,xmAppKey:null===(o=null===(i=this.offlinePushConfig)||void 0===i?void 0:i.miPush)||void 0===o?void 0:o.appKey,xmCertificateName:null===(s=null===(a=this.offlinePushConfig)||void 0===a?void 0:a.miPush)||void 0===s?void 0:s.certificateName,hwAppId:null===(u=null===(c=this.offlinePushConfig)||void 0===c?void 0:c.hwPush)||void 0===u?void 0:u.appId,hwCertificateName:null===(l=null===(d=this.offlinePushConfig)||void 0===d?void 0:d.hwPush)||void 0===l?void 0:l.certificateName,oppoAppId:null===(m=null===(p=this.offlinePushConfig)||void 0===p?void 0:p.oppoPush)||void 0===m?void 0:m.appId,oppoAppKey:null===(f=null===(h=this.offlinePushConfig)||void 0===h?void 0:h.oppoPush)||void 0===f?void 0:f.appKey,oppoAppSecret:null===(v=null===(g=this.offlinePushConfig)||void 0===g?void 0:g.oppoPush)||void 0===v?void 0:v.secret,oppoCertificateName:null===(M=null===(y=this.offlinePushConfig)||void 0===y?void 0:y.oppoPush)||void 0===M?void 0:M.certificateName,vivoAppId:null===(S=null===(I=this.offlinePushConfig)||void 0===I?void 0:I.vivoPush)||void 0===S?void 0:S.appId,vivoAppKey:null===(b=null===(T=this.offlinePushConfig)||void 0===T?void 0:T.vivoPush)||void 0===b?void 0:b.appKey,vivoCertificateName:null===(_=null===(C=this.offlinePushConfig)||void 0===C?void 0:C.vivoPush)||void 0===_?void 0:_.certificateName,fcmCertificateName:null===(w=null===(E=this.offlinePushConfig)||void 0===E?void 0:E.fcmPush)||void 0===w?void 0:w.certificateName,mzAppId:null===(k=null===(R=this.offlinePushConfig)||void 0===R?void 0:R.mzPush)||void 0===k?void 0:k.appId,mzAppKey:null===(N=null===(A=this.offlinePushConfig)||void 0===A?void 0:A.mzPush)||void 0===N?void 0:N.appKey,mzCertificateName:null===(O=null===(x=this.offlinePushConfig)||void 0===x?void 0:x.mzPush)||void 0===O?void 0:O.certificateName,apnsCertificateName:null===(L=null===(P=this.offlinePushConfig)||void 0===P?void 0:P.apns)||void 0===L?void 0:L.certificateName,honorCertificateName:null===(U=null===(V=this.offlinePushConfig)||void 0===V?void 0:V.honorPush)||void 0===U?void 0:U.certificateName}},r.regToken=function(){var e=this,t=Zl.getSystemInfo()||{},r=t.os?t.os.toLowerCase():"";if(this.logger.log("OfflinePushService: os",r),"ios"===r||"android"===r)if(!this.offlinePushPlugin||"UNIAPP"===Zl.platform&&"function"!=typeof this.offlinePushPlugin.getDeviceToken||"React Native"===Zl.platform&&"android"===r&&"function"!=typeof this.offlinePushPlugin.init||"React Native"===Zl.platform&&"ios"===r&&"function"!=typeof this.offlinePushPlugin.checkPermissions)this.logger.warn("OfflinePushService: plugin is not correct, please check your plugin according to Yunxin Official Documentation");else{var n;"React Native"===Zl.platform&&Zl.envPayload.AppState&&Zl.envPayload.AppState.addEventListener("change",tr(n=this.handleRNAppStateChange).call(n,this));var i="";this.aosPushInfo&&this.aosPushInfo.pushType?i=this.aosPushInfo.pushType:"ios"===r?i="":"android"===r&&(i="8"),this.logger.log("OfflinePushService:: prepare to get device token. suggestPushType: "+i),this.logger.log("OfflinePushService push config",_i(this.authConfig,null,2),"platform",Zl.platform),"UNIAPP"===Zl.platform?this.offlinePushPlugin.getDeviceToken({suggestPushType:i,config:this.authConfig},(function(t){t?(e.logger.log("OfflinePushService:: token is :"+t),e.pushTokenToServer(i,t)):e.logger.warn("OfflinePushService:: token is empty. Please check your parameters")})):"React Native"===Zl.platform&&"android"===r?(this.logger.log("OfflinePushService:: onLogin",this.core.account,typeof i,i),this.offlinePushPlugin.onLogin(this.core.account,$p(i),!1,"")):"React Native"===Zl.platform&&"ios"===r?this.offlinePushPlugin.checkPermissions((function(){e.logger.log("OfflinePushService addEventListener requestPermissions");try{e.offlinePushPlugin.requestPermissions()}catch(t){e.logger.log("OfflinePushService:: requestPermissions error",t)}e.offlinePushPlugin.addEventListener("register",(function(t){e.logger.log("OfflinePushService:: ios token: "+t),e.pushTokenToServer(i,t)})),e.offlinePushPlugin.addEventListener("registrationError",(function(t){e.logger.log("OfflinePushService:: ios registerError",t)}))})):this.logger.error("OfflinePushService:: platform is not supported. Please check your parameters. Platform: "+Zl.platform+". os: "+r)}else this.logger.warn("OfflinePushService: only Android or IOS support offline push")},r.pushTokenToServer=function(e,t){var r,n,i,o,a,s,c,u,d="",l=this.offlinePushConfig;switch(e){case"5":d=null===(r=null==l?void 0:l.miPush)||void 0===r?void 0:r.certificateName;break;case"6":d=null===(n=null==l?void 0:l.hwPush)||void 0===n?void 0:n.certificateName;break;case"7":d=null===(i=null==l?void 0:l.mzPush)||void 0===i?void 0:i.certificateName;break;case"8":d=null===(o=null==l?void 0:l.fcmPush)||void 0===o?void 0:o.certificateName;break;case"9":d=null===(a=null==l?void 0:l.vivoPush)||void 0===a?void 0:a.certificateName;break;case"10":d=null===(s=null==l?void 0:l.oppoPush)||void 0===s?void 0:s.certificateName;break;case"11":d=null===(c=null==l?void 0:l.honorPush)||void 0===c?void 0:c.certificateName;break;default:d=null===(u=null==l?void 0:l.apns)||void 0===u?void 0:u.certificateName}if(""===d||void 0===d)this.logger.warn("OfflinePushService:: certificate name is empty for push type: ",e);else try{if("UNIAPP"===Zl.platform){var p=GI.parse("557d1e3cafa43e2589a588270c53d56f"),m=GI.stringify(iS.decrypt(t,p));this.logger.log("OfflinePushService:: token",m),this.core.sendCmd("v2SetDeviceToken",{certificateName:d,pushDeviceToken:m,pushkit:0})}else this.core.sendCmd("v2SetDeviceToken",{certificateName:d,pushDeviceToken:t,pushkit:0})}catch(e){return this.logger.log("OfflinePushService:: decrypt error",e),void this.logger.warn("OfflinePushService:: token before decrypt",t)}},r.handleRNAppStateChange=function(e){this.logger.log("push::handleAppStateChange: pushConfig ios/aos; state: "+e),this.appBackgroundOptions={badge:this.core.V2NIMConversationService.getTotalUnreadCount(),isBackground:"background"===e||"inactive"===e},this.setAppBackground(this.appBackgroundOptions.isBackground,this.appBackgroundOptions.badge)},ct(t,[{key:"hasUserService",get:function(){var e;return!!(null===(e=this.core.V2NIMUserService)||void 0===e?void 0:e.name)}},{key:"hasTeamService",get:function(){var e;return!!(null===(e=this.core.V2NIMTeamService)||void 0===e?void 0:e.name)}}]),t}(rf);nt({target:"Number",stat:!0},{isNaN:function(e){return e!=e}});var aS,sS=B.Number.isNaN,cS=mf({none:0,normal:1,all:3}),uS={normal:0,advanced:1},dS=mf(uS),lS=mf({normal:0,owner:1,manager:2}),pS={noVerify:0,needVerify:1,rejectAll:2},mS=mf(pS),hS={needVerify:0,noVerify:1},fS=mf(hS),gS={manager:0,all:1},vS=mf(gS),yS={manager:0,all:1},MS=mf(yS),IS={manager:0,all:1},SS=mf(IS);function TS(e){var t,r=["teamId"],n=["level","memberNum","memberUpdateTime","createTime","updateTime"],i=["valid","validToCurrentUser","mute"],o={type:dS,muteType:cS,joinMode:mS,beInviteMode:fS,inviteMode:vS,updateTeamMode:MS,updateExtMode:SS};e.bits;var a=Jl(e,["bits"]);return jn(r).call(r,(function(e){a[e]&&(a[e]=a[e].toString())})),jn(n).call(n,(function(e){void 0!==a[e]&&(a[e]=$p(a[e]))})),jn(i).call(i,(function(e){void 0!==a[e]&&(a[e]=1===$p(a[e]))})),jn(t=fr(o)).call(t,(function(e){void 0!==a[e]&&(a[e]=o[e][a[e]]||a[e])})),a}function bS(e){return e&&e.length>0?du(e).call(e,(function(e){return TS(e)})):[]}function CS(e){var t,r=dr({},e),n=["avatar","name","intro","announcement","ext"],i={type:uS,joinMode:pS,beInviteMode:hS,inviteMode:gS,updateTeamMode:yS,updateExtMode:IS};return jn(n).call(n,(function(e){void 0!==r[e]&&(r[e]=r[e].toString())})),jn(t=fr(i)).call(t,(function(e){void 0!==r[e]&&(r[e]=i[e][r[e]])})),r}function _S(e){var t=["teamId","ext","account","nickInTeam"],r={};return void 0!==e.bitConfigMask&&(r.bits=$p(e.bitConfigMask)),jn(t).call(t,(function(t){e[t]&&(r[t]=e[t].toString())})),Object.prototype.hasOwnProperty.call(e,"nickInTeam")&&(r.nickInTeam=e.nickInTeam),r}function ES(e){var t,r=["teamId"],n=["joinTime","updateTime","bitConfigMask"],i=["active","valid","mute"],o={type:lS},a=e.bits,s=Jl(e,["bits"]);return void 0!==a&&(s.muteTeam=1===$p(a),s.bitConfigMask=a),s.id=s.teamId+"-"+s.account,jn(r).call(r,(function(e){s[e]&&(s[e]=s[e].toString())})),jn(n).call(n,(function(e){void 0!==s[e]&&(s[e]=$p(s[e]))})),jn(i).call(i,(function(e){void 0!==s[e]&&(s[e]=1===$p(s[e]))})),jn(t=fr(o)).call(t,(function(e){void 0!==s[e]&&(s[e]=o[e][s[e]]||s[e])})),s}function wS(e){return e&&e.length>0?du(e).call(e,(function(e){return ES(e)})):[]}function RS(e,t,r){return void 0===r&&(r="normal"),{id:e.teamId+"-"+t,teamId:e.teamId,account:t,type:r,nickInTeam:"",muteTeam:!1,mute:!1,joinTime:e.memberUpdateTime,updateTime:e.memberUpdateTime,active:!0,valid:!0}}function kS(e,t,r){return void 0===r&&(r="normal"),t&&t.length>0?du(t).call(t,(function(t){return RS(e,t,r)})):[]}function AS(e){var t=dr({},e);return t.createTime&&(t.createTime=+t.createTime),t.updateTime&&(t.updateTime=+t.updateTime),t.gender&&(t.gender=aS[+t.gender]),t}!function(e){e[e.unknown=0]="unknown",e[e.male=1]="male",e[e.female=2]="female"}(aS||(aS={}));var NS={"8_1":"createTeam","8_5":"addTeamMembers","8_6":"removeTeamMembers","8_7":"updateTeamInfo","8_8":"leaveTeam","8_9":"getTeamInfo","8_10":"getTeams","8_11":"getTeamMembers","8_12":"dismissTeam","8_13":"applyTeam","8_14":"passTeamApply","8_15":"rejectTeamApply","8_16":"addTeamManagers","8_17":"removeTeamManagers","8_18":"transferTeam","8_19":"updateMyMemberInfo","8_20":"updateNickInTeam","8_21":"acceptTeamInvite","8_22":"rejectTeamInvite","8_25":"muteTeamMember","8_27":"getMutedTeamMembers","8_28":"sendTeamMsgReceipt","8_29":"getTeamMsgReads","8_30":"getTeamMsgReadAccounts","8_31":"notifyTeamMsgReceipts","8_32":"muteTeam","8_33":"getTeamMemberInvitorAccid","8_34":"getTeamsById","8_101":"syncCreateTeam","8_109":"syncTeams","8_119":"syncUpdateTeamMember","8_126":"syncMyTeamMembers"},xS={team:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,ext:18,serverExt:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateExtMode:24,mute:100,muteType:101},teamMsgReceiptTag:{teamId:0,idServer:1,read:100,unread:101,idClient:102,account:103},teamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,joinTime:10,updateTime:11,ext:12,mute:13,invitorAccid:14}},OS=Ih(xS),PS={getTeamInfo:{sid:8,cid:9,service:"team",params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"team",reflectMapper:OS.team}]},getTeams:{sid:8,cid:10,service:"team",params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:OS.team},{type:"Long",name:"timetag"}],ignoreErrCodes:[803]},createTeam:{sid:8,cid:1,service:"team",params:[{type:"Property",name:"team",reflectMapper:xS.team},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:OS.team},{type:"StrArray",name:"abortedAccidList"}]},sendTeamMsgReceipt:{sid:8,cid:28,service:"team",params:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:xS.teamMsgReceiptTag}],response:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:OS.teamMsgReceiptTag}]},getTeamMsgReads:{sid:8,cid:29,service:"team",params:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:xS.teamMsgReceiptTag}],response:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:OS.teamMsgReceiptTag}]},getTeamMsgReadAccounts:{sid:8,cid:30,service:"team",params:[{type:"Property",name:"teamMsgReceiptTag",reflectMapper:xS.teamMsgReceiptTag}],response:[{type:"Property",name:"teamMsgReceipt",reflectMapper:OS.teamMsgReceiptTag},{type:"StrArray",name:"readAccounts"},{type:"StrArray",name:"unreadAccounts"}]},notifyTeamMsgReceipts:{sid:8,cid:31,service:"team",response:[{type:"PropertyArray",name:"teamMsgReceipts",reflectMapper:OS.teamMsgReceiptTag}]},dismissTeam:{sid:8,cid:12,service:"team",params:[{type:"Long",name:"teamId"}]},leaveTeam:{sid:8,cid:8,service:"team",params:[{type:"Long",name:"teamId"}]},transferTeam:{sid:8,cid:18,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Bool",name:"leave"}]},updateTeamInfo:{sid:8,cid:7,service:"team",params:[{type:"Property",name:"team",reflectMapper:xS.team}],response:[{type:"Long",name:"id"},{type:"Long",name:"time"}]},getTeamsById:{sid:8,cid:34,service:"team",params:[{type:"LongArray",name:"teamIds"}],response:[{type:"PropertyArray",name:"teams",reflectMapper:OS.team},{type:"LongArray",name:"tids"}],ignoreErrCodes:[816]},getTeamMembers:{sid:8,cid:11,service:"team",params:[{type:"Long",name:"teamId"},{type:"Long",name:"timetag"}],response:[{type:"Long",name:"teamId"},{type:"PropertyArray",name:"teamMembers",reflectMapper:OS.teamMember},{type:"Long",name:"timetag"}]},getMutedTeamMembers:{sid:8,cid:27,service:"team",params:[{type:"Long",name:"teamId"}],response:[{type:"Long",name:"teamId"},{type:"PropertyArray",name:"teamMembers",reflectMapper:OS.teamMember}]},addTeamMembers:{sid:8,cid:5,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"},{type:"String",name:"attach"}],response:[{type:"Long",name:"time"},{type:"StrArray",name:"abortedAccidList"}]},removeTeamMembers:{sid:8,cid:6,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},applyTeam:{sid:8,cid:13,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"team",reflectMapper:OS.team}]},addTeamManagers:{sid:8,cid:16,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeTeamManagers:{sid:8,cid:17,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},updateMyMemberInfo:{sid:8,cid:19,service:"team",params:[{type:"Property",name:"teamMember",reflectMapper:xS.teamMember}]},updateNickInTeam:{sid:8,cid:20,service:"team",params:[{type:"Property",name:"teamMember",reflectMapper:xS.teamMember}]},muteTeamMember:{sid:8,cid:25,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Int",name:"mute"}]},getTeamMemberInvitorAccid:{sid:8,cid:33,service:"team",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}],response:[{type:"StrStrMap",name:"accountsMap"}]},muteTeam:{sid:8,cid:32,service:"team",params:[{type:"Long",name:"teamId"},{type:"Int",name:"mute"}]},passTeamApply:{sid:8,cid:14,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamApply:{sid:8,cid:15,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},acceptTeamInvite:{sid:8,cid:21,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamInvite:{sid:8,cid:22,service:"team",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},syncTeams:{sid:8,cid:109,service:"team",response:[{type:"Long",name:"timetag"},{type:"PropertyArray",name:"teams",reflectMapper:OS.team}]},syncCreateTeam:{sid:8,cid:101,service:"team",response:[{type:"Property",name:"team",reflectMapper:OS.team}]},syncUpdateTeamMember:{sid:8,cid:119,service:"team",response:[{type:"Property",name:"teamMember",reflectMapper:OS.teamMember}]},syncMyTeamMembers:{sid:8,cid:126,ext:"sync",service:"team",response:[{type:"PropertyArray",name:"teamMembers",entity:"teamMember",reflectMapper:OS.teamMember},{type:"Long",name:"timetag"}]}},LS={"3_7":"getUsersNameCardFromServer","3_10":"updateMyNameCard","3_109":"syncMyNameCard","3_110":"onUpdateMyNameCard","3_3":"setBlack","3_103":"onUpdateBlackList","3_5":"setMute","3_105":"onUpdateMuteList","3_8":"syncRelations"},VS={user:{account:1,nick:3,avatar:4,signature:5,gender:6,email:7,birth:8,tel:9,ext:10,createTime:12,updateTime:13},relationMember:{account:0,isMuted:1,isBlack:2,createTime:3,updateTime:4}},US=Ih(VS),DS={syncMyNameCard:{sid:3,cid:109,service:"user",response:[{type:"Property",name:"user",reflectMapper:US.user},{type:"Long",name:"timetag"}]},setBlack:{service:"user",sid:3,cid:3,params:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},onUpdateBlackList:{service:"user",sid:3,cid:103,response:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},setMute:{service:"user",sid:3,cid:5,params:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},onUpdateMuteList:{service:"user",sid:3,cid:105,response:[{type:"String",name:"account"},{type:"Bool",name:"isAdd"}]},syncRelations:{service:"user",sid:3,cid:8,params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"list",reflectMapper:US.relationMember},{type:"Long",name:"timetag"}]},getUsersNameCardFromServer:{service:"user",sid:3,cid:7,params:[{type:"StrArray",name:"accounts"}],response:[{type:"PropertyArray",name:"users",reflectMapper:US.user}]},updateMyNameCard:{service:"user",sid:3,cid:10,params:[{type:"Property",name:"user",reflectMapper:VS.user}],response:[{type:"Long",name:"timetag"}]},onUpdateMyNameCard:{service:"user",sid:3,cid:110,response:[{type:"Property",name:"user",reflectMapper:US.user}]}},qS={needPush:{type:"boolean",required:!1},needPushBadge:{type:"boolean",required:!1},needPushNick:{type:"boolean",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},needForcePush:{type:"boolean",required:!1},forcePushIDsList:{type:"string",allowEmpty:!1,required:!1},forcePushContent:{type:"string",allowEmpty:!1,required:!1}},BS={function:{type:"string",required:!1},topic:{type:"string",required:!1},customContent:{type:"string",required:!1},account:{type:"string",required:!1}};function FS(e,t){var r,n=void 0!==Nc&&Fl(e)||e["@@iterator"];if(n)return tr(r=(n=n.call(e)).next).call(r,n);if(Ei(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return GS(e,t);var n=Wc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Bl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?GS(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function GS(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var jS={subType:{type:"string"},setting:{resendFlag:{type:"boolean"},envConfig:{type:"string"},needSaveHistory:{type:"boolean"},needRoaming:{type:"boolean"},needOffline:{type:"boolean"},needSelfSync:{type:"boolean"},needRouted:{type:"boolean"},needUpdateSession:{type:"boolean"},isMuted:{type:"boolean"}},antiSpamInfo:{needAntiSpam:{type:"boolean"},antiSpamContent:{type:"string"},antiSpamBIZID:{type:"string"},clientAntispamHitting:{type:"boolean"},antiSpamUsingYidun:{type:"boolean"},yidunCallbackURL:{type:"string"},yidunAntiCheating:{type:"string"},yidunAntiSpamExtension:{type:"string"},yidunAntiSpamResult:{type:"string"}},pushInfo:qS,robotInfo:BS,teamSpecializationInfo:{needACK:{type:"boolean"},isACKSent:{type:"boolean"},ackSnapshot:{type:"number"}},threadMessageInfo:{replyMsgFromAccount:{type:"string"},replyMsgToAccount:{type:"string"},replyMsgTime:{type:"number"},replyMsgIdServer:{type:"string"},replyMsgIdClient:{type:"string"},threadMsgFromAccount:{type:"string"},threadMsgToAccount:{type:"string"},threadMsgTime:{type:"number"},threadMsgIdServer:{type:"string"},threadMsgIdClient:{type:"string"}}},HS={0:"addTeamMembers",1:"removeTeamMembers",2:"leaveTeam",3:"updateTeam",4:"dismissTeam",5:"passTeamApply",6:"transferTeam",7:"addTeamManagers",8:"removeTeamManagers",9:"acceptTeamInvite",10:"updateTeamMemberMute",101:"netcallMiss",102:"netcallBill",103:"netcallReject",401:"addSuperTeamMembers",402:"removeSuperTeamMembers",403:"leaveSuperTeam",404:"updateSuperTeam",405:"dismissSuperTeam",406:"transferSuperTeam",407:"addSuperTeamManagers",408:"removeSuperTeamManagers",409:"updateSuperTeamMembersMute",410:"passSuperTeamApply",411:"acceptSuperTeamInvite"};function WS(e,t){return Eh[e.scene]+"-"+(e.to===t?e.from:e.to)}function KS(e,t){return e.from===t?e.to===t?"in":"out":"in"}function YS(e,t){var r=t.account,n=t.featureValue,i=t.statusValue,o=t.sessionAck,a=t.msgReceiptTime,s=Eh[e.scene],c=e.to===r?e.from:e.to,u=kh.default,d=Rh.unread;$p(e.isInBlackList)>0?(d=Rh.refused,delete e.isInBlackList):d=e.from===r?a&&a>=+e.time?Rh.receipt:Rh.sent:o&&o>=+e.time?Rh.read:Rh.unread;var l=dr(dr({},Ph(jS,e)),{scene:s,type:_h[e.type],fromClientType:wh[e.fromClientType],flow:KS(e,r),target:c,to:e.to,from:e.from,time:e.time?+e.time:void 0,userUpdateTime:e.userUpdateTime?+e.userUpdateTime:void 0,idClient:e.idClient,sessionId:s+"-"+c,status:Rh[i||d],feature:kh[n||u]});if("string"==typeof l.attach)try{l.attach=JSON.parse(l.attach)}catch(e){}return"notification"===l.type&&(l.attach=l.attach?function(e){var t,r={};if(r.type=HS[e.id]||e.id,!e.data)return r;var n,i={ids:"accounts",id:"account",attach:"custom",channel:"channelId",calltype:"netcallType",mute:"mute",duration:"duration",time:"time",from:"from",ext:"ext"},o=e.data;return jn(t=fr(i)).call(t,(function(e){void 0!==o[e]&&(r[i[e]]=o[e])})),o.tinfo&&(r.team=TS(yh(o.tinfo,OS.team))),o.uinfos&&(r.users=du(n=o.uinfos).call(n,(function(e){return AS(yh(e,US.user))}))),void 0!==o.mute&&(r.mute=1===$p(o.mute)),r}(l.attach):{}),l}function QS(e,t){return e&&e.length>0?JS(du(e).call(e,(function(e){return YS(e,t)}))):[]}function JS(e){for(var t,r,n={},i=FS(e);!(r=i()).done;){var o=r.value,a=n[o.idClient];a&&a.time>o.time||(n[o.idClient]=o)}return du(t=fr(n)).call(t,(function(e){return n[e]}))}function zS(e,t){void 0===t&&(t=!0);var r=dr({},e);if(r.pushInfo&&t){for(var n in r.pushInfo)"boolean"==typeof r.pushInfo[n]?r[n]=r.pushInfo[n]?1:0:r[n]=r.pushInfo[n];delete r.pushInfo}return r.scene===Eh.team&&r.needForcePush&&(r.forcePushContent=r.forcePushContent||r.pushContent,r.forcePushIDsList=r.forcePushIDsList?r.forcePushIDsList:"#%@all@%#"),r}function XS(e,t,r,n){e.onSendBefore,e.onUploadStart,e.onUploadDone;var i=e.replyMsg,o=Jl(e,["onSendBefore","onUploadStart","onUploadDone","replyMsg"]),a=dr(dr({},Uh(jS,o)),{scene:Eh[e.scene],type:_h[e.type],from:t,fromClientType:16,fromDeviceId:r,fromNick:null==n?void 0:n.nick,userUpdateTime:null==n?void 0:n.updateTime,status:Rh[Rh.sending]});if(a.idClient=a.resendFlag?e.idClient:Ep(),!a.idClient)throw new Rl("idClient is required to resend a message","idClient","required");return a=zS(a,!1),i&&(a.replyMsgFromAccount=i.from,a.replyMsgToAccount=i.to,a.replyMsgTime=+i.time,a.replyMsgIdServer=i.idServer,a.replyMsgIdClient=i.idClient,a.threadMsgFromAccount=i.from,a.threadMsgToAccount=i.to,a.threadMsgTime=+i.time,a.threadMsgIdServer=i.idServer,a.threadMsgIdClient=i.idClient,i.threadMessageInfo&&i.threadMessageInfo.threadMsgIdServer&&(a.threadMsgFromAccount=i.threadMessageInfo.threadMsgFromAccount,a.threadMsgToAccount=i.threadMessageInfo.threadMsgToAccount,a.threadMsgTime=i.threadMessageInfo.threadMsgTime,a.threadMsgIdServer=i.threadMessageInfo.threadMsgIdServer,a.threadMsgIdClient=i.threadMessageInfo.threadMsgIdClient)),a}function $S(e,t){return du(e).call(e,(function(e){var r;return r=t||(sS($p(e.scene))?e.scene:1===$p(e.scene)?"p2p":"team"),{deletedTime:$p(e.time),from:e.from,idClient:e.deletedIdClient||e.idClient,idServer:e.deletedIdServer||e.idServer,scene:r,time:$p(e.deletedMsgCreateTime),to:e.to,ext:"string"==typeof e.ext?e.ext:null}}))}function ZS(e){for(var t=[],r=(e=e||[]).length-1;r>=0;r--)t.push(e[r]);return t}var eT,tT,rT,nT=function(){function e(e){this.core=e}return e.prototype.processBroadcastMsg=function(e){var t=du(e).call(e,(function(e){return dr(dr({},e),{time:$p(e.time)})}));return this.core.sendCmd("batchMarkRead",{sid:7,cid:17,ids:du(t).call(t,(function(e){return e.id}))}),t},e}(),iT={needPush:{type:"boolean",required:!1},needPushBadge:{type:"boolean",required:!1},needPushNick:{type:"boolean",required:!1},pushContent:{type:"string",allowEmpty:!1,required:!1},pushPayload:{type:"string",allowEmpty:!1,required:!1}},oT={pushContent:8,pushPayload:9,needPush:107,needPushBadge:109,needPushNick:110},aT={"4_4":"syncOfflineMsgs","4_9":"syncRoamingMsgs","4_17":"syncRoamingMsgs","4_21":"syncDeleteSelfMsgs","7_1":"sendMsg","8_23":"getHistoryTeamMsgs","21_14":"getHistorySuperTeamMsgs","8_2":"sendTeamMsg","21_2":"sendSuperTeamMsg","7_11":"sendMsgReceipt","7_13":"recallMsg","7_24":"deleteSelfMsgs","21_17":"recallSuperTeamMsg","7_2":"onMsg","8_3":"onMsg","21_3":"onMsg","7_101":"onMsg","8_102":"onMsg","21_102":"onMsg","8_4":"nimOnTeamMsgs","4_16":"syncBroadcastMsg","7_17":"onBroadcastMsg","7_123":"onDeleteSelfMsg","7_124":"onDeleteSelfMsgs"},sT=dr(dr({scene:0,to:1,from:2,fromClientType:4,fromDeviceId:5,fromNick:6,time:7,type:8,body:9,attach:10,idClient:11,idServer:12,resendFlag:13,userUpdateTime:14,ext:15,needAntiSpam:21,antiSpamContent:22,antiSpamBIZID:23,clientAntispamHitting:24,antiSpamUsingYidun:25,needACK:26,yidunCallbackURL:27,needUpdateSession:28,replyMsgFromAccount:29,replyMsgToAccount:30,replyMsgTime:31,replyMsgIdServer:32,replyMsgIdClient:33,threadMsgFromAccount:34,threadMsgToAccount:35,threadMsgTime:36,threadMsgIdServer:37,threadMsgIdClient:38,isDeleted:39,callbackExt:40,subType:41,yidunAntiCheating:42,envConfig:43,yidunAntiSpamExtension:44,yidunAntiSpamResult:45,__clientExt:{id:46,converter:bh,retConverter:Ch},needSaveHistory:100,needRoaming:101,needSelfSync:102,isMuted:104,needRouted:105,isInBlackList:106,needOffline:108,isReplyMsg:111,ackSnapshot:112},{pushContent:17,pushPayload:16,forcePushIDsList:18,forcePushContent:19,needForcePush:20,needPush:107,needPushBadge:109,needPushNick:110}),{function:47,topic:48,customContent:49,account:50}),cT={msg:sT,recallMsgTag:dr({time:0,type:1,to:2,from:3,ps:4,attach:5,deletedIdClient:10,deletedIdServer:11,deleteMsgCreatetime:14,opeAccount:16,env:21},oT),deleteSelfMsgTag:{scene:1,from:2,to:3,idServer:4,idClient:5,deletedMsgCreateTime:6,time:7,ext:8},msgReceiptTag:{to:1,from:2,time:7,idClient:11},broadcastMsg:{id:1,fromAccid:2,time:4,body:5}},uT=Ih(cT),dT={sendMsg:{sid:7,cid:1,service:"msg",params:[{type:"Property",name:"msg",reflectMapper:cT.msg}],response:[{type:"Property",name:"msg",reflectMapper:uT.msg}],ignoreErrCodes:[7101]},sendTeamMsg:{sid:8,cid:2,service:"msg",params:[{type:"Property",name:"msg",reflectMapper:cT.msg}],response:[{type:"Property",name:"msg",reflectMapper:uT.msg}]},sendSuperTeamMsg:{sid:21,cid:2,service:"msg",params:[{type:"Property",name:"msg",reflectMapper:cT.msg}],response:[{type:"Property",name:"msg",reflectMapper:uT.msg}]},onMsg:{sid:7,cid:2,service:"msg",response:[{type:"Property",name:"msg",reflectMapper:uT.msg}]},nimOnTeamMsgs:{sid:8,cid:4,service:"msg",response:[{type:"PropertyArray",name:"datas",reflectMapper:uT.msg}]},getHistoryTeamMsgs:{sid:8,cid:23,service:"msg",params:[{type:"Long",name:"to"},{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:uT.msg}]},getHistorySuperTeamMsgs:{sid:21,cid:14,params:[{type:"Long",name:"to"},{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:uT.msg}],service:"msg"},recallMsg:{sid:7,cid:13,service:"msg",params:[{type:"Property",name:"recallMsgTag",reflectMapper:cT.recallMsgTag}]},deleteSelfMsgs:{sid:7,cid:24,service:"msg",params:[{type:"PropertyArray",name:"deletedMsgs",reflectMapper:cT.deleteSelfMsgTag}],response:[{type:"Long",name:"timetag"}]},recallSuperTeamMsg:{sid:21,cid:17,service:"msg",params:[{type:"Property",name:"recallMsgTag",reflectMapper:cT.recallMsgTag}]},sendMsgReceipt:{sid:7,cid:11,service:"msg",params:[{type:"Property",name:"msgReceiptTag",reflectMapper:cT.msgReceiptTag}],response:[{type:"Property",name:"msgReceiptTag",reflectMapper:uT.msgReceiptTag}]},batchMarkRead:{sid:4,cid:5,service:"msg",hasPacketResponse:!1,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]},syncMsgReceipts:{sid:4,cid:12,service:"msg",response:[{type:"PropertyArray",name:"msgReceipts",reflectMapper:uT.msgReceiptTag},{type:"Long",name:"timetag"}]},syncOfflineMsgs:{sid:4,cid:4,service:"msg",response:[{type:"PropertyArray",name:"msgs",reflectMapper:uT.msg}]},syncRoamingMsgs:{sid:4,cid:9,service:"msg",response:[{type:"PropertyArray",name:"msgs",reflectMapper:uT.msg}]},syncBroadcastMsg:{sid:4,cid:16,service:"msg",response:[{type:"PropertyArray",name:"msgs",reflectMapper:uT.broadcastMsg}]},onBroadcastMsg:{sid:7,cid:17,service:"msg",response:[{type:"Property",name:"msg",reflectMapper:uT.broadcastMsg}]},onDeleteSelfMsg:{sid:7,cid:123,service:"msg",response:[{type:"Property",name:"deletedMsg",reflectMapper:uT.deleteSelfMsgTag}]},onDeleteSelfMsgs:{sid:7,cid:124,service:"msg",response:[{type:"PropertyArray",name:"deletedMsgs",reflectMapper:uT.deleteSelfMsgTag}]},syncDeleteSelfMsgs:{sid:4,cid:21,service:"msg",response:[{type:"PropertyArray",name:"deletedMsgs",reflectMapper:uT.deleteSelfMsgTag}]}};!function(e){e[e.none=0]="none",e[e.pass=1]="pass",e[e.decline=2]="decline",e[e.read=3]="read",e[e.deleted=4]="deleted",e[e.invalid=5]="invalid"}(eT||(eT={})),function(e){e[e.default=0]="default",e[e.leave=1]="leave",e[e.roam=2]="roam"}(tT||(tT={})),function(e){e[e.applyTeam=0]="applyTeam",e[e.rejectTeamApply=1]="rejectTeamApply",e[e.teamInvite=2]="teamInvite",e[e.rejectTeamInvite=3]="rejectTeamInvite",e[e.friendRequest=5]="friendRequest",e[e.deleteFriend=6]="deleteFriend",e[e.recallMsgP2p=7]="recallMsgP2p",e[e.recallMsgTeam=8]="recallMsgTeam",e[e.recallMsgSuperTeam=12]="recallMsgSuperTeam",e[e.deleteMsgP2pOneWay=13]="deleteMsgP2pOneWay",e[e.deleteMsgTeamOneWay=14]="deleteMsgTeamOneWay",e[e.applySuperTeam=15]="applySuperTeam",e[e.rejectSuperTeamApply=16]="rejectSuperTeamApply",e[e.superTeamInvite=17]="superTeamInvite",e[e.rejectSuperTeamInvite=18]="rejectSuperTeamInvite",e[e.customP2p=100]="customP2p",e[e.customTeam=101]="customTeam",e[e.customSuperTeam=103]="customSuperTeam"}(rT||(rT={}));var lT={1:"addFriend",2:"applyFriend",3:"passFriendApply",4:"rejectFriendApply"},pT={setting:{needSaveOffline:{type:"boolean"},isRoutable:{type:"boolean"},envConfig:{type:"string"}},antiSpamInfo:{needAntiSpam:{type:"boolean"},antiSpamContent:{type:"boolean"}},pushInfo:iT,recallMessageInfo:{idClient:{type:"string",rawKey:"deletedIdClient"},idServer:{type:"string",rawKey:"deletedIdServer"},createTime:{type:"number",rawKey:"deletedMsgCreateTime"},fromNick:{type:"string",rawKey:"deletedMsgFromNick"},opeAccount:{type:"string"}}};function mT(e,t,r){var n=+e.type,i=Rp(rT,n);r=r||tT.default;var o=dr(dr({},Ph(pT,e)),{type:i,time:+e.time,to:e.to,from:e.from,idServer:e.idServer,state:eT[eT.none],feature:tT[r]});if("0"===o.idServer&&o.setting&&(o.setting.needSaveOffline=!1),"string"==typeof o.attach)try{o.attach=JSON.parse(o.attach)}catch(e){t.error("formatSystemMessage: "+o.idServer+" parse attach error",e&&e.message)}return 5===n&&o.attach?(o.attach.type=lT[+o.attach.vt],"passFriendApply"===o.attach.type?o.state=eT[eT.pass]:"rejectFriendApply"===o.attach.type&&(o.state=eT[eT.decline])):n<=3&&o.attach&&(o.attach=function(e){var t=e.attach,r=e.tinfo,n=Jl(e,["attach","tinfo"]);return n.ext=t,void 0!==r&&(n.team=TS(yh(e.tinfo,OS.team))),n}(o.attach)),o}function hT(e){var t=dr({},e);return dr(dr({},Uh(pT,t)),{type:rT[t.type],to:t.to,attach:t.attach})}function fT(e){return e===rT.recallMsgP2p?"p2p":e===rT.recallMsgTeam?"team":e===rT.recallMsgSuperTeam?"superTeam":""}var gT=function(e){function t(t){var r;return(r=e.call(this,"msg",t)||this).onV2SendMessage=function(e){var t=YS(e,{account:r.core.account,featureValue:kh.default});t.status=e.status,r.core.eventBus.emit("session/updateForNewMsg",t)},r.onV2ModifyMessage=function(e){var t,n=Eh[e.scene]+"-"+(e.to===r.core.account?e.from:e.to),i=null===(t=r.core.session)||void 0===t?void 0:t.getSessionWithUncomplete({id:n}),o=YS(e,i?{account:r.core.account,sessionAck:i.ack,msgReceiptTime:i.msgReceiptTime}:{account:r.core.account});r.core.eventBus.emit("session/updateForModifyMsg",o)},r.onV2RecallMsg=function(e){var t=$S([e],fT(+e.type));r.core.eventBus.emit("session/updateForDeletedMsg",t)},r.onV2DeleteSelfMsgs=function(e){var t=$S(e);r.core.eventBus.emit("session/updateForDeletedMsg",t)},r.service=new nT(t),Mh({cmdMap:aT,cmdConfig:dT}),r.registerListener(),r}nr(t,e);var r=t.prototype;return r.registerListener=function(){this.core.eventBus.on("forwardReceive/msg/sendMsg",this.onV2SendMessage),this.core.eventBus.on("forwardReceive/msg/modifyMsg",this.onV2ModifyMessage),this.core.eventBus.on("forwardReceive/msg/recallMsg",this.onV2RecallMsg),this.core.eventBus.on("forwardReceive/msg/deleteSelfMsgs",this.onV2DeleteSelfMsgs)},r.sendTextMsg=function(e){return Pl({body:{type:"string",allowEmpty:!1}},e),this.sendMsg(dr(dr({},e),{type:"text"}))},r.sendTipMsg=function(e){return Pl({body:{type:"string",allowEmpty:!1}},e),this.sendMsg(dr(dr({},e),{type:"tip"}))},r.sendGeoLocationMsg=function(e){return Pl({attach:{type:"object",rules:{title:{type:"string",allowEmpty:!1},lat:{type:"number"},lng:{type:"number"}}}},e),this.sendMsg(dr(dr({},e),{type:"geo",attach:_i(e.attach)}))},r.sendCustomMsg=function(e){return Pl({attach:{type:"string",allowEmpty:!1}},e),this.sendMsg(dr(dr({},e),{type:"custom"}))},r.sendMsg=function(e){var t,r=this;if(Pl({scene:{type:"enum",values:wp(Eh)},type:{type:"enum",values:wp(_h)},to:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1},setting:{type:"object",rules:{resendFlag:{type:"boolean",required:!1},needSaveHistory:{type:"boolean",required:!1},needRoaming:{type:"boolean",required:!1},needOffline:{type:"boolean",required:!1},needSelfSync:{type:"boolean",required:!1},needRouted:{type:"boolean",required:!1},needUpdateSession:{type:"boolean",required:!1}},required:!1},antiSpamInfo:{type:"object",required:!1,rules:{clientAntispamHitting:{type:"boolean",required:!1},antiSpamUsingYidun:{type:"boolean",required:!1}}},pushInfo:{type:"object",required:!1,rules:qS},robotInfo:{type:"object",required:!1,rules:BS},teamSpecializationInfo:{type:"object",required:!1,rules:{needACK:{type:"boolean",required:!1}}}},e),"team"===e.scene&&e.robotInfo&&!e.robotInfo.account)throw new El('When "scene" equals "team", account is required in robotInfo',{key:"account"},"required");var n,i="p2p"===e.scene?"sendMsg":"team"===e.scene?"sendTeamMsg":"sendSuperTeamMsg",o=XS(e,this.core.account,this.core.config.deviceId,null===(t=this.core.user)||void 0===t?void 0:t.myInfo),a=YS(dr(dr({},o),{time:(new Date).getTime()}),{account:this.core.account,featureValue:kh.default,statusValue:Rh.sending});try{e.onSendBefore&&e.onSendBefore(a)}catch(e){this.logger.error("sendMsg: options.onSendBefore error",e)}return this.core.eventBus.emit("session/updateForNewMsg",a),this.core.eventBus.emit("forwardSend/msg/sendMsg",o),this.core.sendCmd(i,{msg:o}).then((function(t){var i=t.content,s=t.error;if(n=i.msg,s)throw s;var c=YS(dr(dr({},o),i.msg),{account:r.core.account,featureValue:kh.default,statusValue:Rh.sent});return c.from===c.to&&r.markMsgsAck([c]),r.core.eventBus.emit("session/updateForNewMsg",c),r.core.eventBus.emit("forwardSend/msg/sendMsg",dr(dr({},XS(c,c.from,c.fromDeviceId)),{idClient:c.idClient,status:"sent"})),r.core.reporter.report("msgSend",{msgId:c.idServer,clientId:c.idClient,msgTime:c.time,fromAccid:"p2p"===e.scene?r.core.account:"",toAccid:c.to,type:Eh[c.scene],roomId:"",tid:"p2p"===e.scene?"":c.to,result:200,failReason:"",rt:_s()-a.time}),c})).catch((function(t){var i=YS(dr(dr(dr({},o),{time:(new Date).getTime()}),n),{account:r.core.account,featureValue:kh.default,statusValue:7101===t.code?Rh.refused:Rh.sendFailed});throw t.msg=i,r.core.eventBus.emit("session/updateForNewMsg",i),r.core.eventBus.emit("forwardSend/msg/sendMsg",dr(dr({},XS(i,i.from,i.fromDeviceId)),{status:"sendFailed"})),r.core.reporter.report("msgSend",{msgId:i.idServer,clientId:i.idClient,msgTime:i.time,fromAccid:"p2p"===e.scene?r.core.account:"",toAccid:i.to,type:Eh[i.scene],roomId:"",tid:"p2p"===e.scene?"":i.to,result:null==t?void 0:t.code,failReason:(null==t?void 0:t.message)||"",rt:_s()-a.time}),t}))},r.resendMsg=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Pl({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1}}}},e),r=e.msg,n=dr(dr({},r),{attach:r.attach?_i(r.attach):void 0,setting:{resendFlag:!0}}),r.from===this.core.account){t.next=5;break}throw new Error("You can only resend messages that you sent: "+r.idClient);case 5:return t.abrupt("return",this.sendMsg(n));case 6:case"end":return t.stop()}}),t,this)})))},r.forwardMsg=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1}}},scene:{type:"enum",values:wp(Eh)},to:{type:"string",allowEmpty:!1}},e),r=e.msg,n=dr(dr({},r),{scene:e.scene,to:e.to,attach:r.attach?_i(r.attach):void 0}),t.abrupt("return",this.sendMsg(n));case 4:case"end":return t.stop()}}),t,this)})))},r.sendImageMsg=function(e){return this.doSendFile(dr(dr({},e),{type:"image"}))},r.sendFileMsg=function(e){return this.doSendFile(dr(dr({},e),{type:"file"}))},r.sendAudioMsg=function(e){return this.doSendFile(dr(dr({},e),{type:"audio"}))},r.sendVideoMsg=function(e){return this.doSendFile(dr(dr({},e),{type:"video"}))},r.doSendFile=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Pl({scene:{type:"enum",values:wp(Eh)},to:{type:"string",allowEmpty:!1},type:{type:"string",allowEmpty:!1},attach:{type:"object",rules:{url:{type:"string",allowEmpty:!1}},required:!1},maxSize:{type:"number",min:1,required:!1}},e),r=e.attach){t.next=15;break}if(this.core.cloudStorage&&this.core.cloudStorage.uploadFile){t.next=5;break}throw new Error('Service "cloudStorage" does not exist');case 5:return t.prev=5,t.next=8,this.core.cloudStorage.uploadFile(e);case 8:r=t.sent,t.next=15;break;case 11:throw t.prev=11,t.t0=t.catch(5),this.logger.error("sendFile:: upload File error or abort.",t.t0),t.t0;case 15:return t.abrupt("return",this.sendMsg(dr(dr({},e),{attach:_i(r),type:e.type})));case 16:case"end":return t.stop()}}),t,this,[[5,11]])})))},r.recallMsg=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a,s;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1},scene:{type:"enum",values:wp(Eh)},time:{type:"number"}}},pushInfo:{type:"object",required:!1,rules:iT},ps:{type:"string",allowEmpty:!1,required:!1}},e),r=e.msg,n={p2p:"recallMsg",team:"recallMsg",superTeam:"recallSuperTeamMsg"},i={p2p:7,team:8,superTeam:12},o=zS({time:r.time,type:i[r.scene],to:r.to,from:r.from,ps:e.ps,attach:e.attach,deletedIdClient:r.idClient,deletedIdServer:r.idServer,opeAccount:r.from,env:e.env,pushInfo:e.pushInfo}),t.next=7,this.core.sendCmd(n[r.scene],{recallMsgTag:o});case 7:return a=dr({},r,{deletedMsgCreateTime:r.time}),s=$S([a]),this.core.eventBus.emit("session/updateForDeletedMsg",s),this.core.eventBus.emit("forwardSend/msg/recallMsg",o),t.abrupt("return",r);case 12:case"end":return t.stop()}}),t,this)})))},r.deleteSelfMsgs=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({msgs:{type:"array",rules:{scene:{type:"enum",values:["p2p","team"]},from:{type:"string",allowEmpty:!1},to:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},time:{type:"number",allowEmpty:!1}}},ext:{type:"string",allowEmpty:!1,required:!1}},e),r=e.msgs,n=du(r).call(r,(function(t){return{scene:"p2p"===t.scene?1:2,from:t.from,to:t.to,idServer:t.idServer,idClient:t.idClient,deletedMsgCreateTime:t.time,ext:e.ext}})),t.next=5,this.core.sendCmd("deleteSelfMsgs",{deletedMsgs:n});case 5:return i=t.sent,o=du(n).call(n,(function(e){var t;return dr({},e,{time:null===(t=null==i?void 0:i.content)||void 0===t?void 0:t.timetag})})),a=$S(o),this.core.eventBus.emit("session/updateForDeletedMsg",a),this.core.eventBus.emit("forwardSend/msg/deleteSelfMsgs",du(n).call(n,(function(e){var t;return dr(dr({},e),{time:null===(t=null==i?void 0:i.content)||void 0===t?void 0:t.timetag})}))),t.abrupt("return",a);case 11:case"end":return t.stop()}}),t,this)})))},r.sendMsgReceipt=function(e){var t,r;return zl(this,void 0,void 0,Ql.mark((function n(){var i,o,a,s;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(Pl({msg:{type:"object",rules:{idClient:{type:"string",allowEmpty:!1},target:{type:"string",allowEmpty:!1},time:{type:"number"}}}},e),"p2p"===(i=e.msg).scene&&"in"===i.flow){n.next=5;break}return this.logger.warn("Msg scene: "+i.scene+", flow: "+i.flow+" is not allowed to send msg receipt"),n.abrupt("return",void 0);case 5:return o={to:i.target,idClient:i.idClient,time:i.time},n.next=8,this.core.sendCmd("sendMsgReceipt",{msgReceiptTag:o});case 8:return a=n.sent,s=$p(null===(r=null===(t=a.content)||void 0===t?void 0:t.msgReceiptTag)||void 0===r?void 0:r.time),n.abrupt("return",dr(dr({},o),{time:s?Math.min(s,o.time):o.time}));case 11:case"end":return n.stop()}}),n,this)})))},r.sendTeamMsgReceipt=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamMsgReceipts:{type:"array",rules:{teamId:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1}},max:50}},e),r=e.teamMsgReceipts,this.core.sendCmd("sendTeamMsgReceipt",{teamMsgReceipts:r}),t.abrupt("return",void 0);case 4:case"end":return t.stop()}}),t,this)})))},r.getTeamMsgReads=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Pl({teamMsgReceipts:{type:"array",rules:{teamId:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1}}}},e),n=e.teamMsgReceipts,r.next=4,this.core.sendCmd("getTeamMsgReads",{teamMsgReceipts:n});case 4:return i=r.sent,o=(o=null===(t=i.content)||void 0===t?void 0:t.teamMsgReceipts)?du(o).call(o,(function(e){return dr(dr({},e),{read:$p(e.read),unread:$p(e.unread)})})):[],r.abrupt("return",o);case 8:case"end":return r.stop()}}),r,this)})))},r.getTeamMsgReadAccounts=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamMsgReceipt:{type:"object",rules:{teamId:{type:"string",allowEmpty:!1},idClient:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1}}}},e),r=e.teamMsgReceipt,t.next=4,this.core.sendCmd("getTeamMsgReadAccounts",{teamMsgReceiptTag:r});case 4:return n=t.sent,t.abrupt("return",n.content);case 6:case"end":return t.stop()}}),t,this)})))},r.markMsgsAck=function(e){if(e&&e.length>0){var t=[],r=[];jn(e).call(e,(function(e){"p2p"===e.scene&&"in"===e.flow?t.push(e):"team"===e.scene&&"in"===e.flow&&r.push(e)})),t.length>0&&this.core.sendCmd("batchMarkRead",{sid:7,cid:2,ids:du(t).call(t,(function(e){return e.idServer}))}),r.length>0&&this.core.sendCmd("batchMarkRead",{sid:8,cid:3,ids:du(r).call(r,(function(e){return e.idServer}))})}},r.onMsgHandler=function(e){var t;if(e.error)this.logger.error("msgHandler::recvError",e.error);else{var r="number"==typeof Zp(e,"raw.r[0]")?""+e.raw.r[0]:void 0,n=e.content.msg;n.idServer=n.idServer||r;var i=WS(n,this.core.account),o=null===(t=this.core.session)||void 0===t?void 0:t.getSessionWithUncomplete({id:i}),a=YS(n,o?{account:this.core.account,sessionAck:o.ack,msgReceiptTime:o.msgReceiptTime}:{account:this.core.account});this.logger.getDebugMode()?this.logger.debug("msgHandler::recvMsg",a.idClient,a.idServer,a):this.logger.log("msgHandler::recvMsg",a.idClient,a.idServer),this.markMsgsAck([a]),this.core.eventBus.emit("session/updateForNewMsg",a),"superTeam"===a.scene?this.core.eventBus.emit("sync/updateTimetag",{superTeamRoamingMsgs:a.time}):this.core.eventBus.emit("sync/updateTimetag",{roamingMsgs:a.time}),this.core.emit("msg",a),"notification"===a.type?this.core.eventBus.emit("team/onNotification",a):"out"!==a.flow&&this.doMsgReceiveReport(a,e),"notification"!==a.type&&this.core.user.checkUserUpdate(a)}},r.doMsgReceiveReport=function(e,t){if(e.from!==this.core.account){var r="p2p"===e.scene,n=Zp(e,"__clientExt.statistics.apiCallingTime")||0,i=Zp(e,"__clientExt.statistics.sendTime")||0,o=Zp(e,"__clientExt.statistics.attachUploadDuration")||0,a=this.core.timeOrigin.getNTPTime(),s=e.time,c=this.core.timeOrigin.checkNodeReliable(t.__receiveTimeNode)?this.core.timeOrigin.getNTPTime(t.__receiveTimeNode):a;this.core.reporter.report("msgReceive",{msgId:e.idServer,clientId:e.idClient,serverTime:s,receiveTime:c,fromAccid:r?e.from:"",toAccid:e.to,type:Eh[e.scene],tid:r?"":e.to,apiCallingTime:n,sendTime:i,attachUploadDuration:o,callbackTime:a,preHandleTime:a,result:200,failReason:"",rt:a-s})}},r.nimOnTeamMsgsHandler=function(e){var t,r=this;jn(t=e.content.datas).call(t,(function(t){r.onMsgHandler(dr({},e,{content:{msg:t}}))}))},r.syncRoamingMsgsHandler=function(e){var t,r,n=e.content.msgs||[];if(0!==n.length){var i=WS(n[0],this.core.account),o=null===(t=this.core.session)||void 0===t?void 0:t.getSessionWithUncomplete({id:i}),a=(n=QS(n,o?{account:this.core.account,featureValue:kh.roam,sessionAck:o.ack,msgReceiptTime:o.msgReceiptTime}:{account:this.core.account,featureValue:kh.roam}))[0].time,s={timetag:a,sessionId:i,msgs:ZS(n)};"function"!=typeof(null===(r=this.core.sync)||void 0===r?void 0:r.getSyncDoneFlag)||this.core.sync.getSyncDoneFlag()||this.core.eventBus.emit("session/syncMsgs",s),this.core.emit("syncRoamingMsgs",s),"superTeam"===n[0].scene?this.core.eventBus.emit("sync/updateTimetag",{superTeamRoamingMsgs:a}):this.core.eventBus.emit("sync/updateTimetag",{roamingMsgs:a})}},r.syncOfflineMsgsHandler=function(e){var t,r=this,n=e.content.msgs||[];if(0!==n.length){var i={},o=[];jn(n).call(n,(function(e){var t=WS(e,r.core.account),n=r.core.session.getSessionWithUncomplete({id:t}),a=YS(e,n?{account:r.core.account,featureValue:kh.leave,sessionAck:n.ack,msgReceiptTime:n.msgReceiptTime}:{account:r.core.account,featureValue:kh.leave});o.push(a),i[a.sessionId]?i[a.sessionId].push(a):i[a.sessionId]=[a]})),this.markMsgsAck(o);var a=0;jn(t=fr(i)).call(t,(function(e){var t,n=Vm(t=i[e]).call(t,(function(e,t){return t.time-e.time}));(n=JS(n))[0].time>a&&(a=n[0].time);var o={timetag:n[0].time,sessionId:e,msgs:n};r.core.eventBus.emit("session/syncMsgs",o),r.core.emit("syncOfflineMsgs",o)})),this.core.eventBus.emit("sync/updateTimetag",{offlineMsgs:a})}},r.syncDeleteSelfMsgsHandler=function(e){var t,r=null===(t=e.content)||void 0===t?void 0:t.deletedMsgs;r&&r.length>0||this.logger.warn("syncDeleteSelfMsgs:: no msgs");var n=r[r.length-1].time;this.core.eventBus.emit("sync/updateTimetag",{deleteSelfMsgs:n})},r.onDeleteSelfMsgHandler=function(e){var t=$S([e.content.deletedMsg]);this.core.eventBus.emit("session/updateForDeletedMsg",t),this.core.emit("deleteSelfMsgs",t)},r.onDeleteSelfMsgsHandler=function(e){var t=$S(e.content.deletedMsgs);this.core.eventBus.emit("session/updateForDeletedMsg",t),this.core.emit("deleteSelfMsgs",t)},r.onBroadcastMsgHandler=function(e){var t=e.content.msg,r=this.service.processBroadcastMsg([t]);this.core.emit("broadcastMsgs",r)},r.syncBroadcastMsgHandler=function(e){var t=e.content.msgs,r=this.service.processBroadcastMsg(t);this.core.emit("broadcastMsgs",r)},t}(nf),vT={"5_1":"sync"},yT={sync:{sid:5,cid:1,service:"sync",hasPacketTimer:!1,params:[{type:"Property",name:"sync",reflectMapper:{myInfo:1,offlineMsgs:2,teams:3,roamingMsgs:7,relations:9,friends:11,friendUsers:13,msgReceipts:14,myTeamMembers:15,donnop:16,recallMsg:17,sessionAck:18,broadcastMsgs:20,avSignal:21,superTeams:22,mySuperTeamMembers:23,superTeamRoamingMsgs:24,deleteSuperTeamMsg:25,superTeamSessionAck:26,deleteSelfMsgs:27,stickTopSessions:28,sessionHistoryMsgsDelete:29}}],response:[{type:"Long",name:"timetag"}]}},MT=function(e){function t(t,r){var n;return void 0===r&&(r={}),(n=e.call(this,"sync",t)||this).syncDoneFlag=!1,n.config={myInfo:!!t.user.name,offlineMsgs:!!t.msg.name,teams:!!t.team.name,myTeamMembers:!!t.team.name,roamingMsgs:!!t.msg.name,relations:!!t.user.name,friends:!!t.friend.name,friendUsers:!!t.user.name,msgReceipts:!!t.msg.name,broadcastMsgs:!!t.msg.name,recallMsg:!!t.msg.name,sessionAck:!!t.session.name,superTeamSessionAck:!!t.session.name,superTeams:!!t.superTeam.name,mySuperTeamMembers:!!t.superTeam.name,superTeamRoamingMsgs:!!t.superTeam.name,deleteSuperTeamMsg:!!t.superTeam.name,deleteSelfMsgs:!!t.msg.name,sessionHistoryMsgsDelete:!!t.msgLog.name,avSignal:!!t.signaling.name},n.setOptions(r),n.timetags={},n.initEventListeners(),Mh({cmdMap:vT,cmdConfig:yT}),n}nr(t,e);var r=t.prototype;return r.setOptions=function(e){dr(this.config,e)},r.reset=function(){this.timetags={},this.syncDoneFlag=!1},r.getSyncDoneFlag=function(){return this.syncDoneFlag},r.doSync=function(){var e;return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this.genSyncParams(),this.logger.log("sync::doSyncV1: ",r),t.prev=2,t.next=5,this.core.clientSocket.sendCmd("sync",{sync:r});case 5:n=t.sent,this.core.logger.log("sync::doSyncV1 done in",null===(e=n.content)||void 0===e?void 0:e.timetag),this.syncDoneFlag=!0,this.core.emit("syncdone"),t.next=17;break;case 11:return t.prev=11,t.t0=t.catch(2),this.core.logger.error("sync::doSyncV1 error",t.t0),this.syncDoneFlag=!0,this.core.emit("syncdone"),t.abrupt("return");case 17:case"end":return t.stop()}}),t,this,[[2,11]])})))},r.initEventListeners=function(){var e=this;this.core.eventBus.on("logined",(function(){e.syncDoneFlag=!1,e.doSync()})),this.core.eventBus.on("sync/updateTimetag",(function(t){var r;jn(r=fr(t)).call(r,(function(r){t[r]>(e.timetags[r]||0)&&(e.timetags[r]=t[r])}))}))},r.genSyncParams=function(){var e,t,r=this;return Ml(e=fu(t=fr(this.config)).call(t,(function(e){var t=e;return r.config[t]}))).call(e,(function(e,t){var n=t;return e[n]=r.timetags[n]||0,e}),{})},r.handleImmediate=function(e){return this.core.session&&this.core.session.onSyncDone&&this.core.session.onSyncDone(),fs.resolve(e)},r.delaySyncDone=function(e){var t=this;return"ALI"===Ap()?(this.core.logger.log("sync: emit ALIAPP sycnHandler, handle later"),new fs((function(r){qs((function(){t.handleImmediate(e).then((function(){r(e)}))}),100)}))):this.handleImmediate(e)},r.syncHandler=function(e){return this.delaySyncDone(e)},t}(nf);function IT(e,t){var r,n=void 0!==Nc&&Fl(e)||e["@@iterator"];if(n)return tr(r=(n=n.call(e)).next).call(r,n);if(Ei(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return ST(e,t);var n=Wc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Bl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ST(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ST(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var TT=function(e){function t(t){var r;return(r=e.call(this,"user",t)||this).userInfoMap=new ad,r.myInfo=AS({}),Mh({cmdMap:LS,cmdConfig:DS}),r}nr(t,e);var r=t.prototype;return r.setBlack=function(e){var t=this;return Pl({account:{type:"string",allowEmpty:!1},isAdd:{type:"boolean"}},e),this.core.sendCmd("setBlack",e).then((function(){t.core.eventBus.emit("forwardSend/user/updateBlackList",e.account,e.isAdd)}))},r.setMute=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({account:{type:"string",allowEmpty:!1},isAdd:{type:"boolean"}},e),t.next=3,this.core.sendCmd("setMute",e).then((function(){}));case 3:this.core.eventBus.emit("forwardSend/user/setMute",e.account,e.isAdd);case 4:case"end":return t.stop()}}),t,this)})))},r.getRelations=function(){return this.core.sendCmd("syncRelations",{timetag:0})},r.getBlackList=function(){return zl(this,void 0,void 0,Ql.mark((function e(){var t;return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.sendCmd("syncRelations",{timetag:0});case 2:return t=e.sent,e.abrupt("return",t.blackList||[]);case 4:case"end":return e.stop()}}),e,this)})))},r.getMuteList=function(){return zl(this,void 0,void 0,Ql.mark((function e(){var t;return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.sendCmd("syncRelations",{timetag:0});case 2:return t=e.sent,e.abrupt("return",t.muteList||[]);case 4:case"end":return e.stop()}}),e,this)})))},r.updatePushToken=function(){return zl(this,void 0,void 0,Ql.mark((function e(){return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.logger.error("This function is deprecated, please use nim.offlinePush.setOfflinePushConfig instead");case 1:case"end":return e.stop()}}),e,this)})))},r.updateAppBackground=function(){return zl(this,void 0,void 0,Ql.mark((function e(){return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.logger.error("This function is deprecated, please use nim.offlinePush.setOfflinePushConfig instead");case 1:case"end":return e.stop()}}),e,this)})))},r.getUsersNameCardFromServer=function(e){var t=this;return Pl({accounts:{type:"array",max:150,itemType:"string"}},e),this.core.sendCmd("getUsersNameCardFromServer",og(e,["accounts"])).then((function(r){var n,i=r.content;return t.logger.log("user:: getUsers done",e.accounts),i&&i.users?du(n=i.users).call(n,(function(e){return AS(e)})):[]}))},r.updateMyNameCard=function(e){var t=this;if(Pl({nick:{type:"string",required:!1},avatar:{type:"string",required:!1},signature:{type:"string",required:!1},gender:{type:"enum",values:wp(aS),required:!1},email:{type:"string",required:!1},birth:{type:"string",required:!1},tel:{type:"string",required:!1},ext:{type:"string",required:!1}},e),0===fr(e).length)return fs.resolve(this.myInfo);var r=og(e,["nick","avatar","signature","email","birth","tel","ext"]);return e.gender&&(r.gender=aS[e.gender]),this.core.sendCmd("updateMyNameCard",{user:r}).then((function(n){var i=n.content;return i&&i.timetag&&t.core.eventBus.emit("sync/updateTimetag",{myInfo:+i.timetag}),e.gender&&(r.gender=e.gender),t.myInfo=dr({},t.myInfo,r),t.core.eventBus.emit("forwardSend/user/updateUserInfo",r),t.myInfo}))},r.checkUserUpdate=function(e){var t=e.from;if(t!==this.core.account){var r=this.userInfoMap.get(t);if(r){var n=r.updateTime,i=e.userUpdateTime;!isNaN(n)&&!isNaN(i)&&"number"==typeof n&&"number"==typeof i&&n<i&&this.refreshUserInfo(t)}else this.refreshUserInfo(t)}},r.refreshUserInfo=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getUsersNameCardFromServer({accounts:[e]});case 2:for(r=t.sent,n=IT(r);!(i=n()).done;)o=i.value,this.userInfoMap.set(o.account,o),this.core.emit("updateUserInfo",o);case 4:case"end":return t.stop()}}),t,this)})))},r.onUpdateBlackListHandler=function(e){var t=e.content;t.account?this.core.emit("updateBlackList",t):this.logger.warn("onUpdateBlackListHandler: no account")},r.onUpdateMuteListHandler=function(e){var t=e.content;t.account?this.core.emit("updateMuteList",t):this.logger.warn("onUpdateBlackListHandler: no account")},r.syncRelationsHandler=function(e){var t=e.content,r=t.list,n=t.timetag,i={blackList:[],muteList:[]};return n&&this.core.eventBus.emit("sync/updateTimetag",{relations:n}),r&&r.length&&jn(r).call(r,(function(e){var t=function(e){var t={account:e.account,updateTime:+e.updateTime,createTime:+e.createTime};return"1"===e.isMuted&&(t.isMuted=!0),"1"===e.isBlack&&(t.isBlack=!0),t}(e);t.isBlack&&i.blackList.push(t),t.isMuted&&i.muteList.push(t)})),this.core.emit("relations",i),fs.resolve(i)},r.syncMyNameCardHandler=function(e){e.content.user&&(this.myInfo=AS(e.content.user),this.core.emit("syncMyNameCard",this.myInfo),this.core.eventBus.emit("sync/updateTimetag",{myInfo:e.content.timetag}))},r.onUpdateMyNameCardHandler=function(e){var t=e.content.user;t?(dr(this.myInfo,AS(t)),this.core.emit("updateMyNameCard",this.myInfo)):this.logger.warn("onUpdateMyNameCardHandler no user info")},t}(nf),bT={"4_12":"syncMsgReceipts","4_14":"syncSessionAck","4_20":"syncSuperTeamSessionAck","4_22":"nimSyncSessionsWithMoreRoaming","4_25":"syncSessionReliableInfo","7_12":"multiSyncMsgReceipt","7_16":"markSessionAck","7_25":"markMultSessionsAck","7_116":"syncMarkSessionAck","21_25":"markSuperTeamSessionAck","21_32":"markMultSuperTeamSessionsAck","21_125":"syncMarkSuperTeamSessionAck","4_23":"nimSyncStickTopSessions","23_12":"nimAddStickTopSession","23_13":"nimDeleteStickTopSession","23_14":"nimUpdateStickTopSession","23_112":"nimMultiSyncAddStickTopSession","23_113":"nimMultiSyncDeleteStickTopSession","23_114":"nimMultiSyncUpdateStickTopSession"},CT={msgReceiptTag:{to:1,from:2,time:7,idClient:11},stickTopSessionTag:{id:1,ext:2,createTime:3,updateTime:4},sessionAckTag:{scene:1,to:2,timetag:3},sessionReliableSyncTag:{scene:1,sessionId:2,syncStatus:3,syncEndMsgId:4,syncEndMsgidClient:5,syncEndMsgTime:6,syncStartMsgid:7,syncStartMsgidClient:8,syncStartMsgTime:9,nextMsgid:10,nextMsgidClient:11,nextMsgTime:12,roamMsgSync:13,offlineMsgSync:14,netCallOfflineMsgSync:15}},_T=Ih(CT),ET={syncMsgReceipts:{sid:4,cid:12,service:"session",response:[{type:"PropertyArray",name:"msgReceipts",reflectMapper:_T.msgReceiptTag},{type:"Long",name:"timetag"}]},syncSessionAck:{sid:4,cid:14,service:"session",response:[{type:"StrLongMap",name:"p2p"},{type:"LongLongMap",name:"team"},{type:"Long",name:"timetag"}]},syncSuperTeamSessionAck:{sid:4,cid:20,service:"session",response:[{type:"LongLongMap",name:"superTeam"},{type:"Long",name:"timetag"}]},multiSyncMsgReceipt:{sid:7,cid:12,service:"session",response:[{type:"Property",name:"msgReceiptTag",reflectMapper:_T.msgReceiptTag}]},markSessionAck:{sid:7,cid:16,service:"session",params:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},syncMarkSessionAck:{sid:7,cid:116,service:"session",response:[{type:"Byte",name:"scene"},{type:"String",name:"to"},{type:"Long",name:"timetag"}]},syncMarkSuperTeamSessionAck:{sid:21,cid:125,service:"session",response:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},markMultSessionsAck:{sid:7,cid:25,service:"session",ignoreErrCodes:[700],params:[{type:"PropertyArray",name:"datas",reflectMapper:CT.sessionAckTag}]},markSuperTeamSessionAck:{sid:21,cid:25,service:"session",params:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},nimAddStickTopSession:{sid:23,cid:12,service:"session",params:[{type:"Property",name:"tag",reflectMapper:CT.stickTopSessionTag}],response:[{type:"Property",name:"data",reflectMapper:_T.stickTopSessionTag}]},nimDeleteStickTopSession:{sid:23,cid:13,service:"session",params:[{type:"Property",name:"tag",reflectMapper:CT.stickTopSessionTag}],response:[{type:"Long",name:"timetag"}]},nimUpdateStickTopSession:{sid:23,cid:14,service:"session",params:[{type:"Property",name:"tag",reflectMapper:CT.stickTopSessionTag}],response:[{type:"Property",name:"data",reflectMapper:_T.stickTopSessionTag}]},nimMultiSyncAddStickTopSession:{sid:23,cid:112,service:"session",response:[{type:"Property",name:"data",reflectMapper:_T.stickTopSessionTag}]},nimMultiSyncDeleteStickTopSession:{sid:23,cid:113,service:"session",response:[{type:"Long",name:"timetag"},{type:"Property",name:"data",reflectMapper:_T.stickTopSessionTag}]},nimMultiSyncUpdateStickTopSession:{sid:23,cid:114,service:"session",response:[{type:"Property",name:"data",reflectMapper:_T.stickTopSessionTag}]},nimSyncStickTopSessions:{sid:4,cid:23,service:"session",response:[{type:"Long",name:"timetag"},{type:"Bool",name:"isThereAnyChange"},{type:"PropertyArray",name:"datas",reflectMapper:_T.stickTopSessionTag}]},markMultSuperTeamSessionsAck:{sid:21,cid:32,service:"session",ignoreErrCodes:[700],params:[{type:"PropertyArray",name:"datas",reflectMapper:CT.sessionAckTag}]},nimSyncSessionsWithMoreRoaming:{sid:4,cid:22,service:"session",response:[]},syncSessionReliableInfo:{sid:4,cid:25,service:"session",response:[]}},wT={id:{type:"string"},ext:{type:"string"},createTime:{type:"number"},updateTime:{type:"number"}};function RT(e,t,r){void 0===r&&(r=!0);var n=Ph(wT,e);n.isStickOnTop=r,n.id=t.id,r||(n.ext="");var i=dr(dr({},t),{stickTopInfo:t.stickTopInfo?dr({},t.stickTopInfo,n):n});return void 0===i.lastMsg&&(i.lastMsg=null),i}var kT=function(){function e(e){this.core=e}var t=e.prototype;return t.getSession=function(e){return this.core.session.getSessionWithUncomplete({id:e})||this.core.session.createSession(e)},t.addStickTopSession=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a,s;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({id:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},e),r=kp(e.id),n=r.scene,i=r.accid,t.next=4,this.core.sendCmd("nimAddStickTopSession",{tag:{id:("superTeam"===n?"super_team":n)+"|"+i,ext:e.ext||""}});case 4:return o=t.sent,a=this.getSession(e.id),s=RT(o.content.data,a),t.abrupt("return",s);case 8:case"end":return t.stop()}}),t,this)})))},t.deleteStickTopSession=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a,s;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({id:{type:"string",allowEmpty:!1}},e),r=kp(e.id),n=r.scene,i=r.accid,t.next=4,this.core.sendCmd("nimDeleteStickTopSession",{tag:{id:("superTeam"===n?"super_team":n)+"|"+i}});case 4:return o=t.sent,a=this.getSession(e.id),s=RT({updateTime:o.content.timetag,ext:""},a,!1),t.abrupt("return",s);case 8:case"end":return t.stop()}}),t,this)})))},t.updateStickTopSession=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a,s;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({id:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},e),r=kp(e.id),n=r.scene,i=r.accid,t.next=4,this.core.sendCmd("nimUpdateStickTopSession",{tag:{id:("superTeam"===n?"super_team":n)+"|"+i,ext:e.ext||""}});case 4:return o=t.sent,a=this.getSession(e.id),s=RT(o.content.data,a),t.abrupt("return",s);case 8:case"end":return t.stop()}}),t,this)})))},t.stickTopSessionHandler=function(e,t){void 0===t&&(t=!0);var r=kp(e.id,"|"),n=r.scene+"-"+r.accid;return RT(e,this.getSession(n),t)},e}(),AT=function(){function e(e){this.core=e,this.logger=e.logger}var t=e.prototype;return t.canSessionResetUnreadCount=function(e){var t=e.id;if(void 0===e.lastMsg)throw new Error("Session::canSessionResetUnreadCount: session "+t+" is not completly, lastMsg undefined");return null!==e.lastMsg||e.unread>0?!(e.ack&&e.lastMsg&&e.ack>=e.lastMsg.time&&(this.logger.log("Session::canSessionResetUnreadCount: session "+t+" reset failed, ack time is greater than last message time"),1)):(this.logger.log("Session::canSessionResetUnreadCount: session "+t+" doesn't need to be updated, lastMsg null and unread 0"),!1)},t.filterSessionForResetUnreadCount=function(e){var t=this,r={cmd:"markMultSuperTeamSessionsAck",params:[]},n={cmd:"markMultSessionsAck",params:[]};return jn(e).call(e,(function(e){var i;try{if(!t.canSessionResetUnreadCount(e))return;var o=kp(e.id),a=o.accid,s=o.scene,c={to:a,sessionId:e.id,timetag:(null===(i=null==e?void 0:e.lastMsg)||void 0===i?void 0:i.time)||e.updateTime||0},u=function(e){return Uh({scene:{type:"enum",values:Eh}},e)}({scene:s});"superTeam"===s?r.params.push(c):n.params.push(dr(dr({},c),u))}catch(e){t.logger.warn(e)}})),{superTeam:r,p2pOrTeam:n}},e}();function NT(e,t){e=e||[],t=t||1,t=Math.max(Math.floor(t),1);for(var r=[],n=0;n<e.length;n+=t)r.push(Wc(e).call(e,n,n+t));return r}function xT(e,t){var r,n=void 0!==Nc&&Fl(e)||e["@@iterator"];if(n)return tr(r=(n=n.call(e)).next).call(r,n);if(Ei(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return OT(e,t);var n=Wc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Bl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?OT(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function OT(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var PT=function(e){function t(t,r){var n;return(n=e.call(this,"session",t)||this).list=new ad,n.unreadCountFilterFn=function(e){return!0},n.lastMessageFilterFn=function(e){return!0},n.initEventListeners(),Mh({cmdMap:bT,cmdConfig:ET}),n.stickTopService=new kT(t),n.unreadModule=new AT(t),r&&n.setOptions(r),n}nr(t,e);var r=t.prototype;return r.setOptions=function(e){"function"==typeof(null==e?void 0:e.unreadCountFilterFn)&&(this.unreadCountFilterFn=e.unreadCountFilterFn),"function"==typeof(null==e?void 0:e.lastMessageFilterFn)&&(this.lastMessageFilterFn=e.lastMessageFilterFn)},r.reset=function(){var e;jn(e=this.list).call(e,(function(e){e.unreadMsgs=[]})),this.list.clear()},r.initEventListeners=function(){var e,t,r,n,i=this;this.core.eventBus.on("session/syncMsgs",tr(e=this.onSyncMsgs).call(e,this)),this.core.eventBus.on("session/updateForNewMsg",tr(t=this.updateSessionWithMsg).call(t,this)),this.core.eventBus.on("session/updateForModifyMsg",tr(r=this.updateSessionByModifyMsg).call(r,this)),this.core.eventBus.on("session/updateForClearMsg",(function(e,t){void 0===t&&(t=!0),e&&e.length>0&&jn(e).call(e,(function(e){i.updateSession({id:e.sessionId,lastMsg:null,unread:0,unreadMsgs:[]},t)}))})),this.core.eventBus.on("session/updateForDeletedMsg",tr(n=this.updateSessionForDeletedMsg).call(n,this))},r.createSession=function(e,t){try{var r=kp(e);return{id:e,scene:r.scene,to:r.accid,lastMsg:t,updateTime:t?t.time:0,unread:0,unreadMsgs:[],ack:0}}catch(t){throw this.logger.error("Failed to create session with "+e,t),new Error("Failed to create session with "+e)}},r.getSession=function(e){Pl({id:{type:"string",allowEmpty:!1}},e);var t=this.list.get(e.id);if(this.isSessionComplete(t))return t},r.getSessionWithUncomplete=function(e){return this.list.get(e.id)},r.getAllSessions=function(){for(var e,t=[],r=xT(this.list);!(e=r()).done;){var n=e.value;n[0];var i=n[1];this.isSessionComplete(i)&&t.push(i)}return t},r.getSessions=function(e){Pl({limit:{type:"number",required:!1},lastSessionId:{type:"string",allowEmpty:!1,required:!1},desc:{type:"boolean",required:!1}},e);var t=[],r=e.limit,n=void 0===r?100:r,i=e.desc,o=void 0===i||i,a=e.lastSessionId,s=0;if(o){for(var c,u,d=xT(this.list);!(u=d()).done;){var l=u.value,p=l[0],m=l[1];if(a===p)break;this.isSessionComplete(m)&&t.push(m)}return Dc(c=Wc(t).call(t,-n)).call(c)}for(var h,f=xT(this.list);!(h=f()).done;){var g=h.value,v=g[0],y=g[1];if(a)v===a&&(a=void 0);else if(this.isSessionComplete(y)){if(++s>n)break;t.push(y)}}return t},r.resetSessionUnreadCount=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o,a,s,c,u,d,l=this;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(Pl({id:{type:"string",allowEmpty:!1}},e),Pl({id:{type:"string",allowEmpty:!1}},e),n=e.id,i=this.list.get(n)){r.next=7;break}throw this.logger.warn("resetSessionUnreadCount: can not find session "+n),new Error("Session::canSessionResetUnreadCount: can not find session "+n);case 7:o=!1;try{o=this.unreadModule.canSessionResetUnreadCount(i)}catch(e){this.logger.warn(e)}if(!1!==o){r.next=11;break}return r.abrupt("return");case 11:return a=kp(n),s=a.accid,c=a.scene,u={to:s,timetag:(null===(t=null==i?void 0:i.lastMsg)||void 0===t?void 0:t.time)||i.updateTime||0},d="markSuperTeamSessionAck","superTeam"!==c&&(u.scene="p2p"===c?0:1,d="markSessionAck"),r.abrupt("return",this.core.sendCmd(d,u).then((function(){var e=l.storeUnreadByAck(n,u.timetag);e&&l.core.emit("updateSession",e)})));case 16:case"end":return r.stop()}}),r,this)})))},r.resetMultiSessionUnreadCount=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a,s,c,u,d,l,p,m,h,f,g=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Pl({ids:{type:"array",itemType:"string",min:1}},e),i=fu(r=du(n=e.ids).call(n,(function(e){return g.list.get(e)}))).call(r,(function(t,r){return!!t||(g.logger.warn("Session::canSessionResetUnreadCount: can not find session "+e.ids[r]),!1)})),o=this.unreadModule.filterSessionForResetUnreadCount(i),a=o.superTeam,s=o.p2pOrTeam,c=NT(a.params,50),u=NT(s.params,50),d=xT(c);case 6:if((l=d()).done){t.next=13;break}return p=l.value,t.next=10,this.core.sendCmd(a.cmd,{datas:p});case 10:jn(p).call(p,(function(e){var t=g.storeUnreadByAck(e.sessionId,e.timetag);t&&g.core.emit("updateSession",t)}));case 11:t.next=6;break;case 13:m=xT(u);case 14:if((h=m()).done){t.next=21;break}return f=h.value,t.next=18,this.core.sendCmd(s.cmd,{datas:f});case 18:jn(f).call(f,(function(e){var t=g.storeUnreadByAck(e.sessionId,e.timetag);t&&g.core.emit("updateSession",t)}));case 19:t.next=14;break;case 21:case"end":return t.stop()}}),t,this)})))},r.resetAllSessionsUnreadCount=function(){var e,t=[];return jn(e=this.list).call(e,(function(e){t.push(e.id)})),0===t.length?fs.resolve():this.resetMultiSessionUnreadCount({ids:t})},r.deleteSession=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Pl({id:{type:"string",allowEmpty:!1},isSyncToServer:{type:"boolean",required:!1}},e),this.list.delete(e.id),!this.core.msgLog||!e.isSyncToServer){t.next=5;break}return t.next=5,this.core.msgLog.deleteRoamingMsgs({ids:[e.id]});case 5:case"end":return t.stop()}}),t,this)})))},r.deleteAllSessionsFromLocal=function(){this.list.clear()},r.addStickTopSession=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stickTopService.addStickTopSession(e);case 2:return r=t.sent,this.list.set(r.id,r),t.abrupt("return",r);case 5:case"end":return t.stop()}}),t,this)})))},r.deleteStickTopSession=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stickTopService.deleteStickTopSession(e);case 2:return r=t.sent,this.list.set(r.id,r),t.abrupt("return",r);case 5:case"end":return t.stop()}}),t,this)})))},r.updateStickTopSession=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.stickTopService.updateStickTopSession(e);case 2:return r=t.sent,this.list.set(r.id,r),t.abrupt("return",r);case 5:case"end":return t.stop()}}),t,this)})))},r.nimMultiSyncAddStickTopSessionHandler=function(e){var t=this.stickTopService.stickTopSessionHandler(e.content.data);this.list.set(t.id,t),this.core.emit("updateSession",t)},r.nimMultiSyncDeleteStickTopSessionHandler=function(e){var t=this.stickTopService.stickTopSessionHandler({id:e.content.data.id,updateTime:e.content.timetag,ext:""},!1);this.list.set(t.id,t),this.core.emit("updateSession",t)},r.nimMultiSyncUpdateStickTopSessionHandler=function(e){var t=this.stickTopService.stickTopSessionHandler(e.content.data);this.list.set(t.id,t),this.core.emit("updateSession",t)},r.nimSyncStickTopSessionsHandler=function(e){var t,r=this;if(this.core.eventBus.emit("sync/updateTimetag",{stickTopSessions:e.content.timetag}),e.content.isThereAnyChange){var n=e.content.datas,i=[];jn(t=this.list).call(t,(function(e){var t;e&&(null===(t=null==e?void 0:e.stickTopInfo)||void 0===t?void 0:t.isStickOnTop)&&i.push(e)})),jn(i).call(i,(function(e){var t=e.id;if(!oh(n).call(n,(function(e){var r=kp(e.id,"|");return r.scene+"-"+r.accid===t}))){var r={},i=kp(t,"-"),o=i.scene,a=i.accid;r.id=o+"|"+a,r.ext="",r.isTop=!1,n.push(r)}})),jn(n).call(n,(function(e){var t;!1===e.isTop?(delete e.isTop,t=r.stickTopService.stickTopSessionHandler(e,!1)):t=r.stickTopService.stickTopSessionHandler(e),r.list.set(t.id,t)}))}},r.updateSessionWithMsg=function(e){var t,r,n=!0,i=!0,o="boolean"!=typeof(null===(t=e.pushInfo)||void 0===t?void 0:t.needPushBadge)||(null===(r=e.pushInfo)||void 0===r?void 0:r.needPushBadge);try{n=!!this.unreadCountFilterFn(e)}catch(e){this.logger.error("session:updateSessionWithMsg, unreadCountFilterFn error",e)}try{i=!!this.lastMessageFilterFn(e)}catch(e){this.logger.error("session:updateSessionWithMsg, lastMessageFilterFn error",e)}var a=this.list.get(e.sessionId)||this.createSession(e.sessionId),s=!1;if(this.logger.log("session:updateSessionWithMsg, pending ",e.sessionId,e.idClient,e.idServer,i,n),i&&(!a.lastMsg||a.lastMsg.time<e.time||e.status===Rh[Rh.sending]||a.lastMsg.status===Rh[Rh.sending])&&(a.lastMsg=e,a.updateTime=e.time,s=!0),n&&o&&e.status===Rh[Rh.unread]&&e.time>(a.ack||0)){a.unread++;var c=a.unreadMsgs||[];c.unshift(e),Vm(c).call(c,(function(e,t){return t.time-e.time})),a.unreadMsgs=c,s=!0}s&&(this.logger.log("session:updateSessionWithMsg updating ",a.id,a.unread,a.lastMsg&&a.lastMsg.idClient),this.list.set(a.id,a),this.core.emit("updateSession",a))},r.updateSessionByModifyMsg=function(e){var t=this.list.get(e.sessionId)||this.createSession(e.sessionId),r=t.unreadMsgs||[],n=Qn(r).call(r,(function(t){return t.idClient===e.idClient}));n>-1&&(r[n]=e),t.unreadMsgs=r,this.list.set(t.id,t);var i=!0;try{i=!!this.lastMessageFilterFn(e)}catch(e){this.logger.error("session:updateSessionByModifyMsg, lastMessageFilterFn error",e)}i&&(t.lastMsg&&t.lastMsg.idClient!==e.idClient||(t.lastMsg=e,t.updateTime=e.time,this.logger.log("session:updateSessionByModifyMsg updating ",t.id,t.unread,t.lastMsg&&t.lastMsg.idClient),this.list.set(t.id,t),this.core.emit("updateSession",t)))},r.storeUnreadByAck=function(e,t){var r=this.list.get(e)||this.createSession(e);if(!(r.ack&&t<r.ack)){var n=r.unreadMsgs||[],i=[],o=[],a=0;return r.unreadMsgs=[],n.length>0&&(jn(n).call(n,(function(e){ou(o).call(o,e.idClient)||e.time>t&&(a++,o.push(e.idClient),i.push(e))})),r.unreadMsgs=Vm(i).call(i,(function(e,t){return t.time-e.time}))),r.ack=t,r.unread=a,r.lastMsg&&"unread"===r.lastMsg.status&&t>=r.lastMsg.time&&(r.lastMsg.status="read"),this.list.set(e,r),r}this.logger.warn("storeUnreadByAck: not need update ack",e,t,r.ack)},r.updateSession=function(e,t){void 0===t&&(t=!0);var r=e.id,n=this.list.get(r)||this.createSession(e.id),i=dr(n,e);return this.list.set(r,i),this.logger.log("updateSession: update",t,og(e,["id","ack","unread"]),i.lastMsg&&i.lastMsg.idClient),t&&this.core.emit("updateSession",i),i},r.isSessionComplete=function(e){return!!e&&!!(e.id&&e.scene&&e.to)&&void 0!==e.lastMsg},r.syncSessionAckHandler=function(e){var t,r,n=this,i=e.content.p2p||{},o=e.content.team.m_map||{};this.logger.log("syncSessionAck::",i,o),jn(t=fr(i)).call(t,(function(e){n.updateSession({id:"p2p-"+e,ack:i[e]},!1)})),jn(r=fr(o)).call(r,(function(e){n.updateSession({id:"team-"+e,ack:o[e]},!1)}))},r.syncSuperTeamSessionAckHandler=function(e){var t,r=this,n=e.content.superTeam.m_map;this.logger.log("syncSuperTeamSessionAck::",n),jn(t=fr(n)).call(t,(function(e){r.updateSession({id:"superTeam-"+e,ack:n[e]},!1)}))},r.syncMarkSessionAckHandler=function(e){var t=e.content,r=(0===t.scene?"p2p":1===t.scene?"team":"superTeam")+"-"+t.to,n=this.list.get(r);if(n&&n.ack&&t.timetag<n.ack)this.logger.warn("syncMarkSessionAckHandler: "+r+" do not need update ack",n.ack,t.timetag);else{var i=this.storeUnreadByAck(r,t.timetag);i&&this.core.emit("updateSession",i)}},r.syncMarkSuperTeamSessionAckHandler=function(e){e.content.scene=5,this.syncMarkSessionAckHandler(e)},r.onSyncDone=function(){var e,t,r,n=this,i=[];jn(e=this.list).call(e,(function(e,t){i.push(n.storeUnreadByAck(t,e.ack||0))})),this.list.clear(),jn(t=Vm(i).call(i,(function(e,t){return e.updateTime-t.updateTime}))).call(t,(function(e){n.list.set(e.id,e)})),(i=Vm(r=fu(i).call(i,(function(e){return n.isSessionComplete(e)}))).call(r,(function(e,t){return t.updateTime-e.updateTime}))).length>0&&this.core.emit("sessions",i)},r.onSyncMsgs=function(e){var t,r=this,n=this.list.get(e.sessionId),i=[];try{var o;i=fu(o=e.msgs).call(o,(function(e){var t,n,i="boolean"!=typeof(null===(t=e.pushInfo)||void 0===t?void 0:t.needPushBadge)||(null===(n=e.pushInfo)||void 0===n?void 0:n.needPushBadge);return r.unreadCountFilterFn(JSON.parse(_i(e)))&&i}))}catch(e){this.logger.error("session:onSyncMsgs, unreadCountFilterFn error ",e)}var a,s=[];try{var c;s=fu(c=e.msgs).call(c,(function(e){return r.lastMessageFilterFn(JSON.parse(_i(e)))}))}catch(e){this.logger.error("session:onSyncMsgs, lastMessageFilterFn error ",e)}s&&s.length>0&&(a=s[s.length-1],a=s[0].time>a.time?s[0]:a);var u=a?a.time:0;n||(n=a?this.createSession(e.sessionId,a):this.createSession(e.sessionId)),n.unreadMsgs=n.unreadMsgs?fu(t=xs(i).call(i,n.unreadMsgs)).call(t,(function(e){return e.status===Rh[Rh.unread]})):fu(i).call(i,(function(e){return e.status===Rh[Rh.unread]})),n.updateTime&&n.updateTime>=u||(n.updateTime=u),n.lastMsg&&n.lastMsg.time>=u||(n.lastMsg=a),this.list.set(n.id,n)},r.updateSessionForDeletedMsg=function(e){var t,r=this,n={};jn(e).call(e,(function(e){var t,i=e.to===r.core.account?e.from:e.to,o=e.scene+"-"+i,a=r.list.get(o);if(a){var s=Gm(t=a.unreadMsgs).call(t,(function(t){return t.idClient===e.idClient})),c=!0;try{c=!!r.unreadCountFilterFn(e)}catch(e){r.logger.error("session:updateSessionForDeletedMsg, unreadCountFilterFn error",e)}var u=a.ack||0;if(c&&s&&u<e.time&&e.from!==r.core.account&&a.unread>0&&(a.unread=a.unread-1,a.unreadMsgs&&a.unreadMsgs.length>0)){var d,l=function(e,t){e=e||[],t=t||{};for(var r=0;r<e.length;r++){var n=!0;for(var i in t)if(e[r][i]!==t[i]){n=!1;break}if(n)return r}return-1}(a.unreadMsgs,{idClient:e.idClient});l>=0&&di(d=a.unreadMsgs).call(d,l,1)}a.lastMsg&&a.lastMsg.idClient===e.idClient&&(a.lastMsg=null),n[a.id]=!0}})),jn(t=fr(n)).call(t,(function(e){var t=r.list.get(e);t&&r.core.emit("updateSession",t)}))},r.multiSyncMsgReceiptHandler=function(e){var t,r=null===(t=e.content)||void 0===t?void 0:t.msgReceiptTag;if(r){this.updateSessionMsgReceiptTime([r],!0),r.msgReceiptTime=r.time,r.sessionId="p2p-"+r.from,r.time,r.from;var n=Jl(r,["time","from"]);this.core.emit("msgReceipts",[n])}},r.syncMsgReceiptsHandler=function(e){var t,r=null===(t=e.content)||void 0===t?void 0:t.msgReceipts;r&&this.updateSessionMsgReceiptTime(r,!1)},r.updateSessionMsgReceiptTime=function(e,t){var r=this;void 0===t&&(t=!0),e&&e.length>0&&jn(e).call(e,(function(e){var n=r.list.get("p2p-"+e.from);n||(n=r.createSession("p2p-"+e.from));var i=$p(e.time);n.msgReceiptTime&&n.msgReceiptTime>=i||(n.msgReceiptTime=i,n.lastMsg&&"sent"===n.lastMsg.status&&i>=n.lastMsg.time&&(n.lastMsg.status="receipt"),r.logger.log("session: update session "+n.id+" msgReceiptTime: "+n.msgReceiptTime),r.list.set(n.id,n),t&&r.core.emit("updateSession",n))}))},t}(nf),LT=function(){function e(e){this.core=e}var t=e.prototype;return t.notifyAddTeamMembers=function(e,t){this.core.emit("addTeamMembers",{team:e,accounts:t,members:kS(e,t)})},t.notifyUpdateTeamManagers=function(e,t,r,n){this.core.emit("updateTeamManagers",{team:{teamId:e,memberUpdateTime:n},accounts:t,isManager:r,members:du(t).call(t,(function(t){return{id:e+"-"+t,account:t,type:r?"manager":"normal",updateTime:n}}))})},t.notifyRemoveTeamMembers=function(e,t){this.core.emit("removeTeamMembers",{team:e,accounts:t})},t.notifyTransferTeam=function(e,t,r){this.core.emit("transferTeam",{team:e,from:{id:e.teamId+"-"+t,type:"normal",account:t,updateTime:e.memberUpdateTime},to:{id:e.teamId+"-"+r,type:"owner",account:r,updateTime:e.memberUpdateTime}})},t.notifyUpdateTeamMembersMute=function(e,t,r){this.core.emit("updateTeamMembersMute",{team:e,accounts:t,members:du(t).call(t,(function(t){return{id:e.teamId+"-"+t,account:t,teamId:e.teamId,mute:r,updateTime:e.memberUpdateTime}})),mute:r})},e}();function VT(e,t){if((t=new ad).get(e))return e;if(e instanceof RegExp)return new RegExp(e);if(e instanceof Date)return new Date(e.getTime());if(Ei(e))return t.set(e,!0),du(e).call(e,(function(e){return VT(e,t)}));if("object"==typeof e&&null!==e){var r;t.set(e,!0);var n={};return jn(r=fr(e)).call(r,(function(r){n[r]=VT(e[r],t)})),n}return e}var UT=function(e){function t(t){var r;return(r=e.call(this,"team",t)||this).myTeamMembersMap=new ad,r.service=new LT(t),r.setListeners(),Mh({cmdMap:NS,cmdConfig:PS}),r}nr(t,e);var r=t.prototype;return r.setListeners=function(){var e=this;this.core.eventBus.on("forwardReceive/team/updateMyMemberInfo",(function(t){e.emitMemberUpdate(t)})),this.core.eventBus.on("team/onNotification",(function(t){return e.notificationHandler(t)}))},r.reset=function(){this.myTeamMembersMap.clear()},r.mergeMyTeamMembers=function(e){var t=this;jn(e).call(e,(function(e){var r=e.teamId,n=t.myTeamMembersMap.get(r),i=dr({},n,e);t.myTeamMembersMap.set(r,i)}))},r.getTeamInfo=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),t.next=3,this.core.sendCmd("getTeamInfo",{teamId:e.teamId});case 3:return r=t.sent,n=r.content.team,t.abrupt("return",TS(n));case 6:case"end":return t.stop()}}),t,this)})))},r.getTeams=function(){return zl(this,void 0,void 0,Ql.mark((function e(){var t,r;return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.sendCmd("getTeams",{timetag:0});case 2:return t=e.sent,r=t.content.teams,e.abrupt("return",bS(r));case 5:case"end":return e.stop()}}),e,this)})))},r.getTeamsById=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamIds:{type:"array",itemType:"string"}},e),t.next=3,this.core.sendCmd("getTeamsById",{teamIds:e.teamIds});case 3:return r=t.sent,n=bS(r.content.teams),t.abrupt("return",{teams:n,tids:r.content.tids});case 6:case"end":return t.stop()}}),t,this)})))},r.createTeam=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({type:{type:"enum",values:["advanced","normal"]},name:{type:"string",allowEmpty:!1},level:{type:"number",required:!1},accounts:{type:"array",itemType:"string",required:!1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1},joinMode:{type:"enum",values:["noVerify","needVerify","rejectAll"],required:!1},beInviteMode:{type:"enum",values:["noVerify","needVerify"],required:!1},inviteMode:{type:"enum",values:["manager","all"],required:!1},updateTeamMode:{type:"enum",values:["manager","all"],required:!1},updateExtMode:{type:"enum",values:["manager","all"],required:!1},intro:{type:"string",allowEmpty:!0,required:!1},announcement:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",allowEmpty:!0,required:!1},ext:{type:"string",allowEmpty:!0,required:!1}},e),r=CS(e),t.next=4,this.core.sendCmd("createTeam",{team:r,accounts:e.accounts||[],ps:e.ps||""});case 4:return n=t.sent,i=TS(n.content.team),this.core.eventBus.emit("forwardSend/team/created",i),t.abrupt("return",i);case 8:case"end":return t.stop()}}),t,this)})))},r.dismissTeam=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),t.next=3,this.core.sendCmd("dismissTeam",{teamId:e.teamId});case 3:case"end":return t.stop()}}),t,this)})))},r.leaveTeam=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),t.next=3,this.core.sendCmd("leaveTeam",{teamId:e.teamId});case 3:case"end":return t.stop()}}),t,this)})))},r.transferTeam=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},leave:{type:"boolean"}},e),t.next=3,this.core.sendCmd("transferTeam",e);case 3:case"end":return t.stop()}}),t,this)})))},r.updateTeamInfo=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},joinMode:{type:"enum",values:["noVerify","needVerify","rejectAll"],required:!1},beInviteMode:{type:"enum",values:["noVerify","needVerify"],required:!1},inviteMode:{type:"enum",values:["manager","all"],required:!1},updateTeamMode:{type:"enum",values:["manager","all"],required:!1},updateExtMode:{type:"enum",values:["manager","all"],required:!1},intro:{type:"string",allowEmpty:!0,required:!1},announcement:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",allowEmpty:!0,required:!1},ext:{type:"string",allowEmpty:!0,required:!1}},e),r=CS(e),t.next=4,this.core.sendCmd("updateTeamInfo",{team:r});case 4:return t.abrupt("return",TS(r));case 5:case"end":return t.stop()}}),t,this)})))},r.getTeamMembers=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){var n,i;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",required:!1}},e),r.next=3,this.core.sendCmd("getTeamMembers",{teamId:e.teamId,timetag:0});case 3:if(n=r.sent,i=wS(null===(t=n.content)||void 0===t?void 0:t.teamMembers),e.accounts&&e.accounts.length>0){r.next=7;break}return r.abrupt("return",i);case 7:return r.abrupt("return",fu(i).call(i,(function(t){var r;return null===(r=e.accounts)||void 0===r?void 0:ou(r).call(r,t.account)})));case 8:case"end":return r.stop()}}),r,this)})))},r.getMutedTeamMembers=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),t.next=3,this.core.sendCmd("getMutedTeamMembers",{teamId:e.teamId});case 3:return r=t.sent,n=r.content,t.abrupt("return",wS(n.teamMembers));case 6:case"end":return t.stop()}}),t,this)})))},r.addTeamMembers=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},e),t.next=3,this.core.sendCmd("addTeamMembers",{teamId:e.teamId,accounts:e.accounts,ps:e.ps||"",attach:e.ext||""});case 3:case"end":return t.stop()}}),t,this)})))},r.removeTeamMembers=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("removeTeamMembers",{teamId:e.teamId,accounts:e.accounts});case 3:case"end":return t.stop()}}),t,this)})))},r.applyTeam=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},e),t.next=3,this.core.sendCmd("applyTeam",{teamId:e.teamId,ps:e.ps||""});case 3:return r=t.sent,t.abrupt("return",TS(r.content.team));case 5:case"end":return t.stop()}}),t,this)})))},r.addTeamManagers=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},e),t.next=3,this.core.sendCmd("addTeamManagers",e);case 3:case"end":return t.stop()}}),t,this)})))},r.removeTeamManagers=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},e),t.next=3,this.core.sendCmd("removeTeamManagers",e);case 3:case"end":return t.stop()}}),t,this)})))},r.updateMyMemberInfo=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0,required:!1},bitConfigMask:{type:"number",min:0,max:2,required:!1},ext:{type:"string",required:!1}},e),r=_S({teamId:e.teamId,nickInTeam:e.nickInTeam,bitConfigMask:e.bitConfigMask,ext:e.ext}),t.next=4,this.core.sendCmd("updateMyMemberInfo",{teamMember:r});case 4:return n=ES(dr({updateTime:(new Date).getTime(),account:this.core.account},r)),i=this.emitMemberUpdate(n),this.core.eventBus.emit("forwardSend/team/updateMyMemberInfo",i),t.abrupt("return",n);case 8:case"end":return t.stop()}}),t,this)})))},r.emitMemberUpdate=function(e){e=ES(e),this.mergeMyTeamMembers([e]),this.core.emit("updateTeamMember",e);var t=VT(this.myTeamMembersMap.get(e.teamId));return this.core.emit("myTeamMembers",[t]),t},r.updateMemberNick=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0}},e),r=_S({teamId:e.teamId,nickInTeam:e.nickInTeam,account:e.account}),t.next=4,this.core.sendCmd("updateNickInTeam",{teamMember:r});case 4:return n=ES(dr({updateTime:(new Date).getTime()},r)),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t,this)})))},r.muteTeamMember=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},mute:{type:"boolean"}},e),t.next=3,this.core.sendCmd("muteTeamMember",{teamId:e.teamId,account:e.account,mute:e.mute?1:0});case 3:case"end":return t.stop()}}),t,this)})))},r.getTeamMemberInvitorAccid=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){var n,i;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",max:200}},e),n={teamId:e.teamId},e.accounts&&e.accounts.length>0&&(n.accounts=e.accounts),r.next=5,this.core.sendCmd("getTeamMemberInvitorAccid",n);case 5:return i=r.sent,r.abrupt("return",(null===(t=i.content)||void 0===t?void 0:t.accountsMap)||{});case 7:case"end":return r.stop()}}),r,this)})))},r.muteTeam=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},mute:{type:"boolean"}},e),t.next=3,this.core.sendCmd("muteTeam",{teamId:e.teamId,mute:e.mute?1:0});case 3:case"end":return t.stop()}}),t,this)})))},r.passTeamApply=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},e),t.prev=1,t.next=4,this.core.sendCmd("passTeamApply",e);case 4:this.core.eventBus.emit("forwardSend/team/passTeamApply",e),t.next=12;break;case 7:throw t.prev=7,t.t0=t.catch(1),r=t.t0,this.core.eventBus.emit("forwardSend/team/passTeamApply",e,null==r?void 0:r.code),t.t0;case 12:case"end":return t.stop()}}),t,this,[[1,7]])})))},r.rejectTeamApply=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},e),t.prev=1,t.next=4,this.core.sendCmd("rejectTeamApply",{teamId:e.teamId,from:e.from,ps:e.ps||""});case 4:this.core.eventBus.emit("forwardSend/team/rejectTeamApply",e),t.next=12;break;case 7:throw t.prev=7,t.t0=t.catch(1),r=t.t0,this.core.eventBus.emit("forwardSend/team/rejectTeamApply",e,null==r?void 0:r.code),t.t0;case 12:case"end":return t.stop()}}),t,this,[[1,7]])})))},r.acceptTeamInvite=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},e),t.prev=1,t.next=4,this.core.sendCmd("acceptTeamInvite",e);case 4:this.core.eventBus.emit("forwardSend/team/acceptTeamInvite",e),t.next=12;break;case 7:throw t.prev=7,t.t0=t.catch(1),r=t.t0,this.core.eventBus.emit("forwardSend/team/acceptTeamInvite",e,null==r?void 0:r.code),t.t0;case 12:case"end":return t.stop()}}),t,this,[[1,7]])})))},r.rejectTeamInvite=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},e),t.prev=1,t.next=4,this.core.sendCmd("rejectTeamInvite",{teamId:e.teamId,from:e.from,ps:e.ps||""});case 4:this.core.eventBus.emit("forwardSend/team/rejectTeamInvite",e),t.next=12;break;case 7:throw t.prev=7,t.t0=t.catch(1),r=t.t0,this.core.eventBus.emit("forwardSend/team/rejectTeamInvite",e,null==r?void 0:r.code),t.t0;case 12:case"end":return t.stop()}}),t,this,[[1,7]])})))},r.notifyTeamMsgReceiptsHandler=function(e){var t,r=null===(t=e.content)||void 0===t?void 0:t.teamMsgReceipts;r&&r.length>0&&(this.core.emit("teamMsgReceipts",r),this.core.emit("msgReceipts",r))},r.syncTeamsHandler=function(e){var t=e.content;this.core.eventBus.emit("sync/updateTimetag",{teams:$p(t.timetag)});var r=null==t?void 0:t.teams;if(r&&r.length){var n=bS(r);this.core.emit("teams",n)}},r.syncCreateTeamHandler=function(e){var t=e.content,r=TS(null==t?void 0:t.team),n=RS(r,r.owner,"owner");this.core.emit("createTeam",r,n)},r.syncUpdateTeamMemberHandler=function(e){var t=e.content,r=ES(null==t?void 0:t.teamMember);r.updateTime||(r.updateTime=(new Date).getTime()),this.mergeMyTeamMembers([r]),this.core.emit("updateTeamMember",r);var n=VT(this.myTeamMembersMap.get(r.teamId));this.core.emit("myTeamMembers",[n])},r.syncMyTeamMembersHandler=function(e){var t,r=e.content;this.core.eventBus.emit("sync/updateTimetag",{myTeamMembers:$p(r.timetag)});var n=null==r?void 0:du(t=r.teamMembers).call(t,(function(e){return ES(e)}));this.mergeMyTeamMembers(n),this.core.emit("myTeamMembers",VT(n))},r.notificationHandler=function(e){var t=e.attach,r=e.scene,n=e.from,i=e.to,o=e.time,a=e.idServer,s=e.idClient,c=t.team,u=t.account,d=t.accounts,l=t.type;if("team"===r)switch(this.logger.getDebugMode()?this.logger.debug("team::recvNotification",a,s,t):this.logger.log("team::recvNotification",a,s,i,l,u,d),l){case"updateTeam":c.updateTime=o,this.core.emit("updateTeam",c);break;case"addTeamMembers":this.service.notifyAddTeamMembers(c,d);break;case"acceptTeamInvite":this.service.notifyAddTeamMembers(c,[n]);break;case"passTeamApply":this.service.notifyAddTeamMembers(c,[u]);break;case"addTeamManagers":this.service.notifyUpdateTeamManagers(i,d,!0,o);break;case"removeTeamManagers":this.service.notifyUpdateTeamManagers(i,d,!1,o);break;case"removeTeamMembers":this.service.notifyRemoveTeamMembers(c,d);break;case"leaveTeam":this.service.notifyRemoveTeamMembers(c,[n]);break;case"dismissTeam":this.core.emit("dismissTeam",{teamId:i});break;case"transferTeam":this.service.notifyTransferTeam(c,n,u);break;case"updateTeamMemberMute":this.service.notifyUpdateTeamMembersMute(c,[u],t.mute)}},t}(nf),DT={"4_6":"syncOfflineSysMsgs","4_18":"syncOfflineSysMsgs","4_19":"syncRecallMsgOfflineAndRoaming","7_3":"onSysMsg","7_7":"sendCustomSysMsg","7_14":"onRecallMsg","21_18":"onRecallMsg","21_117":"onRecallMsg","7_15":"syncRecallMsgOfflineAndRoaming","21_19":"onSysMsg","21_16":"sendSuperTeamCustomSysMsg"},qT={sysMsg:dr({time:0,type:1,to:2,from:3,content:4,attach:5,idServer:6,needSaveOffline:7,deletedIdClient:10,deletedIdServer:11,needcAntiSpam:12,antiSpamContent:13,deletedMsgCreateTime:14,deletedMsgFromNick:15,opeAccount:16,envConfig:21,callbackExt:22,isRoutable:105},oT)},BT=Ih(qT),FT={onSysMsg:{service:"systemMessage",sid:7,cid:3,response:[{type:"Property",name:"sysMsg",reflectMapper:BT.sysMsg}]},sendCustomSysMsg:{service:"systemMessage",sid:7,cid:7,params:[{type:"Property",name:"sysMsg",reflectMapper:qT.sysMsg}]},sendSuperTeamCustomSysMsg:{service:"systemMessage",sid:21,cid:16,params:[{type:"Property",name:"sysMsg",reflectMapper:qT.sysMsg}]},sendFilterCustomSysMsg:{service:"systemMessage",sid:101,cid:7,params:[{type:"Property",name:"sysMsg",reflectMapper:qT.sysMsg}]},batchMarkRead:{service:"systemMessage",sid:4,cid:5,hasPacketResponse:!1,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]},onRecallMsg:{sid:7,cid:14,service:"systemMessage",response:[{type:"Property",name:"sysMsg",reflectMapper:BT.sysMsg}]},syncRecallMsgOfflineAndRoaming:{sid:7,cid:15,service:"systemMessage",response:[{type:"PropertyArray",name:"sysMsgs",reflectMapper:BT.sysMsg},{type:"Long",name:"timetag"},{type:"Byte",name:"type"}]},syncOfflineSysMsgs:{sid:4,cid:9,service:"systemMessage",response:[{type:"PropertyArray",name:"sysMsgs",reflectMapper:BT.sysMsg}]}},GT=function(e){function t(t){var r;return(r=e.call(this,"systemMessage",t)||this).sysMsgUnread={total:0,friend:0,msg:0,team:0,superTeam:0},r.core.eventBus.on("logined",(function(){r.initEventListeners()})),Mh({cmdMap:DT,cmdConfig:FT}),r}nr(t,e);var r=t.prototype;return r.initEventListeners=function(){var e=this;this.core.eventBus.on("systemMessage/passFriendApply",(function(t){e.core.emit("updateSystemMessages",[{idServer:t.idServer,from:t.account,state:"pass",type:"friendRequest"}])})),this.core.eventBus.on("systemMessage/rejectFriendApply",(function(t){e.core.emit("updateSystemMessages",[{idServer:t.idServer,from:t.account,state:"decline",type:"friendRequest"}])}))},r.doMarkSysMsgAck=function(e){var t=[],r=[],n=["customSuperTeam"];jn(e).call(e,(function(e){e.idServer&&(ou(n).call(n,e.type)?r.push(e.idServer):t.push(e.idServer))})),t.length>0&&this.core.sendCmd("batchMarkRead",{sid:"7",cid:"3",ids:t}),r.length>0&&this.core.sendCmd("batchMarkRead",{sid:"21",cid:"19",ids:r})},r.sendCustomSysMsg=function(e){var t=this;Pl({to:{type:"string",allowEmpty:!1},type:{type:"enum",values:["customP2p","customTeam","customSuperTeam"]},attach:{type:"string",allowEmpty:!1},setting:{type:"object",rules:{needSaveOffline:{type:"boolean",required:!1},env:{type:"string",allowEmpty:!1,required:!1}},required:!1},pushInfo:{type:"object",required:!1,rules:iT}},e);var r="customSuperTeam"===e.type?"sendSuperTeamCustomSysMsg":"sendCustomSysMsg";return this.core.sendCmd(r,{sysMsg:hT(e)}).then((function(){t.logger.log("sendCustomSysMsg success")})).catch((function(e){throw t.logger.error("sendCustomSysMsg failed",e.message),e}))},r.onSysMsgHandler=function(e){var t,r=null===(t=e.content)||void 0===t?void 0:t.sysMsg;if(r){var n="number"==typeof Zp(e,"raw.r[0]")?""+e.raw.r[0]:void 0;r.idServer=r.idServer||n;var i=mT(r,this.logger,tT.default);this.core.emit("sysMsg",i),this.doMarkSysMsgAck([i])}else this.logger.warn("onSysMsg no content.sysMsg")},r.syncOfflineSysMsgsHandler=function(e){var t,r=this;if(e.content.sysMsgs&&e.content.sysMsgs.length>0){var n=du(t=e.content.sysMsgs).call(t,(function(e){return mT(e,r.logger,tT.leave)}));this.core.emit("syncSysMsgs",n),this.doMarkSysMsgAck(n)}},r.onRecallMsgHandler=function(e){var t,r=null===(t=e.content)||void 0===t?void 0:t.sysMsg;if(r){var n="number"==typeof Zp(e,"raw.r[0]")?""+e.raw.r[0]:void 0;r.idServer=r.idServer||n;var i=$S([r],fT(+r.type));this.core.eventBus.emit("session/updateForDeletedMsg",i);var o=mT(r,this.logger,tT.default);this.core.emit("sysMsg",o),this.doMarkSysMsgAck([o])}else this.logger.warn("onSysMsg no content.sysMsg")},r.syncRecallMsgOfflineAndRoamingHandler=function(e){var t=this,r=e.content,n=r.timetag,i=r.type,o=r.sysMsgs,a=$p(i),s=1===a?tT.leave:tT.roam,c=du(o).call(o,(function(e){return mT(e,t.logger,s)}));1===a&&this.doMarkSysMsgAck(c),this.core.eventBus.emit("sync/updateTimetag",{recallMsg:n}),this.core.emit("syncSysMsgs",c)},t}(nf);function jT(e){var t=["bitsExtension","createTime","updateTime","passRelationShip","relationShip","source"],r=dr({},e);return jn(t).call(t,(function(e){void 0!==r[e]&&(r[e]=$p(r[e]))})),void 0!==r.relationShip&&(r.valid=1===r.relationShip),r}var HT={1:"addFriend",2:"applyFriend",3:"passFriendApply",4:"rejectFriendApply"},WT={"12_4":"getFriends","12_1":"friendReuqest","12_2":"deleteFriend","12_3":"updateFriend","12_5":"syncFriends","12_6":"syncFriendUsers","12_101":"syncFriendRequest","12_102":"syncDeleteFriend","12_103":"syncUpdateFriend"},KT={updateFriendTag:{account:4,alias:8,ext:10},delFriendParams:{delAlias:1},friendTag:{account:4,relationShip:5,passRelationShip:6,source:7,alias:8,bitsExtension:9,ext:10,createTime:11,updateTime:12,serverex:13},userTag:{account:1,nick:3,avatar:4,sign:5,gender:6,email:7,birth:8,tel:9,ext:10,createTime:12,updateTime:13}},YT=Ih(KT),QT={getFriends:{sid:12,cid:4,service:"friend",params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"friends",reflectMapper:YT.friendTag},{type:"Long",name:"timetag"}]},friendReuqest:{sid:12,cid:1,service:"friend",params:[{type:"String",name:"account"},{type:"Byte",name:"type"},{type:"String",name:"ps"}]},deleteFriend:{sid:12,cid:2,service:"friend",params:[{type:"String",name:"account"},{type:"Property",name:"delFriendParams",reflectMapper:KT.delFriendParams}]},updateFriend:{sid:12,cid:3,service:"friend",params:[{type:"Property",name:"updateFriendTag",reflectMapper:KT.updateFriendTag}]},syncFriends:{sid:12,cid:5,service:"friend",response:[{type:"PropertyArray",name:"friends",entity:"friendTag",reflectMapper:YT.friendTag},{type:"Long",name:"timetag"}]},syncFriendUsers:{sid:12,cid:6,service:"friend",response:[{type:"PropertyArray",name:"users",entity:"userTag",reflectMapper:YT.userTag},{type:"Long",name:"timetag"}]},syncFriendRequest:{sid:12,cid:101,service:"friend",params:[{type:"String",name:"account"},{type:"Byte",name:"type"},{type:"String",name:"ps"}],response:[{type:"String",name:"account"},{type:"Byte",name:"type"},{type:"String",name:"ps"}]},syncDeleteFriend:{sid:12,cid:102,service:"friend",response:[{type:"String",name:"account"}]},syncUpdateFriend:{sid:12,cid:103,service:"friend",response:[{type:"Property",name:"friend",reflectMapper:YT.friendTag}]}},JT=function(e){function t(t){var r;return r=e.call(this,"friend",t)||this,Mh({cmdMap:WT,cmdConfig:QT}),r}nr(t,e);var r=t.prototype;return r.getFriends=function(){var e;return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("getFriends",{timetag:0});case 2:return r=t.sent,n=(null===(e=r.content)||void 0===e?void 0:e.friends)||[],n=du(n).call(n,(function(e){return jT(e)})),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t,this)})))},r.addFriend=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({account:{type:"string",allowEmpty:!1},ps:{type:"string",allowEmpty:!1,required:!1}},e),t.next=3,this.core.sendCmd("friendReuqest",{account:e.account,type:1,ps:e.ps||""});case 3:return r=(new Date).getTime(),this.core.eventBus.emit("forwardSend/friend/addFriend",e.account),t.abrupt("return",{account:e.account,createTime:r,updateTime:r,valid:!0,source:0,passRelationShip:1,relationShip:1,bitsExtension:0});case 6:case"end":return t.stop()}}),t,this)})))},r.applyFriend=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({account:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("friendReuqest",{account:e.account,type:2,ps:e.ps||""});case 3:case"end":return t.stop()}}),t,this)})))},r.passFriendApply=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({account:{type:"string",allowEmpty:!1}},e),t.prev=1,t.next=4,this.core.sendCmd("friendReuqest",{account:e.account,type:3,ps:e.ps||""}).then((function(t){return r.core.eventBus.emit("systemMessage/passFriendApply",e),t}));case 4:this.core.eventBus.emit("forwardSend/friend/passFriendApply",e.account),t.next=11;break;case 7:throw t.prev=7,t.t0=t.catch(1),this.core.eventBus.emit("forwardSend/friend/passFriendApply",e.account,t.t0),t.t0;case 11:case"end":return t.stop()}}),t,this,[[1,7]])})))},r.rejectFriendApply=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({account:{type:"string",allowEmpty:!1}},e),t.prev=1,t.next=4,this.core.sendCmd("friendReuqest",{account:e.account,type:4,ps:e.ps||""}).then((function(t){return r.core.eventBus.emit("systemMessage/rejectFriendApply",e),t}));case 4:this.core.eventBus.emit("forwardSend/friend/rejectFriendApply",e.account,e.ps),t.next=11;break;case 7:throw t.prev=7,t.t0=t.catch(1),this.core.eventBus.emit("forwardSend/friend/rejectFriendApply",e.account,e.ps,t.t0),t.t0;case 11:case"end":return t.stop()}}),t,this,[[1,7]])})))},r.deleteFriend=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({account:{type:"string",allowEmpty:!1},delAlias:{type:"boolean"}},e),t.next=3,this.core.sendCmd("deleteFriend",{account:e.account,delFriendParams:{delAlias:!0===e.delAlias?1:0}});case 3:this.core.eventBus.emit("forwardSend/friend/deleteFriend",e.account);case 4:case"end":return t.stop()}}),t,this)})))},r.updateFriend=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({account:{type:"string",allowEmpty:!1},alias:{type:"string"},ext:{type:"string",required:!1}},e),t.next=3,this.core.sendCmd("updateFriend",{updateFriendTag:e});case 3:this.core.eventBus.emit("forwardSend/friend/updateFriend",e);case 4:case"end":return t.stop()}}),t,this)})))},r.syncFriendRequestHandler=function(e){var t=function(e){var t=dr({},e);try{t.ps=t.ps&&JSON.parse(t.ps)}catch(e){}if(t.type=HT[t.type],"addFriend"===t.type||"passFriendApply"===t.type){var r=(new Date).getTime();t.friend={account:e.account,alias:"",createTime:r,ext:"",updateTime:r,valid:!0}}return t}(e.content);this.core.emit("syncFriend",t)},r.syncDeleteFriendHandler=function(e){var t=e.content.account;this.logger.log("friend::emit syncFriendAction: deleteFriend "+t),this.core.emit("syncFriend",{type:"deleteFriend",account:t})},r.syncUpdateFriendHandler=function(e){var t=jT(e.content.friend);this.logger.log("friend::emit syncFriendAction: updateFriend, ",null==t?void 0:t.account),this.core.emit("syncFriend",{type:"updateFriend",friend:t})},r.syncFriendsHandler=function(e){var t=e.content;this.core.eventBus.emit("sync/updateTimetag",{friends:$p(t.timetag)});var r=null==t?void 0:t.friends;if(r&&r.length){var n=du(r).call(r,(function(e){return jT(e)}));this.core.emit("friends",n)}},r.syncFriendUsersHandler=function(e){var t=e.content;this.core.eventBus.emit("sync/updateTimetag",{friendUsers:$p(t.timetag)});var r=null==t?void 0:t.users;if(r&&r.length){var n=du(r).call(r,(function(e){return AS(e)}));this.core.emit("users",n)}},t}(nf);function zT(e){return e&&e.length>0?du(e).call(e,(function(e){return function(e){var t=dr({},e),r=["subscribeTime","time"];return jn(r).call(r,(function(e){t[e]&&(t[e]=$p(t[e]))})),t}(e)})):[]}function XT(e){if(!e)return e;var t=e.serverExt,r=Jl(e,["serverExt"]),n=["time","type","value"];if(jn(n).call(n,(function(e){r[e]&&(r[e]=$p(r[e]))})),r.clientType&&(r.clientType=Rp(wh,r.clientType)||""),t)try{r.ext=JSON.parse(t),"string"==typeof r.ext[0]&&(r.ext=r.ext[0])}catch(e){}return r}var $T={"14_1":"publishEvent","14_2":"pushEvent","14_3":"subscribeEvent","14_4":"unSubscribeEventsByAccounts","14_5":"unSubscribeEventsByType","14_6":"querySubscribeEventsByAccounts","14_7":"querySubscribeEventsByType","14_9":"pushEvents"},ZT={msgEvent:{type:1,value:2,idClient:3,ext:4,validTime:5,broadcastType:6,sync:7,validTimeType:8,durable:9,time:10,idServer:11,clientType:12,serverConfig:13,serverExt:14,appid:101,account:103,enableMultiClient:104,consid:106},msgEventSubscribe:{type:1,subscribeTime:2,sync:3,to:102,from:104,time:105}},eb=Ih(ZT),tb={publishEvent:{sid:14,cid:1,service:"event",params:[{type:"Property",name:"msgEvent",reflectMapper:ZT.msgEvent}],response:[{type:"Property",name:"msgEvent",reflectMapper:eb.msgEvent}]},pushEvent:{sid:14,cid:2,service:"event",response:[{type:"Property",name:"msgEvent",reflectMapper:eb.msgEvent}]},subscribeEvent:{sid:14,cid:3,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:ZT.msgEventSubscribe},{type:"StrArray",name:"accounts"}],response:[{type:"StrArray",name:"accounts"}]},unSubscribeEventsByAccounts:{sid:14,cid:4,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:ZT.msgEventSubscribe},{type:"StrArray",name:"accounts"}],response:[{type:"StrArray",name:"accounts"}]},unSubscribeEventsByType:{sid:14,cid:5,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:ZT.msgEventSubscribe}]},querySubscribeEventsByAccounts:{sid:14,cid:6,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:ZT.msgEventSubscribe},{type:"StrArray",name:"accounts"}],response:[{type:"PropertyArray",name:"msgEventSubscribes",reflectMapper:eb.msgEventSubscribe}]},querySubscribeEventsByType:{sid:14,cid:7,service:"event",params:[{type:"Property",name:"msgEventSubscribe",reflectMapper:ZT.msgEventSubscribe}],response:[{type:"PropertyArray",name:"msgEventSubscribes",reflectMapper:eb.msgEventSubscribe}]},pushEvents:{sid:14,cid:9,service:"event",response:[{type:"PropertyArray",name:"msgEvents",reflectMapper:eb.msgEvent}]}},rb=function(e){function t(t){var r;return r=e.call(this,"event",t)||this,Mh({cmdMap:$T,cmdConfig:tb}),r}nr(t,e);var r=t.prototype;return r.publishEvent=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Pl({type:{type:"number"},value:{type:"number"},ext:{type:"string",required:!1},validTime:{type:"number",min:60,max:2592e3,required:!1},broadcastType:{type:"number",required:!1},sync:{type:"boolean",required:!1}},e),n=dr(dr({validTime:e.validTime||604800,broadcastType:e.broadcastType||2},e),{idClient:Ep(),sync:!0===e.sync?1:0}),r.next=4,this.core.sendCmd("publishEvent",{msgEvent:n});case 4:return i=r.sent,o=(null===(t=i.content)||void 0===t?void 0:t.msgEvent)||{},r.abrupt("return",XT(o));case 7:case"end":return r.stop()}}),r,this)})))},r.subscribeEvent=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Pl({type:{type:"number"},accounts:{type:"array",itemType:"string",max:100},subscribeTime:{type:"number",min:60,max:2592e3,required:!1}},e),n=dr(dr({subscribeTime:2592e3},e),{sync:!0===e.sync?1:0}),r.next=4,this.core.sendCmd("subscribeEvent",{msgEventSubscribe:n,accounts:e.accounts});case 4:return i=r.sent,o=(null===(t=i.content)||void 0===t?void 0:t.accounts)||[],r.abrupt("return",{failedAccounts:o});case 7:case"end":return r.stop()}}),r,this)})))},r.unSubscribeEvents=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(Pl({type:{type:"number"},accounts:{type:"array",itemType:"string",max:100,required:!1}},e),n={type:e.type},!(e.accounts&&e.accounts.length>0)){r.next=9;break}return r.next=5,this.core.sendCmd("unSubscribeEventsByAccounts",{msgEventSubscribe:n,accounts:e.accounts});case 5:o=r.sent,i=(null===(t=o.content)||void 0===t?void 0:t.accounts)||[],r.next=12;break;case 9:return r.next=11,this.core.sendCmd("unSubscribeEventsByType",{msgEventSubscribe:n});case 11:i=[];case 12:return r.abrupt("return",{failedAccounts:i});case 13:case"end":return r.stop()}}),r,this)})))},r.querySubscribeEvents=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){var n;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(Pl({type:{type:"number"},accounts:{type:"array",itemType:"string",max:100,required:!1}},e),!(e.accounts&&e.accounts.length>0)){r.next=7;break}return r.next=4,this.core.sendCmd("querySubscribeEventsByAccounts",{msgEventSubscribe:{type:e.type},accounts:e.accounts});case 4:n=r.sent,r.next=10;break;case 7:return r.next=9,this.core.sendCmd("querySubscribeEventsByType",{msgEventSubscribe:{type:e.type}});case 9:n=r.sent;case 10:return r.abrupt("return",zT(null===(t=n.content)||void 0===t?void 0:t.msgEventSubscribes));case 11:case"end":return r.stop()}}),r,this)})))},r.pushEventHandler=function(e){var t,r=(null===(t=e.content)||void 0===t?void 0:t.msgEvent)||{};this.core.emit("pushEvents",[XT(r)])},r.pushEventsHandler=function(e){var t,r=(null===(t=e.content)||void 0===t?void 0:t.msgEvents)||{};this.core.emit("pushEvents",function(e){return Ei(e)&&e.length>0?du(e).call(e,(function(e){return XT(e)})):[]}(r))},t}(nf);function nb(e){var t={scene:Eh[e.scene],from:e.threadMsgFromAccount,to:e.threadMsgToAccount,time:e.threadMsgTime,idServer:e.threadMsgIdServer},r={limit:e.limit<100?e.limit:100,beginTime:"number"==typeof e.beginTime?e.beginTime:0,reverse:!0===Dc(e)?1:0};return e.lastMsgId&&(r.lastMsgId=e.lastMsgId),{msg:t,threadMsgReq:r}}var ib,ob={"23_1":"getThreadMsgs","23_2":"getMsgsByIdServer"},ab={msg:sT,threadMsgReq:{beginTime:1,endTime:2,lastMsgId:3,limit:4,reverse:5},threadMsgsMeta:{total:1,lastMsgTime:2}},sb=Ih(ab),cb={getThreadMsgs:{sid:23,cid:1,service:"msgExtend",params:[{type:"Property",name:"msg",reflectMapper:ab.msg},{type:"Property",name:"threadMsgReq",reflectMapper:ab.threadMsgReq}],response:[{type:"Property",name:"threadMsg",reflectMapper:sb.msg},{type:"Property",name:"threadMsgsMeta",reflectMapper:sb.threadMsgsMeta},{type:"PropertyArray",name:"msgs",reflectMapper:sb.msg}]},getMsgsByIdServer:{sid:23,cid:2,service:"msgExtend",params:[{type:"PropertyArray",name:"reqMsgs",reflectMapper:ab.msg}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:sb.msg}]}},ub=function(e){function t(t){var r;return r=e.call(this,"msgExtend",t)||this,Mh({cmdMap:ob,cmdConfig:cb}),r}nr(t,e);var r=t.prototype;return r.getThreadMsgs=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o,a,s,c,u;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Pl({scene:{type:"enum",values:wp(Eh)},threadMsgFromAccount:{type:"string",allowEmpty:!1},threadMsgIdServer:{type:"string",allowEmpty:!1},threadMsgTime:{type:"number"},threadMsgToAccount:{type:"string",allowEmpty:!1},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},lastMsgId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,max:100,required:!1},reverse:{type:"boolean",required:!1}},e),r.next=3,this.core.sendCmd("getThreadMsgs",nb(e));case 3:return n=r.sent,i=n.content,o=i.msgs,a=i.threadMsg,s=n.content.threadMsgsMeta,c=WS(a,this.core.account),u=null===(t=this.core.session)||void 0===t?void 0:t.getSessionWithUncomplete({id:c}),o=QS(o,u?{account:this.core.account,sessionAck:u.ack,msgReceiptTime:u.msgReceiptTime}:{account:this.core.account}),a=YS(a,u?{account:this.core.account,sessionAck:u.ack,msgReceiptTime:u.msgReceiptTime}:{account:this.core.account}),r.abrupt("return",{msgs:o,threadMsg:a,total:$p(s.total),timetag:$p(s.lastMsgTime)});case 11:case"end":return r.stop()}}),r,this)})))},r.getMsgsByIdServer=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({reqMsgs:{type:"array",rules:{scene:{type:"enum",values:wp(Eh)},from:{type:"string",allowEmpty:!1},to:{type:"string",allowEmpty:!1},idServer:{type:"string",allowEmpty:!1},time:{type:"number"}},min:1,max:100}},e),t.next=3,this.core.sendCmd("getMsgsByIdServer",{reqMsgs:du(r=e.reqMsgs).call(r,(function(e){return dr(dr({},e),{scene:Rp(Eh,e.scene)})}))});case 3:return i=t.sent,o=du(n=i.content.msgs).call(n,(function(e){var t,r=WS(e,a.core.account),n=null===(t=a.core.session)||void 0===t?void 0:t.getSessionWithUncomplete({id:r});return YS(e,n?{account:a.core.account,sessionAck:n.ack,msgReceiptTime:n.msgReceiptTime}:{account:a.core.account})})),t.abrupt("return",o);case 6:case"end":return t.stop()}}),t,this)})))},t}(nf);!function(e){e[e.ASC=1]="ASC",e[e.DESC=2]="DESC"}(ib||(ib={}));var db,lb={"7_6":"getHistoryMsgs","7_9":"deleteRoamingMsgs","4_24":"syncClearServerHistoryMsgs","7_18":"clearHistoryMsgsFromServer","7_118":"multiSyncClearServerHistoryMsgs","7_26":"nimFtsCloudMsgLogsAggWithSession","7_27":"nimFtsCloudMsgLogs"},pb={msg:sT,clearHistoryMsgsFromServerReqTag:{type:0,otherAccid:1,isDeleteRoam:2,toTid:3,isSyncSelf:4,time:6,ext:7},clearMsgsParamsWithSync:{type:0,otherAccid:1,isDeleteRoam:2,toTid:3,isSyncSelf:4,fromAccid:5,time:6,ext:7},ftsReqTag:{keyword:1,fromTime:2,toTime:3,sessionLimit:4,msglogsLimit:5,orderRule:6,p2pSessionList:7,teamSessionList:8,senderList:9,msgTypeList:10,msgSubTypeList:11}},mb=Ih(pb),hb={deleteRoamingMsgs:{sid:7,cid:9,service:"msgLog",params:[{type:"StrArray",name:"ids"}]},getHistoryMsgs:{sid:7,cid:6,params:[{type:"String",name:"to"},{type:"Long",name:"beginTime"},{type:"Long",name:"endTime"},{type:"Long",name:"lastMsgId"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:mb.msg}],service:"msgLog"},clearHistoryMsgsFromServer:{sid:7,cid:18,params:[{type:"Property",name:"clearHistoryMsgsFromServerReqTag",reflectMapper:pb.clearHistoryMsgsFromServerReqTag}],response:[{type:"Long",name:"timetag"}],service:"msgLog"},multiSyncClearServerHistoryMsgs:{sid:7,cid:118,response:[{type:"Property",name:"data",reflectMapper:mb.clearMsgsParamsWithSync}],service:"msgLog"},syncClearServerHistoryMsgs:{sid:4,cid:24,service:"msgLog",response:[{type:"PropertyArray",name:"datas",reflectMapper:mb.clearMsgsParamsWithSync}]},nimFtsCloudMsgLogsAggWithSession:{sid:7,cid:26,service:"msgLog",params:[{type:"Property",name:"tag",reflectMapper:pb.ftsReqTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:mb.msg}]},nimFtsCloudMsgLogs:{sid:7,cid:27,service:"msgLog",params:[{type:"Property",name:"tag",reflectMapper:pb.ftsReqTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:mb.msg}]}};!function(e){e[e.p2p=1]="p2p",e[e.team=2]="team"}(db||(db={}));var fb={type:{type:"enum",values:db},isDeleteRoam:{type:"boolean"},isSyncSelf:{type:"boolean"},time:{type:"number"}};function gb(e){var t=Ph(fb,e);return{sessionId:"p2p"===t.type?"p2p-"+t.otherAccid:"team-"+t.toTid,time:t.time}}var vb={orderRule:{type:"enum",values:ib}};function yb(e){var t,r=Ph(vb,e);Ei(r.msgTypeList)&&(r.msgTypeList=du(t=r.msgTypeList).call(t,(function(e){return _h[e]})).join(","));var n=["p2pSessionList","teamSessionList","senderList","msgSubTypeList"];return jn(n).call(n,(function(e){Ei(r[e])&&(r[e]=r[e].join(","))})),r}var Mb=function(e){function t(t){var r;return(r=e.call(this,"msgLog",t)||this).onV2ClearHistoryMessage=function(e){var t=gb(e);r.core.eventBus.emit("session/updateForClearMsg",[t],!0)},Mh({cmdMap:lb,cmdConfig:hb}),r.registerListener(),r}nr(t,e);var r=t.prototype;return r.registerListener=function(){this.core.eventBus.on("forwardReceive/msgLog/clearHistoryMsgsFromServer",this.onV2ClearHistoryMessage)},r.deleteRoamingMsgs=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Pl({ids:{type:"array",itemType:"string"}},e),r=[],t.prev=2,r=du(n=e.ids).call(n,(function(e){var t=kp(e);return t.scene+"|"+t.accid})),t.next=10;break;case 6:throw t.prev=6,t.t0=t.catch(2),this.logger.error("Failed to delete roaming msgs with "+e.ids,t.t0),new Error("Failed to create session with "+e.ids);case 10:return t.next=12,this.core.sendCmd("deleteRoamingMsgs",{ids:r});case 12:case"end":return t.stop()}}),t,this,[[2,6]])})))},r.getHistoryMsgs=function(e){var t,r;return zl(this,void 0,void 0,Ql.mark((function n(){var i,o,a,s,c,u,d;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return"function"!=typeof(null===(t=this.core.sync)||void 0===t?void 0:t.getSyncDoneFlag)||this.core.sync.getSyncDoneFlag()||this.logger.warn("Please call getHistoryMsgs after syncdone event"),Pl({scene:{type:"enum",values:wp(Eh)},to:{type:"string",allowEmpty:!1},beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},limit:{type:"number",min:1,max:100,required:!1},reverse:{type:"boolean",required:!1},lastMsgId:{type:"string",required:!1,allowEmpty:!1},asc:{type:"boolean",required:!1},msgTypes:{type:"array",itemType:"string",required:!1}},e),o="p2p"===e.scene?"getHistoryMsgs":"team"===e.scene?"getHistoryTeamMsgs":"getHistorySuperTeamMsgs",n.next=5,this.core.sendCmd(o,Np({beginTime:0,endTime:0,lastMsgId:0,limit:100,reverse:!1},dr(dr({},e),{msgTypes:e.msgTypes?du(i=e.msgTypes).call(i,(function(e){return _h[e]})):[]})));case 5:if(a=n.sent,(s=a.content).msgs&&s.msgs.length>0){n.next=9;break}return n.abrupt("return",[]);case 9:if(c=WS(s.msgs[0],this.core.account),u=null===(r=this.core.session)||void 0===r?void 0:r.getSessionWithUncomplete({id:c}),d=QS(s.msgs,u?{account:this.core.account,sessionAck:u.ack,msgReceiptTime:u.msgReceiptTime}:{account:this.core.account}),!0!==e.asc){n.next=14;break}return n.abrupt("return",Vm(d).call(d,(function(e,t){return e.time-t.time})));case 14:return n.abrupt("return",d);case 15:case"end":return n.stop()}}),n,this)})))},r.clearHistoryMsgsFromServer=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({scene:{type:"enum",values:["p2p","team"]},to:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1},isSyncSelf:{type:"boolean",required:!1}},e),(r=dr(dr({isDeleteRoam:1},e),{type:"team"===e.scene?2:1,isSyncSelf:!0===e.isSyncSelf?1:0}))[2===r.type?"toTid":"otherAccid"]=e.to,t.next=5,this.core.sendCmd("clearHistoryMsgsFromServer",{clearHistoryMsgsFromServerReqTag:r});case 5:return n=t.sent,i=n.content,this.core.eventBus.emit("session/updateForClearMsg",[{sessionId:e.scene+"-"+e.to}],!0),this.core.eventBus.emit("forwardSend/msgLog/clearHistoryMsgsFromServer",dr(dr({},r),{time:i.timetag})),t.abrupt("return",i);case 10:case"end":return t.stop()}}),t,this)})))},r.multiSyncClearServerHistoryMsgsHandler=function(e){var t=gb(e.content.data);this.core.eventBus.emit("session/updateForClearMsg",[t],!0),this.core.emit("clearServerHistoryMsgs",[t])},r.ftsCloudMsgLogs=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.baseFtsCloudMsgLogs(e,"nimFtsCloudMsgLogs"));case 1:case"end":return t.stop()}}),t,this)})))},r.ftsCloudMsgLogsAggWithSession=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.baseFtsCloudMsgLogs(e,"nimFtsCloudMsgLogsAggWithSession"));case 1:case"end":return t.stop()}}),t,this)})))},r.baseFtsCloudMsgLogs=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o,a=this;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(Pl({keyword:{type:"string",allowEmpty:!1},fromTime:{type:"number",required:!1},toTime:{type:"number",required:!1},sessionLimit:{type:"number",required:!1},msglogsLimit:{type:"number",required:!1},orderRule:{type:"enum",values:wp(ib),required:!1},p2pSessionList:{type:"array",itemType:"string",required:!1},teamSessionList:{type:"array",itemType:"string",required:!1},senderList:{type:"array",itemType:"string",required:!1},msgTypeList:{type:"array",itemType:"enum",values:wp(_h),required:!1},msgSubTypeList:{type:"array",itemType:"number",required:!1}},e),!(e.fromTime&&e.toTime&&e.toTime<e.fromTime)){r.next=3;break}throw new El("Request parameter error: toTime should be greater than fromTime",e,"");case 3:return i=yb(e),r.next=6,this.core.sendCmd(t,{tag:i});case 6:return o=r.sent,r.abrupt("return",du(n=o.content.datas).call(n,(function(e){var t,r=WS(e,a.core.account),n=null===(t=a.core.session)||void 0===t?void 0:t.getSessionWithUncomplete({id:r});return YS(e,n?{account:a.core.account,sessionAck:n.ack,msgReceiptTime:n.msgReceiptTime}:{account:a.core.account})})));case 8:case"end":return r.stop()}}),r,this)})))},r.syncClearServerHistoryMsgsHandler=function(e){var t=function(e){return Ei(e)&&e.length>0?du(e).call(e,(function(e){return gb(e)})):[]}(e.content.datas);this.core.emit("clearServerHistoryMsgs",t)},t}(nf),Ib={"22_1":"requestProxy","22_2":"onRequestProxy"},Sb={requestProxyTag:{zone:1,path:2,method:3,header:4,body:5},requestProxyMsgTag:{from:1,body:2,time:3}},Tb=Ih(Sb),bb={requestProxy:{sid:22,cid:1,service:"passThrough",params:[{type:"Property",name:"requestProxyTag",reflectMapper:Sb.requestProxyTag}],response:[{type:"Property",name:"requestProxyTag",reflectMapper:Tb.requestProxyTag}]},onRequestProxy:{sid:22,cid:2,service:"passThrough",response:[{type:"Property",name:"proxyMsg",reflectMapper:Tb.requestProxyMsgTag}]}},Cb=function(e){function t(t){var r;return(r=e.call(this,"passThrough",t)||this).core=t,Mh({cmdMap:Ib,cmdConfig:bb}),r}nr(t,e);var r=t.prototype;return r.request=function(e){return Pl({path:{type:"string",allowEmpty:!1}},e),this.core.sendCmd("requestProxy",{requestProxyTag:e}).then((function(e){return e.content.requestProxyTag}))},r.onRequestProxyHandler=function(e){var t=e.content.proxyMsg;t&&t.time&&(t.time=+t.time),this.core.emit("proxyMsg",t)},t}(nf),_b=mf({none:0,normal:1,all:3}),Eb=mf({normal:0,advanced:1}),wb=mf({normal:0,owner:1,manager:2}),Rb={noVerify:0,needVerify:1,rejectAll:2},kb=mf(Rb),Ab={needVerify:0,noVerify:1},Nb=mf(Ab),xb={manager:0,all:1},Ob=mf(xb),Pb={manager:0,all:1},Lb=mf(Pb),Vb={manager:0,all:1},Ub=mf(Vb);function Db(e){var t,r=["teamId"],n=["level","memberNum","memberUpdateTime","createTime","updateTime"],i=["valid","validToCurrentUser","mute"],o={type:Eb,muteType:_b,joinMode:kb,beInviteMode:Nb,inviteMode:Ob,updateTeamMode:Lb,updateExtMode:Ub};e.bits;var a=Jl(e,["bits"]);return jn(r).call(r,(function(e){a[e]&&(a[e]=a[e].toString())})),jn(n).call(n,(function(e){void 0!==a[e]&&(a[e]=$p(a[e]))})),jn(i).call(i,(function(e){void 0!==a[e]&&(a[e]=1===$p(a[e]))})),jn(t=fr(o)).call(t,(function(e){void 0!==a[e]&&(a[e]=o[e][a[e]]||a[e])})),a}function qb(e){return e&&e.length>0?du(e).call(e,(function(e){return Db(e)})):[]}function Bb(e){var t,r=dr({},e),n=["avatar","name","intro","announcement","ext"],i={joinMode:Rb,beInviteMode:Ab,inviteMode:xb,updateTeamMode:Pb,updateExtMode:Vb};return jn(n).call(n,(function(e){void 0!==r[e]&&(r[e]=r[e].toString())})),jn(t=fr(i)).call(t,(function(e){void 0!==r[e]&&(r[e]=i[e][r[e]])})),r}function Fb(e){var t=["teamId","ext","account","nickInTeam"],r={};return void 0!==e.bitConfigMask&&(r.bits=$p(e.bitConfigMask)),jn(t).call(t,(function(t){e[t]&&(r[t]=e[t].toString())})),Object.prototype.hasOwnProperty.call(e,"nickInTeam")&&(r.nickInTeam=e.nickInTeam),r}function Gb(e){var t,r=["teamId"],n=["joinTime","updateTime","bitConfigMask"],i=["active","valid","mute"],o={type:wb},a=e.bits,s=Jl(e,["bits"]);return void 0!==a&&(s.muteTeam=1===$p(a),s.bitConfigMask=a),s.id=s.teamId+"-"+s.account,jn(r).call(r,(function(e){s[e]&&(s[e]=s[e].toString())})),jn(n).call(n,(function(e){void 0!==s[e]&&(s[e]=$p(s[e]))})),jn(i).call(i,(function(e){void 0!==s[e]&&(s[e]=1===$p(s[e]))})),jn(t=fr(o)).call(t,(function(e){void 0!==s[e]&&(s[e]=o[e][s[e]]||s[e])})),s}function jb(e){return e&&e.length>0?du(e).call(e,(function(e){return Gb(e)})):[]}function Hb(e,t,r){return void 0===r&&(r="normal"),{id:e.teamId+"-"+t,teamId:e.teamId,account:t,type:r,nickInTeam:"",muteTeam:!1,mute:!1,joinTime:e.memberUpdateTime,updateTime:e.memberUpdateTime,active:!0,valid:!0}}function Wb(e,t,r){return void 0===r&&(r="normal"),t&&t.length>0?du(t).call(t,(function(t){return Hb(e,t,r)})):[]}var Kb=function(){function e(e){this.core=e}var t=e.prototype;return t.notifyAddSuperTeamMembers=function(e,t){this.core.emit("addSuperTeamMembers",{team:e,accounts:t,members:Wb(e,t)})},t.notifyUpdateSuperTeamManagers=function(e,t,r,n){this.core.emit("updateSuperTeamManagers",{team:{teamId:e,memberUpdateTime:n},accounts:t,isManager:r,members:du(t).call(t,(function(t){return{id:e+"-"+t,type:r?"manager":"normal",account:t,updateTime:n}}))})},t.notifyRemoveSuperTeamMembers=function(e,t){this.core.emit("removeSuperTeamMembers",{team:e,accounts:t})},t.notifyTransferSuperTeam=function(e,t,r){this.core.emit("transferSuperTeam",{team:e,from:{id:e.teamId+"-"+t,account:t,type:"normal",updateTime:e.memberUpdateTime},to:{id:e.teamId+"-"+r,account:r,type:"owner",updateTime:e.memberUpdateTime}})},t.notifyUpdateSuperTeamMembersMute=function(e,t,r){this.core.emit("updateSuperTeamMembersMute",{team:e,accounts:t,members:du(t).call(t,(function(t){return{id:e.teamId+"-"+t,account:t,teamId:e.teamId,mute:r,updateTime:e.memberUpdateTime}})),mute:r})},e}(),Yb={"21_5":"addSuperTeamMembers","21_6":"removeSuperTeamMembers","21_7":"leaveSuperTeam","21_8":"updateSuperTeamInfo","21_9":"getSuperTeamInfo","21_12":"getSuperTeams","21_15":"getSuperTeamMembers","21_10":"updateMySuperTeamMemberInfo","21_20":"applySuperTeam","21_21":"passSuperTeamApply","21_22":"rejectSuperTeamApply","21_23":"acceptSuperTeamInvite","21_24":"rejectSuperTeamInvite","21_26":"addSuperTeamManagers","21_27":"removeSuperTeamManagers","21_28":"muteSuperTeam","21_29":"muteSuperTeamMembers","21_30":"updateSuperTeamMemberNick","21_31":"transferSuperTeam","21_33":"getSuperTeamMembersByAccounts","21_34":"queryMuteSuperTeamMembers","21_101":"syncCreateSuperTeam","21_109":"syncSuperTeams","21_110":"syncUpdateSuperTeamMember","21_111":"syncMySuperTeamMembers"},Qb={superTeam:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,ext:18,serverExt:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateExtMode:24,mute:100,muteType:101},superTeamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,updateTime:11,ext:12,mute:13,invitorAccid:14,joinTime:15}},Jb=Ih(Qb),zb={getSuperTeamInfo:{sid:21,cid:9,service:"superTeam",params:[{type:"Long",name:"teamId"}],response:[{type:"Property",name:"superTeam",reflectMapper:Jb.superTeam}]},getSuperTeams:{sid:21,cid:12,service:"superTeam",params:[{type:"Long",name:"timetag"}],response:[{type:"PropertyArray",name:"superTeams",reflectMapper:Jb.superTeam},{type:"Bool",name:"isAll"},{type:"Long",name:"timetag"}]},updateSuperTeamInfo:{sid:21,cid:8,service:"superTeam",params:[{type:"Property",name:"superTeam",reflectMapper:Qb.superTeam}],response:[{type:"Long",name:"time"}]},addSuperTeamMembers:{sid:21,cid:5,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}],response:[{type:"StrArray",name:"abortedAccidList"},{type:"Long",name:"time"}]},removeSuperTeamMembers:{sid:21,cid:6,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},addSuperTeamManagers:{sid:21,cid:26,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeSuperTeamManagers:{sid:21,cid:27,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"}]},applySuperTeam:{sid:21,cid:20,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"ps"}],response:[{type:"Property",name:"superTeam",reflectMapper:Jb.superTeam}]},transferSuperTeam:{sid:21,cid:31,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"account"},{type:"Bool",name:"leave"}]},muteSuperTeam:{sid:21,cid:28,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"Int",name:"mute"}]},muteSuperTeamMembers:{sid:21,cid:29,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"Int",name:"mute"}]},updateSuperTeamMemberNick:{sid:21,cid:30,service:"superTeam",params:[{type:"Property",name:"teamMember",reflectMapper:Qb.superTeamMember}]},updateMySuperTeamMemberInfo:{sid:21,cid:10,service:"superTeam",params:[{type:"Property",name:"teamMember",reflectMapper:Qb.superTeamMember}]},getSuperTeamMembersByAccounts:{sid:21,cid:33,service:"superTeam",params:[{type:"StrArray",name:"memberIds"}],response:[{type:"PropertyArray",name:"superTeamMembers",reflectMapper:Jb.superTeamMember}]},getSuperTeamMembers:{sid:21,cid:15,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"Long",name:"joinTime"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"}],response:[{type:"PropertyArray",name:"superTeamMembers",reflectMapper:Jb.superTeamMember}]},queryMuteSuperTeamMembers:{sid:21,cid:34,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"Long",name:"joinTime"},{type:"Int",name:"limit"},{type:"Bool",name:"reverse"}],response:[{type:"PropertyArray",name:"superTeamMembers",reflectMapper:Jb.superTeamMember}]},leaveSuperTeam:{sid:21,cid:7,service:"superTeam",params:[{type:"Long",name:"teamId"}]},passSuperTeamApply:{sid:21,cid:21,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectSuperTeamApply:{sid:21,cid:22,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},acceptSuperTeamInvite:{sid:21,cid:23,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"}]},rejectSuperTeamInvite:{sid:21,cid:24,service:"superTeam",params:[{type:"Long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},syncSuperTeams:{sid:21,cid:109,service:"superTeam",response:[{type:"PropertyArray",name:"teams",reflectMapper:Jb.superTeam},{type:"Bool",name:"isAll"},{type:"Long",name:"timetag"}]},syncCreateSuperTeam:{sid:21,cid:101,service:"superTeam",response:[{type:"Property",name:"superTeam",reflectMapper:Jb.superTeam}]},syncUpdateSuperTeamMember:{sid:21,cid:110,service:"superTeam",response:[{type:"Property",name:"teamMember",reflectMapper:Jb.superTeamMember}]},syncMySuperTeamMembers:{sid:21,cid:111,ext:"sync",service:"superTeam",response:[{type:"PropertyArray",name:"teamMembers",reflectMapper:Jb.superTeamMember},{type:"Long",name:"timetag"}]}},Xb=function(e){function t(t){var r;return(r=e.call(this,"superTeam",t)||this).mySuperTeamMembersMap=new ad,r.service=new Kb(t),Mh({cmdMap:Yb,cmdConfig:zb}),r.setListeners(),r}nr(t,e);var r=t.prototype;return r.setListeners=function(){var e=this;this.core.eventBus.on("forwardReceive/superTeam/updateMyMemberInfo",(function(t){e.emitMemberUpdate(t)})),this.core.eventBus.on("team/onNotification",(function(t){return e.notificationHandler(t)}))},r.reset=function(){this.mySuperTeamMembersMap.clear()},r.mergeMySuperTeamMembers=function(e){var t=this;jn(e).call(e,(function(e){var r=e.teamId,n=t.mySuperTeamMembersMap.get(r),i=dr({},n,e);t.mySuperTeamMembersMap.set(r,i)}))},r.getSuperTeamInfo=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),t.next=3,this.core.sendCmd("getSuperTeamInfo",{teamId:e.teamId});case 3:return r=t.sent,n=r.content.superTeam,t.abrupt("return",Db(n));case 6:case"end":return t.stop()}}),t,this)})))},r.getSuperTeams=function(){return zl(this,void 0,void 0,Ql.mark((function e(){var t,r;return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.sendCmd("getSuperTeams",{timetag:0});case 2:return t=e.sent,r=t.content.superTeams,e.abrupt("return",qb(r));case 5:case"end":return e.stop()}}),e,this)})))},r.updateSuperTeamInfo=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},joinMode:{type:"enum",values:["noVerify","needVerify","rejectAll"],required:!1},beInviteMode:{type:"enum",values:["noVerify","needVerify"],required:!1},inviteMode:{type:"enum",values:["manager","all"],required:!1},updateTeamMode:{type:"enum",values:["manager","all"],required:!1},updateExtMode:{type:"enum",values:["manager","all"],required:!1},intro:{type:"string",allowEmpty:!0,required:!1},announcement:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",allowEmpty:!0,required:!1},ext:{type:"string",allowEmpty:!0,required:!1}},e),r=Bb(e),t.next=4,this.core.sendCmd("updateSuperTeamInfo",{superTeam:r});case 4:return t.abrupt("return",Db(r));case 5:case"end":return t.stop()}}),t,this)})))},r.addSuperTeamMembers=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},e),t.next=3,this.core.sendCmd("addSuperTeamMembers",{teamId:e.teamId,accounts:e.accounts,ps:e.ps||"",attach:e.ext||""});case 3:case"end":return t.stop()}}),t,this)})))},r.removeSuperTeamMembers=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("removeSuperTeamMembers",{teamId:e.teamId,accounts:e.accounts});case 3:case"end":return t.stop()}}),t,this)})))},r.addSuperTeamManagers=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},e),t.next=3,this.core.sendCmd("addSuperTeamManagers",e);case 3:case"end":return t.stop()}}),t,this)})))},r.removeSuperTeamManagers=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",min:1,itemType:"string"}},e),t.next=3,this.core.sendCmd("removeSuperTeamManagers",e);case 3:case"end":return t.stop()}}),t,this)})))},r.applySuperTeam=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},ps:{type:"string",allowEmpty:!0,max:5e3,required:!1}},e),t.next=3,this.core.sendCmd("applySuperTeam",{teamId:e.teamId,ps:e.ps||""});case 3:return r=t.sent,t.abrupt("return",Db(r.content.superTeam));case 5:case"end":return t.stop()}}),t,this)})))},r.transferSuperTeam=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},leave:{type:"boolean"}},e),t.next=3,this.core.sendCmd("transferSuperTeam",e);case 3:case"end":return t.stop()}}),t,this)})))},r.muteSuperTeam=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},mute:{type:"boolean"}},e),t.next=3,this.core.sendCmd("muteSuperTeam",{teamId:e.teamId,mute:e.mute?1:0});case 3:case"end":return t.stop()}}),t,this)})))},r.muteSuperTeamMembers=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string"},mute:{type:"boolean"}},e),t.next=3,this.core.sendCmd("muteSuperTeamMembers",{teamId:e.teamId,accounts:e.accounts,mute:e.mute?1:0});case 3:case"end":return t.stop()}}),t,this)})))},r.updateMemberNick=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},account:{type:"string",allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0}},e),r=Fb({teamId:e.teamId,nickInTeam:e.nickInTeam,account:e.account}),t.next=4,this.core.sendCmd("updateSuperTeamMemberNick",{teamMember:r});case 4:return n=Gb(dr({updateTime:(new Date).getTime()},r)),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t,this)})))},r.updateMyMemberInfo=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},nickInTeam:{type:"string",allowEmpty:!0,required:!1},bitConfigMask:{type:"number",min:0,max:2,required:!1},ext:{type:"string",required:!1}},e),r=Fb({teamId:e.teamId,nickInTeam:e.nickInTeam,bitConfigMask:e.bitConfigMask,ext:e.ext}),t.next=4,this.core.sendCmd("updateMySuperTeamMemberInfo",{teamMember:r});case 4:return n=Gb(dr({updateTime:(new Date).getTime(),account:this.core.account},r)),i=this.emitMemberUpdate(n),this.core.eventBus.emit("forwardSend/superTeam/updateMyMemberInfo",i),t.abrupt("return",n);case 8:case"end":return t.stop()}}),t,this)})))},r.getSuperTeamMembersByAccounts=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},accounts:{type:"array",itemType:"string",max:20,min:1}},e),i=du(n=e.accounts).call(n,(function(t){return e.teamId+"|"+t})),r.next=4,this.core.sendCmd("getSuperTeamMembersByAccounts",{memberIds:i});case 4:return o=r.sent,r.abrupt("return",jb(null===(t=o.content)||void 0===t?void 0:t.superTeamMembers));case 6:case"end":return r.stop()}}),r,this)})))},r.getSuperTeamMembers=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){var n;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},joinTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,max:1e3,required:!1},reverse:{type:"boolean",required:!1}},e),r.next=3,this.core.sendCmd("getSuperTeamMembers",dr({joinTime:0,limit:100,reverse:!1},e));case 3:return n=r.sent,r.abrupt("return",jb(null===(t=n.content)||void 0===t?void 0:t.superTeamMembers));case 5:case"end":return r.stop()}}),r,this)})))},r.queryMuteMembers=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},joinTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1},reverse:{type:"boolean",required:!1}},e),t.next=3,this.core.sendCmd("queryMuteSuperTeamMembers",dr({limit:100,joinTime:0,reverse:!1},e));case 3:return r=t.sent,n=r.content,t.abrupt("return",jb(n.superTeamMembers));case 6:case"end":return t.stop()}}),t,this)})))},r.leaveSuperTeam=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1}},e),t.next=3,this.core.sendCmd("leaveSuperTeam",{teamId:e.teamId});case 3:case"end":return t.stop()}}),t,this)})))},r.passSuperTeamApply=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},e),t.prev=1,t.next=4,this.core.sendCmd("passSuperTeamApply",e);case 4:this.core.eventBus.emit("forwardSend/superTeam/passTeamApply",e),t.next=12;break;case 7:throw t.prev=7,t.t0=t.catch(1),r=t.t0,this.core.eventBus.emit("forwardSend/superTeam/passTeamApply",e,null==r?void 0:r.code),t.t0;case 12:case"end":return t.stop()}}),t,this,[[1,7]])})))},r.rejectSuperTeamApply=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},e),t.prev=1,t.next=4,this.core.sendCmd("rejectSuperTeamApply",{teamId:e.teamId,from:e.from,ps:e.ps||""});case 4:this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamApply",e),t.next=12;break;case 7:throw t.prev=7,t.t0=t.catch(1),r=t.t0,this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamApply",e,null==r?void 0:r.code),t.t0;case 12:case"end":return t.stop()}}),t,this,[[1,7]])})))},r.acceptSuperTeamInvite=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1}},e),t.prev=1,t.next=4,this.core.sendCmd("acceptSuperTeamInvite",e);case 4:this.core.eventBus.emit("forwardSend/superTeam/acceptSuperTeamInvite",e),t.next=12;break;case 7:throw t.prev=7,t.t0=t.catch(1),r=t.t0,this.core.eventBus.emit("forwardSend/superTeam/acceptSuperTeamInvite",e,null==r?void 0:r.code),t.t0;case 12:case"end":return t.stop()}}),t,this,[[1,7]])})))},r.rejectSuperTeamInvite=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({teamId:{type:"string",regExp:/\d+/,allowEmpty:!1},from:{type:"string",allowEmpty:!1},ps:{type:"string",max:5e3,required:!1}},e),t.prev=1,t.next=4,this.core.sendCmd("rejectSuperTeamInvite",{teamId:e.teamId,from:e.from,ps:e.ps||""});case 4:this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamInvite",e),t.next=12;break;case 7:throw t.prev=7,t.t0=t.catch(1),r=t.t0,this.core.eventBus.emit("forwardSend/superTeam/rejectSuperTeamInvite",e,null==r?void 0:r.code),t.t0;case 12:case"end":return t.stop()}}),t,this,[[1,7]])})))},r.emitMemberUpdate=function(e){e=Gb(e),this.mergeMyTeamMembers([e]),this.core.emit("updateTeamMember",e);var t=VT(this.mySuperTeamMembersMap.get(e.teamId));return this.core.emit("myTeamMembers",[t]),t},r.mergeMyTeamMembers=function(e){var t=this;jn(e).call(e,(function(e){var r=e.teamId,n=t.mySuperTeamMembersMap.get(r),i=dr({},n,e);t.mySuperTeamMembersMap.set(r,i)}))},r.syncSuperTeamsHandler=function(e){var t=e.content;this.core.eventBus.emit("sync/updateTimetag",{superTeams:$p(t.timetag)});var r=null==t?void 0:t.teams;if(r&&r.length){var n=qb(r);this.core.emit("superTeams",n)}},r.syncCreateSuperTeamHandler=function(e){var t=e.content,r=Db(null==t?void 0:t.superTeam),n=Hb(r,r.owner,"owner");this.core.emit("createSuperTeam",r,n)},r.syncUpdateSuperTeamMemberHandler=function(e){var t=e.content,r=Gb(null==t?void 0:t.teamMember);r.updateTime||(r.updateTime=(new Date).getTime()),this.mergeMySuperTeamMembers([r]),this.core.emit("updateSuperTeamMember",r);var n=VT(this.mySuperTeamMembersMap.get(r.teamId));this.core.emit("mySuperTeamMembers",[n])},r.syncMySuperTeamMembersHandler=function(e){var t,r=e.content;this.core.eventBus.emit("sync/updateTimetag",{mySuperTeamMembers:$p(r.timetag)});var n=null==r?void 0:du(t=r.teamMembers).call(t,(function(e){return Gb(e)}));this.mergeMySuperTeamMembers(n),this.core.emit("mySuperTeamMembers",VT(n))},r.notificationHandler=function(e){var t=e.attach,r=e.scene,n=e.from,i=e.to,o=e.time,a=e.idServer,s=e.idClient,c=t.team,u=t.account,d=t.accounts,l=t.type;if("superTeam"===r)switch(this.logger.getDebugMode()?this.logger.debug("superTeam::recvNotification",a,s,t):this.logger.log("superTeam::recvNotification",a,s,i,l,u,d),l){case"updateSuperTeam":c.updateTime=o,this.core.emit("updateSuperTeam",c);break;case"addSuperTeamMembers":this.service.notifyAddSuperTeamMembers(c,d);break;case"acceptSuperTeamInvite":this.service.notifyAddSuperTeamMembers(c,[n]);break;case"passSuperTeamApply":this.service.notifyAddSuperTeamMembers(c,[u]);break;case"addSuperTeamManagers":this.service.notifyUpdateSuperTeamManagers(i,d,!0,o);break;case"removeSuperTeamManagers":this.service.notifyUpdateSuperTeamManagers(i,d,!1,o);break;case"removeSuperTeamMembers":this.service.notifyRemoveSuperTeamMembers(c,d);break;case"leaveSuperTeam":this.service.notifyRemoveSuperTeamMembers(c,[n]);break;case"dismissSuperTeam":this.core.emit("dismissSuperTeam",{teamId:i});break;case"transferSuperTeam":this.service.notifyTransferSuperTeam(c,n,u);break;case"updateSuperTeamMembersMute":this.service.notifyUpdateSuperTeamMembersMute(c,d,t.mute)}},t}(nf),$b={"13_1":"getChatroomAddress","24_1":"getQChatAddress"},Zb={getChatroomAddress:{sid:13,cid:1,service:"plugin",params:[{type:"Long",name:"chatroomId"},{type:"Bool",name:"isWeixinApp"},{type:"Int",name:"ipType"}],response:[{type:"StrArray",name:"address"}]},getQChatAddress:{sid:24,cid:1,service:"plugin",params:[{type:"Property",name:"getQChatAddressTag",reflectMapper:{ipType:1}}],response:[{type:"StrArray",name:"address"}]}},eC=function(e){function t(t){var r;return(r=e.call(this,"plugin",t)||this).core=t,Mh({cmdMap:$b,cmdConfig:Zb}),r}nr(t,e);var r=t.prototype;return r.getChatroomAddress=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({chatroomId:{type:"string",allowEmpty:!1},ipType:{type:"number",required:!1}},e),t.next=3,this.core.sendCmd("getChatroomAddress",{chatroomId:e.chatroomId,isWeixinApp:"WXAPP"===Zl.platform,ipType:e.ipType||0});case 3:return r=t.sent,t.abrupt("return",r.content.address);case 5:case"end":return t.stop()}}),t,this)})))},r.getQChatAddress=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({ipType:{type:"number",required:!1}},e),t.next=3,this.core.sendCmd("getQChatAddress",{getQChatAddressTag:{ipType:(null==e?void 0:e.ipType)||0}});case 3:return r=t.sent,t.abrupt("return",r.content.address);case 5:case"end":return t.stop()}}),t,this)})))},t}(nf),tC={"7_19":"nimQueryCloudSessionList","7_20":"nimQueryCloudSession","7_21":"nimUpdateCloudSession","7_22":"nimDeleteCloudSessionList","7_121":"nimMultiSyncUpdateCloudSession"},rC={sessionReqTag:{minTimestamp:1,maxTimestamp:2,includedLastMsg:3,limit:4,hasMore:5},sessionTag:{sessionId:1,updateTime:2,ext:3,lastMsg:4,lastMsgType:5}},nC=Ih(rC),iC={nimQueryCloudSessionList:{sid:7,cid:19,service:"cloudSession",params:[{type:"Property",name:"tag",reflectMapper:rC.sessionReqTag}],response:[{type:"Property",name:"tag",reflectMapper:nC.sessionReqTag},{type:"PropertyArray",name:"sessions",reflectMapper:nC.sessionTag}]},nimQueryCloudSession:{sid:7,cid:20,service:"cloudSession",params:[{type:"Property",name:"tag",reflectMapper:rC.sessionTag}],response:[{type:"Property",name:"session",reflectMapper:nC.sessionTag}]},nimUpdateCloudSession:{sid:7,cid:21,service:"cloudSession",params:[{type:"Property",name:"tag",reflectMapper:rC.sessionTag}]},nimDeleteCloudSessionList:{sid:7,cid:22,service:"cloudSession",params:[{type:"PropertyArray",name:"tags",reflectMapper:rC.sessionTag}]},nimMultiSyncUpdateCloudSession:{sid:7,cid:121,service:"cloudSession",response:[{type:"Property",name:"session",reflectMapper:nC.sessionTag}]}},oC={sessionId:{type:"string"},updateTime:{type:"number"},ext:{type:"string"},lastMsg:{type:"object"},lastMsgType:{type:"number"}};function aC(e,t,r){var n=Ph(oC,e),i=kp(n.sessionId,"|"),o=i.accid,a=i.scene;if(n.sessionId=a+"-"+o,n.lastMsg){var s=1===n.lastMsgType;n.lastMsgInfo=s?{isLastMsgRecalled:s,revokedMsg:mT(yh(n.lastMsg,BT.sysMsg),r)}:{isLastMsgRecalled:s,lastMsg:YS(yh(n.lastMsg,uT.msg),{account:t})}}return delete n.lastMsg,delete n.lastMsgType,n}function sC(e,t,r){return e&&e.length>0?du(e).call(e,(function(e){return aC(e,t,r)})):[]}var cC=function(e){function t(t){var r;return r=e.call(this,"cloudSession",t)||this,Mh({cmdMap:tC,cmdConfig:iC}),r}nr(t,e);var r=t.prototype;return r.queryCloudSessionList=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o,a;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Pl({minTimestamp:{type:"number",min:0,required:!1},maxTimestamp:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1},includedLastMsg:{type:"boolean",required:!1}},e),(n=dr({limit:100,includedLastMsg:!0},e)).includedLastMsg=Bh.boolean(e,"includedLastMsg"),r.next=5,this.core.sendCmd("nimQueryCloudSessionList",{tag:n});case 5:return i=r.sent,o=(null===(t=i.content)||void 0===t?void 0:t.tag)||{},a=i.content.sessions,r.abrupt("return",{hasMore:+o.hasMore>0,sessionList:sC(a,this.core.account,this.logger)});case 9:case"end":return r.stop()}}),r,this)})))},r.queryCloudSession=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({sessionId:{type:"string",allowEmpty:!1}},e),r=kp(e.sessionId,"-"),n=r.accid,i=r.scene,t.next=4,this.core.sendCmd("nimQueryCloudSession",{tag:{sessionId:"superTeam"===i?"super_team|"+n:i+"|"+n}});case 4:return o=t.sent,t.abrupt("return",aC(o.content.session,this.core.account,this.logger));case 6:case"end":return t.stop()}}),t,this)})))},r.updateCloudSession=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({sessionId:{type:"string",allowEmpty:!1},ext:{type:"string",allowEmpty:!1,required:!1}},e),r=kp(e.sessionId,"-"),n=r.accid,i=r.scene,t.next=4,this.core.sendCmd("nimUpdateCloudSession",{tag:{sessionId:"superTeam"===i?"super_team|"+n:i+"|"+n,ext:e.ext}});case 4:case"end":return t.stop()}}),t,this)})))},r.deleteCloudSessionList=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({sessionIdList:{type:"array",itemType:"string"}},e),n=du(r=e.sessionIdList).call(r,(function(e){var t=kp(e,"-"),r=t.accid,n=t.scene;return{sessionId:"superTeam"===n?"super_team|"+r:n+"|"+r}})),t.next=4,this.core.sendCmd("nimDeleteCloudSessionList",{tags:n});case 4:case"end":return t.stop()}}),t,this)})))},r.nimMultiSyncUpdateCloudSessionHandler=function(e){var t=aC(e.content.session,this.core.account,this.logger);this.core.emit("multiSyncUpdateCloudSession",t)},t}(nf),uC={needPush:{type:"boolean",required:!1},pushTitle:{type:"string",required:!1},pushContent:{type:"string",required:!1},pushPayload:{type:"string",required:!1},needPushBadge:{type:"boolean",required:!1}},dC={"15_1":"signalingCreate","15_2":"signalingDelay","15_3":"signalingClose","15_4":"signalingJoin","15_5":"signalingLeave","15_6":"signalingInvite","15_7":"signalingCancelInvite","15_8":"signalingReject","15_9":"signalingAccept","15_10":"signalingSendCustomCommand","15_11":"signalingRecvNotification","15_12":"signalingMultiSyncNotification","15_13":"signalingSyncNotification","15_14":"singalingSyncChannels","15_15":"signalingQueryInfo","15_16":"signalingCallEx","15_17":"signalingJoinAndAccept"},lC={avSignalTag:dr({type:1,name:2,channelId:3,createTime:4,expireTime:5,creatorAccid:6,ext:7,invalid:8,fromAccid:10,toAccid:11,requestId:12,members:18,attach:19,attachExt:20,needOffline:21,msgId:22,uid:23,time:24,nertcChannelName:25,nertcTokenTtl:26,nertcToken:27,nertcJoinRoomQueryParamMap:28,nertcJoinRoomResponse:29,callStatus:30},{needPush:13,pushTitle:14,pushContent:15,pushPayload:16,needPushBadge:17})},pC=Ih(lC),mC={signalingCreate:{sid:15,cid:1,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:lC.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:pC.avSignalTag}]},signalingDelay:{sid:15,cid:2,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:lC.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:pC.avSignalTag}]},signalingClose:{sid:15,cid:3,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:lC.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:pC.avSignalTag}]},signalingJoin:{sid:15,cid:4,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:lC.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:pC.avSignalTag}]},signalingLeave:{sid:15,cid:5,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:lC.avSignalTag}]},signalingInvite:{sid:15,cid:6,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:lC.avSignalTag}]},signalingCancelInvite:{sid:15,cid:7,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:lC.avSignalTag}]},signalingReject:{sid:15,cid:8,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:lC.avSignalTag}]},signalingAccept:{sid:15,cid:9,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:lC.avSignalTag}]},signalingSendCustomCommand:{sid:15,cid:10,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:lC.avSignalTag}]},signalingRecvNotification:{sid:15,cid:11,service:"signaling",response:[{type:"Property",name:"data",reflectMapper:pC.avSignalTag}]},signalingMultiSyncNotification:{sid:15,cid:12,service:"signaling",response:[{type:"Property",name:"data",reflectMapper:pC.avSignalTag}]},signalingSyncNotification:{sid:15,cid:13,service:"signaling",response:[{type:"PropertyArray",name:"datas",reflectMapper:pC.avSignalTag}]},singalingSyncChannels:{sid:15,cid:14,service:"signaling",response:[{type:"PropertyArray",name:"datas",reflectMapper:pC.avSignalTag}]},signalingQueryInfo:{sid:15,cid:15,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:lC.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:pC.avSignalTag}]},signalingCallEx:{sid:15,cid:16,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:lC.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:pC.avSignalTag}]},signalingJoinAndAccept:{sid:15,cid:17,service:"signaling",params:[{type:"Property",name:"tag",reflectMapper:lC.avSignalTag}],response:[{type:"Property",name:"data",reflectMapper:pC.avSignalTag}]},signalingBatchMarkRead:{sid:4,cid:5,hasPacketResponse:!1,service:"signaling",params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]}},hC={type:{type:"number"},createTime:{type:"number"},expireTime:{type:"number"},invalid:{type:"boolean"},pushInfo:uC,pluginSetting:{nertcInfo:{nertcChannelName:{type:"string"},nertcTokenTtl:{type:"number"},nertcToken:{type:"string"},nertcJoinRoomQueryParamMap:{type:"string"},callStatus:{type:"number"}}},callStatus:{type:"number"},attach:{type:"object"},members:{type:"object"},needOffline:{type:"boolean"},uid:{type:"number"},time:{type:"number"}};function fC(e){return Ph(hC,yh(e,{1:"accid",2:"uid",3:"createTime",4:"expireTime"}))}function gC(e){var t,r=Ph(hC,e),n=[];return r.members&&r.members.length>0&&(n=du(t=r.members).call(t,(function(e){return fC(e)})),delete r.members),n.length>0?{channelInfo:r,memberList:n}:{channelInfo:r}}function vC(e){var t,r=Ph(hC,e),n=[];r.members&&r.members.length>0&&(n=du(t=r.members).call(t,(function(e){return fC(e)})),delete r.members);var i=200;return e.callStatus&&(i=Number(e.callStatus)),n.length>0?{channelInfo:r,memberList:n,callStatus:i}:{channelInfo:r,callStatus:i}}function yC(e){return Uh(hC,e)}var MC,IC,SC,TC,bC,CC,_C,EC=function(e){function t(t){var r;return(r=e.call(this)||this).timer=0,r.pollingInterval=12e4,r.name="signaling",r.logger=t.logger,r.core=t,r.channels={},Mh({cmdMap:dC,cmdConfig:mC}),r}nr(t,e);var r=t.prototype;return r.callEx=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o,a;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Pl({type:{type:"number"},toAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},needOffline:{type:"boolean",required:!1},pushInfo:{type:"object",required:!1,rules:uC},pluginSetting:{type:"object",required:!1,rules:{nertcInfo:{type:"object",required:!1}}}},e),r.next=3,this.core.sendCmd("signalingCallEx",{tag:yC(e)});case 3:return n=r.sent,i=(null===(t=n.content)||void 0===t?void 0:t.data)||{},o=vC(i),this.channels[o.channelInfo.channelId]=VT(o.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(tr(a=this.aotoDelay).call(a,this),this.pollingInterval,-1)),r.abrupt("return",o);case 9:case"end":return r.stop()}}),r,this)})))},r.joinAndAccept=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o,a,s,c;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Pl({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",required:!1},needOffline:{type:"boolean",required:!1},uid:{type:"number",required:!1},pluginSetting:{type:"object",required:!1,rules:{nertcInfo:{type:"object",required:!1}}}},e),n=e.fromAccid,(i=Jl(e,["fromAccid"])).toAccid=n,r.next=5,this.core.sendCmd("signalingJoinAndAccept",{tag:yC(i)});case 5:return o=r.sent,a=(null===(t=o.content)||void 0===t?void 0:t.data)||{},s=vC(a),this.channels[s.channelInfo.channelId]=VT(s.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(tr(c=this.aotoDelay).call(c,this),this.pollingInterval,-1)),r.abrupt("return",s);case 11:case"end":return r.stop()}}),r,this)})))},r.create=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){var n,i;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Pl({type:{type:"number"},ext:{type:"string",required:!1}},e),r.next=3,this.core.sendCmd("signalingCreate",{tag:yC(e)});case 3:return n=r.sent,i=(null===(t=n.content)||void 0===t?void 0:t.data)||{},r.abrupt("return",gC(i));case 6:case"end":return r.stop()}}),r,this)})))},r.close=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({channelId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},e),t.next=3,this.core.sendCmd("signalingClose",{tag:yC(e)});case 3:case"end":return t.stop()}}),t,this)})))},r.queryInfo=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){var n,i;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Pl({name:{type:"string",allowEmpty:!1}},e),r.next=3,this.core.sendCmd("signalingQueryInfo",{tag:e});case 3:return n=r.sent,i=(null===(t=n.content)||void 0===t?void 0:t.data)||{},r.abrupt("return",gC(i));case 6:case"end":return r.stop()}}),r,this)})))},r.join=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o,a;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Pl({channelId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},uid:{type:"number",min:0,required:!1},needOffline:{type:"boolean",required:!1}},e),r.next=3,this.core.sendCmd("signalingJoin",{tag:yC(e)});case 3:return n=r.sent,i=(null===(t=n.content)||void 0===t?void 0:t.data)||{},o=gC(i),this.channels[o.channelInfo.channelId]=VT(o.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(tr(a=this.aotoDelay).call(a,this),this.pollingInterval,-1)),r.abrupt("return",o);case 9:case"end":return r.stop()}}),r,this)})))},r.aotoDelay=function(){return zl(this,void 0,void 0,Ql.mark((function e(){var t,r,n,i,o;return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(t=fr(this.channels)).length){e.next=5;break}return this.timer&&this.core.timerManager.deleteTimer(this.timer),this.timer=0,e.abrupt("return");case 5:this.logger.log("signling:autoDelay",t),r=0;case 7:if(!(r<t.length)){e.next=24;break}return n=t[r],e.prev=9,e.next=12,this.core.sendCmd("signalingDelay",{tag:{channelId:n}});case 12:i=e.sent,o=gC(i.content.data),this.channels[n]=o.channelInfo,e.next=21;break;case 17:e.prev=17,e.t0=e.catch(9),this.logger.warn("signling:autoDelay "+n+" failed",e.t0),delete this.channels[n];case 21:r++,e.next=7;break;case 24:case"end":return e.stop()}}),e,this,[[9,17]])})))},r.leave=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({channelId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},e),t.next=3,this.core.sendCmd("signalingLeave",{tag:yC(e)});case 3:delete this.channels[e.channelId];case 4:case"end":return t.stop()}}),t,this)})))},r.invite=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({channelId:{type:"string",allowEmpty:!1},toAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1},pushInfo:{type:"object",required:!1,rules:uC}},e),t.next=3,this.core.sendCmd("signalingInvite",{tag:yC(e)});case 3:case"end":return t.stop()}}),t,this)})))},r.cancelInvite=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({channelId:{type:"string",allowEmpty:!1},toAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},e),t.next=3,this.core.sendCmd("signalingCancelInvite",{tag:yC(e)});case 3:case"end":return t.stop()}}),t,this)})))},r.reject=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1}},e),r=e.fromAccid,(n=Jl(e,["fromAccid"])).toAccid=r,t.next=5,this.core.sendCmd("signalingReject",{tag:yC(n)});case 5:case"end":return t.stop()}}),t,this)})))},r.accept=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},attachExt:{type:"string",required:!1},needOffline:{type:"boolean",required:!1},autoJoin:{type:"boolean",required:!1},uid:{type:"number",min:0,required:!1},joinAttachExt:{type:"string",required:!1}},e),r=e.autoJoin,n=e.joinAttachExt,i=e.fromAccid,(o=Jl(e,["autoJoin","joinAttachExt","fromAccid"])).toAccid=i,t.next=5,this.core.sendCmd("signalingAccept",{tag:yC(o)});case 5:if(this.logger.log("Signaling:accept, accept success, autoJoin "+e.autoJoin),!r){t.next=10;break}return a={channelId:e.channelId,needOffline:e.needOffline,attachExt:n,uid:e.uid},t.next=10,this.join(a);case 10:case"end":return t.stop()}}),t,this)})))},r.sendCustomCommand=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({channelId:{type:"string",allowEmpty:!1},fromAccid:{type:"string",allowEmpty:!1,required:!1},attachExt:{type:"string",required:!1}},e),t.next=3,this.core.sendCmd("signalingSendCustomCommand",{tag:yC(e)});case 3:case"end":return t.stop()}}),t,this)})))},r.signalingRecvNotificationHandler=function(e){var t="number"==typeof Zp(e,"raw.r[0]")?""+e.raw.r[0]:"0";e.content.data.msgId=e.content.data.msgId||t,this.doNotify(e.content.data),t&&$p(t)&&this.core.sendCmd("signalingBatchMarkRead",{sid:15,cid:11,ids:[t]})},r.signalingMultiSyncNotificationHandler=function(e){this.doNotify(e.content.data,3)},r.doNotify=function(e,t){void 0===t&&(t=0);var r=function(e,t){void 0===t&&(t=0);var r=Ph(hC,e),n=r.attach,i=r.attachExt,o=r.time,a=r.msgId;r.fromAccid,r.toAccid,r.members,r.requestId,r.pushInfo;var s=Jl(r,["attach","attachExt","time","msgId","fromAccid","toAccid","members","requestId","pushInfo"]);if(2===n.type)try{r.member={accid:r.attach.member[1],uid:Number(r.attach.member[2]),createTime:Number(r.attach.member[3]),expireTime:Number(r.attach.member[4])}}catch(e){delete r.member}var c=n.type;return delete r.attach,{metaData:{eventType:c,channelInfo:s,feature:t,ext:i||"",time:o,msgId:a},rawData:r}}(e,t),n=r.metaData,i=r.rawData,o=i.fromAccid,a=i.toAccid,s=i.requestId,c=i.pushInfo,u=i.msgId,d=i.member;switch(n.eventType){case 1:this.emit("signalingClose",{fromAccid:o,metaData:n});break;case 2:this.emit("signalingJoin",{fromAccid:o,metaData:n,member:d});break;case 3:this.emit("signalingInvite",{fromAccid:o,toAccid:a,requestId:s,pushInfo:c,metaData:n});break;case 4:this.emit("signalingCancelInvite",{fromAccid:o,toAccid:a,requestId:s,metaData:n});break;case 5:this.emit("signalingReject",{fromAccid:o,toAccid:a,requestId:s,metaData:n});break;case 6:this.emit("signalingAccept",{fromAccid:o,toAccid:a,requestId:s,metaData:n});break;case 7:this.emit("signalingLeave",{fromAccid:o,metaData:n});break;case 8:this.emit("signalingCustomCommand",{fromAccid:o,metaData:n});break;default:this.logger.warn("signaling:notification, no such a type "+n.eventType,i)}return u},r.signalingSyncNotificationHandler=function(e){var t,r,n=this;if(e.content.datas&&e.content.datas.length>0){var i=fu(t=du(r=e.content.datas).call(r,(function(e){return n.doNotify(e,1)}))).call(t,(function(e){return e}));i.length>0&&this.core.sendCmd("signalingBatchMarkRead",{sid:15,cid:11,ids:i})}},r.singalingSyncChannelsHandler=function(e){var t,r=this;if(this.timer=0,this.channels={},e.content.datas&&e.content.datas.length>0){var n=du(t=e.content.datas).call(t,(function(e){return gC(e)}));jn(n).call(n,(function(e){var t=e.channelInfo.channelId;r.channels[t]=VT(e.channelInfo)})),this.emit("singalingSyncChannels",n)}},r.process=function(e){var t=this[e.cmd+"Handler"];if("function"==typeof t)return t.call(this,e),fs.resolve(e);var r=Zp(e,"error.detail.ignore");return e.error&&!r?fs.reject(e.error):fs.resolve(e)},t}(Bs.EventEmitter),wC=function(e){function t(t,r){var n;return(n=e.call(this)||this).name=t,n.core=r,n.name=t,n.logger=r.logger,n.core=r,n}nr(t,e);var r=t.prototype;return r.emit=function(t){var r=this;try{for(var n,i,o=arguments.length,a=new Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];return(n=e.prototype.emit).call.apply(n,xs(i=[this,t]).call(i,a))}catch(e){return qs((function(){throw r.logger.error(r.name+"::emit throw error in setTimeout. event: "+t.toString()+". Error",e),e}),0),!1}},r.process=function(e){var t=this[e.cmd+"Handler"];if("function"==typeof t)return t.call(this,e);var r=Zp(e,"error.detail.ignore");return e.error&&!r?fs.reject(e.error):fs.resolve(e)},t}(Bs),RC={"24_15":"qchatSubscribe","24_27":"qchatGetUnreadInfo","24_48":"qchatCreateChannel","24_49":"qchatDeleteChannel","24_50":"qchatUpdateChannel","24_51":"qchatGetChannels","24_52":"qchatGetChannelsByPage","24_53":"qchatGetMembersByPage","24_54":"qchatUpdateWhiteBlackRole","24_55":"qchatGetWhiteBlackRolesPage","24_56":"qchatUpdateWhiteBlackMembers","24_57":"qchatGetWhiteBlackMembersPage","24_58":"qchatGetExistingWhiteBlackRoles","24_59":"qchatGetExistingWhiteBlackMembers","24_60":"qchatUpdateCategoryInfoOfChannel","24_109":"qchatCreateChannelCategory","24_110":"qchatRemoveChannelCategory","24_111":"qchatUpdateChannelCategory","24_112":"qchatGetChannelCategoriesByID","24_113":"qchatUpdateChannelCategoryWhiteBlackRole","24_114":"qchatGetChannelCategoryWhiteBlackRolesPage","24_115":"qchatUpdateChannelCategoryWhiteBlackMembers","24_116":"qchatGetChannelCategoryWhiteBlackMembersPage","24_117":"qchatGetChannelCategoryWhiteBlackRoles","24_118":"qchatGetChannelCategoryWhiteBlackMembers","24_119":"qchatGetChannelCategoriesPage","24_120":"qchatGetChannelCategoryChannelsPage","24_93":"qchatGetChannelSearchByPage","24_95":"qchatChannelMemberSearch","25_8":"qchatGetRoleIdsByServerId","25_9":"qchatSubscribeAsVisitor","25_12":"qchatAutoSubscribe","25_13":"qchatAutoSubscribeNotification"},kC={serverId:1,channelId:2,ackTimestamp:3,unreadCount:4,mentionedCount:5,maxCount:6,lastMsgTime:7},AC={channelInfo:{channelId:1,serverId:2,name:4,topic:5,ext:6,type:7,validFlag:8,createTime:9,updateTime:10,owner:11,viewMode:12,categoryId:13,syncMode:14,reorderWeight:15,visitorMode:16},antispamTag:{antiSpamBusinessId:1},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},serverRole:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,type:7,memberCount:8,priority:9,createTime:10,updateTime:11},qchatSubReqTag:{type:1,opeType:2},qchatChannelIdInfoTag:{serverId:1,channelId:2},unreadInfo:kC,qchatGetChannelListPageTag:{serverId:1,timetag:2,limit:3},qchatGetMembersByPageTag:{serverId:1,channelId:2,timetag:3,limit:4},qchatUpdateWhiteBlackRoleTag:{serverId:1,channelId:2,type:3,opeType:4,roleId:5},qchatGetWhiteBlackRolesPageTag:{serverId:1,channelId:2,type:3,timetag:4,limit:5},qchatUpdateWhiteBlackMembersTag:{serverId:1,channelId:2,type:3,opeType:4,toAccids:5},qchatGetWhiteBlackMembersPageTag:{serverId:1,channelId:2,type:3,timetag:4,limit:5},qchatGetExistingWhiteBlackRolesTag:{serverId:1,channelId:2,type:3,roleIds:4},qchatGetExistingWhiteBlackMembersTag:{serverId:1,channelId:2,type:3,accids:4},QChatChannelCategoryInfo:{categoryId:1,serverId:2,name:4,ext:5,owner:6,viewMode:7,validFlag:8,createTime:9,updateTime:10,channelNumber:11},qchatUpdateChannelCategoryWhiteBlackRoleTag:{serverId:1,categoryId:2,type:3,opeType:4,roleId:5},qchatGetChannelCategoryWhiteBlackRolesPageTag:{serverId:1,categoryId:2,type:3,timetag:4,limit:5},qchatUpdateChannelCategoryWhiteBlackMembersTag:{serverId:1,categoryId:2,type:3,opeType:4,toAccids:5},qchatGetChannelCategoryWhiteBlackMembersPageTag:{serverId:1,categoryId:2,type:3,timetag:4,limit:5},qchatGetChannelCategoryWhiteBlackRolesTag:{serverId:1,categoryId:2,type:3,roleIds:4},qchatGetChannelCategoryWhiteBlackMembersTag:{serverId:1,categoryId:2,type:3,accids:4},qchatGetChannelCategoriesPageTag:{serverId:1,timetag:2,limit:3},qchatGetChannelCategoryChannelsPageTag:{serverId:1,categoryId:2,timetag:3,limit:4},qchatGetChannelSearchByPageTag:{keyword:1,startTime:2,endTime:3,order:4,limit:5,serverId:6,sort:7,cursor:8},qchatUpdateChannelTag:{channelId:1,name:4,topic:5,ext:6,viewMode:12,visitorMode:16},serverRoles:{serverId:1,roleIds:2,timeTag:3},qchatChannelMemberSearchTag:{serverId:1,channelId:2,keyword:3,limit:4},qchatChannelMemberInfo:{serverId:1,channelId:2,avatar:3,accid:4,nick:5,createTime:6,updateTime:7}},NC=function(){return Ih(AC)},xC=function(){var e=NC();return{qchatCreateChannel:{sid:24,cid:48,service:"qchatChannel",params:[{type:"Property",name:"channelInfo",reflectMapper:AC.channelInfo},{type:"Property",name:"antispamTag",reflectMapper:AC.antispamTag}],response:[{type:"Property",name:"channelInfo",reflectMapper:e.channelInfo}]},qchatDeleteChannel:{sid:24,cid:49,service:"qchatChannel",params:[{type:"Long",name:"channelId"}]},qchatUpdateChannel:{sid:24,cid:50,service:"qchatChannel",params:[{type:"Property",name:"channelInfo",reflectMapper:AC.qchatUpdateChannelTag},{type:"Property",name:"antispamTag",reflectMapper:AC.antispamTag}],response:[{type:"Property",name:"channelInfo",reflectMapper:e.channelInfo}]},qchatGetChannels:{sid:24,cid:51,service:"qchatChannel",params:[{type:"LongArray",name:"channelIds"}],response:[{type:"PropertyArray",name:"channelList",reflectMapper:e.channelInfo}]},qchatGetChannelsByPage:{sid:24,cid:52,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelListPageTag",reflectMapper:AC.qchatGetChannelListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.channelInfo}]},qchatGetMembersByPage:{sid:24,cid:53,service:"qchatChannel",params:[{type:"Property",name:"qchatGetMembersByPageTag",reflectMapper:AC.qchatGetMembersByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.memberInfo}]},qchatUpdateWhiteBlackRole:{sid:24,cid:54,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateWhiteBlackRoleTag",reflectMapper:AC.qchatUpdateWhiteBlackRoleTag}]},qchatGetWhiteBlackRolesPage:{sid:24,cid:55,service:"qchatChannel",params:[{type:"Property",name:"qchatGetWhiteBlackRolesPageTag",reflectMapper:AC.qchatGetWhiteBlackRolesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.serverRole}]},qchatUpdateWhiteBlackMembers:{sid:24,cid:56,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateWhiteBlackMembersTag",reflectMapper:AC.qchatUpdateWhiteBlackMembersTag}]},qchatGetWhiteBlackMembersPage:{sid:24,cid:57,service:"qchatChannel",params:[{type:"Property",name:"qchatGetWhiteBlackMembersPageTag",reflectMapper:AC.qchatGetWhiteBlackMembersPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.memberInfo}]},qchatGetExistingWhiteBlackRoles:{sid:24,cid:58,service:"qchatChannel",params:[{type:"Property",name:"qchatGetExistingWhiteBlackRolesTag",reflectMapper:AC.qchatGetExistingWhiteBlackRolesTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:e.serverRole}]},qchatGetExistingWhiteBlackMembers:{sid:24,cid:59,service:"qchatChannel",params:[{type:"Property",name:"qchatGetExistingWhiteBlackMembersTag",reflectMapper:AC.qchatGetExistingWhiteBlackMembersTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:e.memberInfo}]},qchatUpdateCategoryInfoOfChannel:{sid:24,cid:60,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateCategoryInfoOfChannelTag",reflectMapper:AC.channelInfo}],response:[{type:"Property",name:"channelInfo",reflectMapper:e.channelInfo}]},qchatCreateChannelCategory:{sid:24,cid:109,service:"qchatChannel",params:[{type:"Property",name:"qchatCreateChannelCategoryTag",reflectMapper:AC.QChatChannelCategoryInfo}],response:[{type:"Property",name:"QChatChannelCategoryInfo",reflectMapper:e.QChatChannelCategoryInfo}]},qchatRemoveChannelCategory:{sid:24,cid:110,service:"qchatChannel",params:[{type:"Long",name:"categoryId"}]},qchatUpdateChannelCategory:{sid:24,cid:111,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryTag",reflectMapper:AC.QChatChannelCategoryInfo}],response:[{type:"Property",name:"QChatChannelCategoryInfo",reflectMapper:e.QChatChannelCategoryInfo}]},qchatGetChannelCategoriesByID:{sid:24,cid:112,service:"qchatChannel",params:[{type:"LongArray",name:"categoryIds"}],response:[{type:"PropertyArray",name:"channelCategoryList",reflectMapper:e.QChatChannelCategoryInfo}]},qchatUpdateChannelCategoryWhiteBlackRole:{sid:24,cid:113,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryWhiteBlackRoleTag",reflectMapper:AC.qchatUpdateChannelCategoryWhiteBlackRoleTag}]},qchatGetChannelCategoryWhiteBlackRolesPage:{sid:24,cid:114,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackRolesPageTag",reflectMapper:AC.qchatGetChannelCategoryWhiteBlackRolesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.serverRole}]},qchatUpdateChannelCategoryWhiteBlackMembers:{sid:24,cid:115,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryWhiteBlackMembersTag",reflectMapper:AC.qchatUpdateChannelCategoryWhiteBlackMembersTag}]},qchatGetChannelCategoryWhiteBlackMembersPage:{sid:24,cid:116,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackMembersPageTag",reflectMapper:AC.qchatGetChannelCategoryWhiteBlackMembersPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.memberInfo}]},qchatGetChannelCategoryWhiteBlackRoles:{sid:24,cid:117,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackRolesTag",reflectMapper:AC.qchatGetChannelCategoryWhiteBlackRolesTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:e.serverRole}]},qchatGetChannelCategoryWhiteBlackMembers:{sid:24,cid:118,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackMembersTag",reflectMapper:AC.qchatGetChannelCategoryWhiteBlackMembersTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:e.memberInfo}]},qchatGetChannelCategoriesPage:{sid:24,cid:119,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoriesPageTag",reflectMapper:AC.qchatGetChannelCategoriesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.QChatChannelCategoryInfo}]},qchatGetChannelCategoryChannelsPage:{sid:24,cid:120,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryChannelsPageTag",reflectMapper:AC.qchatGetChannelCategoryChannelsPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.channelInfo}]},qchatSubscribe:{sid:24,cid:15,service:"qchatChannel",params:[{type:"Property",name:"qchatSubReqTag",reflectMapper:AC.qchatSubReqTag},{type:"PropertyArray",name:"channels",reflectMapper:AC.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:e.unreadInfo},{type:"PropertyArray",name:"failedChannels",reflectMapper:e.qchatChannelIdInfoTag}]},qchatAutoSubscribe:{sid:25,cid:12,service:"qchatChannel",hasPacketTimer:!1,params:[{type:"Property",name:"qchatAutoSubReqTag"}],response:[{type:"Property",name:"qchatAutoSubInfo",reflectMapper:{1:"time"}}]},qchatAutoSubscribeNotification:{service:"qchatChannel",sid:25,cid:13,response:[{type:"PropertyArray",name:"serverIds",reflectMapper:e.unreadInfo},{type:"PropertyArray",name:"unreadInfos",reflectMapper:e.unreadInfo}]},qchatGetUnreadInfo:{sid:24,cid:27,service:"qchatChannel",params:[{type:"PropertyArray",name:"channels",reflectMapper:AC.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:e.unreadInfo}]},qchatGetChannelSearchByPage:{sid:24,cid:93,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelSearchByPageTag",reflectMapper:AC.qchatGetChannelSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag",3:"cursor"}},{type:"PropertyArray",name:"datas",reflectMapper:e.channelInfo}]},qchatGetRoleIdsByServerId:{sid:25,cid:8,service:"qchatChannel",params:[{type:"Property",name:"qchatGetRoleIdsByServerIdTag",reflectMapper:{serverIdTimeTags:1}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:e.serverRoles},{type:"String",name:"failServerIds"}]},qchatChannelMemberSearch:{sid:24,cid:95,service:"qchatChannel",params:[{type:"Property",name:"qchatChannelMemberSearchTag",reflectMapper:AC.qchatChannelMemberSearchTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:e.qchatChannelMemberInfo}]},qchatSubscribeAsVisitor:{sid:25,cid:9,service:"qchatChannel",params:[{type:"Property",name:"tag",reflectMapper:AC.qchatSubReqTag},{type:"PropertyArray",name:"datas",reflectMapper:AC.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"failedArr",reflectMapper:e.qchatChannelIdInfoTag}]}}};!function(e){e[e.reorderWeight=0]="reorderWeight",e[e.createTime=1]="createTime"}(MC||(MC={})),function(e){e[e.white=1]="white",e[e.black=2]="black"}(IC||(IC={})),function(e){e[e.add=1]="add",e[e.remove=2]="remove"}(SC||(SC={})),function(e){e[e.message=0]="message",e[e.media=1]="media",e[e.ext=100]="ext"}(TC||(TC={})),function(e){e[e.ASC=1]="ASC",e[e.DESC=2]="DESC"}(bC||(bC={})),function(e){e[e.reorderWeight=0]="reorderWeight",e[e.createTime=1]="createTime",e[e.totalMember=2]="totalMember"}(CC||(CC={})),function(e){e[e.square=1]="square",e[e.person=2]="person"}(_C||(_C={}));var OC={channelId:{type:"string"},serverId:{type:"string"},name:{type:"string"},topic:{type:"string"},ext:{type:"string"},type:{type:"enum",values:TC},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},viewMode:{type:"number"},categoryId:{type:"string"},syncMode:{type:"number"},visitorMode:{type:"number"},reorderWeight:{type:"string"}},PC={serverId:{type:"string"},channelId:{type:"string"},ackTimestamp:{type:"number"},unreadCount:{type:"number"},mentionedCount:{type:"number"},maxCount:{type:"number"},lastMsgTime:{type:"number"}},LC={serverId:{type:"string"},channelId:{type:"string"},type:{type:"enum",values:IC},opeType:{type:"enum",values:SC},toAccids:{type:"object"}},VC={serverId:{type:"string"},channelId:{type:"string"},type:{type:"enum",values:IC},opeType:{type:"enum",values:SC},roleId:{type:"string"}},UC={categoryId:{type:"string"},serverId:{type:"string"},name:{type:"string"},ext:{type:"string"},owner:{type:"string"},viewMode:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},channelNumber:{type:"number"}},DC={serverId:{type:"string"},channelId:{type:"string"},accid:{type:"string"},avatar:{type:"string"},nick:{type:"string"},createTime:{type:"number"},updateTime:{type:"number"}};function qC(e){return Ph(VC,e)}function BC(e){return Ph(OC,e)}function FC(e){return Ei(e)&&e.length>0?du(e).call(e,(function(e){return BC(e)})):[]}function GC(e){return Ph(PC,e)}function jC(e){return Ei(e)&&e.length>0?du(e).call(e,(function(e){return GC(e)})):[]}function HC(e){return Ph(UC,e)}function WC(e){return Ei(e)&&e.length>0?du(e).call(e,(function(e){return HC(e)})):[]}function KC(e){return Ei(e)&&e.length>0?du(e).call(e,(function(e){return function(e){return Ph(DC,e)}(e)})):[]}function YC(e){try{return JSON.parse(e)}catch(e){return[]}}var QC={serverId:{type:"string"},name:{type:"string"},icon:{type:"string"},ext:{type:"string"},owner:{type:"string"},memberNumber:{type:"number"},inviteMode:{type:"number"},applyMode:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},channelNumber:{type:"number"},categoryNumber:{type:"number"},searchType:{type:"number"},searchEnable:{type:"boolean"},reorderWeight:{type:"string"}},JC={serverId:{type:"string"},uid:{type:"string"},accid:{type:"string"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},type:{type:"number"},joinTime:{type:"number"},inviter:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}},zC={serverId:{type:"string"},appid:{type:"string"},accid:{type:"string"},ext:{type:"string"},banTime:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}};function XC(e){return Ph(QC,e)}function $C(e){return Ei(e)&&e.length>0?du(e).call(e,(function(e){return XC(e)})):[]}function ZC(e){return Ph(JC,e)}function e_(e){return Ei(e)&&e.length>0?du(e).call(e,(function(e){return ZC(e)})):[]}function t_(e){return Ei(e)&&e.length>0?du(e).call(e,(function(e){return function(e){return Ph(zC,e)}(e)})):[]}function r_(e){var t,r,n;if(!e.antispamTag)return{};var i=dr({},e.antispamTag);return(null===(t=e.antispamTag)||void 0===t?void 0:t.antiSpamBusinessId)&&"string"!=typeof(null===(r=e.antispamTag)||void 0===r?void 0:r.antiSpamBusinessId)&&(i.antiSpamBusinessId=_i(null===(n=e.antispamTag)||void 0===n?void 0:n.antiSpamBusinessId)),i}var n_={accid:{type:"string"},type:{type:"number"},serverId:{type:"string"},status:{type:"number"},requestId:{type:"string"},createTime:{type:"number"},updateTime:{type:"number"},expireTime:{type:"number"},data:{type:"object"}};function i_(e){return Ph(n_,e)}function o_(e){return Ei(e)&&e.length>0?du(e).call(e,(function(e){return i_(e)})):[]}var a_,s_,c_,u_,d_={successServerIds:{type:"object"},failServerIds:{type:"object"},ackTimestamp:{type:"number"}};function l_(e){return Ph(d_,e)}!function(e){e[e.everyone=1]="everyone",e[e.custom=2]="custom"}(a_||(a_={})),function(e){e[e.normal=0]="normal",e[e.owner=1]="owner"}(s_||(s_={})),function(e){e[e.ignore=0]="ignore",e[e.deny=-1]="deny",e[e.allow=1]="allow"}(c_||(c_={})),function(e){e[e.manageServer=1]="manageServer",e[e.manageChannel=2]="manageChannel",e[e.manageRole=3]="manageRole",e[e.sendMsg=4]="sendMsg",e[e.accountInfoSelf=5]="accountInfoSelf",e[e.inviteServer=6]="inviteServer",e[e.kickServer=7]="kickServer",e[e.accountInfoOther=8]="accountInfoOther",e[e.recallMsg=9]="recallMsg",e[e.deleteMsg=10]="deleteMsg",e[e.remindOther=11]="remindOther",e[e.remindEveryone=12]="remindEveryone",e[e.manageBlackWhiteList=13]="manageBlackWhiteList",e[e.banServerMember=14]="banServerMember",e[e.RTCChannelConnect=15]="RTCChannelConnect",e[e.RTCChannelDisconnectOther=16]="RTCChannelDisconnectOther",e[e.RTCChannelOpenMicrophone=17]="RTCChannelOpenMicrophone",e[e.RTCChannelOpenCamera=18]="RTCChannelOpenCamera",e[e.RTCChannelOpenCloseOtherMicrophone=19]="RTCChannelOpenCloseOtherMicrophone",e[e.RTCChannelOpenCloseOtherCamera=20]="RTCChannelOpenCloseOtherCamera",e[e.RTCChannelOpenCloseEveryoneMicrophone=21]="RTCChannelOpenCloseEveryoneMicrophone",e[e.RTCChannelOpenCloseEveryoneCamera=22]="RTCChannelOpenCloseEveryoneCamera",e[e.RTCChannelOpenShareScreen=23]="RTCChannelOpenShareScreen",e[e.RTCChannelCloseOtherShareScreen=24]="RTCChannelCloseOtherShareScreen",e[e.manageInviteApply=25]="manageInviteApply",e[e.manageInviteApplyHistory=26]="manageInviteApplyHistory",e[e.mentionedRole=27]="mentionedRole"}(u_||(u_={}));var p_,m_,h_,f_,g_,v_,y_,M_,I_={type:{type:"enum",values:a_},memberType:{type:"enum",values:s_},createTime:{type:"number"},updateTime:{type:"number"},priority:{type:"number"},memberCount:{type:"number"},joinTime:{type:"number"}},S_={roleId:{type:"string"},categoryId:{type:"string"},serverId:{type:"string"},type:{type:"enum",values:a_},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},name:{type:"string"},icon:{type:"string"},ext:{type:"string"}},T_={id:{type:"string"},accid:{type:"string"},categoryId:{type:"string"},serverId:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},memberType:{type:"enum",values:s_},joinTime:{type:"number"},inviter:{type:"string"}};function b_(e){var t=dr({},e),r=Uh(I_,t);return r.auths&&(r.auths=function(e){var t,r=Ml(t=fr(e)).call(t,(function(t,r){var n=u_[r];return n?t[n]=c_[e[r]]:t[r]=c_[e[r]],t}),{});return _i(r)}(r.auths)),r}function C_(e){var t;return Ml(t=fr(e)).call(t,(function(t,r){var n=Rp(u_,r);return n?t[n]=c_[e[r]]:t[$p(r)]=c_[e[r]],t}),{})}function __(e){var t=Ph(I_,e);return e.auths&&(t.auths=C_(JSON.parse(t.auths))),t.isMember&&delete t.isMember,t}function E_(e){return Ei(e)&&e.length>0?du(e).call(e,(function(e){return __(e)})):[]}function w_(e){return e.auths&&(e.auths=C_(JSON.parse(e.auths))),Ph(S_,e)}function R_(e){return e.auths&&(e.auths=C_(JSON.parse(e.auths))),Ph(T_,e)}function k_(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}!function(e){e[e.default=1]="default",e[e.sync=2]="sync"}(p_||(p_={})),function(e){e[e.sendTime=1]="sendTime"}(m_||(m_={})),function(e){e[e.text=0]="text",e[e.image=1]="image",e[e.audio=2]="audio",e[e.video=3]="video",e[e.geo=4]="geo",e[e.notification=5]="notification",e[e.file=6]="file",e[e.tip=10]="tip",e[e.robot=11]="robot",e[e.g2=12]="g2",e[e.custom=100]="custom"}(h_||(h_={})),function(e){e[e.sending=1]="sending",e[e.success=2]="success",e[e.failed=3]="failed"}(f_||(f_={})),function(e){e[e.notifyAll=1]="notifyAll",e[e.notifySubscribe=2]="notifySubscribe"}(g_||(g_={})),function(e){e[e.unknown=0]="unknown",e[e.server=1]="server",e[e.channel=2]="channel",e[e.serverAccids=3]="serverAccids",e[e.channelAccids=4]="channelAccids",e[e.accids=5]="accids"}(v_||(v_={})),function(e){e[e.serverMemberInvite=1]="serverMemberInvite",e[e.serverMemberInviteReject=2]="serverMemberInviteReject",e[e.serverMemberApply=3]="serverMemberApply",e[e.serverMemberApplyReject=4]="serverMemberApplyReject",e[e.serverCreate=5]="serverCreate",e[e.serverRemove=6]="serverRemove",e[e.serverUpdate=7]="serverUpdate",e[e.serverMemberInviteDone=8]="serverMemberInviteDone",e[e.serverMemberInviteAccept=9]="serverMemberInviteAccept",e[e.serverMemberApplyDone=10]="serverMemberApplyDone",e[e.serverMemberApplyAccept=11]="serverMemberApplyAccept",e[e.serverMemberKick=12]="serverMemberKick",e[e.serverMemberLeave=13]="serverMemberLeave",e[e.serverMemberUpdate=14]="serverMemberUpdate",e[e.channelCreate=15]="channelCreate",e[e.channelRemove=16]="channelRemove",e[e.channelUpdate=17]="channelUpdate",e[e.channelUpdateWhiteBlackIdentify=18]="channelUpdateWhiteBlackIdentify",e[e.channelUpdateWhiteBlackIdentifyUser=19]="channelUpdateWhiteBlackIdentifyUser",e[e.updateQuickComment=20]="updateQuickComment",e[e.channelCategoryCreate=21]="channelCategoryCreate",e[e.channelCategoryRemove=22]="channelCategoryRemove",e[e.channelCategoryUpdate=23]="channelCategoryUpdate",e[e.channelCategoryUpdateWhiteBlackIdentify=24]="channelCategoryUpdateWhiteBlackIdentify",e[e.channelCategoryUpdateWhiteBlackIdentifyUser=25]="channelCategoryUpdateWhiteBlackIdentifyUser",e[e.serverIdentifyAdd=26]="serverIdentifyAdd",e[e.serverIdentifyRemove=27]="serverIdentifyRemove",e[e.serverIdentifyUpdate=28]="serverIdentifyUpdate",e[e.channelIdentifyUpdate=29]="channelIdentifyUpdate",e[e.userIdentifyUpdate=30]="userIdentifyUpdate",e[e.channelVisibilityUpdate=31]="channelVisibilityUpdate",e[e.serverEnterLeave=32]="serverEnterLeave",e[e.serverMemberJoinByInviteCode=33]="serverMemberJoinByInviteCode",e[e.channelVisibilityToVisitorUpdate=34]="channelVisibilityToVisitorUpdate",e[e.myMemberInfoUpdated=35]="myMemberInfoUpdated",e[e.custom=100]="custom",e[e.msgTyping=101]="msgTyping"}(y_||(y_={})),function(e){e[e.reply=1]="reply",e[e.thread=2]="thread",e[e.all=3]="all"}(M_||(M_={}));var A_,N_=Math.max,x_=Math.min;function O_(e,t,r){var n,i,o,a,s,c,u=0,d=!1,l=!1,p=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function m(t){var r=n,o=i;return n=i=void 0,u=t,a=e.apply(o,r)}function h(e){return u=e,s=qs(g,t),d?m(e):a}function f(e){var r=e-c;return void 0===c||r>=t||r<0||l&&e-u>=o}function g(){var e=_s();if(f(e))return v(e);s=qs(g,function(e){var r=t-(e-c);return l?x_(r,o-(e-u)):r}(e))}function v(e){return s=void 0,p&&n?m(e):(n=i=void 0,a)}function y(){var e=_s(),r=f(e);if(n=arguments,i=this,c=e,r){if(void 0===s)return h(c);if(l)return clearTimeout(s),s=qs(g,t),m(c)}return void 0===s&&(s=qs(g,t)),a}return t=Number(t)||0,k_(r)&&(d=!!r.leading,o=(l="maxWait"in r)?N_(Number(r.maxWait)||0,t):o,p="trailing"in r?!!r.trailing:p),y.cancel=function(){void 0!==s&&clearTimeout(s),u=0,n=c=i=s=void 0},y.flush=function(){return void 0===s?a:v(_s())},y}function P_(e,t,r){var n=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return k_(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),O_(e,t,{leading:n,maxWait:t,trailing:i})}!function(e){e[e.sub=1]="sub",e[e.unSub=2]="unSub"}(A_||(A_={}));var L_=function(){function e(e){var t=this;this.unreadCount={},this.manualSubscribeUnreadMap={},this.manualSubscribeServerMap={},this.manualSubscribeTypingMap={},this.unreadServerCount={},this.serverRoleIdsMap={},this.autoSubscribeUnreadMap={},this.autoSubscribeServerMap={},this._serverUnreadInfo=P_((function(e){t.core.emit("serverUnreadInfo",t.getServerUnreadInfo(e)),Zp(t.core,"qchatServer.emit")&&t.core.qchatServer.emit("serverUnreadInfo",t.getServerUnreadInfo(e))}),100),this.core=e}var t=e.prototype;return t.changeCacheServerRoleIds=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a,s,c,u=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.attach.serverIdentifyInfo,i=n.serverId,o=n.roleId,this.serverRoleIdsMap[i]){t.next=4;break}return t.next=4,this.getRoleIdsByServerId([i]);case 4:if(a=this.serverRoleIdsMap[i],!(e.time<a.timeTag)){t.next=7;break}return t.abrupt("return");case 7:if(e.type===y_[y_.serverIdentifyAdd]?a.roleIds.add(o):a.roleIds.delete(o),this.core.logger.debug("QChatChannel::qchatChannel/serverIdentifyChange::now "+i+" roleIds is",xs(r=[]).call(r,a.roleIds)),s=this.unreadServerCount[i]){t.next=12;break}return t.abrupt("return");case 12:c=NT(fr(s),100),jn(c).call(c,(function(e){u.core.qchatChannel.getChannelUnreadInfos({channels:du(e).call(e,(function(e){return{serverId:i,channelId:e}}))})}));case 14:case"end":return t.stop()}}),t,this)})))},t.getRoleIdsByServerId=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n=fu(e).call(e,(function(e){return!a.serverRoleIdsMap[e]}))).length){t.next=3;break}return t.abrupt("return");case 3:return i={serverIdTimeTags:n},t.next=6,this.core.sendCmd("qchatGetRoleIdsByServerId",{qchatGetRoleIdsByServerIdTag:i});case 6:o=t.sent,this.core.logger.debug("QChatChannel:: getRoleIdsByServerId, params is ",i,"result is",o),jn(r=o.content.serverRoles).call(r,(function(e){try{e.roleIds=JSON.parse(e.roleIds)}catch(e){a.core.logger.error("QChatChannel:: getRoleIdsByServerId JSON parse roleIds error",e)}a.serverRoleIdsMap[e.serverId]={roleIds:new pI(e.roleIds),timeTag:e.timeTag}}));case 9:case"end":return t.stop()}}),t,this)})))},t._unSubscribeChannel=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o,a,s;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e+"_"+t,i=[],this.manualSubscribeUnreadMap[n]?i.push(this.manualSubscribeUnreadMap[n]):this.autoSubscribeUnreadMap[n]&&i.push(this.autoSubscribeUnreadMap[n]),this.manualSubscribeTypingMap[n]&&i.push(this.manualSubscribeTypingMap[n]),0!==i.length){r.next=6;break}return r.abrupt("return");case 6:for(o=0,a=i;o<a.length;o++)s=a[o],this.subscribe({opeType:A_.unSub,type:s,channels:[{serverId:e,channelId:t}]});this.manualSubscribeUnreadMap[n]?this.manualSubscribeUnreadMap[n]=void 0:this.autoSubscribeUnreadMap[n]&&(this.autoSubscribeUnreadMap[n]=void 0),this.manualSubscribeTypingMap[n]&&(this.manualSubscribeTypingMap[n]=void 0);case 9:case"end":return r.stop()}}),r,this)})))},t._unSubscribeServer=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e,n=this.manualSubscribeServerMap[r]||this.autoSubscribeServerMap[r]){t.next=4;break}return t.abrupt("return");case 4:this.subscribe({opeType:A_.unSub,type:n,channels:[{serverId:e,channelId:""}]}),this.manualSubscribeServerMap[r]?this.manualSubscribeServerMap[r]=void 0:this.autoSubscribeServerMap[r]&&(this.autoSubscribeServerMap[r]=void 0);case 6:case"end":return t.stop()}}),t,this)})))},t.subscribe=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({type:{type:"number",min:1,max:5},opeType:{type:"number",min:1,max:2}},e),t.next=3,this.core.sendCmd("qchatSubscribe",{qchatSubReqTag:{type:e.type,opeType:e.opeType},channels:e.channels});case 3:return n=t.sent,i=new pI,jn(r=e.channels).call(r,(function(e){return zl(a,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.serverRoleIdsMap[e.serverId]||i.add(e.serverId);case 1:case"end":return t.stop()}}),t,this)})))})),o=NT(Bl(i),10),jn(o).call(o,(function(e){a.getRoleIdsByServerId(e)})),t.abrupt("return",n.content);case 9:case"end":return t.stop()}}),t,this)})))},t.autoSubscribe=function(){return zl(this,void 0,void 0,Ql.mark((function e(){return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.sendCmd("qchatAutoSubscribe",{qchatAutoSubReqTag:{}});case 2:case"end":return e.stop()}}),e,this)})))},t.resumeSubscribe=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a,s,c,u=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.serverRoleIdsMap={},a=100,e){t.next=6;break}return this.unreadServerCount={},this.unreadCount={},t.abrupt("return");case 6:return s={},jn(r=fr(this.manualSubscribeUnreadMap)).call(r,(function(e){var t=u.manualSubscribeUnreadMap[e];if(t){var r=e.split("_"),n={serverId:r[0],channelId:r[1]};s[t]=s[t]||[],s[t].push(n)}})),s[5]=[],jn(n=fr(this.manualSubscribeTypingMap)).call(n,(function(e){return zl(u,void 0,void 0,Ql.mark((function t(){var r,n,i,o;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.manualSubscribeTypingMap[e]&&(r=e.split("_"),n=r[0],i=r[1],o={serverId:n,channelId:i},s[5].push(o));case 2:case"end":return t.stop()}}),t,this)})))})),s[4]=[],jn(i=fr(this.manualSubscribeServerMap)).call(i,(function(e){return zl(u,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.manualSubscribeServerMap[e]&&(r={serverId:e},s[4].push(r));case 2:case"end":return t.stop()}}),t,this)})))})),c=[],jn(o=fr(s)).call(o,(function(e){var t=s[e];if(t&&0===t.length)return fs.resolve();if(t.length>a){var r=NT(t,100);return jn(r).call(r,(function(t){c.push(u.createSubscribePromise(t,e))}))}c.push(u.createSubscribePromise(t,e))})),t.next=16,fs.all(c);case 16:case"end":return t.stop()}}),t,this)})))},t.createSubscribePromise=function(e,t){var r=this,n={type:$p(t),opeType:1,channels:e};return this.core.logger.debug("qchatChannel:: autoSubscribeUnread params",n),this.subscribe(n).then((function(e){var t=e.unreadInfos;t&&t.length>0&&(t=jC(t),r.updateUnreads(t))})).catch((function(e){r.core.logger.error("qchatChannel:: autoSubscribeUnread error ",e)}))},t.cacheSubscribe=function(e){var t,r=this;jn(t=e.channels).call(t,(function(t){var n=t.channelId?t.serverId+"_"+t.channelId:""+t.serverId,i=5===e.type?r.manualSubscribeTypingMap:4===e.type?r.manualSubscribeServerMap:r.manualSubscribeUnreadMap;e.opeType===A_.sub?i[n]=e.type:e.opeType===A_.unSub&&(i[n]=void 0)}))},t.cacheAutoSubscribe=function(e){var t,r=this;jn(t=e.channels).call(t,(function(t){var n=t.channelId?t.serverId+"_"+t.channelId:""+t.serverId,i=4===e.type?r.autoSubscribeServerMap:r.autoSubscribeUnreadMap;e.opeType===A_.sub?i[n]=e.type:e.opeType===A_.unSub&&(i[n]=void 0)}))},t.cacheUnreadCount=function(e){var t=this;jn(e).call(e,(function(e){var r=e.serverId+"_"+e.channelId;t.unreadCount[r]=dr({},e),t.unreadServerCount[e.serverId]||(t.unreadServerCount[e.serverId]={}),t.unreadServerCount[e.serverId][e.channelId]=!0}))},t.getServerUnreadInfo=function(e){var t,r=this,n={serverId:e,unreadCount:0,mentionedCount:0,maxCount:0},i=this.unreadServerCount[e];return i&&(jn(t=fr(i)).call(t,(function(t){var i=e+"_"+t,o=r.unreadCount[i];n.unreadCount+=o.unreadCount,n.mentionedCount+=o.mentionedCount,void 0!==o.maxCount&&(n.maxCount=o.maxCount)})),n.unreadCount=n.unreadCount>n.maxCount?n.maxCount:n.unreadCount,n.mentionedCount=n.mentionedCount>n.maxCount?n.maxCount:n.mentionedCount),n},t.getUnreadInfo=function(e){Pl({serverId:{type:"string"},channelId:{type:"string"}},e);var t=e.serverId+"_"+e.channelId;return this.unreadCount[t]?this.unreadCount[t]:null},t.shouldChangeUnread=function(e,t){if(!e.serverId||!e.channelId)return!1;if(this.core.qchatChannel.subscribeForVisitorService.isInSubscribeChannels(e.serverId,e.channelId))return!1;if(!1===e.historyEnable)return!1;if(!1===e.needBadge)return!1;if(e.fromAccount===this.core.account)return!1;if(t&&2!==(null==e?void 0:e.status))return!1;if(e.notifyReason&&e.notifyReason===Rp(g_,g_.notifySubscribe)){if(!e.serverId||!e.channelId)return!1;var r=this.getUnreadInfo({serverId:e.serverId,channelId:e.channelId}),n=t?"ackTimestamp":"lastMsgTime";if(!r)return!1;if(e.time&&r[n]&&r[n]>e.time)return!1}return!0},t.shouldChangeMentionedUnread=function(e,t){return void 0===t&&(t=!1),zl(this,void 0,void 0,Ql.mark((function r(){var n,i;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!e.accidsOfMentionedRoles||!ou(n=e.accidsOfMentionedRoles).call(n,this.core.account)){r.next=2;break}return r.abrupt("return",!0);case 2:if(!e.mentionRoleIds||!e.serverId){r.next=16;break}if(this.serverRoleIdsMap[e.serverId]){r.next=9;break}if(t){r.next=7;break}return this.handledRoleMsg(e),r.abrupt("return",!1);case 7:return r.next=9,this.getRoleIdsByServerId([e.serverId]);case 9:i=0;case 10:if(!(i<e.mentionRoleIds.length)){r.next=16;break}if(!this.serverRoleIdsMap[e.serverId].roleIds.has(e.mentionRoleIds[i])){r.next=13;break}return r.abrupt("return",!0);case 13:i++,r.next=10;break;case 16:return r.abrupt("return",!1);case 17:case"end":return r.stop()}}),r,this)})))},t.handledRoleMsg=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a,s=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.mentionRoleIds){t.next=2;break}return t.abrupt("return");case 2:if(this.serverRoleIdsMap[e.serverId]){t.next=5;break}return t.next=5,this.getRoleIdsByServerId([e.serverId]);case 5:if(this.serverRoleIdsMap[e.serverId]){t.next=8;break}return this.core.logger.warn("QChatChannel::handledRoleMsg::can not get serverRoleIds,server id",e.serverId),t.abrupt("return");case 8:if(n=!1,jn(r=e.mentionRoleIds).call(r,(function(t){s.serverRoleIdsMap[e.serverId].roleIds.has(t)&&(n=!0,s.core.logger.debug("QChatChannel::handledRoleMsg::will update message mentionedCount，message is ",e))})),n){t.next=12;break}return t.abrupt("return");case 12:if(i=this.unreadCount[e.serverId+"_"+e.channelId],o=2===(null==e?void 0:e.status),i.mentionedCount=o?i.mentionedCount?i.mentionedCount-1:0:i.mentionedCount?i.mentionedCount+1:1,"number"!=typeof i.maxCount){t.next=25;break}if(!((a=(a=i.mentionedCount)>i.maxCount?i.maxCount:a)>i.maxCount)){t.next=21;break}return this.core.logger.debug("QChatChannel::handledRoleMsg::tempUnreadCount more than maxCount"),t.abrupt("return");case 21:this.core.emit("unreadInfo",dr(dr({},i),{mentionedCount:a})),this.core.emit("unreadInfos",[dr(dr({},i),{mentionedCount:a})]),this.core.qchatChannel.emit("unreadInfos",[dr(dr({},i),{mentionedCount:a})]),this._serverUnreadInfo(e.serverId);case 25:case"end":return t.stop()}}),t,this)})))},t.getMentionedFlag=function(e,t){return void 0===t&&(t=!1),zl(this,void 0,void 0,Ql.mark((function r(){var n;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!e.mentionAll){r.next=4;break}return r.abrupt("return",!0);case 4:if(!e.mentionRoleIds&&!e.accidsOfMentionedRoles){r.next=10;break}return r.next=7,this.shouldChangeMentionedUnread(e,t);case 7:return r.abrupt("return",r.sent);case 10:if(!e.mentionAccids||!ou(n=e.mentionAccids).call(n,this.core.account)){r.next=12;break}return r.abrupt("return",!0);case 12:return r.abrupt("return",!1);case 13:case"end":return r.stop()}}),r,this)})))},t.changeUnread=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o,a,s,c,u;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=e.serverId,i=e.channelId,o=n+"_"+i,this.shouldChangeUnread(e,t)){r.next=6;break}return this.core.logger.debug("changeUnread: "+o+" does not need to update unreadInfo"),r.abrupt("return");case 6:if(this.unreadCount[o]){r.next=11;break}return r.next=9,this.core.qchatChannel.getChannelUnreadInfos({channels:[{serverId:n,channelId:i}]});case 9:return!this.serverRoleIdsMap[n]&&e.mentionRoleIds&&this.getRoleIdsByServerId([n]),r.abrupt("return");case 11:return a=this.unreadCount[o],s=2===(null==e?void 0:e.status),r.next=15,this.getMentionedFlag(e);case 15:if(c=r.sent,s?(a.unreadCount=a.unreadCount?a.unreadCount-1:0,c&&(a.mentionedCount=a.mentionedCount?a.mentionedCount-1:0),delete a.lastMsgTime,this.core.logger.debug("changeUnread: "+o+" unread reduce ",a)):(a.unreadCount=a.unreadCount?a.unreadCount+1:1,c&&(a.mentionedCount=a.mentionedCount?a.mentionedCount+1:1),e.time&&(a.lastMsgTime=e.time),this.core.logger.debug("changeUnread: "+o+" unread add ",a)),u="number"==typeof a.maxCount?a.maxCount:100,!(a.unreadCount>u)){r.next=21;break}return this.core.logger.debug("QChatChannel::subscribe::tempUnreadCount more than maxCount"),r.abrupt("return");case 21:this.core.logger.warn("unreadInfo event will abandon,please use unreadInfos"),this.core.emit("unreadInfo",dr(dr({},a),{mentionedCount:a.mentionedCount>u?u:a.mentionedCount,unreadCount:a.unreadCount>u?u:a.unreadCount})),this.core.emit("unreadInfos",[dr(dr({},a),{mentionedCount:a.mentionedCount>u?u:a.mentionedCount,unreadCount:a.unreadCount>u?u:a.unreadCount})]),this.core.qchatChannel.emit("unreadInfos",[dr(dr({},a),{mentionedCount:a.mentionedCount>u?u:a.mentionedCount,unreadCount:a.unreadCount>u?u:a.unreadCount})]),this._serverUnreadInfo(n);case 26:case"end":return r.stop()}}),r,this)})))},t.updateUnreads=function(e){var t,r,n=this;if(e&&e.length>0){var i=[],o=[],a=du(t=fu(e).call(e,(function(e){var t=e.serverId+"_"+e.channelId,r=n.unreadCount[t],i=Zp(r,"ackTimestamp"),o=Zp(e,"ackTimestamp");return!(i&&o&&o<i||Zp(r,"unreadCount")===Zp(e,"unreadCount")&&Zp(r,"mentionedCount")===Zp(e,"mentionedCount"))}))).call(t,(function(e){i.push(n.getServerUnreadInfo(e.serverId)),o.push(n.unreadServerCount[e.serverId]);var t=e.serverId,r=e.channelId,a=t+"_"+r;return n.core.logger.debug("qchat channel updateUnread: ",e),n.unreadCount[a]=dr({},e),n.unreadServerCount[t]||(n.unreadServerCount[t]={}),n.unreadServerCount[t][r]=!0,e}));if(0!==a.length){this.core.emit("unreadInfos",a),this.core.qchatChannel.emit("unreadInfos",a);var s={};jn(a).call(a,(function(e,t){n.core.emit("unreadInfo",e);var r=i[t],a=o[t],c=n.getServerUnreadInfo(e.serverId),u=n.unreadServerCount[e.serverId],d=r.unreadCount!==c.unreadCount,l=!a||0===fr(a).length,p=u&&fr(u).length>0,m=r.mentionedCount!==c.mentionedCount;(d||m||l&&p)&&(s[e.serverId]=!0)})),jn(r=fr(s)).call(r,(function(e){n.core.emit("serverUnreadInfo",n.getServerUnreadInfo(e)),Zp(n.core,"qchatServer.emit")&&n.core.qchatServer.emit("serverUnreadInfo",n.getServerUnreadInfo(e))}))}}},t.clearUnreadCountByServers=function(e,t){var r=this,n=[];jn(e).call(e,(function(e){var t;r.unreadServerCount[e]&&jn(t=fr(r.unreadServerCount[e])).call(t,(function(t){n.push(e+"_"+t)}))}));var i=[];jn(n).call(n,(function(e){i.push(dr(dr({},r.unreadCount[e]),{unreadCount:0,mentionedCount:0,ackTimestamp:t}))})),this.updateUnreads(i)},e}(),V_=function(){function e(e){this.limitForBatchEnter=10,this.limitForBatchSubscribe=100,this.autoServers=new pI,this.autoVisitorSubscribeServer=new pI,this.autoVisitorSubscribeChannel=new pI,this.core=e}var t=e.prototype;return t.subscribeChannelAsVisitor=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatSubscribeAsVisitor",{tag:{type:e.type||6,opeType:e.opeType},datas:e.channels});case 2:return n=t.sent,i=n.content.failedArr,o=fu(r=e.channels).call(r,(function(e){return!Gm(i).call(i,(function(t){return t.channelId===e.channelId&&t.serverId===e.serverId}))})),jn(o).call(o,(function(t){1===e.opeType?a.autoVisitorSubscribeChannel.add(t.serverId+"&"+t.channelId):a.autoVisitorSubscribeChannel.delete(t.serverId+"&"+t.channelId)})),t.abrupt("return",{failedChannels:i});case 7:case"end":return t.stop()}}),t,this)})))},t.subscribeServerAsVisitor=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a,s,c=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatSubscribeAsVisitor",{tag:{type:e.type||7,opeType:e.opeType},datas:du(r=e.serverIds).call(r,(function(e){return{serverId:e}}))});case 2:return o=t.sent,a=o.content.failedArr,s=fu(n=e.serverIds).call(n,(function(e){return!Gm(a).call(a,(function(t){return t.serverId===e}))})),jn(s).call(s,(function(t){1===e.opeType?c.autoVisitorSubscribeServer.add(t):c.autoVisitorSubscribeServer.delete(t)})),t.abrupt("return",{failedServers:du(i=o.content.failedArr).call(i,(function(e){return e.serverId}))});case 7:case"end":return t.stop()}}),t,this)})))},t.deleteServer=function(e){var t;this.autoServers.delete(e),this.autoVisitorSubscribeServer.has(e)&&this.subscribeServerAsVisitor({opeType:2,serverIds:[e]});var r=[];jn(t=this.autoVisitorSubscribeChannel).call(t,(function(t){if(0===wu(t).call(t,e)){var n=t.replace(e+"&","");r.push({serverId:e,channelId:n})}})),r.length>0&&this.subscribeChannelAsVisitor({opeType:2,channels:r})},t.deleteAutoSetInServerId=function(e){var t,r=this;this.autoServers.delete(e),this.autoVisitorSubscribeServer.delete(e),jn(t=this.autoVisitorSubscribeChannel).call(t,(function(t){0===wu(t).call(t,e)&&r.autoVisitorSubscribeChannel.delete(t)}))},t.deleteAutoSetInChannel=function(e,t){this.autoVisitorSubscribeChannel.delete(e+"&"+t)},t.unSubscribeChannel=function(e,t){this.subscribeChannelAsVisitor({opeType:2,channels:[{serverId:e,channelId:t}]})},t.isInSubscribeChannels=function(e,t){return this.autoVisitorSubscribeChannel.has(e+"&"+t)},t.isInAutoServers=function(e){return this.autoServers.has(e)},t.doAutoSubscribe=function(){var e=this,t=[],r=NT(Bl(this.autoVisitorSubscribeServer),this.limitForBatchSubscribe);jn(r).call(r,(function(r){t.push(e.subscribeServerAsVisitor({opeType:1,serverIds:r}))}));var n=NT(Bl(this.autoVisitorSubscribeChannel),this.limitForBatchSubscribe);return jn(n).call(n,(function(r){t.push(e.subscribeChannelAsVisitor({opeType:1,channels:du(r).call(r,(function(e){var t=wu(e).call(e,"&");return{serverId:Wc(e).call(e,0,t),channelId:Wc(e).call(e,t+1)}}))}))})),fs.all(t)},t.doAutoEnterServer=function(){return zl(this,void 0,void 0,Ql.mark((function e(){var t,r,n,i=this;return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=NT(Bl(this.autoServers),this.limitForBatchEnter),r=[],jn(t).call(t,(function(e){r.push(i.core.qchatServer.enterAsVisitor({serverIds:e}))})),e.next=5,fs.all(r);case 5:n=e.sent,jn(n).call(n,(function(e){var t;jn(t=e.failedServers).call(t,(function(e){i.deleteAutoSetInServerId(e)}))}));case 7:case"end":return e.stop()}}),e,this)})))},t.resumeSubscribe=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=7;break}return t.next=3,this.doAutoEnterServer();case 3:return t.next=5,this.doAutoSubscribe();case 5:t.next=10;break;case 7:this.autoServers.clear(),this.autoVisitorSubscribeChannel.clear(),this.autoVisitorSubscribeServer.clear();case 10:case"end":return t.stop()}}),t,this)})))},t.cacheServer=function(e){var t=this;jn(e).call(e,(function(e){return t.autoServers.add(e)}))},e}();function U_(e,t){var r,n=void 0!==Nc&&Fl(e)||e["@@iterator"];if(n)return tr(r=(n=n.call(e)).next).call(r,n);if(Ei(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return D_(e,t);var n=Wc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Bl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?D_(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function D_(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var q_=function(e){function t(t,r){var n;return(n=e.call(this,"qchatChannel",t)||this).config={autoSubscribe:!1},n.core=t,Mh({cmdMap:RC,cmdConfig:xC()}),r&&n.setOptions(r),n.subscribeModuleService=new L_(t),n.subscribeForVisitorService=new V_(t),n.setListener(),n}nr(t,e);var r=t.prototype;return r.setOptions=function(e){e&&(this.config=dr(this.config,e))},r.setListener=function(){var e,t,r,n,i,o=this;this.core.eventBus.on("logined",(function(e){o.subscribeModuleService.resumeSubscribe(e.isAutoReconnect),o.subscribeForVisitorService.resumeSubscribe(e.isAutoReconnect),o.config.autoSubscribe&&(o.subscribeModuleService.autoSubscribeServerMap={},o.subscribeModuleService.autoSubscribeUnreadMap={},o.subscribeModuleService.autoSubscribe())})),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(e){o.subscribeModuleService.resumeSubscribe(e.isReconnect),o.subscribeForVisitorService.resumeSubscribe(e.isReconnect),o.config.autoSubscribe&&(o.subscribeModuleService.autoSubscribeServerMap={},o.subscribeModuleService.autoSubscribeUnreadMap={},o.subscribeModuleService.autoSubscribe())})),this.core.eventBus.on("qchatChannel/changeUnread",tr(e=this.subscribeModuleService.changeUnread).call(e,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/updateUnreads",tr(t=this.subscribeModuleService.updateUnreads).call(t,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/cacheSubscribe",tr(r=this.subscribeModuleService.cacheSubscribe).call(r,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/clearUnreadCountByServers",tr(n=this.subscribeModuleService.clearUnreadCountByServers).call(n,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/getRoleIdsByServerId",tr(i=this.subscribeModuleService.getRoleIdsByServerId).call(i,this.subscribeModuleService)),this.core.eventBus.on("qchatChannel/autoUnSubscribe",(function(e){if(o.logger.log("QChatChannel::enter autoUnSubscribe sysMsg is",e),e.type===y_[y_.channelVisibilityUpdate])o.logger.log("QChatChannel::begin autoUnSubscribe channel key is",e.serverId+"_"+e.channelId),o.subscribeModuleService._unSubscribeChannel(e.serverId,e.channelId),o.logger.log("QChatChannel::autoUnSubscribe channel done key is",e.serverId+"_"+e.channelId);else if(e.type===y_[y_.serverEnterLeave]){var t;(o.subscribeModuleService.manualSubscribeServerMap[e.serverId]||o.subscribeModuleService.autoSubscribeServerMap[e.serverId])&&(o.logger.log("QChatChannel::begin autoUnSubscribe server key is",e.serverId),o.subscribeModuleService._unSubscribeServer(e.serverId),o.logger.log("QChatChannel::autoUnSubscribe server done key is",e.serverId));var r=o.subscribeModuleService.unreadServerCount[e.serverId];if(!r)return;o.logger.log("QChatChannel::begin autoUnSubscribe channels key is",fr(r)),jn(t=fr(r)).call(t,(function(t){o.subscribeModuleService._unSubscribeChannel(e.serverId,t)})),o.logger.log("QChatChannel::autoUnSubscribe channels done key is",fr(r))}})),this.core.eventBus.on("qchatChannel/serverIdentifyChange",(function(e){o.subscribeModuleService.changeCacheServerRoleIds(e)}))},r.createChannel=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",min:1},type:{type:"enum",values:wp(TC)},name:{type:"string",required:!1},topic:{type:"string",required:!1},ext:{type:"string",required:!1},visitorMode:{type:"number",required:!1}},e),t.next=3,this.core.sendCmd("qchatCreateChannel",{channelInfo:dr(dr({},e),{type:TC[e.type]}),antispamTag:r_(e)});case 3:return r=t.sent,t.abrupt("return",BC(r.content.channelInfo));case 5:case"end":return t.stop()}}),t,this)})))},r.deleteChannel=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({channelId:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatDeleteChannel",e);case 3:case"end":return t.stop()}}),t,this)})))},r.updateChannel=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({channelId:{type:"string",min:1},serverId:{type:"string",required:!1},type:{type:"enum",values:wp(TC),required:!1},name:{type:"string",required:!1},topic:{type:"string",required:!1},ext:{type:"string",required:!1},visitorMode:{type:"number",required:!1}},e),r=e,e.type&&(r.type=TC[e.type]),t.next=5,this.core.sendCmd("qchatUpdateChannel",{channelInfo:r,antispamTag:r_(e)});case 5:return n=t.sent,t.abrupt("return",BC(n.content.channelInfo));case 7:case"end":return t.stop()}}),t,this)})))},r.getChannels=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({channelIds:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatGetChannels",e);case 3:return r=t.sent,t.abrupt("return",FC(r.content.channelList));case 5:case"end":return t.stop()}}),t,this)})))},r.getChannelsByPage=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetChannelsByPage",{qchatGetChannelListPageTag:dr({limit:100},e)});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:$p(o.nextTimetag)},datas:FC(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.getMembersByPage=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",min:1},channelId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetMembersByPage",{qchatGetMembersByPageTag:e});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:$p(o.nextTimetag)},datas:e_(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.updateWhiteBlackRole=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",min:1},channelId:{type:"string",min:1},roleId:{type:"string",min:1},type:{type:"enum",values:wp(IC)},opeType:{type:"enum",values:wp(SC)}},e),t.next=3,this.core.sendCmd("qchatUpdateWhiteBlackRole",{qchatUpdateWhiteBlackRoleTag:dr(dr({},e),{type:IC[e.type],opeType:SC[e.opeType]})});case 3:case"end":return t.stop()}}),t,this)})))},r.getWhiteBlackRolesPage=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:wp(IC)},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetWhiteBlackRolesPage",{qchatGetWhiteBlackRolesPageTag:dr(dr({},e),{type:IC[e.type]})});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:$p(o.nextTimetag)},datas:E_(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.updateWhiteBlackMembers=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:wp(IC)},opeType:{type:"enum",values:wp(SC)},toAccids:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatUpdateWhiteBlackMembers",{qchatUpdateWhiteBlackMembersTag:dr(dr({},e),{type:IC[e.type],opeType:SC[e.opeType],toAccids:_i(e.toAccids)})});case 3:case"end":return t.stop()}}),t,this)})))},r.getWhiteBlackMembersPage=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:wp(IC)},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetWhiteBlackMembersPage",{qchatGetWhiteBlackMembersPageTag:dr(dr({limit:100},e),{type:IC[e.type]})});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:$p(o.nextTimetag)},datas:e_(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.getExistingWhiteBlackRoles=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:wp(IC)},roleIds:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatGetExistingWhiteBlackRoles",{qchatGetExistingWhiteBlackRolesTag:dr(dr({},e),{type:IC[e.type],roleIds:_i(e.roleIds)})});case 3:return r=t.sent,n=r.content.datas,t.abrupt("return",{datas:E_(n)});case 6:case"end":return t.stop()}}),t,this)})))},r.getExistingWhiteBlackMembers=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:wp(IC)},accids:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatGetExistingWhiteBlackMembers",{qchatGetExistingWhiteBlackMembersTag:dr(dr({},e),{type:IC[e.type],accids:_i(e.accids)})});case 3:return r=t.sent,n=r.content.datas,t.abrupt("return",{datas:e_(n)});case 6:case"end":return t.stop()}}),t,this)})))},r.updateCategoryInfoOfChannel=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({channelId:{type:"string",min:1},categoryId:{type:"string",allowEmpty:!1,required:!1},syncMode:{type:"number",min:0,max:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateCategoryInfoOfChannel",{qchatUpdateCategoryInfoOfChannelTag:e});case 3:return r=t.sent,t.abrupt("return",BC(r.content.channelInfo));case 5:case"end":return t.stop()}}),t,this)})))},r.createChannelCategory=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},ext:{type:"string",required:!1},viewMode:{type:"number",min:0,max:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatCreateChannelCategory",{qchatCreateChannelCategoryTag:e});case 3:return r=t.sent,t.abrupt("return",HC(r.content.QChatChannelCategoryInfo));case 5:case"end":return t.stop()}}),t,this)})))},r.removeChannelCategory=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({categoryId:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatRemoveChannelCategory",e);case 3:case"end":return t.stop()}}),t,this)})))},r.updateChannelCategory=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({categoryId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},ext:{type:"string",required:!1},viewMode:{type:"number",min:0,max:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateChannelCategory",{qchatUpdateChannelCategoryTag:e});case 3:return r=t.sent,t.abrupt("return",HC(r.content.QChatChannelCategoryInfo));case 5:case"end":return t.stop()}}),t,this)})))},r.getChannelCategoriesByID=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({categoryIds:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatGetChannelCategoriesByID",e);case 3:return r=t.sent,t.abrupt("return",WC(r.content.channelCategoryList));case 5:case"end":return t.stop()}}),t,this)})))},r.updateChannelCategoryWhiteBlackRole=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:wp(IC)},opeType:{type:"enum",values:wp(SC)},roleId:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateChannelCategoryWhiteBlackRole",{qchatUpdateChannelCategoryWhiteBlackRoleTag:dr(dr({},e),{type:IC[e.type],opeType:SC[e.opeType]})});case 3:case"end":return t.stop()}}),t,this)})))},r.getChannelCategoryWhiteBlackRolesPage=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:wp(IC)},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackRolesPage",{qchatGetChannelCategoryWhiteBlackRolesPageTag:dr(dr({},e),{type:IC[e.type]})});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:$p(o.nextTimetag)},datas:E_(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.updateChannelCategoryWhiteBlackMembers=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:wp(IC)},opeType:{type:"enum",values:wp(SC)},toAccids:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatUpdateChannelCategoryWhiteBlackMembers",{qchatUpdateChannelCategoryWhiteBlackMembersTag:dr(dr({},e),{type:IC[e.type],opeType:SC[e.opeType],toAccids:_i(e.toAccids)})});case 3:case"end":return t.stop()}}),t,this)})))},r.getChannelCategoryWhiteBlackMembersPage=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:wp(IC)},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackMembersPage",{qchatGetChannelCategoryWhiteBlackMembersPageTag:dr(dr({},e),{type:IC[e.type]})});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:$p(o.nextTimetag)},datas:e_(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.getChannelCategoryWhiteBlackRoles=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:wp(IC)},roleIds:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackRoles",{qchatGetChannelCategoryWhiteBlackRolesTag:dr(dr({},e),{type:IC[e.type],roleIds:_i(e.roleIds)})});case 3:return r=t.sent,n=r.content.datas,t.abrupt("return",E_(n));case 6:case"end":return t.stop()}}),t,this)})))},r.getChannelCategoryWhiteBlackMembers=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:wp(IC)},accids:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackMembers",{qchatGetChannelCategoryWhiteBlackMembersTag:dr(dr({},e),{type:IC[e.type],accids:_i(e.accids)})});case 3:return r=t.sent,n=r.content.datas,t.abrupt("return",e_(n));case 6:case"end":return t.stop()}}),t,this)})))},r.getChannelCategoriesPage=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetChannelCategoriesPage",{qchatGetChannelCategoriesPageTag:e});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:$p(o.nextTimetag)},datas:WC(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.getChannelCategoryChannelsPage=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetChannelCategoryChannelsPage",{qchatGetChannelCategoryChannelsPageTag:e});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:$p(o.nextTimetag)},datas:FC(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.subscribeChannel=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Pl({type:{type:"number",min:1,max:5},opeType:{type:"number",min:1,max:2}},e),!this.config.autoSubscribe||e.isInternalTrigger||5===e.type){t.next=3;break}throw new Al("subscribe server failed, manual subscribe is not allowed in auto subscribe mode",{},403);case 3:return t.next=5,this.subscribeModuleService.subscribe(e);case 5:if((r=t.sent).unreadInfos=jC(r.unreadInfos),5!==e.type){t.next=10;break}return this.subscribeModuleService.cacheSubscribe(e),t.abrupt("return");case 10:return 1===e.opeType&&(e.channels=du(n=r.unreadInfos).call(n,(function(e){return{serverId:e.serverId,channelId:e.channelId}}))),this.logger.debug("QChatChannel::subscribeChannel:: cacheSubscribe ",e),this.config.autoSubscribe?this.subscribeModuleService.cacheAutoSubscribe(e):this.subscribeModuleService.cacheSubscribe(e),this.subscribeModuleService.updateUnreads(r.unreadInfos),t.abrupt("return",r);case 15:case"end":return t.stop()}}),t,this)})))},r.getChannelUnreadInfos=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatGetUnreadInfo",e);case 2:return r=t.sent,n=jC(r.content.unreadInfos),this.subscribeModuleService.updateUnreads(n),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t,this)})))},r.getChannelSearchByPage=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Pl({keyword:{type:"string",allowEmpty:!1},startTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:1,required:!1},order:{type:"enum",values:wp(bC),required:!1},limit:{type:"number",min:1,required:!1},serverId:{type:"string",required:!1},sort:{type:"enum",values:wp(MC),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},e),!(e.startTime&&e.endTime&&e.startTime>=e.endTime)){t.next=3;break}throw new El("startTime more than endTime",e,"timeRule");case 3:return t.next=5,this.core.sendCmd("qchatGetChannelSearchByPage",{qchatGetChannelSearchByPageTag:dr(dr({},e),{order:e.order&&bC[e.order],sort:Vm(e)&&MC[Vm(e)]})});case 5:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:$p(o.nextTimetag),cursor:o.cursor},datas:FC(i)});case 8:case"end":return t.stop()}}),t,this)})))},r.channelMemberSearch=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},keyword:{type:"string",allowEmpty:!1},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatChannelMemberSearch",{qchatChannelMemberSearchTag:e});case 3:return r=t.sent,t.abrupt("return",KC(r.content.datas));case 5:case"end":return t.stop()}}),t,this)})))},r.subscribeAsVisitor=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({opeType:{type:"number",min:1,max:2},type:{type:"number",required:!1},channels:{type:"array",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},min:1}},e),t.next=3,this.subscribeForVisitorService.subscribeChannelAsVisitor(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.qchatAutoSubscribeNotificationHandler=function(e){var t=jC(e.content.unreadInfos),r=e.content.serverIds;this.subscribeModuleService.updateUnreads(t);var n=[];if(r.length){var i={opeType:1};i.channels=du(r).call(r,(function(e){return{serverId:e.serverId,channelId:""}})),i.type=4,n.push(i)}if(t.length){var o={opeType:1};o.channels=du(t).call(t,(function(e){return{serverId:e.serverId,channelId:e.channelId}})),o.type=1,n.push(o)}if(n.length)for(var a,s=U_(n);!(a=s()).done;){var c=a.value;this.subscribeModuleService.cacheAutoSubscribe(c)}},t}(wC),B_={serverId:{type:"string"},uid:{type:"string"},accid:{type:"string"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},type:{type:"number"},joinTime:{type:"number"},inviter:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}},F_={limit:{type:"number"}};function G_(e){return Ei(e)&&e.length>0?du(e).call(e,(function(e){return function(e){return Ph(B_,e)}(e)})):[]}function j_(e){try{e.audio&&(e.audio=JSON.parse(e.audio))}catch(e){throw new El('result "audio" JSON parse error',{key:"audio"},"JSON parse error")}try{e.video&&(e.video=JSON.parse(e.video))}catch(e){throw new El('result "video" JSON parse error',{key:"video"},"JSON parse error")}return Ph(F_,e)}var H_,W_={"25_1":"qchatGetNeroomToken","25_2":"qchatUpdateRTCChannelConfig","25_3":"qchatGetRTCChannelConfig","25_4":"qchatGetRTCChannelMembers"},K_={QChatRTCChannelConfigTag:{serverId:1,channelId:2,limit:3,audio:4,video:5},QChatRTCChannelConfigResultTag:{limit:1,audio:2,video:3},QChatGetRTCParams:{serverId:1,channelId:2},qchatGetRTCChannelMembersTag:{serverId:1,channelId:2},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},QChatGetNeroomTokenResultTag:{token:1,expire:2},QChatGetNeroomTokenParams:{neroomDeviceId:1}},Y_=function(){var e=Ih(K_);return{qchatGetNeroomToken:{sid:25,cid:1,service:"qchatMedia",params:[{type:"Property",name:"qchatGetNeroomTokenTag",reflectMapper:K_.QChatGetNeroomTokenParams}],response:[{type:"Property",name:"neroomToken",reflectMapper:e.QChatGetNeroomTokenResultTag}]},qchatUpdateRTCChannelConfig:{sid:25,cid:2,service:"qchatMedia",params:[{type:"Property",name:"RTCChannelConfig",reflectMapper:K_.QChatRTCChannelConfigTag}]},qchatGetRTCChannelConfig:{sid:25,cid:3,service:"qchatMedia",params:[{type:"Property",name:"qchatGetRTCChannelConfigTag",reflectMapper:K_.QChatGetRTCParams}],response:[{type:"Property",name:"RTCChannelConfig",reflectMapper:e.QChatRTCChannelConfigResultTag}]},qchatGetRTCChannelMembers:{sid:25,cid:4,service:"qchatMedia",params:[{type:"Property",name:"qchatGetRTCChannelMembersTag",reflectMapper:K_.QChatGetRTCParams}],response:[{type:"PropertyArray",name:"memberList",reflectMapper:e.memberInfo}]}}},Q_=function(e){function t(t,r){var n;return(n=e.call(this,"qchatMedia",t)||this).config={},n.tokenExpireTime=24e4,n.getTokenState=!1,n.core=t,Mh({cmdMap:W_,cmdConfig:Y_()}),r&&n.setOptions(r),n.setListener(),n.tokenExpireTime=24e4,n.channelId="",n.serverId="",n}nr(t,e);var r=t.prototype;return r.setOptions=function(e){e&&(this.config=dr(this.config,e),(null==e?void 0:e.neroom)&&this.setNeroom(e.neroom))},r.setNeroom=function(e){this.neroom=new e},r.setListener=function(){var e,t,r,n,i=this;this.core.eventBus.on("disconnect",tr(e=this._existRomm).call(e,this)),this.core.eventBus.on("kicked",tr(t=this._existRomm).call(t,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLogout",tr(r=this._existRomm).call(r,this)),this.core.eventBus.on("V2NIMLoginService/loginLifeCycleKicked",tr(n=this._existRomm).call(n,this)),this.core.eventBus.on("qchatMedia/serverOrChannelLeave",(function(e){return zl(i,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e.type===y_[y_.channelVisibilityUpdate]&&e.channelId===this.channelId||e.type===y_[y_.serverEnterLeave]&&e.serverId===this.serverId)){t.next=4;break}if(!this.roomContext||!this.roomContext.roomUuid){t.next=4;break}return t.next=4,this.disconnectChannel();case 4:case"end":return t.stop()}}),t,this)})))}))},r._existRomm=function(){return zl(this,void 0,void 0,Ql.mark((function e(){return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.roomContext){e.next=3;break}return e.next=3,this.disconnectChannel();case 3:this.tokenTimer&&(this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0);case 4:case"end":return e.stop()}}),e,this)})))},r._checkPermission=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.qchatRole.checkPermission(e);case 2:return r=t.sent,t.abrupt("return",r);case 4:case"end":return t.stop()}}),t,this)})))},r._checkConnectState=function(){if("connect"!==this.state)throw new Al("QChatMedia::you should connect first")},r.kickMemberOut=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this._checkConnectState(),Pl({accid:{type:"string",allowEmpty:!1}},e),r.prev=2,r.next=5,null===(t=this.roomContext)||void 0===t?void 0:t.kickMemberOut(e.accid);case 5:r.next=11;break;case 7:throw r.prev=7,r.t0=r.catch(2),this.logger.error("QChatMedia::kickMemberOut error params is "+_i(e),r.t0),new Al("QChatMedia::kickMemberOut error",r.t0);case 11:case"end":return r.stop()}}),r,this,[[2,7]])})))},r.disconnectChannel=function(){var e;return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.logger.debug("QChatMedia::disconnect begin disconnect"),t.prev=1,t.next=4,null===(e=this.roomContext)||void 0===e?void 0:e.leaveRoom();case 4:t.next=9;break;case 6:t.prev=6,t.t0=t.catch(1),this.logger.error("QChatMedia::disconnect error",t.t0);case 9:if(!this.authService){t.next=12;break}return t.next=12,this.authService.logout();case 12:this._setStateInit(),this.core.emit("qchatMediaDisconnect"),this.core.qchatMedia.emit("qchatMediaDisconnect");case 15:case"end":return t.stop()}}),t,this,[[1,6]])})))},r._setStateInit=function(){this.logger.debug("QChatMedia::disconnect end"),this.roomContext=void 0,this.rtcController=void 0,this.state="init",this.tokenTimer&&(this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0),this.channelId="",this.serverId=""},r.muteAudio=function(e){var t,r,n,i,o;return zl(this,void 0,void 0,Ql.mark((function a(){var s;return Ql.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(this._checkConnectState(),Pl({accid:{type:"string",allowEmpty:!1}},e),(null===(t=this.roomContext)||void 0===t?void 0:t.localMember.uuid)!==e.accid){a.next=14;break}return a.prev=3,a.next=6,null===(r=this.rtcController)||void 0===r?void 0:r.muteMyAudio();case 6:a.next=12;break;case 8:throw a.prev=8,a.t0=a.catch(3),this.logger.error("QChatMedia::muteAudio error",a.t0),new Al("QChatMedia::muteAudio error",a.t0);case 12:case 25:a.next=31;break;case 14:if(a.prev=14,!(s=null===(n=this.roomContext)||void 0===n?void 0:n.roomProperties.audioOff)||"offNotAllowSelfOn"!==(null===(i=s.value)||void 0===i?void 0:i.split("_")[0])){a.next=23;break}return a.next=19,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 19:if(a.sent){a.next=23;break}return this.logger.error("QChatMedia::unMuteAudio not allow open auido"),a.abrupt("return");case 23:return a.next=25,null===(o=this.rtcController)||void 0===o?void 0:o.muteMemberAudio(e.accid);case 27:throw a.prev=27,a.t1=a.catch(14),this.logger.error("QChatMedia::muteAudio error params is "+_i(e),a.t1),new Al("QChatMedia::muteAudio error",a.t1);case 31:case"end":return a.stop()}}),a,this,[[3,8],[14,27]])})))},r.unMuteAudio=function(e){var t,r,n,i,o;return zl(this,void 0,void 0,Ql.mark((function a(){var s;return Ql.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(this._checkConnectState(),Pl({accid:{type:"string",allowEmpty:!1}},e),!(s=null===(t=this.roomContext)||void 0===t?void 0:t.roomProperties.audioOff)||"offNotAllowSelfOn"!==(null===(r=s.value)||void 0===r?void 0:r.split("_")[0])){a.next=10;break}return a.next=6,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 6:if(a.sent){a.next=10;break}return this.logger.error("QChatMedia::unMuteAudio not allow open auido"),a.abrupt("return");case 10:if((null===(n=this.roomContext)||void 0===n?void 0:n.localMember.uuid)!==e.accid){a.next=22;break}return a.prev=11,a.next=14,null===(i=this.rtcController)||void 0===i?void 0:i.unmuteMyAudio();case 14:a.next=20;break;case 16:throw a.prev=16,a.t0=a.catch(11),this.logger.error("QChatMedia::unMuteAudio error",a.t0),new Al("QChatMedia::unMuteAudio error",a.t0);case 20:case 25:a.next=31;break;case 22:return a.prev=22,a.next=25,null===(o=this.rtcController)||void 0===o?void 0:o.unmuteMemberAudio(e.accid);case 27:throw a.prev=27,a.t1=a.catch(22),this.logger.error("QChatMedia::unMuteAudio error params is "+_i(e),a.t1),new Al("QChatMedia::unMuteAudio error",a.t1);case 31:case"end":return a.stop()}}),a,this,[[11,16],[22,27]])})))},r.muteVideo=function(e){var t,r,n,i,o;return zl(this,void 0,void 0,Ql.mark((function a(){var s;return Ql.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(this._checkConnectState(),Pl({accid:{type:"string",allowEmpty:!1}},e),(null===(t=this.roomContext)||void 0===t?void 0:t.localMember.uuid)!==e.accid){a.next=14;break}return a.prev=3,a.next=6,null===(r=this.rtcController)||void 0===r?void 0:r.muteMyVideo();case 6:a.next=12;break;case 8:throw a.prev=8,a.t0=a.catch(3),this.logger.error("QChatMedia::muteVideo error",a.t0),new Al("QChatMedia::muteVideo error",a.t0);case 12:case 25:a.next=31;break;case 14:if(a.prev=14,!(s=null===(n=this.roomContext)||void 0===n?void 0:n.roomProperties.videoOff)||"offNotAllowSelfOn"!==(null===(i=s.value)||void 0===i?void 0:i.split("_")[0])){a.next=23;break}return a.next=19,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 19:if(a.sent){a.next=23;break}return this.logger.error("QChatMedia::unMuteVideo not allow open video"),a.abrupt("return");case 23:return a.next=25,null===(o=this.rtcController)||void 0===o?void 0:o.muteMemberVideo(e.accid);case 27:throw a.prev=27,a.t1=a.catch(14),this.logger.error("QChatMedia::muteVideo error params is "+_i(e),a.t1),new Al("QChatMedia::muteVideo error",a.t1);case 31:case"end":return a.stop()}}),a,this,[[3,8],[14,27]])})))},r.unMuteVideo=function(e){var t,r,n,i,o;return zl(this,void 0,void 0,Ql.mark((function a(){var s;return Ql.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(this._checkConnectState(),Pl({accid:{type:"string",allowEmpty:!1}},e),!(s=null===(t=this.roomContext)||void 0===t?void 0:t.roomProperties.videoOff)||"offNotAllowSelfOn"!==(null===(r=s.value)||void 0===r?void 0:r.split("_")[0])){a.next=10;break}return a.next=6,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 6:if(a.sent){a.next=10;break}return this.logger.error("QChatMedia::unMuteVideo not allow open video"),a.abrupt("return");case 10:if((null===(n=this.roomContext)||void 0===n?void 0:n.localMember.uuid)!==e.accid){a.next=22;break}return a.prev=11,a.next=14,null===(i=this.rtcController)||void 0===i?void 0:i.unmuteMyVideo();case 14:a.next=20;break;case 16:throw a.prev=16,a.t0=a.catch(11),this.logger.error("QChatMedia::unMuteVideo error",a.t0),new Al("QChatMedia::unMuteVideo error",a.t0);case 20:a.next=30;break;case 22:a.prev=22,null===(o=this.rtcController)||void 0===o||o.unmuteMemberVideo(e.accid),a.next=30;break;case 26:throw a.prev=26,a.t1=a.catch(22),this.logger.error("QChatMedia::unMuteVideo error",a.t1),new Al("QChatMedia::unMuteVideo error",a.t1);case 30:case"end":return a.stop()}}),a,this,[[11,16],[22,26]])})))},r.startScreenShare=function(){var e;return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._checkConnectState(),t.prev=1,null===(e=this.rtcController)||void 0===e||e.startScreenShare(),t.next=9;break;case 5:throw t.prev=5,t.t0=t.catch(1),this.logger.error("QChatMedia::startScreenShare error",t.t0),new Al("QChatMedia::startScreenShare error",t.t0);case 9:case"end":return t.stop()}}),t,this,[[1,5]])})))},r.stopScreenShare=function(){var e;return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._checkConnectState(),t.prev=1,null===(e=this.rtcController)||void 0===e||e.stopScreenShare(),t.next=9;break;case 5:throw t.prev=5,t.t0=t.catch(1),this.logger.error("QChatMedia::stopScreenShare error",t.t0),new Al("QChatMedia::stopScreenShare error",t.t0);case 9:case"end":return t.stop()}}),t,this,[[1,5]])})))},r.stopMemberScreenShare=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:this._checkConnectState(),Pl({accid:{type:"string",allowEmpty:!1}},e),r.prev=2,null===(t=this.rtcController)||void 0===t||t.stopMemberScreenShare(e.accid),r.next=10;break;case 6:throw r.prev=6,r.t0=r.catch(2),this.logger.error("QChatMedia::stopMemberScreenShare error",r.t0),new Al("QChatMedia::stopMemberScreenShare error",r.t0);case 10:case"end":return r.stop()}}),r,this,[[2,6]])})))},r.subscribeRemoteVideoStream=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:this._checkConnectState(),Pl({accid:{type:"string",allowEmpty:!1},streamType:{type:"number",allowEmpty:!1,min:0,max:1}},e),r.prev=2,null===(t=this.rtcController)||void 0===t||t.subscribeRemoteVideoStream(e.accid,e.streamType),r.next=10;break;case 6:throw r.prev=6,r.t0=r.catch(2),this.logger.error("QChatMedia::subscribeRemoteVideoStream error",r.t0),new Al("QChatMedia::subscribeRemoteVideoStream error",r.t0);case 10:case"end":return r.stop()}}),r,this,[[2,6]])})))},r.unSubscribeRemoteVideoStream=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:this._checkConnectState(),Pl({accid:{type:"string",allowEmpty:!1},streamType:{type:"number",allowEmpty:!1,min:0,max:1}},e),r.prev=2,null===(t=this.rtcController)||void 0===t||t.unsubscribeRemoteVideoStream(e.accid,e.streamType),r.next=10;break;case 6:throw r.prev=6,r.t0=r.catch(2),this.logger.error("QChatMedia::unSubscribeRemoteVideoStream error",r.t0),new Al("QChatMedia::unSubscribeRemoteVideoStream error",r.t0);case 10:case"end":return r.stop()}}),r,this,[[2,6]])})))},r.setupVideoCanvas=function(e){var t;if(this._checkConnectState(),(null===(t=this.roomContext)||void 0===t?void 0:t.localMember.uuid)===e.accid)try{return this.rtcController.setupLocalVideoCanvas(e.videoView)}catch(e){throw this.logger.error("QChatMedia::setupVideoCanvas error",e),new Al("QChatMedia::setupVideoCanvas error",e)}else try{return this.rtcController.setupRemoteVideoCanvas(e.videoView,e.accid)}catch(e){throw this.logger.error("QChatMedia::setupVideoCanvas error",e),new Al("QChatMedia::setupVideoCanvas error",e)}},r.setupRemoteVideoSubStreamCanvas=function(e){this._checkConnectState(),Pl({accid:{type:"string",allowEmpty:!1}},e);try{return this.rtcController.setupRemoteVideoSubStreamCanvas(e.videoView,e.accid)}catch(e){throw this.logger.error("QChatMedia::setupRemoteVideoSubStreamCanvas error",e),new Al("QChatMedia::setupRemoteVideoSubStreamCanvas error",e)}},r.getScreenSharingUserUuid=function(){this._checkConnectState();try{return this.rtcController.getScreenSharingUserUuid()}catch(e){throw this.logger.error("QChatMedia::getScreenSharingUserUuid error",e),new Al("QChatMedia::getScreenSharingUserUuid error",e)}},r.initQChatMedia=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.neroom){t.next=3;break}return this.logger.warn("QChatMedia::init::you should import neroom SDK"),t.abrupt("return");case 3:if(void 0===this.state){t.next=6;break}return this.logger.error("QChatMedia::init::you already init QChatMedia"),t.abrupt("return");case 6:t.prev=6,this.neroom.initialize({appKey:this.core.options.appkey,serverConfig:e.serverConfig}),t.next=14;break;case 10:throw t.prev=10,t.t0=t.catch(6),this.logger.error("QChatMedia::initQChatMedia error",t.t0),new Al("QChatMedia::initQChatMedia error",t.t0);case 14:this.authService=this.neroom.authService,this.roomService=this.neroom.roomService,this.messageChannelService=this.neroom.messageChannelService,this.state="init";case 18:case"end":return t.stop()}}),t,this,[[6,10]])})))},r.loginByIM=function(){var e;return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("init"===this.state){t.next=3;break}return this.logger.error("QChatMedia::connect::you should init before login"),t.abrupt("return");case 3:return t.next=5,this._getToken();case 5:return r=t.sent,n=Zp(this.core,"options.token")||Zp(this.core,"V2NIMLoginService.token"),t.prev=7,t.next=10,null===(e=this.authService)||void 0===e?void 0:e.loginByIM(this.core.account,r,n);case 10:t.next=16;break;case 12:throw t.prev=12,t.t0=t.catch(7),this.logger.error("QChatMedia::loginByIM error",t.t0),new Al("QChatMedia::loginByIM error",t.t0);case 16:this.state="login";case 17:case"end":return t.stop()}}),t,this,[[7,12]])})))},r._getToken=function(){var e;return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.logger.log("QChatMedia::getToken begin getToken"),t.next=3,this.core.sendCmd("qchatGetNeroomToken",{qchatGetNeroomTokenTag:{neroomDeviceId:null===(e=this.neroom)||void 0===e?void 0:e.deviceId}});case 3:return r=t.sent,n=r.content.neroomToken,i=n.token,o=n.expire,this.logger.log("QChatMedia::getToken success token is "+i+",expire is "+o+" "),this.tokenTimer||(this.logger.debug("QChatMedia::getToken set token timer,expire is "+(1e3*o-this.tokenExpireTime)+" "),this.tokenTimer=this.core.timerManager.addTimer((function(){return zl(a,void 0,void 0,Ql.mark((function e(){var t;return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.tokenTimer&&this.core.timerManager.deleteTimer(this.tokenTimer),this.tokenTimer=void 0,e.next=4,this._getToken();case 4:t=e.sent,this.authService&&this.authService.renewToken(t);case 6:case"end":return e.stop()}}),e,this)})))}),1e3*o-this.tokenExpireTime)),t.abrupt("return",i);case 8:case"end":return t.stop()}}),t,this)})))},r.connectChannel=function(e){var t,r;return zl(this,void 0,void 0,Ql.mark((function n(){var i;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0!==this.state){n.next=3;break}return this.logger.error("QChatMedia::connect::you should init before login"),n.abrupt("return");case 3:if("init"!==this.state){n.next=6;break}return n.next=6,this.loginByIM();case 6:return this.serverId=e.serverId,this.channelId=e.channelId,n.prev=8,n.next=11,null===(t=this.roomService)||void 0===t?void 0:t.joinRoom({roomUuid:e.channelId,role:"qchatAudience",userName:this.core.account,initialProperties:{}},{});case 11:n.next=17;break;case 13:throw n.prev=13,n.t0=n.catch(8),this.logger.error("QChatMedia::connectChannel error",n.t0),new Al("QChatMedia::connectChannel error",n.t0);case 17:if(!(i=null===(r=this.roomService)||void 0===r?void 0:r.getRoomContext(e.channelId))){n.next=28;break}return this.roomContext=i,this.rtcController=this.roomContext.rtcController,this.state="connect",n.next=24,this.rtcController.joinRtcChannel();case 24:this.core.emit("connectChannel"),this.core.qchatMedia.emit("connectChannel"),n.next=29;break;case 28:this.logger.error("QChatMedia::connect room not exited");case 29:case"end":return n.stop()}}),n,this,[[8,13]])})))},r.updateRTCChannelInfo=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},limit:{type:"number",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateRTCChannelConfig",{RTCChannelConfig:dr(dr({},e),{audio:_i(e.audio),video:_i(e.video)})});case 3:case"end":return t.stop()}}),t,this)})))},r.getRTCChannelInfo=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatGetRTCChannelConfig",{qchatGetRTCChannelConfigTag:e});case 3:return r=t.sent,t.abrupt("return",j_(r.content.RTCChannelConfig));case 5:case"end":return t.stop()}}),t,this)})))},r.getRTCChannelOnlineMembers=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatGetRTCChannelMembers",{qchatGetRTCChannelMembersTag:e});case 3:return r=t.sent,t.abrupt("return",G_(r.content.memberList));case 5:case"end":return t.stop()}}),t,this)})))},r.addRTCChannelListener=function(){var e,t,r=this;this._checkConnectState();try{null===(e=this.authService)||void 0===e||e.addAuthListener({onAuthEvent:function(e){return zl(r,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(1026!==e||this.getTokenState){t.next=10;break}return this.logger.log("QChatMedia::loginByIM token expire,begin get new token "),this.getTokenState=!0,t.next=5,this._getToken();case 5:if(r=t.sent,!this.authService){t.next=9;break}return t.next=9,this.authService.renewToken(r);case 9:this.getTokenState=!1;case 10:case"end":return t.stop()}}),t,this)})))}})}catch(e){throw this.getTokenState=!1,this.logger.error("QChatMedia::loginByIM addAuthListener error",e),new Al("QChatMedia::loginByIM addAuthListener error",e)}null===(t=this.roomContext)||void 0===t||t.addRoomListener({onRoomPropertiesChanged:function(e){var t,n,i,o,a,s;if(r.logger.log("QChatMedia::addRTCChannelListener::onRoomPropertiesChanged",e),e.audioOff){var c=null===(t=e.audioOff.value)||void 0===t?void 0:t.split("_")[0];"offNotAllowSelfOn"!==c&&"offAllowSelfOn"!==c||(null===(n=r.roomContext)||void 0===n?void 0:n.localMember.isAudioOn)&&(null===(i=r.rtcController)||void 0===i||i.muteMyAudio())}else if(e.videoOff){var u=null===(o=e.videoOff.value)||void 0===o?void 0:o.split("_")[0];"offNotAllowSelfOn"!==u&&"offAllowSelfOn"!==u||(null===(a=r.roomContext)||void 0===a?void 0:a.localMember.isVideoOn)&&(null===(s=r.rtcController)||void 0===s||s.muteMyVideo())}},onRoomPropertiesDeleted:function(e){r.logger.log("QChatMedia::addRTCChannelListener::onRoomPropertiesDeleted",e)},onMemberJoinRtcChannel:function(e){r.logger.log("QChatMedia::addRTCChannelListener::onMemberJoinRTCChannel",e);var t=du(e).call(e,(function(e){return e.uuid}));r.core.emit("memberJoinRTCChannel",t),r.core.qchatMedia.emit("memberJoinRTCChannel",t)},onMemberLeaveRoom:function(e){r.logger.log("QChatMedia::addRTCChannelListener::onMemberLeaveRoom",e);var t=du(e).call(e,(function(e){return e.uuid}));r.core.emit("memberLeaveRTCChannel",t),r.core.qchatMedia.emit("memberLeaveRTCChannel",t)},onRoomEnded:function(e){r.authService&&r.authService.logout(),r._setStateInit(),r.logger.log("QChatMedia::addRTCChannelListener::onRoomEnded",e),r.core.emit("RTCChannelEnded",e),r.core.qchatMedia.emit("RTCChannelEnded",e)},onRtcChannelError:function(e){r.logger.log("QChatMedia::addRTCChannelListener::onRtcChannelError",e),"SOCKET_ERROR"===e&&r.disconnectChannel(),r.core.emit("RTCChannelError",e),r.core.qchatMedia.emit("RTCChannelError",e)},onRtcAudioVolumeIndication:function(e){r.logger.log("QChatMedia::addRTCChannelListener::onRtcAudioVolumeIndication",e),r.core.emit("onRtcAudioVolumeIndication",e),r.core.qchatMedia.emit("onRtcAudioVolumeIndication",e)},onMemberAudioMuteChanged:function(e,t,n){r.logger.log("QChatMedia::addRTCChannelListener::onMemberAudioMuteChanged",e,t),r.core.emit("memberAudioMuteChanged",{memberAccId:e.uuid,mute:t,operateByAccId:n.uuid}),r.core.qchatMedia.emit("memberAudioMuteChanged",{memberAccId:e.uuid,mute:t,operateByAccId:n.uuid})},onMemberScreenShareStateChanged:function(e,t,n){r.logger.log("QChatMedia::addRTCChannelListener::onMemberScreenShareStateChanged",e,t),r.core.emit("memberScreenShareStateChanged",{memberAccId:e.uuid,isSharing:t,operateByAccId:n.uuid}),r.core.qchatMedia.emit("memberScreenShareStateChanged",{memberAccId:e.uuid,isSharing:t,operateByAccId:n.uuid})},onMemberVideoMuteChanged:function(e,t,n){r.logger.log("QChatMedia::addRTCChannelListener::onMemberVideoMuteChanged",e,t),r.core.emit("memberVideoMuteChanged",{memberAccId:e.uuid,mute:t,operateByAccId:n.uuid}),r.core.qchatMedia.emit("memberVideoMuteChanged",{memberAccId:e.uuid,mute:t,operateByAccId:n.uuid})}})},r.enumCameraDevices=function(){var e=this;return this._checkConnectState(),this.rtcController.enumCameraDevices().then((function(e){return e.data}),(function(t){throw e.logger.error("QChatMedia::enumCameraDevices error",t),new Al("QChatMedia::enumCameraDevices error",t)}))},r.enumPlayoutDevices=function(){var e=this;return this._checkConnectState(),this.rtcController.enumPlayoutDevices().then((function(e){return e.data}),(function(t){throw e.logger.error("QChatMedia::enumPlayoutDevices error",t),new Al("QChatMedia::enumPlayoutDevices error",t)}))},r.enumRecordDevices=function(){var e=this;return this._checkConnectState(),this.rtcController.enumRecordDevices().then((function(e){return e.data}),(function(t){throw e.logger.error("QChatMedia::enumRecordDevices error",t),new Al("QChatMedia::enumRecordDevices error",t)}))},r.removeRTCChannelListener=function(){var e,t;this._checkConnectState(),null===(e=this.roomContext)||void 0===e||e.removeRoomListener({}),null===(t=this.authService)||void 0===t||t.removeAuthListener({})},r.setSelectedCameraDevice=function(e){var t=this;return this._checkConnectState(),Pl({deviceId:{type:"string",allowEmpty:!1}},e),this.rtcController.setSelectedCameraDevice(e.deviceId).then((function(e){return e.data}),(function(e){throw t.logger.error("QChatMedia::setSelectedCameraDevice error",e),new Al("QChatMedia::setSelectedCameraDevice error",e)}))},r.setSelectedPlayoutDevice=function(e){var t=this;return this._checkConnectState(),Pl({deviceId:{type:"string",allowEmpty:!1}},e),this.rtcController.setSelectedPlayoutDevice(e.deviceId).then((function(e){return e.data}),(function(e){throw t.logger.error("QChatMedia::setSelectedPlayoutDevice error",e),new Al("QChatMedia::setSelectedPlayoutDevice error",e)}))},r.setSelectedRecordDevice=function(e){var t=this;return this._checkConnectState(),Pl({deviceId:{type:"string",allowEmpty:!1}},e),this.rtcController.setSelectedRecordDevice(e.deviceId).then((function(e){return e.data}),(function(e){throw t.logger.error("QChatMedia::setSelectedRecordDevice error",e),new Al("QChatMedia::setSelectedRecordDevice error",e)}))},r.getRTCMembers=function(){var e,t;return this._checkConnectState(),du(e=fu(t=this.roomContext.remoteMembers).call(t,(function(e){return e.isInRtcChannel}))).call(e,(function(e){return{accid:e.uuid,isAudioOn:!!e.isAudioOn,isVideoOn:!!e.isVideoOn,isSharingScreen:!!e.isSharingScreen,properties:e.properties}}))},r.subscribeRemoteVideoSubStream=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:this._checkConnectState(),Pl({accid:{type:"string",allowEmpty:!1}},e),r.prev=2,null===(t=this.rtcController)||void 0===t||t.subscribeRemoteVideoSubStream(e.accid),r.next=10;break;case 6:throw r.prev=6,r.t0=r.catch(2),this.logger.error("QChatMedia::subscribeRemoteVideoSubStream error",r.t0),new Al("QChatMedia::subscribeRemoteVideoSubStream error",r.t0);case 10:case"end":return r.stop()}}),r,this,[[2,6]])})))},r.unsubscribeRemoteVideoSubStream=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:this._checkConnectState(),Pl({accid:{type:"string",allowEmpty:!1}},e),r.prev=2,null===(t=this.rtcController)||void 0===t||t.unsubscribeRemoteVideoSubStream(e.accid),r.next=10;break;case 6:throw r.prev=6,r.t0=r.catch(2),this.logger.error("QChatMedia::unsubscribeRemoteVideoSubStream error",r.t0),new Al("QChatMedia::unsubscribeRemoteVideoSubStream error",r.t0);case 10:case"end":return r.stop()}}),r,this,[[2,6]])})))},r.muteAllAudio=function(){var e;return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._checkConnectState(),t.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 3:if(t.sent){t.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneMicrophone auth"),t.abrupt("return");case 7:t.prev=7,null===(e=this.roomContext)||void 0===e||e.updateRoomProperty("audioOff",_i({value:"offNotAllowSelfOn_"+(new Date).getTime()})),t.next=15;break;case 11:throw t.prev=11,t.t0=t.catch(7),this.logger.error("QChatMedia::muteAllAudio error",t.t0),new Al("QChatMedia::muteAllAudio error",t.t0);case 15:case"end":return t.stop()}}),t,this,[[7,11]])})))},r.muteAllVideo=function(){var e;return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._checkConnectState(),t.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 3:if(t.sent){t.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneCamera auth"),t.abrupt("return");case 7:t.prev=7,null===(e=this.roomContext)||void 0===e||e.updateRoomProperty("videoOff",_i({value:"offNotAllowSelfOn_"+(new Date).getTime()})),t.next=15;break;case 11:throw t.prev=11,t.t0=t.catch(7),this.logger.error("QChatMedia::muteAllVideo error",t.t0),new Al("QChatMedia::muteAllVideo error",t.t0);case 15:case"end":return t.stop()}}),t,this,[[7,11]])})))},r.unMuteAllAudio=function(){var e;return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._checkConnectState(),t.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 3:if(t.sent){t.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneMicrophone auth"),t.abrupt("return");case 7:t.prev=7,null===(e=this.roomContext)||void 0===e||e.updateRoomProperty("audioOff",_i({value:"disable_"+(new Date).getTime()})),t.next=15;break;case 11:throw t.prev=11,t.t0=t.catch(7),this.logger.error("QChatMedia::unMuteAllAudio error",t.t0),new Al("QChatMedia::unMuteAllAudio error",t.t0);case 15:case"end":return t.stop()}}),t,this,[[7,11]])})))},r.unMuteAllVideo=function(){var e;return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._checkConnectState(),t.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 3:if(t.sent){t.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneCamera auth"),t.abrupt("return");case 7:t.prev=7,null===(e=this.roomContext)||void 0===e||e.updateRoomProperty("videoOff",_i({value:"disable_"+(new Date).getTime()})),t.next=15;break;case 11:throw t.prev=11,t.t0=t.catch(7),this.logger.error("QChatMedia::unMuteAllVideo error",t.t0),new Al("QChatMedia::unMuteAllVideo error",t.t0);case 15:case"end":return t.stop()}}),t,this,[[7,11]])})))},t}(wC),J_={"24_10":"qchatSendMsg","24_11":"qchatOnMsg","24_12":"qchatOnRecvUnreadInfo","24_13":"qchatSendCustomSysMsg","24_14":"qchatOnSysMsg","24_16":"qchatGetHistoryMsg","24_17":"qchatMarkMessageRead","24_18":"qchatMultiSyncMessageRead","24_22":"qchatUpdateSystemNotification","24_23":"qchatMultiSyncSystemNotificationUpdate","24_24":"qchatSyncSystemNotification","24_25":"qchatUpdateMessage","24_26":"qchatRecvMessageUpdate","24_28":"qchatMarkSysMsgRead","24_94":"qchatMessageSearchByPage","24_100":"qchatGetMessageHistoryByIds","24_101":"qchatGetThreadMessages","24_102":"qchatUpdateQuickComment","24_103":"qchatGetQuickComments","24_108":"qchatGetThreadRootMessagesMeta","24_121":"qchatGetLastMessageOfChannels","24_127":"qchatGetMentionedMeMessages","25_6":"qchatMultiSyncServersMessageRead"},z_={getHistoryMsgTag:{serverId:1,channelId:2,beginTime:3,endTime:4,excludeMsgId:5,limit:6,reverse:7},getThreadHistoryMsgTag:{beginTime:1,endTime:2,excludeMsgId:3,limit:4,reverse:5},qchatMsgTag:{serverId:1,channelId:2,fromAccount:3,fromClientType:4,fromDeviceId:5,fromNick:6,time:7,updateTime:8,type:9,body:10,attach:11,ext:12,msgIdClient:13,msgIdServer:14,resendFlag:15,status:16,pushPayload:17,pushContent:18,mentionAccids:19,mentionAll:20,env:21,callbackExt:22,replyMsgFromAccount:23,replyMsgTime:24,replyMsgIdServer:25,replyMsgIdClient:26,threadMsgFromAccount:27,threadMsgTime:28,threadMsgIdServer:29,threadMsgIdClient:30,useCustomContent:31,antiSpamContent:32,antiSpamBusinessId:33,antiSpamUsingYidun:34,yidunCallback:35,yidunAntiCheating:36,yidunAntiSpamExt:37,yidunAntiSpamRes:38,mentionRoleIds:41,accidsOfMentionedRoles:42,updateContent:39,updateOperatorInfo:40,subType:61,historyEnable:100,pushEnable:101,needBadge:102,needPushNick:103,notifyReason:104,routeEnable:105,isAntispam:106},sysMsg:{toType:1,serverId:2,channelId:3,toAccids:4,fromAccount:5,fromClientType:6,fromDeviceId:7,fromNick:8,time:9,updateTime:10,type:11,msgIdClient:12,msgIdServer:13,body:14,attach:15,ext:16,resendFlag:17,status:18,pushPayload:19,pushContent:20,env:21,callbackExt:22,persistEnable:100,pushEnable:101,needBadge:102,needPushNick:103,routeEnable:104},qchatMsgUpdateTag:{operatorAccount:1,operatorClientType:2,ps:3,ext:4,pushContent:5,pushPayload:6,env:7,routeEnable:100},markMsgReadTag:{serverId:1,channelId:2,time:3},qchatQuickCommentRequestTag:{serverId:1,channelId:2,fromAccount:3,msgIdServer:4,time:5,type:6,opeType:7,opeAccid:8},qchatQuickCommentQueryTag:{serverId:1,channelId:2,msgIdServerList:3},qchatGetLastMessageOfChannelsTag:{serverId:1,channelIdList:2},qchatMultiSyncServersMessageReadTag:{successServerIds:1,failServerIds:2,ackTimestamp:3},qchatMessageSearchByPageTag:{keyword:1,serverId:2,channelId:3,fromAccid:4,fromTime:5,toTime:6,msgTypes:7,subTypes:8,includeSelf:9,order:10,limit:11,sort:12,cursor:13},qchatPageQueryTag:{hasMore:1,nextTimetag:2,cursor:3},unreadInfo:kC},X_=function(){return Ih(z_)},$_=function(){var e=X_();return{qchatSendMsg:{service:"qchatMsg",sid:24,cid:10,params:[{type:"Property",name:"qchatMsg",reflectMapper:z_.qchatMsgTag}],response:[{type:"Property",name:"qchatMsg",reflectMapper:e.qchatMsgTag}]},qchatOnMsg:{service:"qchatMsg",sid:24,cid:11,response:[{type:"Property",name:"qchatMsg",reflectMapper:e.qchatMsgTag}]},qchatOnRecvUnreadInfo:{service:"qchatMsg",sid:24,cid:12,response:[{type:"Property",name:"qchatMsg",reflectMapper:e.qchatMsgTag}]},qchatSendCustomSysMsg:{service:"qchatMsg",sid:24,cid:13,params:[{type:"Property",name:"sysMsg",reflectMapper:z_.sysMsg}],response:[{type:"Property",name:"sysMsg",reflectMapper:e.sysMsg}]},qchatOnSysMsg:{service:"qchatMsg",sid:24,cid:14,response:[{type:"Property",name:"sysMsg",reflectMapper:e.sysMsg}]},qchatGetHistoryMsg:{service:"qchatMsg",sid:24,cid:16,params:[{type:"Property",name:"getHistoryMsgTag",reflectMapper:z_.getHistoryMsgTag}],response:[{type:"PropertyArray",name:"qchatMsgs",reflectMapper:e.qchatMsgTag}]},qchatUpdateMessage:{service:"qchatMsg",sid:24,cid:25,params:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:z_.qchatMsgUpdateTag},{type:"Property",name:"qchatMsg",reflectMapper:z_.qchatMsgTag}],response:[{type:"Property",name:"qchatMsg",reflectMapper:e.qchatMsgTag}]},qchatRecvMessageUpdate:{service:"qchatMsg",sid:24,cid:26,response:[{type:"Property",name:"qchatMsgUpdateInfo",reflectMapper:e.qchatMsgUpdateTag},{type:"Property",name:"qchatMsg",reflectMapper:e.qchatMsgTag}]},qchatMarkMessageRead:{sid:24,cid:17,service:"qchatMsg",params:[{type:"Property",name:"markMsgReadTag",reflectMapper:z_.markMsgReadTag}],response:[{type:"Property",name:"unreadInfo",reflectMapper:e.unreadInfo}]},qchatMultiSyncMessageRead:{sid:24,cid:18,service:"qchatMsg",response:[{type:"Property",name:"unreadInfo",reflectMapper:e.unreadInfo}]},qchatUpdateSystemNotification:{service:"qchatMsg",sid:24,cid:22,params:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:z_.qchatMsgUpdateTag},{type:"Property",name:"sysMsg",reflectMapper:z_.sysMsg}],response:[{type:"Property",name:"sysMsg",reflectMapper:e.sysMsg}]},qchatMultiSyncSystemNotificationUpdate:{service:"qchatMsg",sid:24,cid:23,response:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:e.qchatMsgUpdateTag},{type:"Property",name:"sysMsg",reflectMapper:e.sysMsg}]},qchatSyncSystemNotification:{service:"qchatMsg",sid:24,cid:24,response:[{type:"PropertyArray",name:"systemNotifications",reflectMapper:e.sysMsg}]},qchatMarkSysMsgRead:{service:"qchatMsg",sid:24,cid:28,params:[{type:"PropertyArray",name:"sysMsgs",reflectMapper:z_.sysMsg}]},qchatMessageSearchByPage:{service:"qchatMsg",sid:24,cid:94,params:[{type:"Property",name:"qchatMessageSearchByPageTag",reflectMapper:z_.qchatMessageSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:e.qchatPageQueryTag},{type:"PropertyArray",name:"datas",reflectMapper:e.qchatMsgTag}]},qchatGetMessageHistoryByIds:{service:"qchatMsg",sid:24,cid:100,params:[{type:"Property",name:"channelInfo",reflectMapper:{serverId:1,channelId:2}},{type:"PropertyArray",name:"messageReferList",reflectMapper:{msgIdServer:1,time:2}}],response:[{type:"PropertyArray",name:"qchatMsgs",reflectMapper:e.qchatMsgTag}]},qchatGetThreadMessages:{service:"qchatMsg",sid:24,cid:101,params:[{type:"Property",name:"qchatMsg",reflectMapper:z_.qchatMsgTag},{type:"Property",name:"getThreadHistoryMsgTag",reflectMapper:z_.getThreadHistoryMsgTag}],response:[{type:"Property",name:"thread",reflectMapper:e.qchatMsgTag},{type:"Property",name:"threadInfo",reflectMapper:{1:"messageCount",2:"lastMessageTimestamp"}},{type:"PropertyArray",name:"qchatMsgs",reflectMapper:e.qchatMsgTag}]},qchatUpdateQuickComment:{service:"qchatMsg",sid:24,cid:102,params:[{type:"Property",name:"tag",reflectMapper:z_.qchatQuickCommentRequestTag}]},qchatGetQuickComments:{service:"qchatMsg",sid:24,cid:103,params:[{type:"Property",name:"tag",reflectMapper:z_.qchatQuickCommentQueryTag}],response:[{type:"PropertyArray",name:"quickCommentResponse",reflectMapper:{1:"serverId",2:"channelId",3:"msgIdServer",4:"totalCount",5:"lastUpdateTime",6:"details"}}]},qchatGetThreadRootMessagesMeta:{service:"qchatMsg",sid:24,cid:108,params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,channelId:2}},{type:"PropertyArray",name:"qchatMsgs",reflectMapper:{time:7,msgIdServer:14}}],response:[{type:"PropertyArray",name:"metas",reflectMapper:{1:"total",2:"timestamp",3:"msgIdServer",4:"msgTime"}}]},qchatGetLastMessageOfChannels:{service:"qchatMsg",sid:24,cid:121,params:[{type:"Property",name:"tag",reflectMapper:z_.qchatGetLastMessageOfChannelsTag}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:e.qchatMsgTag}]},qchatMultiSyncServersMessageRead:{service:"qchatMsg",sid:25,cid:6,response:[{type:"Property",name:"qchatMultiSyncServersMessageReadTag",reflectMapper:e.qchatMultiSyncServersMessageReadTag}]},qchatGetMentionedMeMessages:{service:"qchatMsg",sid:24,cid:127,params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,channelId:2,timestamp:3,limit:4}}],response:[{type:"Property",name:"page",reflectMapper:e.qchatPageQueryTag},{type:"PropertyArray",name:"datas",reflectMapper:e.qchatMsgTag}]}}};!function(e){e[e.Android=1]="Android",e[e.iOS=2]="iOS",e[e.PC=4]="PC",e[e.WindowsPhone=8]="WindowsPhone",e[e.Web=16]="Web",e[e.Server=32]="Server",e[e.Mac=64]="Mac",e[e.HarmonyOS=65]="HarmonyOS"}(H_||(H_={}));var Z_,eE={"24_31":"qchatCreateServer","24_32":"qchatDeleteServer","24_33":"qchatUpdateServer","24_34":"qchatGetServers","24_35":"qchatGetServersByPage","24_36":"qchatInviteServerMembers","24_37":"qchatAcceptServerInvite","24_38":"qchatRejectInviteServer","24_39":"qchatApplyServerJoin","24_40":"qchatAcceptServerApply","24_41":"qchatRejectServerApply","24_42":"qchatKickServerMembers","24_43":"qchatLeaveServer","24_44":"qchatUpdateMyMemberInfo","24_45":"qchatUpdateServerMemberInfo","24_46":"qchatGetServerMembers","24_47":"qchatGetServerMembersByPage","24_104":"qchatUpdateServerMemberBan","24_105":"qchatGetBannedMembersByPage","24_91":"qchatServerSearchByPage","24_92":"qchatServerMemberSearchByPage","24_122":"qchatGenerateInviteCode","24_123":"qchatJoinByInviteCode","24_124":"qchatGetInviteApplyRecordOfServer","24_125":"qchatGetInviteApplyRecordOfSelf","25_5":"qchatClearServersUnread","25_7":"qchatSubscribeChannelsByServers","25_10":"qchatEnterAsVisitor","25_11":"qchatLeaveAsVisitor"},tE={serverInfo:{serverId:1,name:3,icon:4,ext:5,owner:6,memberNumber:7,inviteMode:8,applyMode:9,validFlag:10,createTime:11,updateTime:12,channelNumber:13,categoryNumber:14,searchType:15,searchEnable:16,reorderWeight:17},antispamTag:{antiSpamBusinessId:1},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},otherMemberInfo:{serverId:1,accid:3,nick:4,avatar:5,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},getServerListPageTag:{timestamp:1,limit:2},getServerMemberListPageTag:{serverId:1,timetag:2,limit:3},updateServerMemberBanTag:{serverId:1,opeType:2,accid:3,ext:4},getBannedMembersByPageTag:{serverId:1,timetag:2,limit:3},serverMemberBanInfo:{serverId:1,appid:2,accid:3,ext:4,banTime:5,validFlag:6,createTime:7,updateTime:8},serverSearchByPageTag:{keyword:1,startTime:2,endTime:3,order:4,limit:5,serverType:6,searchType:7,sort:8,cursor:9},serverMemberSearchByPageTag:{serverId:1,keyword:3,limit:4},inviteRespParamTag:{requestId:1},applyRespParamTag:{requestId:1,expireTime:2},inviteApplyRecord:{accid:1,type:2,serverId:3,status:4,requestId:5,createTime:6,updateTime:7,expireTime:8,data:9,recordId:10},clearServersUnreadTag:{successServerIds:1,failServerIds:2,ackTimestamp:3},unreadInfo:kC},rE=function(){return Ih(tE)},nE=function(){var e=rE();return{qchatCreateServer:{sid:24,cid:31,service:"qchatServer",params:[{type:"Property",name:"serverInfo",reflectMapper:tE.serverInfo},{type:"Property",name:"antispamTag",reflectMapper:tE.antispamTag}],response:[{type:"Property",name:"serverInfo",reflectMapper:e.serverInfo}]},qchatDeleteServer:{sid:24,cid:32,service:"qchatServer",params:[{type:"Long",name:"serverId"}]},qchatUpdateServer:{sid:24,cid:33,service:"qchatServer",params:[{type:"Property",name:"serverInfo",reflectMapper:tE.serverInfo},{type:"Property",name:"antispamTag",reflectMapper:tE.antispamTag}],response:[{type:"Property",name:"serverInfo",reflectMapper:e.serverInfo}]},qchatGetServers:{sid:24,cid:34,service:"qchatServer",params:[{type:"LongArray",name:"serverIds"}],response:[{type:"PropertyArray",name:"serverList",reflectMapper:e.serverInfo}]},qchatGetServersByPage:{sid:24,cid:35,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:tE.getServerListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.serverInfo}]},qchatInviteServerMembers:{sid:24,cid:36,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"StrArray",name:"accids"},{type:"String",name:"ps"},{type:"Property",name:"params",reflectMapper:{ttl:1}}],response:[{type:"StrArray",name:"failByOverAccids"},{type:"StrArray",name:"failByBanAccids"},{type:"Property",name:"record",reflectMapper:e.applyRespParamTag}]},qchatAcceptServerInvite:{sid:24,cid:37,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"Property",name:"recordInfo",reflectMapper:tE.inviteRespParamTag}]},qchatRejectInviteServer:{sid:24,cid:38,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"String",name:"ps"},{type:"Property",name:"recordInfo",reflectMapper:tE.inviteRespParamTag}]},qchatApplyServerJoin:{sid:24,cid:39,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"ps"},{type:"Property",name:"params",reflectMapper:{ttl:1}}],response:[{type:"Property",name:"data",reflectMapper:e.applyRespParamTag}]},qchatAcceptServerApply:{sid:24,cid:40,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"Property",name:"recordInfo",reflectMapper:tE.applyRespParamTag}]},qchatRejectServerApply:{sid:24,cid:41,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"String",name:"ps"},{type:"Property",name:"recordInfo",reflectMapper:tE.applyRespParamTag}]},qchatKickServerMembers:{sid:24,cid:42,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"StrArray",name:"accids"}]},qchatLeaveServer:{sid:24,cid:43,service:"qchatServer",params:[{type:"Long",name:"serverId"}]},qchatUpdateMyMemberInfo:{sid:24,cid:44,service:"qchatServer",params:[{type:"Property",name:"memberInfo",reflectMapper:tE.memberInfo},{type:"Property",name:"antispamTag",reflectMapper:tE.antispamTag}],response:[{type:"Property",name:"memberInfo",reflectMapper:e.memberInfo}]},qchatUpdateServerMemberInfo:{sid:24,cid:45,service:"qchatServer",params:[{type:"Property",name:"memberInfo",reflectMapper:tE.otherMemberInfo},{type:"Property",name:"antispamTag",reflectMapper:tE.antispamTag}],response:[{type:"Property",name:"memberInfo",reflectMapper:e.memberInfo}]},qchatGetServerMembers:{sid:24,cid:46,service:"qchatServer",params:[{type:"StrArray",name:"accids"}],response:[{type:"PropertyArray",name:"accidList",reflectMapper:e.memberInfo}]},qchatGetServerMembersByPage:{sid:24,cid:47,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:tE.getServerMemberListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.memberInfo}]},qchatUpdateServerMemberBan:{sid:24,cid:104,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:tE.updateServerMemberBanTag}]},qchatGetBannedMembersByPage:{sid:24,cid:105,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:tE.getBannedMembersByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:e.serverMemberBanInfo}]},qchatServerSearchByPage:{sid:24,cid:91,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:tE.serverSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag",3:"cursor"}},{type:"PropertyArray",name:"datas",reflectMapper:e.serverInfo}]},qchatServerMemberSearchByPage:{sid:24,cid:92,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:tE.serverMemberSearchByPageTag}],response:[{type:"PropertyArray",name:"members",reflectMapper:e.memberInfo}]},qchatGenerateInviteCode:{sid:24,cid:122,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,ttl:2}}],response:[{type:"Property",name:"data",reflectMapper:{1:"serverId",2:"requestId",3:"inviteCode",4:"expireTime"}}]},qchatJoinByInviteCode:{sid:24,cid:123,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,inviteCode:2,ps:3}}]},qchatGetInviteApplyRecordOfServer:{sid:24,cid:124,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,fromTime:2,toTime:3,reverse:4,limit:5,cursor:6}}],response:[{type:"PropertyArray",name:"data",reflectMapper:e.inviteApplyRecord}]},qchatGetInviteApplyRecordOfSelf:{sid:24,cid:125,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{fromTime:1,toTime:2,reverse:3,limit:4,cursor:5}}],response:[{type:"PropertyArray",name:"data",reflectMapper:e.inviteApplyRecord}]},qchatClearServersUnread:{sid:25,cid:5,service:"qchatServer",params:[{type:"LongArray",name:"serverIds"}],response:[{type:"Property",name:"clearServersUnreadTag",reflectMapper:e.clearServersUnreadTag}]},qchatSubscribeChannelsByServers:{sid:25,cid:7,service:"qchatServer",params:[{type:"Int",name:"type"},{type:"LongArray",name:"serverIds"}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:e.unreadInfo},{type:"String",name:"failServerIds"}]},qchatEnterAsVisitor:{sid:25,cid:10,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverIds:1}}],response:[{type:"String",name:"failServerIds"}]},qchatLeaveAsVisitor:{sid:25,cid:11,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverIds:1}}],response:[{type:"String",name:"failServerIds"}]}}},iE={"24_61":"qchatCreateServerRole","24_62":"qchatDeleteServerRole","24_63":"qchatUpdateServerRole","24_64":"qchatGetServerRoles","24_65":"qchatAddChannelRole","24_66":"qchatRemoveChannelRole","24_67":"qchatUpdateChannelRole","24_68":"qchatGetChannelRoles","24_69":"qchatAddMemberRole","24_70":"qchatRemoveMemberRole","24_71":"qchatUpdateMemberRole","24_72":"qchatGetMemberRoles","24_73":"qchatAddMembersToServerRole","24_74":"qchatRemoveMembersFromServerRole","24_75":"qchatGetMembersFromServerRole","24_76":"qchatGetServerRolesByAccid","24_77":"qchatGetExistingServerRolesByAccids","24_78":"qchatGetExistingChannelRolesByServerRoleIds","24_79":"qchatGetExistingAccidsOfMemberRoles","24_80":"qchatUpdateServerRolePriorities","24_81":"qchatGetExistingAccidsInServerRole","24_82":"qchatCheckPermission","24_83":"qchatAddChannelCategoryRole","24_84":"qchatRemoveChannelCategoryRole","24_85":"qchatUpdateChannelCategoryRole","24_86":"qchatGetChannelCategoryRole","24_87":"qchatAddChannelCategoryMemberRole","24_88":"qchatRemoveChannelCategoryMemberRole","24_89":"qchatUpdateChannelCategoryMemberRole","24_90":"qchatGetChannelCategoryMemberRole","24_126":"qchatCheckPermissions"},oE={channelRole:{serverId:1,roleId:2,parentRoleId:3,channelId:4,name:5,icon:6,ext:7,auths:8,type:9,createTime:10,updateTime:11},memberRole:{serverId:1,id:2,accid:3,channelId:4,auths:5,createTime:6,updateTime:7,nick:8,avatar:9,ext:10,memberType:11,joinTime:12,inviter:13},antispamTag:{antiSpamBusinessId:1},serverRole:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,type:7,memberCount:8,priority:9,createTime:10,updateTime:11,isMember:12},getRoleByPagesTag:{serverId:1,channelId:2,time:3,limit:4},checkPermissionTag:{serverId:1,channelId:2,auth:3},member:{serverId:1,roleId:2,accid:3,createTime:4,updateTime:5,nick:6,avatar:7,ext:8,type:9,joinTime:10,inviter:11},qchatAddChannelCategoryRoleTag:{categoryId:3,serverId:4,parentRoleId:5},channelCategoryRole:{roleId:1,categoryId:3,serverId:4,parentRoleId:5,type:6,validFlag:7,createTime:8,updateTime:9,auths:10,name:11,icon:12,ext:13},qchatGetChannelCategoryRoleTag:{serverId:1,categoryId:2,timetag:3,limit:4},channelCategoryMemberRole:{id:1,accid:3,categoryId:4,serverId:5,validFlag:6,createTime:7,updateTime:8,auths:9,nick:10,avatar:11,ext:12,memberType:13,joinTime:14,inviter:15},qchatGetChannelCategoryMemberRoleTag:{serverId:1,categoryId:2,timetag:3,limit:4},checkPermissionsTag:{serverId:1,channelId:2,auths:3}},aE=function(){return Ih(oE)},sE=function(){var e=aE();return{qchatCreateServerRole:{service:"qchatRole",sid:24,cid:61,params:[{type:"Property",name:"serverRole",reflectMapper:oE.serverRole},{type:"Property",name:"antispamTag",reflectMapper:oE.antispamTag}],response:[{type:"Property",name:"serverRole",reflectMapper:e.serverRole}]},qchatDeleteServerRole:{service:"qchatRole",sid:24,cid:62,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"}]},qchatUpdateServerRole:{service:"qchatRole",sid:24,cid:63,params:[{type:"Property",name:"updateServerRoleTag",reflectMapper:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,priority:7}},{type:"Property",name:"antispamTag",reflectMapper:oE.antispamTag}],response:[{type:"Property",name:"serverRole",reflectMapper:e.serverRole}]},qchatGetServerRoles:{service:"qchatRole",sid:24,cid:64,params:[{type:"Property",name:"getServerRolesTag",reflectMapper:{serverId:1,timetag:2,limit:3,priority:4,channelId:5,categoryId:6}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:e.serverRole}]},qchatAddChannelRole:{service:"qchatRole",sid:24,cid:65,params:[{type:"Property",name:"channelRole",reflectMapper:oE.channelRole}],response:[{type:"Property",name:"channelRole",reflectMapper:e.channelRole}]},qchatRemoveChannelRole:{service:"qchatRole",sid:24,cid:66,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"Long",name:"roleId"}]},qchatUpdateChannelRole:{service:"qchatRole",sid:24,cid:67,params:[{type:"Property",name:"updateChannelRoleTag",reflectMapper:{serverId:1,roleId:2,channelId:3,auths:4}}],response:[{type:"Property",name:"channelRole",reflectMapper:e.channelRole}]},qchatGetChannelRoles:{service:"qchatRole",sid:24,cid:68,params:[{type:"Property",name:"getChannelRolesTag",reflectMapper:{serverId:1,channelId:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"channelRoles",reflectMapper:e.channelRole}]},qchatAddMemberRole:{service:"qchatRole",sid:24,cid:69,params:[{type:"Property",name:"memberRole",reflectMapper:oE.memberRole}],response:[{type:"Property",name:"memberRole",reflectMapper:e.memberRole}]},qchatRemoveMemberRole:{service:"qchatRole",sid:24,cid:70,params:[{type:"Property",name:"memberRole",reflectMapper:oE.memberRole}]},qchatUpdateMemberRole:{service:"qchatRole",sid:24,cid:71,params:[{type:"Property",name:"updateMemberRoleTag",reflectMapper:{serverId:1,accid:2,channelId:3,auths:4}}],response:[{type:"Property",name:"memberRole",reflectMapper:e.memberRole}]},qchatGetMemberRoles:{service:"qchatRole",sid:24,cid:72,params:[{type:"Property",name:"getMemberRolesTag",reflectMapper:{serverId:1,channelId:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"memberRoles",reflectMapper:e.memberRole}]},qchatAddMembersToServerRole:{service:"qchatRole",sid:24,cid:73,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"Property",name:"accids",reflectMapper:{1:"successAccids",2:"failedAccids"}}]},qchatRemoveMembersFromServerRole:{service:"qchatRole",sid:24,cid:74,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"Property",name:"accids",reflectMapper:{1:"successAccids",2:"failedAccids"}}]},qchatGetMembersFromServerRole:{service:"qchatRole",sid:24,cid:75,params:[{type:"Property",name:"getMembersFromServerRoleTag",reflectMapper:{serverId:1,roleId:2,timetag:3,accid:4,limit:5}}],response:[{type:"PropertyArray",name:"members",reflectMapper:e.member}]},qchatGetServerRolesByAccid:{service:"qchatRole",sid:24,cid:76,params:[{type:"Property",name:"getServerRolesByAccidTag",reflectMapper:{serverId:1,accid:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:e.serverRole}]},qchatGetExistingServerRolesByAccids:{service:"qchatRole",sid:24,cid:77,params:[{type:"Long",name:"serverId"},{type:"String",name:"accids"}],response:[{type:"String",name:"serverRoles"}]},qchatGetExistingChannelRolesByServerRoleIds:{service:"qchatRole",sid:24,cid:78,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"String",name:"roleIds"}],response:[{type:"PropertyArray",name:"channelRoles",reflectMapper:e.channelRole}]},qchatGetExistingAccidsOfMemberRoles:{service:"qchatRole",sid:24,cid:79,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"String",name:"accids"}],response:[{type:"PropertyArray",name:"memberRoles",reflectMapper:e.memberRole}]},qchatUpdateServerRolePriorities:{service:"qchatRole",sid:24,cid:80,params:[{type:"Long",name:"serverId"},{type:"PropertyArray",name:"serverRoles",reflectMapper:{serverId:1,roleId:2,priority:7}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:e.serverRole}]},qchatGetExistingAccidsInServerRole:{service:"qchatRole",sid:24,cid:81,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"PropertyArray",name:"members",reflectMapper:e.member}]},qchatCheckPermission:{service:"qchatRole",sid:24,cid:82,params:[{type:"Property",name:"checkPermissionTag",reflectMapper:oE.checkPermissionTag}],response:[{type:"Bool",name:"checked"}]},qchatAddChannelCategoryRole:{service:"qchatRole",sid:24,cid:83,params:[{type:"Property",name:"qchatAddChannelCategoryRoleTag",reflectMapper:oE.channelCategoryRole}],response:[{type:"Property",name:"channelCategoryRole",reflectMapper:e.channelCategoryRole}]},qchatRemoveChannelCategoryRole:{service:"qchatRole",sid:24,cid:84,params:[{type:"Long",name:"serverId"},{type:"Long",name:"categoryId"},{type:"Long",name:"roleId"}]},qchatUpdateChannelCategoryRole:{service:"qchatRole",sid:24,cid:85,params:[{type:"Property",name:"qchatUpdateChannelCategoryRoleTag",reflectMapper:oE.channelCategoryRole}],response:[{type:"Property",name:"channelCategoryRole",reflectMapper:e.channelCategoryRole}]},qchatGetChannelCategoryRole:{service:"qchatRole",sid:24,cid:86,params:[{type:"Property",name:"qchatGetChannelCategoryRoleTag",reflectMapper:oE.qchatGetChannelCategoryRoleTag}],response:[{type:"PropertyArray",name:"list",reflectMapper:e.channelCategoryRole}]},qchatAddChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:87,params:[{type:"Property",name:"qchatAddChannelCategoryMemberRoleTag",reflectMapper:oE.channelCategoryMemberRole}],response:[{type:"Property",name:"channelCategoryMemberRole",reflectMapper:e.channelCategoryMemberRole}]},qchatRemoveChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:88,params:[{type:"Long",name:"serverId"},{type:"Long",name:"categoryId"},{type:"String",name:"accid"}]},qchatUpdateChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:89,params:[{type:"Property",name:"qchatUpdateChannelCategoryMemberRoleTag",reflectMapper:oE.channelCategoryMemberRole}],response:[{type:"Property",name:"channelCategoryMemberRole",reflectMapper:e.channelCategoryMemberRole}]},qchatGetChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:90,params:[{type:"Property",name:"qchatGetChannelCategoryMemberRoleTag",reflectMapper:oE.qchatGetChannelCategoryMemberRoleTag}],response:[{type:"PropertyArray",name:"list",reflectMapper:e.channelCategoryMemberRole}]},qchatCheckPermissions:{service:"qchatRole",sid:24,cid:126,params:[{type:"Property",name:"checkPermissionsTag",reflectMapper:oE.checkPermissionsTag}],response:[{type:"PropertyArray",name:"checkPermissionsResult",reflectMapper:{1:"auth",2:"isAllow"}}]}}},cE=["image","audio","video","file"],uE={time:{type:"number"},updateTime:{type:"number"},resendFlag:{type:"boolean"},persistEnable:{type:"boolean"},routeEnable:{type:"boolean"},pushEnable:{type:"boolean"},needBadge:{type:"boolean"},needPushNick:{type:"boolean"},type:{type:"enum",values:y_},fromClientType:{type:"enum",values:H_},status:{type:"number"},toAccids:{type:"object"},toType:{type:"number"},attach:{type:"object"},pushPayload:{type:"object"}};function dE(e,t){var r=dr({},e),n=dr({type:t||y_.custom},Uh(uE,r));return n.serverId&&n.channelId&&n.toAccids?n.toType=4:n.serverId&&n.toAccids?n.toType=3:n.serverId&&n.channelId?n.toType=2:n.serverId?n.toType=1:n.toAccids?n.toType=5:n.toType=0,n}function lE(e){var t=og(e,["msgIdServer","type"]);return Uh(uE,t)}var pE=((Z_={})[y_.channelUpdateWhiteBlackIdentify]=function(e){var t=NC();return e.notify=qC(yh(e.notify,t.qchatUpdateWhiteBlackRoleTag)),e},Z_[y_.channelUpdateWhiteBlackIdentifyUser]=function(e){var t=NC();return e.notify=function(e){return Ph(LC,e)}(yh(e.notify,t.qchatUpdateWhiteBlackMembersTag)),e},Z_[y_.updateQuickComment]=function(e){var t=X_();return e.notify=function(e){return Ph(TE,e)}(yh(e.notify,t.qchatQuickCommentRequestTag)),e},Z_[y_.channelCategoryCreate]=function(e){var t=NC();return e.categoryInfo=HC(yh(e.categoryInfo,t.QChatChannelCategoryInfo)),e},Z_[y_.channelCategoryUpdate]=function(e){var t=NC();return e.categoryInfo=HC(yh(e.categoryInfo,t.QChatChannelCategoryInfo)),e},Z_[y_.channelCategoryUpdateWhiteBlackIdentify]=function(e){var t=NC();return e.notify=qC(yh(e.notify,t.qchatUpdateChannelCategoryWhiteBlackRoleTag)),e},Z_[y_.channelCategoryUpdateWhiteBlackIdentifyUser]=function(e){var t=NC();return e.notify=qC(yh(e.notify,t.qchatUpdateChannelCategoryWhiteBlackMembersTag)),e},Z_[y_.serverIdentifyAdd]=function(e){var t=aE();return e.serverIdentifyInfo=__(yh(e.serverIdentifyInfo,t.serverRole)),e},Z_[y_.serverIdentifyRemove]=function(e){var t=aE();return e.serverIdentifyInfo=__(yh(e.serverIdentifyInfo,t.serverRole)),e},Z_[y_.serverIdentifyUpdate]=function(e){var t=aE();return e.serverIdentifyInfo=__(yh(e.serverIdentifyInfo,t.serverRole)),e},Z_[y_.channelIdentifyUpdate]=function(e){var t=aE();return e.channelIdentifyInfo=__(yh(e.channelIdentifyInfo,t.channelRole)),e},Z_[y_.userIdentifyUpdate]=function(e){var t=aE();return e.userIdentifyInfo=__(yh(e.userIdentifyInfo,t.memberRole)),e},Z_[y_.myMemberInfoUpdated]=function(e){var t,r=Zp(e,"userInfo.name"),n=Zp(e,"userInfo.icon");return e.updatedInfos=du(t=e.reuseServers).call(t,(function(e){var t={serverId:e.serverId};return!(1&~e.bits)&&"string"==typeof r&&dr(t,{nickChanged:!0,nick:r}),!(2&~e.bits)&&"string"==typeof n&&dr(t,{avatarChanged:!0,avatar:n}),t})),delete e.userInfo,delete e.reuseServers,e},Z_);function mE(e,t){var r=Ph(uE,e);if(!r.attach)return r;var n=rE(),i=NC();if(r.attach.serverInfo&&(r.attach.serverInfo=XC(yh(r.attach.serverInfo,n.serverInfo))),r.attach.channelInfo&&(r.attach.channelInfo=BC(yh(r.attach.channelInfo,i.channelInfo))),r.attach.serverMember&&(r.attach.serverMember=ZC(yh(r.attach.serverMember,n.memberInfo))),pE[r.attach.type]&&(r.attach=pE[r.attach.type](r.attach)),r.attach.updateAuths)try{r.attach.updateAuths=C_(JSON.parse(r.attach.updateAuths))}catch(e){t.error("formatSystemNotification:JSON parse updateAuths error: ",e)}return r.attach.type&&(r.attach.rawType=r.attach.type,r.attach.type=y_[r.attach.type]),r}var hE={type:{type:"enum",values:h_},fromClientType:{type:"enum",values:H_},status:{type:"number"},resendFlag:{type:"boolean"},mentionAll:{type:"boolean"},notifyReason:{type:"enum",values:g_},pushEnable:{type:"boolean"},historyEnable:{type:"boolean"},needBadge:{type:"boolean"},needPushNick:{type:"boolean"},routeEnable:{type:"boolean"},time:{type:"number"},updateTime:{type:"number"},mentionAccids:{type:"object"},mentionRoleIds:{type:"object"},accidsOfMentionedRoles:{type:"object"},attach:{type:"object"},pushPayload:{type:"object"},isAntispam:{type:"boolean"},antiSpamInfo:{useCustomContent:{type:"boolean"},antiSpamContent:{type:"string"},antiSpamBusinessId:{type:"string"},antiSpamUsingYidun:{type:"boolean"},yidunCallback:{type:"string"},yidunAntiCheating:{type:"object"},yidunAntiSpamExt:{type:"object"},yidunAntiSpamRes:{type:"string"}},replyRefer:{fromAccount:{type:"string",rawKey:"replyMsgFromAccount"},time:{type:"number",rawKey:"replyMsgTime"},msgIdServer:{type:"string",rawKey:"replyMsgIdServer"},msgIdClient:{type:"string",rawKey:"replyMsgIdClient"}},threadRefer:{fromAccount:{type:"string",rawKey:"threadMsgFromAccount"},time:{type:"number",rawKey:"threadMsgTime"},msgIdServer:{type:"string",rawKey:"threadMsgIdServer"},msgIdClient:{type:"string",rawKey:"threadMsgIdClient"}}};function fE(e){e.onSendBefore,e.onUploadStart,e.onUploadDone,e.onUploadProgress;var t=Jl(e,["onSendBefore","onUploadStart","onUploadDone","onUploadProgress"]),r=Uh(hE,t);if(r.msgIdClient=e.resendFlag?e.msgIdClient:Ep(),!r.msgIdClient)throw new Rl("msgIdClient is required for resend a message","msgIdClient","required");return e.replyMessage&&e.replyMessage.msgIdServer&&(r.replyMsgFromAccount=e.replyMessage.fromAccount,r.replyMsgTime=+e.replyMessage.time,r.replyMsgIdServer=e.replyMessage.msgIdServer,r.replyMsgIdClient=e.replyMessage.msgIdClient,e.replyMessage.threadRefer&&e.replyMessage.threadRefer.msgIdServer?(r.threadMsgFromAccount=e.replyMessage.threadRefer.fromAccount,r.threadMsgTime=+e.replyMessage.threadRefer.time,r.threadMsgIdServer=e.replyMessage.threadRefer.msgIdServer,r.threadMsgIdClient=e.replyMessage.threadRefer.msgIdClient):(r.threadMsgFromAccount=e.replyMessage.fromAccount,r.threadMsgTime=+e.replyMessage.time,r.threadMsgIdServer=e.replyMessage.msgIdServer,r.threadMsgIdClient=e.replyMessage.msgIdClient),delete r.replyMessage),r}function gE(e){return Ph({operatorClientType:{type:"enum",values:H_},pushPayload:{type:"object"}},e)}function vE(e,t,r){var n,i;return void 0===t&&(t={}),zl(this,void 0,void 0,Ql.mark((function o(){var a,s,c,u;return Ql.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return(a=Ph(hE,e)).deliveryStatus=t.deliveryStatus?f_[t.deliveryStatus]:f_[f_.success],t.time&&(a.time=t.time),s=X_(),a.updateContent&&(c=Ph({status:{type:"number"}},c=yh(c=JSON.parse(a.updateContent),s.qchatMsgTag)),a.updateContent=c),a.updateOperatorInfo&&(u=gE(yh(u=JSON.parse(a.updateOperatorInfo),s.qchatMsgUpdateTag)),a.updateOperatorInfo=u),""===(null===(n=null==a?void 0:a.threadRefer)||void 0===n?void 0:n.fromAccount)&&delete a.threadRefer,""===(null===(i=null==a?void 0:a.replyRefer)||void 0===i?void 0:i.fromAccount)&&delete a.replyRefer,a.attach&&t.attachUrl&&(a.attach.url=t.attachUrl),o.next=11,yE(a,r);case 11:return o.abrupt("return",o.sent);case 12:case"end":return o.stop()}}),o)})))}function yE(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(ou(cE).call(cE,e.type)&&e.attach&&e.attach.url){r.next=2;break}return r.abrupt("return",e);case 2:if(t&&t.cloudStorage&&"function"==typeof t.cloudStorage.getPrivateUrl&&"function"==typeof t.cloudStorage.getOriginUrl){r.next=4;break}return r.abrupt("return",e);case 4:if(!(wu(n=e.attach.url).call(n,"_im_url=1")<0)){r.next=7;break}return e.attach.url=t.cloudStorage.getPrivateUrl(e.attach.url),r.abrupt("return",e);case 7:return r.prev=7,r.next=10,t.cloudStorage.getOriginUrl(e.attach.url);case 10:e.attach.url=r.sent,r.next=16;break;case 13:throw r.prev=13,r.t0=r.catch(7),new Rl('url "'+e.attach.url+'" parse error',"message.attach.url","parse error");case 16:return r.abrupt("return",e);case 17:case"end":return r.stop()}}),r,null,[[7,13]])})))}function ME(e,t,r){return void 0===t&&(t={}),zl(this,void 0,void 0,Ql.mark((function n(){var i;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(Ei(e)&&e.length>0){n.next=2;break}return n.abrupt("return",[]);case 2:return i=du(e).call(e,(function(e){return vE(e,t,r)})),n.next=5,fs.all(i);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}}),n)})))}var IE={totalCount:{type:"number"},lastUpdateTime:{type:"number"},details:{type:"object"}};function SE(e){var t=du(e).call(e,(function(e){var t,r=Ph(IE,e);return r.details=du(t=r.details).call(t,(function(e){var t=e.createTime?$p(e.createTime):0;return t=isNaN(t)?0:t,{count:e.count,hasSelf:e.self,severalAccids:e.topN,type:e.type,createTime:t}})),r})),r={};return jn(t).call(t,(function(e){return r[e.msgIdServer]=e})),r}var TE={type:{type:"number"},time:{type:"number"},opeType:{type:"number"}},bE={includeSelf:{type:"number"},order:{type:"enum",values:bC},sort:{type:"enum",values:m_},msgTypes:{type:"object"},subTypes:{type:"object"}},CE={hasMore:{type:"boolean"},nextTimetag:{type:"number"},cursor:{type:"string"}},_E={6:function(e){return this.core.qchatChannel.subscribeForVisitorService.deleteAutoSetInServerId(e.serverId),!0},16:function(e){return this.core.qchatChannel.subscribeForVisitorService.deleteAutoSetInChannel(e.serverId,e.channelId),!0},26:function(e){var t=Zp(e,"attach.addAccids");return t&&ou(t).call(t,this.core.account)&&this.core.eventBus.emit("qchatChannel/serverIdentifyChange",e),!0},27:function(e){var t=Zp(e,"attach.deleteAccids");return t&&ou(t).call(t,this.core.account)&&this.core.eventBus.emit("qchatChannel/serverIdentifyChange",e),!0},31:function(e){var t,r;return 1===e.attach.event?(null===(r=null===(t=this.core.qchatChannel)||void 0===t?void 0:t.config)||void 0===r?void 0:r.autoSubscribe)&&this.core.qchatChannel.subscribeChannel({type:1,opeType:1,channels:[{serverId:e.serverId,channelId:e.channelId}],isInternalTrigger:!0}):2===e.attach.event&&(this.core.eventBus.emit("qchatChannel/autoUnSubscribe",e),this.core.eventBus.emit("qchatMedia/serverOrChannelLeave",e)),!0},32:function(e){var t,r;return 2===e.attach.event?(this.core.eventBus.emit("qchatChannel/autoUnSubscribe",e),this.core.eventBus.emit("qchatMedia/serverOrChannelLeave",e)):1===e.attach.event&&(this.core.qchatChannel.subscribeForVisitorService.deleteServer(e.serverId),(null===(r=null===(t=this.core.qchatChannel)||void 0===t?void 0:t.config)||void 0===r?void 0:r.autoSubscribe)&&this.core.qchatServer.subscribeServer({type:4,opeType:1,servers:[{serverId:e.serverId}],isInternalTrigger:!0})),!0},34:function(e){return 2===e.attach.event&&this.core.qchatChannel.subscribeForVisitorService.unSubscribeChannel(e.serverId,e.channelId),!0},101:function(e){var t=og(e,["serverId","channelId","ext","fromAccount","fromNick","time"]);return this.logger.log("qchat on recvTypingEvent: ",t),this.core.emit("recvTypingEvent",t),this.core.qchatMsg.emit("recvTypingEvent",t),!1}},EE=function(){function e(e){this.core=e,this.logger=e.logger}var t=e.prototype;return t.sendSystemNotification=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatSendCustomSysMsg",{sysMsg:dE(e)});case 2:return r=t.sent,n=mE(r.content.sysMsg,this.logger),this.logger.getDebugMode()?this.logger.debug("sendCustomSysMsg success",n):this.logger.log("sendCustomSysMsg success",n.serverId,n.channelId,n.msgIdServer),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t,this)})))},t.updateSystemNotification=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.systemNotification,n=Jl(e,["systemNotification"]),i=og(r,["msgIdServer","type","body","ext","status"]),o=dE(i),t.next=5,this.core.sendCmd("qchatUpdateSystemNotification",{sysMsg:o,qchatMsgUpdateTag:dr(dr({},n),{operatorAccount:this.core.account,operatorClientType:H_.Web,pushPayload:_i(e.pushPayload),routeEnable:Bh.boolean(e,"routeEnable")})});case 5:return a=t.sent,t.abrupt("return",mE(a.content.sysMsg,this.logger));case 7:case"end":return t.stop()}}),t,this)})))},t.markSystemNotificationsRead=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatMarkSysMsgRead",{sysMsgs:du(r=e.systemNotifications).call(r,(function(e){return lE(e)}))});case 2:case"end":return t.stop()}}),t,this)})))},t.onSysMsg=function(e){var t=e.content.sysMsg;if(t){var r=mE(t,this.core.logger),n=_E[y_[r.type]];if(n&&!1===n.call(this,r))return;var i={feature:"default",systemNotifications:[r]};this.logger.log("qchat on systemNotification: ",i),this.core.emit("systemNotification",i),this.core.qchatMsg.emit("systemNotification",i)}else this.core.logger.warn("No sysMsg in onSysMsg packet")},t.onMultiSysMsg=function(e){var t=e.content.sysMsg;if(t){var r=mE(t,this.logger);this.core.emit("systemNotificationUpdate",r),this.core.qchatMsg.emit("systemNotificationUpdate",r)}},t.onSyncSysMsg=function(e){var t=this,r=e.content.systemNotifications;if(r&&r.length>0){var n=du(r).call(r,(function(e){return mE(e,t.logger)}));this.core.emit("systemNotification",{feature:"sync",systemNotifications:n}),this.core.qchatMsg.emit("systemNotification",{feature:"sync",systemNotifications:n})}else this.logger.warn("sync system notification not exist")},e}(),wE=["image","audio","video","file"],RE=function(){function e(e){var t=this;this.markMessageRead=P_((function(e){return zl(t,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatMarkMessageRead",{markMsgReadTag:e});case 2:r=t.sent,n=GC(r.content.unreadInfo),this.core.eventBus.emit("qchatChannel/updateUnreads",[n]);case 5:case"end":return t.stop()}}),t,this)})))}),200),this.core=e,this.logger=e.logger}var t=e.prototype;return t.sendMessage=function(e){var t,r,n,i;return zl(this,void 0,void 0,Ql.mark((function o(){var a,s,c,u,d,l;return Ql.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(!(wu(wE).call(wE,e.type)>-1)){o.next=4;break}return o.next=3,this.doSendFile(e);case 3:e.attach=o.sent;case 4:return a=fE(dr({fromAccount:this.core.account},e)),o.next=7,vE(a,{time:(new Date).getTime(),deliveryStatus:f_.sending},this.core);case 7:s=o.sent;try{e.onSendBefore&&e.onSendBefore(s)}catch(e){this.logger.error("sendMsg: options.onSendBefore error",e)}return o.prev=9,o.next=12,this.core.sendCmd("qchatSendMsg",{qchatMsg:a});case 12:c=o.sent,o.next=22;break;case 15:return o.prev=15,o.t0=o.catch(9),o.next=19,vE(a,{time:(new Date).getTime(),deliveryStatus:f_.failed,attachUrl:null===(t=s.attach)||void 0===t?void 0:t.url},this.core);case 19:throw u=o.sent,o.t0.msg=u,o.t0;case 22:return d=c.content,o.next=25,vE(dr({},d.qchatMsg),{deliveryStatus:f_.success,attachUrl:null===(r=s.attach)||void 0===r?void 0:r.url},this.core);case 25:if(!(l=o.sent).isAntispam){o.next=29;break}throw{code:10403,msg:l,message:(null===(n=null==l?void 0:l.antiSpamInfo)||void 0===n?void 0:n.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:(null===(i=null==l?void 0:l.antiSpamInfo)||void 0===i?void 0:i.yidunAntiSpamRes)||""};case 29:return o.abrupt("return",l);case 30:case"end":return o.stop()}}),o,this,[[9,15]])})))},t.doSendFile=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Pl({type:{type:"enum",values:["image","audio","video","file"]},attach:{type:"object",rules:{url:{type:"string",allowEmpty:!1}},required:!1},maxSize:{type:"number",min:1,required:!1}},e),r=e.attach){t.next=15;break}if(this.core.cloudStorage&&this.core.cloudStorage.uploadFile){t.next=5;break}throw new Error('Service "cloudStorage" does not exist');case 5:return t.prev=5,t.next=8,this.core.cloudStorage.uploadFile(e);case 8:r=t.sent,t.next=15;break;case 11:throw t.prev=11,t.t0=t.catch(5),this.logger.error("sendFile:: upload File error or abort.",t.t0),t.t0;case 15:return t.abrupt("return",r);case 16:case"end":return t.stop()}}),t,this,[[5,11]])})))},t.resendMessage=function(e){var t,r;return zl(this,void 0,void 0,Ql.mark((function n(){var i,o,a,s,c;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return(i=fE(dr(dr({},e),{resendFlag:!0}))).deliveryStatus=f_.sending,n.prev=2,n.next=5,this.core.sendCmd("qchatSendMsg",{qchatMsg:i});case 5:o=n.sent,n.next=15;break;case 8:return n.prev=8,n.t0=n.catch(2),n.next=12,vE(i,{time:(new Date).getTime(),deliveryStatus:f_.failed},this.core);case 12:throw a=n.sent,n.t0.msg=a,n.t0;case 15:return s=o.content,n.next=18,vE(dr({},s.qchatMsg),{deliveryStatus:f_.success},this.core);case 18:if(!(c=n.sent).isAntispam){n.next=22;break}throw{code:10403,msg:c,message:(null===(t=null==c?void 0:c.antiSpamInfo)||void 0===t?void 0:t.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:(null===(r=null==c?void 0:c.antiSpamInfo)||void 0===r?void 0:r.yidunAntiSpamRes)||""};case 22:return n.abrupt("return",c);case 23:case"end":return n.stop()}}),n,this,[[2,8]])})))},t.doUpdateMessage=function(e){var t,r;return zl(this,void 0,void 0,Ql.mark((function n(){var i,o,a,s,c;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=e.message,o=Jl(e,["message"]),(a=fE(i)).msgIdClient=void 0,a.time=i.time,n.next=6,this.core.sendCmd("qchatUpdateMessage",{qchatMsg:a,qchatMsgUpdateTag:dr(dr({},o),{operatorAccount:this.core.account,operatorClientType:H_.Web,pushPayload:_i(e.pushPayload),routeEnable:Bh.boolean(e,"routeEnable")})});case 6:return s=n.sent,n.next=9,vE(s.content.qchatMsg,{},this.core);case 9:if(c=n.sent,this.core.eventBus.emit("qchatChannel/changeUnread",c,!0),!s.content.qchatMsg.isAntispam){n.next=14;break}throw{code:10403,msg:a,message:(null===(t=s.content.qchatMsg)||void 0===t?void 0:t.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:(null===(r=s.content.qchatMsg)||void 0===r?void 0:r.yidunAntiSpamRes)||""};case 14:return n.abrupt("return",c);case 15:case"end":return n.stop()}}),n,this)})))},t.getHistoryMessage=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatGetHistoryMsg",{getHistoryMsgTag:dr(dr({},e),{reverse:Dc(e)?1:0})});case 2:return n=t.sent,i=n.content,t.next=6,fs.all(du(r=i.qchatMsgs).call(r,(function(e){return vE(e,{},o.core)})));case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t,this)})))},t.getMentionedMeMessages=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a,s=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatGetMentionedMeMessages",{tag:e});case 2:return n=t.sent,c=(i=n.content).page,o=Ph(CE,c),t.next=7,fs.all(du(r=i.datas).call(r,(function(e){return vE(e,{},s.core)})));case 7:return a=t.sent,t.abrupt("return",{pageInfo:o,messages:a});case 9:case"end":return t.stop()}var c}),t,this)})))},t.areMentionedMeMessages=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r={},n=0;case 2:if(!(n<e.length)){t.next=13;break}if((i=e[n]).fromAccount!==this.core.account){t.next=7;break}return r[i.msgIdClient]=!1,t.abrupt("continue",10);case 7:return t.next=9,this.core.qchatChannel.subscribeModuleService.getMentionedFlag(i,!0);case 9:r[i.msgIdClient]=t.sent;case 10:n++,t.next=2;break;case 13:return t.abrupt("return",r);case 14:case"end":return t.stop()}}),t,this)})))},t.getLastMessageOfChannels=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatGetLastMessageOfChannels",{tag:e});case 2:return r=t.sent,n=r.content.msgs,t.next=6,ME(n,{},this.core);case 6:return i=t.sent,t.abrupt("return",Ml(i).call(i,(function(e,t){return e[t.channelId]=t,e}),{}));case 8:case"end":return t.stop()}}),t,this)})))},t.messageSearchByPage=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatMessageSearchByPage",{qchatMessageSearchByPageTag:dr(dr({},(s=e,Uh(bE,s))),{includeSelf:e.includeSelf?1:""})});case 2:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.next=6,ME(i,{},this.core);case 6:return a=t.sent,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:o.nextTimetag?$p(o.nextTimetag):0,cursor:o.cursor},datas:a});case 8:case"end":return t.stop()}var s}),t,this)})))},t.onMsg=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.content.qchatMsg){t.next=4;break}return this.logger.warn("No qchatMsg in qchatMsg packet"),t.abrupt("return");case 4:return t.next=6,vE(r,{},this.core);case 6:n=t.sent,this.core.eventBus.emit("qchatChannel/changeUnread",n,!1),this.core.emit("message",n),this.core.qchatMsg.emit("message",n);case 10:case"end":return t.stop()}}),t,this)})))},t.onRecvUnreadInfo=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.content.qchatMsg){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,vE(r);case 5:n=t.sent,this.core.eventBus.emit("qchatChannel/changeUnread",n,!1);case 7:case"end":return t.stop()}}),t,this)})))},t.onMultiSyncRead=function(e){var t=e.content.unreadInfo;if(t){var r=GC(t);this.core.eventBus.emit("qchatChannel/updateUnreads",[r])}},t.onMultiSyncServersRead=function(e){var t=e.content.qchatMultiSyncServersMessageReadTag;if(t){var r=l_(t),n=r.successServerIds,i=r.ackTimestamp;this.core.eventBus.emit("qchatChannel/clearUnreadCountByServers",n,i)}},t.onRecvMsgUpdate=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.content.qchatMsg,n=e.content.qchatMsgUpdateInfo,r){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,vE(r,{},this.core);case 6:i=t.sent,o=gE(n),this.core.eventBus.emit("qchatChannel/changeUnread",i,!0),this.core.emit("messageUpdate",i,o),this.core.qchatMsg.emit("messageUpdate",i,o);case 11:case"end":return t.stop()}}),t,this)})))},e}(),kE=function(){function e(e){var t=this;this._sendTypingEvent=P_((function(e){return zl(t,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatSendCustomSysMsg",{sysMsg:dE(dr(dr({},e),{resendFlag:!1,persistEnable:!1,routeEnable:!1,pushEnable:!1,needBadge:!1,needPushNick:!1}),y_.msgTyping)});case 2:case"end":return t.stop()}}),t,this)})))}),3e3),this.core=e,this.logger=e.logger,this.lastChannelIdInTyping=""}var t=e.prototype;return t.getMessageHistoryByIds=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatGetMessageHistoryByIds",{channelInfo:{serverId:e.serverId,channelId:e.channelId},messageReferList:e.messageReferList});case 2:return n=t.sent,t.abrupt("return",fs.all(du(r=n.content.qchatMsgs).call(r,(function(e){return vE(e)}))));case 4:case"end":return t.stop()}}),t,this)})))},t.getReferMessages=function(e){var t,r;return zl(this,void 0,void 0,Ql.mark((function n(){var i;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if((null===(t=e.message.replyRefer)||void 0===t?void 0:t.msgIdServer)&&(null===(r=e.message.threadRefer)||void 0===r?void 0:r.msgIdServer)){n.next=2;break}throw new Error("Message has no reply");case 2:return n.next=4,this.getMessageHistoryByIds({serverId:e.message.serverId,channelId:e.message.channelId,messageReferList:[e.message.replyRefer,e.message.threadRefer]});case 4:if(i=n.sent,e.referType!==M_[M_.all]){n.next=9;break}return n.abrupt("return",{replyMessage:i[0],threadMessage:i[1]});case 9:if(e.referType!==M_[M_.reply]){n.next=13;break}return n.abrupt("return",{replyMessage:i[0]});case 13:if(e.referType!==M_[M_.thread]){n.next=15;break}return n.abrupt("return",{threadMessage:i[1]});case 15:return n.abrupt("return",{replyMessage:i[0],threadMessage:i[1]});case 16:case"end":return n.stop()}}),n,this)})))},t.getThreadMessages=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o,a,s;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=(null===(t=e.message.threadRefer)||void 0===t?void 0:t.msgIdServer)?dr({serverId:e.message.serverId,channelId:e.message.channelId},e.message.threadRefer):e.message,r.next=3,this.core.sendCmd("qchatGetThreadMessages",{qchatMsg:i,getThreadHistoryMsgTag:dr(dr({},e.messageQueryOption),{reverse:Bh.boolean(e.messageQueryOption,"reverse")})});case 3:return o=r.sent,r.next=6,vE(o.content.thread);case 6:return a=r.sent,r.next=9,fs.all(du(n=o.content.qchatMsgs).call(n,(function(e){return vE(e)})));case 9:return s=r.sent,r.abrupt("return",{thread:a,threadInfo:{messageCount:+o.content.threadInfo.messageCount,lastMessageTimestamp:+o.content.threadInfo.lastMessageTimestamp},messages:s});case 11:case"end":return r.stop()}}),r,this)})))},t.getThreadRootMessagesMeta=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.threadRootMessages,n=Jl(e,["threadRootMessages"]),t.next=3,this.core.sendCmd("qchatGetThreadRootMessagesMeta",{qchatMsgs:r,tag:n});case 3:if(i=t.sent,!((o=i.content.metas)&&o.length>0)){t.next=7;break}return t.abrupt("return",du(o).call(o,(function(e){return dr(dr({},e),{total:$p(e.total),timestamp:$p(e.timestamp),msgTime:$p(e.msgTime)})})));case 7:return t.abrupt("return",[]);case 8:case"end":return t.stop()}}),t,this)})))},t.getQuickComments=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatGetQuickComments",{tag:{serverId:e.serverId,channelId:e.channelId,msgIdServerList:_i(du(r=e.msgList).call(r,(function(e){return e.msgIdServer})))}});case 2:return n=t.sent,i=n.content.quickCommentResponse,t.abrupt("return",SE(i));case 5:case"end":return t.stop()}}),t,this)})))},t.updateQuickComment=function(e,t){return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o,a,s,c;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Pl({type:{type:"number"},commentMessage:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1}}}},e),n=e.commentMessage,i=n.serverId,o=n.channelId,a=n.fromAccount,s=n.msgIdServer,c=n.time,r.next=4,this.core.sendCmd("qchatUpdateQuickComment",{tag:{serverId:i,channelId:o,fromAccount:a,msgIdServer:s,time:c,type:e.type,opeType:t,opeAccid:this.core.account}});case 4:case"end":return r.stop()}}),r,this)})))},t.sendTypingEvent=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.channelId!==this.lastChannelIdInTyping){t.next=4;break}return this.logger.log("qchatMsg sendTypingEvent throttle"),this._sendTypingEvent(e),t.abrupt("return");case 4:this.lastChannelIdInTyping=e.channelId,this._sendTypingEvent.flush(),this._sendTypingEvent(e);case 7:case"end":return t.stop()}}),t,this)})))},e}(),AE=function(e){function t(t){var r;return(r=e.call(this,"qchatMsg",t)||this).core=t,r.lastChannelIdInMark="",Mh({cmdMap:J_,cmdConfig:$_()}),r.notificationModuleService=new EE(t),r.messageModuleService=new RE(t),r.extendModuleService=new kE(t),r}nr(t,e);var r=t.prototype;return r.sendMessage=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},type:{type:"enum",values:wp(h_)},ext:{type:"string",required:!1},mentionAll:{type:"boolean",required:!1},mentionAccids:{type:"array",itemType:"string",required:!1},mentionRoleIds:{type:"array",itemType:"string",required:!1,min:1},historyEnable:{type:"boolean",required:!1},pushEnable:{type:"boolean",required:!1}},e),t.next=3,this.messageModuleService.sendMessage(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.updateMessage=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Pl({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0},body:{type:"string",required:!1},ext:{type:"string",required:!1}}}},e),!("number"==typeof e.message.status&&e.message.status<1e4)){t.next=3;break}throw new Al("Status should be greater than or equal to 10000");case 3:return t.next=5,this.messageModuleService.doUpdateMessage(e);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})))},r.resendMessage=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdClient:{type:"string",allowEmpty:!1}},e),t.next=3,this.messageModuleService.resendMessage(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.deleteMessage=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0}}}},e),(r=JSON.parse(_i(e))).message.status=2,t.next=5,this.messageModuleService.doUpdateMessage(r);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})))},r.revokeMessage=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0}}}},e),(r=JSON.parse(_i(e))).message=og(r.message,["serverId","channelId","msgIdServer","time"]),r.message.status=1,t.next=6,this.messageModuleService.doUpdateMessage(r);case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t,this)})))},r.markMessageRead=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Pl({serverId:{type:"string"},channelId:{type:"string"},time:{type:"number",min:0}},e),e.channelId!==this.lastChannelIdInMark&&this.messageModuleService.markMessageRead.flush(),this.lastChannelIdInMark=e.channelId,this.messageModuleService.markMessageRead(e);case 4:case"end":return t.stop()}}),t,this)})))},r.replyMessage=function(e){Pl({replyMessage:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1}}}},e);var t=e.replyMessage;if(e.serverId!==t.serverId||e.channelId!==t.channelId)throw new Al("Forbid replying to message from other server, channel");return this.sendMessage(e)},r.getMessageHistoryByIds=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},messageReferList:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}}},e),t.next=3,this.extendModuleService.getMessageHistoryByIds(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.getReferMessages=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({message:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}},referType:{type:"enum",values:wp(M_),required:!1}},e),t.next=3,this.extendModuleService.getReferMessages(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.getThreadMessages=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({message:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}},messageQueryOption:{type:"object",rules:{beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},excludeMsgId:{type:"string",required:!1},limit:{type:"number",required:!1},reverse:{type:"boolean",required:!1}}}},e),t.next=3,this.extendModuleService.getThreadMessages(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.getThreadRootMessagesMeta=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},threadRootMessages:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}}},e),t.next=3,this.extendModuleService.getThreadRootMessagesMeta(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.sendSystemNotification=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},attach:{type:"object",required:!1}},e),t.next=3,this.notificationModuleService.sendSystemNotification(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.updateSystemNotification=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({systemNotification:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},type:{type:"enum",values:wp(y_)},body:{type:"string",required:!1},ext:{type:"string",required:!1},status:{type:"number",required:!1}}}},e),t.next=3,this.notificationModuleService.updateSystemNotification(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.markSystemNotificationsRead=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({systemNotifications:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},type:{type:"string",allowEmpty:!1}},min:1}},e),t.next=3,this.notificationModuleService.markSystemNotificationsRead(e);case 3:case"end":return t.stop()}}),t,this)})))},r.getHistoryMessage=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},beginTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:0,required:!1},excludeMsgId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1},reverse:{type:"boolean",required:!1}},e),t.next=3,this.messageModuleService.getHistoryMessage(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.getMentionedMeMessages=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timestamp:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.messageModuleService.getMentionedMeMessages(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.areMentionedMeMessages=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Pl({messages:{type:"array",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1}},min:1}},e),xu(r=e.messages).call(r,(function(t){return e.messages[0].serverId===t.serverId}))){t.next=4;break}throw new Al("Different serverId",e,10414);case 4:if(!this.core.qchatChannel.subscribeForVisitorService.isInAutoServers(e.messages[0].serverId)){t.next=7;break}throw new Al("Not allowed for visitor",e,10403);case 7:return t.next=9,this.messageModuleService.areMentionedMeMessages(e.messages);case 9:return t.abrupt("return",t.sent);case 10:case"end":return t.stop()}}),t,this)})))},r.addQuickComment=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.extendModuleService.updateQuickComment(e,1);case 2:case"end":return t.stop()}}),t,this)})))},r.removeQuickComment=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.extendModuleService.updateQuickComment(e,2);case 2:case"end":return t.stop()}}),t,this)})))},r.getQuickComments=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgList:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1}},min:1}},e),t.next=3,this.extendModuleService.getQuickComments(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.sendTypingEvent=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},e),t.next=3,this.extendModuleService.sendTypingEvent(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.getLastMessageOfChannels=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},channelIdList:{type:"array",itemType:"string"}},e),t.next=3,this.messageModuleService.getLastMessageOfChannels(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.qchatOnMsgHandler=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.messageModuleService.onMsg(e);case 1:case"end":return t.stop()}}),t,this)})))},r.qchatOnRecvUnreadInfoHandler=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.messageModuleService.onRecvUnreadInfo(e);case 1:case"end":return t.stop()}}),t,this)})))},r.qchatOnSysMsgHandler=function(e){this.notificationModuleService.onSysMsg(e)},r.qchatMultiSyncMessageReadHandler=function(e){this.messageModuleService.onMultiSyncRead(e)},r.qchatMultiSyncSystemNotificationUpdateHandler=function(e){this.notificationModuleService.onMultiSysMsg(e)},r.qchatSyncSystemNotificationHandler=function(e){this.notificationModuleService.onSyncSysMsg(e)},r.qchatRecvMessageUpdateHandler=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.messageModuleService.onRecvMsgUpdate(e);case 1:case"end":return t.stop()}}),t,this)})))},r.searchMsgByPage=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({keyword:{type:"string",allowEmpty:!1,required:!1},serverId:{type:"string",allowEmpty:!1,required:!0},channelId:{type:"string",allowEmpty:!1,required:!1},fromAccid:{type:"string",allowEmpty:!1,required:!1},fromTime:{type:"number",allowEmpty:!1,required:!1},toTime:{type:"number",allowEmpty:!1,required:!1},msgTypes:{type:"array",itemType:"string",allowEmpty:!1,required:!0},subTypes:{type:"array",itemType:"string",allowEmpty:!1,required:!1},includeSelf:{type:"boolean",allowEmpty:!1,required:!1},order:{type:"enum",values:wp(bC),required:!1},limit:{type:"number",min:0,required:!1},sort:{type:"enum",values:wp(m_),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},e),t.next=3,this.messageModuleService.messageSearchByPage(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))},r.qchatMultiSyncServersMessageReadHandler=function(e){this.messageModuleService.onMultiSyncServersRead(e)},t}(wC),NE=function(){function e(e){this.core=e}var t=e.prototype;return t.addChannelCategoryRole=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},parentRoleId:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatAddChannelCategoryRole",{qchatAddChannelCategoryRoleTag:e});case 3:return r=t.sent,t.abrupt("return",w_(r.content.channelCategoryRole));case 5:case"end":return t.stop()}}),t,this)})))},t.removeChannelCategoryRole=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatRemoveChannelCategoryRole",e);case 3:case"end":return t.stop()}}),t,this)})))},t.updateChannelCategoryRole=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},auths:{type:"object"}},e),t.next=3,this.core.sendCmd("qchatUpdateChannelCategoryRole",{qchatUpdateChannelCategoryRoleTag:b_(e)});case 3:if(406!==(r=t.sent).raw.code){t.next=6;break}throw new Al("No update required",{},406);case 6:return t.abrupt("return",w_(r.content.channelCategoryRole));case 7:case"end":return t.stop()}}),t,this)})))},t.getChannelCategoryRole=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetChannelCategoryRole",{qchatGetChannelCategoryRoleTag:e});case 3:return r=t.sent,t.abrupt("return",(n=r.content.list,Ei(n)&&n.length>0?du(n).call(n,(function(e){return w_(e)})):[]));case 5:case"end":return t.stop()}var n}),t,this)})))},t.addChannelCategoryMemberRole=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatAddChannelCategoryMemberRole",{qchatAddChannelCategoryMemberRoleTag:e});case 3:return r=t.sent,t.abrupt("return",R_(r.content.channelCategoryMemberRole));case 5:case"end":return t.stop()}}),t,this)})))},t.removeChannelCategoryMemberRole=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatRemoveChannelCategoryMemberRole",e);case 3:case"end":return t.stop()}}),t,this)})))},t.updateChannelCategoryMemberRole=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},auths:{type:"object"}},e),t.next=3,this.core.sendCmd("qchatUpdateChannelCategoryMemberRole",{qchatUpdateChannelCategoryMemberRoleTag:b_(e)});case 3:if(406!==(r=t.sent).raw.code){t.next=6;break}throw new Al("No update required",{},406);case 6:return t.abrupt("return",R_(r.content.channelCategoryMemberRole));case 7:case"end":return t.stop()}}),t,this)})))},t.getChannelCategoryMemberRole=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetChannelCategoryMemberRole",{qchatGetChannelCategoryMemberRoleTag:e});case 3:return r=t.sent,t.abrupt("return",(n=r.content.list,Ei(n)&&n.length>0?du(n).call(n,(function(e){return R_(e)})):[]));case 5:case"end":return t.stop()}var n}),t,this)})))},e}(),xE=function(e){function t(t){var r;return(r=e.call(this,"qchatRole",t)||this).core=t,Mh({cmdMap:iE,cmdConfig:sE()}),r.category=new NE(t),r}nr(t,e);var r=t.prototype;return r.createServerRole=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1},priority:{type:"number",min:1},icon:{type:"string",required:!1},ext:{type:"string",required:!1}},e),t.next=3,this.core.sendCmd("qchatCreateServerRole",{serverRole:dr(dr({},b_(e)),{type:a_.custom}),antispamTag:r_(e)});case 3:return r=t.sent,t.abrupt("return",__(r.content.serverRole));case 5:case"end":return t.stop()}}),t,this)})))},r.updateServerRole=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},name:{type:"string",required:!1},icon:{type:"string",required:!1},ext:{type:"string",required:!1},priority:{type:"number",required:!1},auths:{type:"object",required:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateServerRole",{updateServerRoleTag:b_(e),antispamTag:r_(e)});case 3:return r=t.sent,t.abrupt("return",__(r.content.serverRole));case 5:case"end":return t.stop()}}),t,this)})))},r.deleteServerRole=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatDeleteServerRole",e);case 3:case"end":return t.stop()}}),t,this)})))},r.getServerRoles=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},categoryId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1},priority:{type:"number",required:!1}},e),t.next=3,this.core.sendCmd("qchatGetServerRoles",{getServerRolesTag:b_(e)});case 3:return n=t.sent,i=fu(r=n.content.serverRoles).call(r,(function(e){return 1===$p(e.isMember)})),i=du(i).call(i,(function(e){return e.roleId})),t.abrupt("return",{roles:E_(n.content.serverRoles),isMemberRoles:i});case 7:case"end":return t.stop()}}),t,this)})))},r.addChannelRole=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},parentRoleId:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatAddChannelRole",{channelRole:b_(e)});case 3:return r=t.sent,t.abrupt("return",__(r.content.channelRole));case 5:case"end":return t.stop()}}),t,this)})))},r.getChannelRoles=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetChannelRoles",{getChannelRolesTag:e});case 3:return r=t.sent,t.abrupt("return",E_(r.content.channelRoles));case 5:case"end":return t.stop()}}),t,this)})))},r.removeChannelRole=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatRemoveChannelRole",e);case 3:case"end":return t.stop()}}),t,this)})))},r.updateChannelRole=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},auths:{type:"object",required:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateChannelRole",{updateChannelRoleTag:b_(e)});case 3:if(406!==(r=t.sent).raw.code){t.next=6;break}throw new Al("No update required",{},406);case 6:return t.abrupt("return",__(r.content.channelRole));case 7:case"end":return t.stop()}}),t,this)})))},r.addMemberRole=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatAddMemberRole",{memberRole:e});case 3:return r=t.sent,t.abrupt("return",__(r.content.memberRole));case 5:case"end":return t.stop()}}),t,this)})))},r.getMemberRoles=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetMemberRoles",{getMemberRolesTag:e});case 3:return r=t.sent,t.abrupt("return",E_(r.content.memberRoles));case 5:case"end":return t.stop()}}),t,this)})))},r.removeMemberRole=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},e),t.next=3,this.core.sendCmd("qchatRemoveMemberRole",{memberRole:e});case 3:case"end":return t.stop()}}),t,this)})))},r.updateMemberRole=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},auths:{type:"object",required:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateMemberRole",{updateMemberRoleTag:b_(e)});case 3:if(406!==(r=t.sent).raw.code){t.next=6;break}throw new Al("No update required",{},406);case 6:return t.abrupt("return",__(r.content.memberRole));case 7:case"end":return t.stop()}}),t,this)})))},r.addMembersToServerRole=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatAddMembersToServerRole",dr(dr({},e),{accids:_i(e.accids)}));case 3:return r=t.sent,n=Zp(r,"content.accids.successAccids"),i=Zp(r,"content.accids.failedAccids"),t.abrupt("return",{successAccids:n?JSON.parse(n):[],failedAccids:i?JSON.parse(i):[]});case 7:case"end":return t.stop()}}),t,this)})))},r.removeMembersFromServerRole=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatRemoveMembersFromServerRole",dr(dr({},e),{accids:_i(e.accids)}));case 3:return r=t.sent,n=Zp(r,"content.accids.successAccids"),i=Zp(r,"content.accids.failedAccids"),t.abrupt("return",{successAccids:n?JSON.parse(n):[],failedAccids:i?JSON.parse(i):[]});case 7:case"end":return t.stop()}}),t,this)})))},r.getMembersFromServerRole=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},accid:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetMembersFromServerRole",{getMembersFromServerRoleTag:e});case 3:return r=t.sent,t.abrupt("return",E_(r.content.members));case 5:case"end":return t.stop()}}),t,this)})))},r.getServerRolesByAccid=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetServerRolesByAccid",{getServerRolesByAccidTag:e});case 3:return r=t.sent,t.abrupt("return",E_(r.content.serverRoles));case 5:case"end":return t.stop()}}),t,this)})))},r.getExistingServerRolesByAccids=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},e),t.next=3,this.core.sendCmd("qchatGetExistingServerRolesByAccids",{serverId:e.serverId,accids:_i(e.accids)});case 3:return r=t.sent,t.prev=4,i=JSON.parse(r.content.serverRoles),jn(n=fr(i)).call(n,(function(e){var t;jn(t=i[e]).call(t,(function(t,r){i[e][r]=yh(t,aE().serverRole)})),i[e]=E_(i[e])})),t.abrupt("return",i);case 10:throw t.prev=10,t.t0=t.catch(4),this.logger.error("can not parse serverRolesGroupByAccid from "+e.serverId+" and "+e.accids,r.content.serverRoles),t.t0;case 14:case"end":return t.stop()}}),t,this,[[4,10]])})))},r.getExistingChannelRolesByServerRoleIds=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleIds:{type:"array",itemType:"string"}},e),t.next=3,this.core.sendCmd("qchatGetExistingChannelRolesByServerRoleIds",{serverId:e.serverId,channelId:e.channelId,roleIds:_i(e.roleIds)});case 3:return r=t.sent,t.abrupt("return",E_(r.content.channelRoles));case 5:case"end":return t.stop()}}),t,this)})))},r.getExistingAccidsOfMemberRoles=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},e),t.next=3,this.core.sendCmd("qchatGetExistingAccidsOfMemberRoles",{serverId:e.serverId,channelId:e.channelId,accids:_i(e.accids)});case 3:return r=t.sent,n=r.content.memberRoles,t.abrupt("return",n&&n.length>0?du(n).call(n,(function(e){return e.accid})):[]);case 6:case"end":return t.stop()}}),t,this)})))},r.getExistingAccidsInServerRole=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},e),t.next=3,this.core.sendCmd("qchatGetExistingAccidsInServerRole",{serverId:e.serverId,roleId:e.roleId,accids:_i(e.accids)});case 3:return r=t.sent,n=r.content.members,t.abrupt("return",n&&n.length>0?du(n).call(n,(function(e){return e.accid})):[]);case 6:case"end":return t.stop()}}),t,this)})))},r.updateServerRolePriorities=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},serverRoles:{type:"array"}},e),t.next=3,this.core.sendCmd("qchatUpdateServerRolePriorities",{serverId:e.serverId,serverRoles:du(r=e.serverRoles).call(r,(function(e){return{serverId:e.serverId,roleId:e.roleId,priority:e.priority}}))});case 3:return n=t.sent,t.abrupt("return",E_(n.content.serverRoles));case 5:case"end":return t.stop()}}),t,this)})))},r.checkPermission=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},auth:{type:"string"}},e),t.next=3,this.core.sendCmd("qchatCheckPermission",{checkPermissionTag:dr(dr({},e),{auth:u_[e.auth]||e.auth})});case 3:return r=t.sent,t.abrupt("return",r.content.checked);case 5:case"end":return t.stop()}}),t,this)})))},r.addChannelCategoryRole=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.category.addChannelCategoryRole(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))},r.removeChannelCategoryRole=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.category.removeChannelCategoryRole(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))},r.updateChannelCategoryRole=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.category.updateChannelCategoryRole(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))},r.getChannelCategoryRole=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.category.getChannelCategoryRole(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))},r.addChannelCategoryMemberRole=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.category.addChannelCategoryMemberRole(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))},r.removeChannelCategoryMemberRole=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.category.removeChannelCategoryMemberRole(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))},r.updateChannelCategoryMemberRole=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.category.updateChannelCategoryMemberRole(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))},r.getChannelCategoryMemberRole=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.category.getChannelCategoryMemberRole(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))},r.checkPermissions=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},auths:{type:"array",itemType:"string"}},e),this.core.logger.log("qchatRole::checkPermission options is",e),t.next=4,this.core.sendCmd("qchatCheckPermissions",{checkPermissionsTag:dr(dr({},e),{auths:_i(du(r=e.auths).call(r,(function(e){return u_[e]||e})))})});case 4:return i=t.sent,this.core.logger.log("qchatRole::checkPermission result is",i.content),o={},jn(n=i.content.checkPermissionsResult).call(n,(function(e){o[e.auth]=e.isAllow})),this.core.logger.log("qchatRole::checkPermission auths is",o),t.abrupt("return",C_(o));case 10:case"end":return t.stop()}}),t,this)})))},t}(wC);function OE(e,t){var r,n=void 0!==Nc&&Fl(e)||e["@@iterator"];if(n)return tr(r=(n=n.call(e)).next).call(r,n);if(Ei(e)||(n=function(e,t){if(e){var r;if("string"==typeof e)return PE(e,t);var n=Wc(r={}.toString.call(e)).call(r,8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Bl(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?PE(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function PE(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var LE=function(e){function t(t){var r;return(r=e.call(this,"qchatServer",t)||this).core=t,Mh({cmdMap:eE,cmdConfig:nE()}),r}nr(t,e);var r=t.prototype;return r.createServer=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({icon:{type:"string",required:!1},name:{type:"string",required:!1},ext:{type:"string",required:!1},searchType:{type:"number",required:!1,min:0},searchEnable:{type:"boolean",required:!1},inviteMode:{type:"number",min:0,max:1,required:!1},applyMode:{type:"number",min:0,max:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatCreateServer",{serverInfo:dr(dr({},e),{searchEnable:!1===e.searchEnable?0:1}),antispamTag:r_(e)});case 3:return r=t.sent,t.abrupt("return",XC(r.content.serverInfo));case 5:case"end":return t.stop()}}),t,this)})))},r.deleteServer=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatDeleteServer",e);case 3:case"end":return t.stop()}}),t,this)})))},r.updateServer=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",min:1},icon:{type:"string",required:!1},name:{type:"string",required:!1},ext:{type:"string",required:!1},searchType:{type:"number",required:!1,min:0},searchEnable:{type:"boolean",required:!1},inviteMode:{type:"number",min:0,max:1,required:!1},applyMode:{type:"number",min:0,max:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateServer",{serverInfo:dr(dr({},e),{searchEnable:!1===e.searchEnable?0:1}),antispamTag:r_(e)});case 3:return r=t.sent,t.abrupt("return",XC(r.content.serverInfo));case 5:case"end":return t.stop()}}),t,this)})))},r.getServers=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverIds:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatGetServers",e);case 3:return r=t.sent,t.abrupt("return",$C(r.content.serverList));case 5:case"end":return t.stop()}}),t,this)})))},r.getServersByPage=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({timestamp:{type:"number"},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetServersByPage",{tag:e});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:$p(o.nextTimetag)},datas:$C(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.inviteServerMembers=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",min:1},accids:{type:"array",itemType:"string",min:1},ps:{type:"string"},params:{type:"object",rules:{ttl:{type:"number"}},required:!1}},e),t.next=3,this.core.sendCmd("qchatInviteServerMembers",e);case 3:return r=t.sent,n=r.content.record||{},t.abrupt("return",{failByOverAccids:r.content.failByOverAccids,failByBanAccids:r.content.failByBanAccids,recordInfo:i_(n)});case 6:case"end":return t.stop()}}),t,this)})))},r.acceptServerInvite=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},e),t.next=3,this.core.sendCmd("qchatAcceptServerInvite",e);case 3:case"end":return t.stop()}}),t,this)})))},r.rejectInviteServer=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",min:1},accid:{type:"string",min:1},ps:{type:"string"},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},e),t.next=3,this.core.sendCmd("qchatRejectInviteServer",e);case 3:case"end":return t.stop()}}),t,this)})))},r.applyServerJoin=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",min:1},ps:{type:"string"},params:{type:"object",rules:{ttl:{type:"number"}},required:!1}},e),t.next=3,this.core.sendCmd("qchatApplyServerJoin",e);case 3:return r=t.sent,t.abrupt("return",i_(r.content.data));case 5:case"end":return t.stop()}}),t,this)})))},r.acceptServerApply=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",min:1},accid:{type:"string",min:1},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},e),t.next=3,this.core.sendCmd("qchatAcceptServerApply",e);case 3:case"end":return t.stop()}}),t,this)})))},r.rejectServerApply=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",min:1},accid:{type:"string",min:1},ps:{type:"string"},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},e),t.next=3,this.core.sendCmd("qchatRejectServerApply",e);case 3:case"end":return t.stop()}}),t,this)})))},r.kickServerMembers=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",min:1},accids:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatKickServerMembers",e);case 3:case"end":return t.stop()}}),t,this)})))},r.leaveServer=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatLeaveServer",e);case 3:case"end":return t.stop()}}),t,this)})))},r.updateMyMemberInfo=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",min:1},accid:{type:"string",required:!1},nick:{type:"string",allowEmpty:!0,required:!1},avatar:{type:"string",required:!1},ext:{type:"string",required:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateMyMemberInfo",{memberInfo:e,antispamTag:r_(e)});case 3:return r=t.sent,t.abrupt("return",ZC(r.content.memberInfo));case 5:case"end":return t.stop()}}),t,this)})))},r.updateServerMemberInfo=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",min:1},accid:{type:"string",min:1},nick:{type:"string",required:!1},avatar:{type:"string",required:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateServerMemberInfo",{memberInfo:e,antispamTag:r_(e)});case 3:return r=t.sent,t.abrupt("return",ZC(r.content.memberInfo));case 5:case"end":return t.stop()}}),t,this)})))},r.getServerMembers=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Pl({accids:{type:"array"}},e),r=[],e.accids.length)for(n=OE(e.accids);!(i=n()).done;)o=i.value,r.push(o.serverId+"|"+o.accid);return t.next=5,this.core.sendCmd("qchatGetServerMembers",{accids:r});case 5:return a=t.sent,t.abrupt("return",e_(a.content.accidList));case 7:case"end":return t.stop()}}),t,this)})))},r.getServerMembersByPage=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetServerMembersByPage",{tag:e});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:$p(o.nextTimetag)},datas:e_(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.subscribeServer=function(e){var t,r,n,i;return zl(this,void 0,void 0,Ql.mark((function o(){var a,s,c,u;return Ql.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(Pl({type:{type:"number",min:4,max:4,required:!1},opeType:{type:"number",min:1,max:2}},e),!(null===(r=null===(t=this.core.qchatChannel)||void 0===t?void 0:t.config)||void 0===r?void 0:r.autoSubscribe)||e.isInternalTrigger){o.next=3;break}throw new Al("subscribe server failed, manual subscribe is not allowed in auto subscribe mode",{},403);case 3:if(e.type||(e.type=4),!e.servers.length){o.next=12;break}return s=dr(dr({},e),{channels:du(a=e.servers).call(a,(function(e){return{serverId:e.serverId,channelId:""}}))}),o.next=8,this.core.qchatChannel.subscribeModuleService.subscribe(s);case 8:return c=o.sent,u=c.failedChannels,(null===(i=null===(n=this.core.qchatChannel)||void 0===n?void 0:n.config)||void 0===i?void 0:i.autoSubscribe)?this.core.qchatChannel.subscribeModuleService.cacheAutoSubscribe(s):this.core.qchatChannel.subscribeModuleService.cacheSubscribe(s),o.abrupt("return",{failedServers:u});case 12:case"end":return o.stop()}}),o,this)})))},r.banServerMember=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateServerMemberBan",{tag:dr(dr({},e),{opeType:1})});case 3:case"end":return t.stop()}}),t,this)})))},r.unbanServerMember=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},e),t.next=3,this.core.sendCmd("qchatUpdateServerMemberBan",{tag:dr(dr({},e),{opeType:2})});case 3:case"end":return t.stop()}}),t,this)})))},r.getBannedMembersByPage=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetBannedMembersByPage",{tag:e});case 3:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:$p(o.nextTimetag)},datas:t_(i)});case 6:case"end":return t.stop()}}),t,this)})))},r.serverSearchByPage=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Pl({keyword:{type:"string",allowEmpty:!1},startTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1},serverType:{type:"array",itemType:"number",min:0,required:!1},order:{type:"enum",values:wp(bC),required:!1},searchType:{type:"enum",values:wp(_C)},sort:{type:"enum",values:wp(CC),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},e),!(e.startTime&&e.endTime&&e.startTime>=e.endTime)){t.next=3;break}throw new El("startTime more than endTime",e,"timeRule");case 3:return t.next=5,this.core.sendCmd("qchatServerSearchByPage",{tag:dr(dr({},e),{order:e.order&&bC[e.order],searchType:_C[e.searchType],sort:Vm(e)&&CC[Vm(e)],serverType:_i(e.serverType)})});case 5:return r=t.sent,n=r.content,i=n.datas,o=n.listQueryTag,t.abrupt("return",{listQueryTag:{hasMore:1==+o.hasMore,nextTimetag:$p(o.nextTimetag),cursor:o.cursor},datas:$C(i)});case 8:case"end":return t.stop()}}),t,this)})))},r.serverMemberSearchByPage=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},keyword:{type:"string",allowEmpty:!1},limit:{type:"number",min:1,required:!1}},e),t.next=3,this.core.sendCmd("qchatServerMemberSearchByPage",{tag:e});case 3:return r=t.sent,t.abrupt("return",e_(r.content.members));case 5:case"end":return t.stop()}}),t,this)})))},r.generateInviteCode=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},ttl:{type:"number",min:0,required:!1}},e),t.next=3,this.core.sendCmd("qchatGenerateInviteCode",{tag:e});case 3:return r=t.sent,t.abrupt("return",Ph({expireTime:{type:"number"}},r.content.data));case 5:case"end":return t.stop()}}),t,this)})))},r.joinByInviteCode=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},inviteCode:{type:"string",allowEmpty:!1},ps:{type:"string",required:!1}},e),t.next=3,this.core.sendCmd("qchatJoinByInviteCode",{tag:e});case 3:case"end":return t.stop()}}),t,this)})))},r.getInviteApplyRecordOfServer=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverId:{type:"string",allowEmpty:!1},fromTime:{type:"number",min:0},toTime:{type:"number",min:0},reverse:{type:"boolean",required:!1},limit:{type:"number",min:1,required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetInviteApplyRecordOfServer",{tag:dr(dr({},e),{reverse:Dc(e)?1:0})});case 3:return r=t.sent,t.abrupt("return",o_(r.content.data));case 5:case"end":return t.stop()}}),t,this)})))},r.getInviteApplyRecordOfSelf=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({fromTime:{type:"number",min:0},toTime:{type:"number",min:0},reverse:{type:"boolean",required:!1},limit:{type:"number",min:1,required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},e),t.next=3,this.core.sendCmd("qchatGetInviteApplyRecordOfSelf",{tag:dr(dr({},e),{reverse:Dc(e)?1:0})});case 3:return r=t.sent,t.abrupt("return",o_(r.content.data));case 5:case"end":return t.stop()}}),t,this)})))},r.markRead=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverIds:{type:"array",itemType:"string",required:!0}},e),t.next=3,this.core.sendCmd("qchatClearServersUnread",e);case 3:return r=t.sent,n=l_(r.content.clearServersUnreadTag),i=n.successServerIds,o=n.ackTimestamp,this.logger.log("qchatServer::clearServersUnread:: begin auto clear servers unreadInfo"),this.core.eventBus.emit("qchatChannel/clearUnreadCountByServers",i,o),t.abrupt("return",n);case 9:case"end":return t.stop()}}),t,this)})))},r.subscribeAllChannel=function(e){var t,r;return zl(this,void 0,void 0,Ql.mark((function n(){var i,o,a;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(Pl({type:{type:"number",required:!0},serverIds:{type:"array",itemType:"string",required:!0,max:10}},e),!(null===(r=null===(t=this.core.qchatChannel)||void 0===t?void 0:t.config)||void 0===r?void 0:r.autoSubscribe)){n.next=3;break}throw new Al("subscribe channel failed, manual subscribe is not allowed in auto subscribe mode.",{},403);case 3:return n.next=5,this.core.sendCmd("qchatSubscribeChannelsByServers",e,{timeout:3e4});case 5:return(o=n.sent).content.unreadInfos=jC(o.content.unreadInfos),o.content.failServerIds=YC(o.content.failServerIds),a={type:e.type,opeType:1,channels:du(i=o.content.unreadInfos).call(i,(function(e){return{serverId:e.serverId,channelId:e.channelId}}))},this.core.eventBus.emit("qchatChannel/cacheSubscribe",a),this.core.eventBus.emit("qchatChannel/getRoleIdsByServerId",e.serverIds),this.core.eventBus.emit("qchatChannel/updateUnreads",o.content.unreadInfos),n.abrupt("return",o.content);case 13:case"end":return n.stop()}}),n,this)})))},r.enterAsVisitor=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverIds:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatEnterAsVisitor",{tag:{serverIds:_i(e.serverIds)}});case 3:return r=t.sent,n=YC(r.content.failServerIds),i=xl(e.serverIds,n),this.core.qchatChannel.subscribeForVisitorService.cacheServer(i),t.abrupt("return",{failedServers:n});case 8:case"end":return t.stop()}}),t,this)})))},r.leaveAsVisitor=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o=this;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({serverIds:{type:"array",itemType:"string",min:1}},e),t.next=3,this.core.sendCmd("qchatLeaveAsVisitor",{tag:{serverIds:_i(e.serverIds)}});case 3:return r=t.sent,n=YC(r.content.failServerIds),i=xl(e.serverIds,n),jn(i).call(i,(function(e){o.core.qchatChannel.subscribeForVisitorService.deleteServer(e)})),t.abrupt("return",{failedServers:n});case 8:case"end":return t.stop()}}),t,this)})))},r.subscribeAsVisitor=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Pl({opeType:{type:"number",min:1,max:2},type:{type:"number",required:!1},serverIds:{type:"array",itemType:"string",min:1}},e),!e.serverIds.length){t.next=5;break}return t.next=4,this.core.qchatChannel.subscribeForVisitorService.subscribeServerAsVisitor(e);case 4:return t.abrupt("return",t.sent);case 5:return t.abrupt("return",{failedServers:[]});case 6:case"end":return t.stop()}}),t,this)})))},t}(wC),VE=function(e){function t(t,r){var n;return(n=e.call(this,"V2NIMNotificationService",t)||this).config={compatibleWithV1:!0},n.notificationUtil=new _y(n.core),n.core._registerDep(Mg,"V2NIMConversationIdUtil"),"v2"!==n.core.options.apiVersion?ut(n):(Mh({cmdMap:vy,cmdConfig:Iy}),n.setOptions(r),n)}nr(t,e);var r=t.prototype;return r.setOptions=function(e){var t;(null===(t=this.core.systemMessage)||void 0===t?void 0:t.name)?this.config.compatibleWithV1=!0:this.config.compatibleWithV1=!1,this.config=dr(this.config,e)},r.emit=function(t){for(var r,n,i=this.name+"::emit "+t.toString(),o=arguments.length,a=new Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];if("onReceiveCustomNotifications"===t){var c=a[0];this.logger.log(""+i,du(c).call(c,(function(e){return"sender:"+e.senderId+";receiver:"+e.receiverId+";ctype:"+e.conversationType+";time:"+e.timestamp})))}else if("onReceiveBroadcastNotifications"===t){var u=a[0];this.logger.log(""+i,du(u).call(u,(function(e){return"id:"+e.id+";sender:"+e.senderId+";time:"+e.time})))}else{var d,l;(d=this.logger).log.apply(d,xs(l=[""+i]).call(l,a))}return(r=e.prototype.emit).call.apply(r,xs(n=[this,t]).call(n,a))},r.sendCustomNotification=function(e,t,r){return zl(this,void 0,void 0,Ql.mark((function n(){var i,o,a;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Vl(this.core.account,e),Pl(Cy,{content:t,params:r},"",!0),i=this.core.V2NIMConversationIdUtil.parseConversationType(e),o=3===i?"v2SendCustomNotificationWithSuperTeam":"v2SendCustomNotification",a=this.notificationUtil.generateNotificationTag(e,t,r),n.next=8,this.core.sendCmd(o,{tag:a});case 8:case"end":return n.stop()}}),n,this)})))},r.processSystemNotification=function(e){var t=[0,1,2,3,4,15,16,17,18],r=[5,6],n=e.type;if(ou(t).call(t,n))this.core.eventBus.emit("V2NIMTeamService/sysNotification",e);else{if(!ou(r).call(r,n)){var i=dr(dr({},e),{conversationType:{100:1,101:2,102:1,103:3}[n]});return delete i.type,i}this.core.eventBus.emit("V2NIMFriendService/sysNotification",e)}},r.markBroadcastMsgAck=function(e){this.config.compatibleWithV1||this.core.sendCmd("v2BatchMarkRead",{sid:7,cid:17,ids:du(e).call(e,(function(e){return e.id}))})},r.syncBroadcastMsgHandler=function(e){var t=e.content.datas;this.markBroadcastMsgAck(t),this.emit("onReceiveBroadcastNotifications",t)},r.onBroadcastMsgHandler=function(e){var t=e.content.data;this.markBroadcastMsgAck([t]),this.emit("onReceiveBroadcastNotifications",[t])},r.onSysNotificationHandler=function(e){this.markSysNotificationAck([e.content.data]);var t=this.processSystemNotification(e.content.data);t&&this.emit("onReceiveCustomNotifications",[t])},r.v2SyncOfflineSysNotificationsHandler=function(e){var t,r,n,i=this;this.markSysNotificationAck(e.content.datas);var o=fu(t=du(r=Vm(n=e.content.datas).call(n,(function(e,t){return e.timestamp-t.timestamp}))).call(r,(function(e){return i.processSystemNotification(e)}))).call(t,(function(e){return e}));o&&this.emit("onReceiveCustomNotifications",o)},r.v2NotificationRevokeHandler=function(e){this.markSysNotificationAck([e.content.data])},r.v2NotificationSyncRevokeHandler=function(e){var t=e.content.type;1===$p(t)&&this.markSysNotificationAck(e.content.datas)},r.markSysNotificationAck=function(e){if(!this.config.compatibleWithV1){var t=[],r=[],n=[15,16,17,18,103];jn(e).call(e,(function(e){e.idServer&&(ou(n).call(n,e.type)?r.push(e.idServer):t.push(e.idServer))})),t.length>0&&this.core.sendCmd("v2BatchMarkRead",{sid:"7",cid:"3",ids:t}),r.length>0&&this.core.sendCmd("v2BatchMarkRead",{sid:"21",cid:"19",ids:r})}},t}(rf),UE={"27_1":"v2NIMSync","27_10":"v2QChatSync"},DE={v2NIMSync:{sid:27,cid:1,service:"V2NIMSyncService",hasPacketTimer:!1,params:[{type:"Property",name:"tag",reflectMapper:{myInfo:1,offlineMsgs:2,teams:3,roamingMsgs:7,relations:9,friends:11,friendUsers:13,msgReceipts:14,myTeamMembers:15,donnop:16,recallMsg:17,sessionAck:18,broadcastMsgs:20,avSignal:21,superTeams:22,mySuperTeamMembers:23,superTeamRoamingMsgs:24,deleteSuperTeamMsg:25,superTeamSessionAck:26,deleteSelfMsgs:27,stickTopSessions:28,sessionHistoryMsgsDelete:29,p2pTeamModifyMessage:30,superTeamModifyMessage:31,filterMsgs:100}}],response:[{type:"Long",name:"timetag"}]},v2QChatSync:{sid:27,cid:10,service:"V2NIMSyncService",hasPacketTimer:!1,params:[{type:"Property",name:"tag",reflectMapper:{systemNotification:1,pushConfig:2}}],response:[{type:"Long",name:"timetag"}]}},qE=function(e){function t(t){var r;return(r=e.call(this,"V2NIMSyncService",t)||this).teamKey=["teams","superTeams","myTeamMembers","mySuperTeamMembers"],r.config={},r.timetags={},"v2"!==r.core.options.apiVersion?ut(r):(r.initEventListeners(),Mh({cmdMap:UE,cmdConfig:DE}),r)}nr(t,e);var r=t.prototype;return r.reset=function(){this.timetags={}},r.setOptions=function(e){var t=this.core;return this.config=dr({myInfo:!!t.user.name,offlineMsgs:!!t.V2NIMMessageService.name,roamingMsgs:!!t.V2NIMMessageService.name,relations:!!t.user.name,friends:!!t.friend.name,friendUsers:!!t.user.name,msgReceipts:!!t.V2NIMMessageService.name,broadcastMsgs:!!t.V2NIMNotificationService.name,recallMsg:!!t.V2NIMMessageService.name,sessionAck:!!t.V2NIMConversationService.name,superTeamSessionAck:!!t.V2NIMConversationService.name,superTeamRoamingMsgs:!!t.V2NIMTeamService.name,deleteSuperTeamMsg:!!t.V2NIMTeamService.name,deleteSelfMsgs:!!t.V2NIMMessageService.name,sessionHistoryMsgsDelete:!!t.V2NIMMessageService.name,avSignal:!!t.signaling.name,teams:!!t.V2NIMTeamService.name,superTeams:!!t.V2NIMTeamService.name,myTeamMembers:!!t.V2NIMTeamService.name,mySuperTeamMembers:!!t.V2NIMTeamService.name,p2pTeamModifyMessage:!!t.V2NIMMessageService.name,superTeamModifyMessage:!!t.V2NIMMessageService.name},e),this.config},r.doBasicSync=function(){return zl(this,void 0,void 0,Ql.mark((function e(){var t,r,n,i,o,a=this;return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=fr(this.config),r=fu(t).call(t,(function(e){var t;return!ou(t=a.teamKey).call(t,e)&&a.config[e]})),n=this.genSyncParams(r),this.logger.log("V2Sync:basic",n),e.next=6,this.core.clientSocket.sendCmd("v2NIMSync",{tag:n});case 6:return i=e.sent,o=i.content.timetag,this.setTimetags(o,r),e.next=11,this.delaySyncDone();case 11:return e.next=13,this.handleImmediate();case 13:this.core.logger.log("sync::basic sync complete in",o);case 14:case"end":return e.stop()}}),e,this)})))},r.doTeamSync=function(){return zl(this,void 0,void 0,Ql.mark((function e(){var t,r,n,i,o,a=this;return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(r=fu(t=this.teamKey).call(t,(function(e){return a.config[e]}))).length){e.next=3;break}return e.abrupt("return");case 3:return n=this.genSyncParams(r),this.core.eventBus.emit("V2NIMTeamService/onSyncStarted"),this.logger.log("V2Sync:team",n),i=null,e.prev=7,e.next=10,this.core.clientSocket.sendCmd("v2NIMSync",{tag:n});case 10:i=e.sent,e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(7),this.core.eventBus.emit("V2NIMTeamService/onSyncFailed",e.t0),e.t0;case 17:this.core.eventBus.emit("V2NIMTeamService/onSyncFinished"),o=i.content.timetag,this.setTimetags(o,this.teamKey),this.core.logger.log("sync::team sync complete in",o);case 21:case"end":return e.stop()}}),e,this,[[7,13]])})))},r.doQchatSync=function(){return zl(this,void 0,void 0,Ql.mark((function e(){var t;return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.core.clientSocket.sendCmd("v2QChatSync",{tag:{systemNotification:0}});case 2:t=e.sent,this.core.logger.log("sync::qchat sync complete in",t.content.timetag);case 4:case"end":return e.stop()}}),e,this)})))},r.doSync=function(){return zl(this,void 0,void 0,Ql.mark((function e(){var t;return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(t=Zp(this.core,"V2NIMLoginService.authenticator.loginClientOfThisConnection.loginType"))){e.next=4;break}return this.logger.warn("sync::doSync: no loginType, stop sync"),e.abrupt("return");case 4:if(this.logger.log("sync::doSync:type "+t),this.core.V2NIMLoginService.dataSync.switchDataSync({type:1,state:2}),1!==t){e.next=20;break}return e.prev=7,e.next=10,this.doBasicSync();case 10:return e.next=12,this.doTeamSync();case 12:e.next=18;break;case 14:return e.prev=14,e.t0=e.catch(7),this.doSyncComplete(e.t0),e.abrupt("return");case 18:e.next=49;break;case 20:if(2!==t){e.next=32;break}return e.prev=21,e.next=24,this.doQchatSync();case 24:e.next=30;break;case 26:return e.prev=26,e.t1=e.catch(21),this.doSyncComplete(e.t1),e.abrupt("return");case 30:e.next=49;break;case 32:if(3!==t){e.next=48;break}return e.prev=33,e.next=36,this.doBasicSync();case 36:return e.next=38,this.doTeamSync();case 38:return e.next=40,this.doQchatSync();case 40:e.next=46;break;case 42:return e.prev=42,e.t2=e.catch(33),this.doSyncComplete(e.t2),e.abrupt("return");case 46:e.next=49;break;case 48:return e.abrupt("return");case 49:this.doSyncComplete();case 50:case"end":return e.stop()}}),e,this,[[7,14],[21,26],[33,42]])})))},r.doSyncComplete=function(e){e&&this.core.logger.log("sync::doSync complete but got error",e),this.core.V2NIMLoginService.dataSync.switchDataSync({type:1,state:3,error:e,subType:"mainSync"})},r.initEventListeners=function(){var e=this;this.core.eventBus.on("V2NIMLoginService/loginLifeCycleLoginSucc",(function(){e.doSync()}))},r.genSyncParams=function(e){var t=this;return Ml(e).call(e,(function(e,r){var n=r;return e[n]=t.timetags[n]||0,e}),{})},r.setTimetags=function(e,t){var r=this;jn(t).call(t,(function(t){r.timetags[t]=e}))},r.handleImmediate=function(){return this.core.session&&this.core.session.onSyncDone&&this.core.session.onSyncDone(),fs.resolve()},r.delaySyncDone=function(){return"ALI"===Ap()?(this.core.logger.log("sync: emit ALIAPP sycnHandler, handle later"),new fs((function(e){qs((function(){e()}),100)}))):fs.resolve()},t}(rf),BE="V2NIMAIService",FE={"4_26":"v2AIChatNotify","29_35":"v2AIProxyModelCall","29_36":"v2AIGetUserList"},GE={accountId:1,messages:{id:2,converter:bh,retConverter:Ch},requestId:3,content:{id:4,converter:bh,retConverter:Ch},promptVariables:5,modelConfigParams:{id:6,converter:bh,retConverter:Ch},antispamBusinessId:7,antispamEnabled:{id:8,converter:Th}},jE={accountId:1,name:3,avatar:4,sign:5,gender:{id:6,retType:"number"},email:7,birthday:8,mobile:9,serverExtension:10,modelType:{id:11,retType:"number"},modelConfig:{id:12,retConverter:function(e){if(e=Ch(e)){var t=fr(e),r=Ml(t).call(t,(function(t,r){var n=function(e){var t;return du(t=(e=e||"").split("_")).call(t,(function(e,t){return 0===t?e:e[0].toUpperCase()+Wc(e).call(e,1)})).join("")}(r);return t[n]=e[r],t}),{});if("string"==typeof r.promptKeys)try{r.promptKeys=JSON.parse(r.promptKeys)}catch(e){}return r}}},yunxinConfig:{id:13,retConverter:function(e){if(e=Ch(e))return e}},valid:{id:14,retType:"boolean"},createTime:{id:15,retType:"number"},updateTime:{id:16,retType:"number"}},HE={v2AIChatNotify:{sid:4,cid:26,service:BE,response:[{type:"Property",name:"data",reflectMapper:Sh({code:{id:1,retType:"number"},accountId:2,requestId:3,content:{id:4,retConverter:Ch}})}]},v2AIProxyModelCall:{sid:29,cid:35,service:BE,params:[{type:"Property",name:"tag",reflectMapper:GE}]},v2AIGetUserList:{sid:29,cid:36,service:BE,params:[{type:"Property",name:"tag",reflectMapper:{pageToken:1,limit:2}}],response:[{type:"PropertyArray",name:"datas",reflectMapper:Sh(jE)},{type:"Property",name:"queryTag",reflectMapper:Sh({hasMore:{id:16,retType:"boolean"},nextToken:2})}]}},WE=function(e){function t(t){var r;return r=e.call(this,"V2NIMAIService",t)||this,Mh({cmdMap:FE,cmdConfig:HE}),r}nr(t,e);var r=t.prototype;return r.emit=function(t){for(var r,n,i=this.name+"::emit "+t.toString(),o=arguments.length,a=new Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];if("onProxyAIModelCall"===t){var c=a[0];this.logger.log(""+i,"code:"+c.code+";accountId:"+c.accountId+";requestId:"+c.requestId)}else{var u,d;(u=this.logger).log.apply(u,xs(d=[""+i]).call(d,a))}return(r=e.prototype.emit).call.apply(r,xs(n=[this,t]).call(n,a))},r.getAIUserList=function(){return zl(this,void 0,void 0,Ql.mark((function e(){var t;return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkV2(),e.next=3,this.core.sendCmd("v2AIGetUserList",{tag:{}});case 3:return t=e.sent,e.abrupt("return",t.content.datas);case 5:case"end":return e.stop()}}),e,this)})))},r.proxyAIModelCall=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl(Nv,e,"",!0),t.next=3,this.core.sendCmd("v2AIProxyModelCall",{tag:e});case 3:case"end":return t.stop()}}),t,this)})))},r.v2AIChatNotifyHandler=function(e){var t=e.content.data;t&&t.requestId?this.emit("onProxyAIModelCall",{code:t.code||200,accountId:t.accountId,requestId:t.requestId,content:t.content}):this.logger.warn("v2AIChatNotifyHandler: invalid data",t)},t}(rf),KE={"18_1":"v2SignallingCreateRoom","18_2":"v2SignallingDelayRoom","18_3":"v2SignallingCloseRoom","18_4":"v2SignallingJoinRoom","18_5":"v2SignallingLeaveRoom","18_6":"v2SignallingInvite","18_7":"v2SignallingCancelInvite","18_16":"v2SignallingCall","18_17":"v2SignallingCallSetup","18_8":"v2SignallingRejectInvite","18_9":"v2SignallingAcceptInvite","18_10":"v2SignallingSendControl","15_11":"v2SignallingOnlineEvent","15_12":"v2SignallingMultiClientEvent","15_13":"v2SignallingOfflineEvent","15_14":"v2SignallingSyncChannels","18_15":"v2SignallingGetRoomInfo"},YE="V2NIMSignallingService",QE={accountId:1,uid:{id:2,retType:"number"},joinTime:{id:3,retType:"number"},expireTime:{id:4,retType:"number"},deviceId:5},JE={channelType:{id:1,retType:"number",retAccess:"channelInfo.channelType"},channelName:{id:2,retAccess:"channelInfo.channelName"},channelId:{id:3,retAccess:"channelInfo.channelId"},createTime:{id:4,retType:"number",retAccess:"channelInfo.createTime"},expireTime:{id:5,retType:"number",retAccess:"channelInfo.expireTime"},creatorAccountId:{id:6,retAccess:"channelInfo.creatorAccountId"},channelExtension:{id:7,retAccess:"channelInfo.channelExtension"},invalid:8,fromAccid:10,toAccid:11,requestId:12,pushEnabled:{id:13,access:"pushConfig.pushEnabled",converter:Th,retType:"boolean"},pushTitle:{id:14,access:"pushConfig.pushTitle"},pushContent:{id:15,access:"pushConfig.pushContent"},pushPayload:{id:16,access:"pushConfig.pushPayload"},unreadEnabled:{id:17,access:"signallingConfig.unreadEnabled",converter:Th,retType:"boolean",def:1},members:{id:18,retAccess:"members",retConverter:function(e){try{var t=JSON.parse(e);return du(t).call(t,(function(e){return yh(e,Sh(QE))}))}catch(e){return}}},attach:{id:19,retConverter:Ch},serverExtension:{id:20,retDef:""},offlineEnabled:{id:21,converter:Th,retType:"boolean",def:1},msgId:22,selfUid:{id:23,retType:"number",access:"signallingConfig.selfUid"},time:{id:24,retType:"number"},rtcChannelName:{id:25,access:"rtcConfig.rtcChannelName"},rtcTokenTtl:{id:26,retType:"number",access:"rtcConfig.rtcTokenTtl",retAccess:"rtcInfo.rtcTokenTtl"},rtcToken:{id:27,retAccess:"rtcInfo.rtcToken"},rtcParams:{id:28,access:"rtcConfig.rtcParams",retAccess:"rtcInfo.rtcParams"},callStatus:{id:30,retType:"number"}},zE={v2SignallingCall:{sid:18,cid:16,service:YE,params:[{type:"Property",name:"tag",reflectMapper:JE}],response:[{type:"Property",name:"data",reflectMapper:Sh(JE)}]},v2SignallingCallSetup:{sid:18,cid:17,service:YE,params:[{type:"Property",name:"tag",reflectMapper:JE}],response:[{type:"Property",name:"data",reflectMapper:Sh(JE)}]},v2SignallingCreateRoom:{sid:18,cid:1,service:YE,params:[{type:"Property",name:"tag",reflectMapper:JE}],response:[{type:"Property",name:"data",reflectMapper:Sh(JE)}]},v2SignallingDelayRoom:{sid:18,cid:2,service:YE,params:[{type:"Property",name:"tag",reflectMapper:JE}],response:[{type:"Property",name:"data",reflectMapper:Sh(JE)}]},v2SignallingCloseRoom:{sid:18,cid:3,service:YE,params:[{type:"Property",name:"tag",reflectMapper:JE}],response:[{type:"Property",name:"data",reflectMapper:Sh(JE)}]},v2SignallingJoinRoom:{sid:18,cid:4,service:YE,params:[{type:"Property",name:"tag",reflectMapper:JE}],response:[{type:"Property",name:"data",reflectMapper:Sh(JE)}]},v2SignallingLeaveRoom:{sid:18,cid:5,service:YE,params:[{type:"Property",name:"tag",reflectMapper:JE}],response:[{type:"Property",name:"data",reflectMapper:Sh(JE)}]},v2SignallingInvite:{sid:18,cid:6,service:YE,params:[{type:"Property",name:"tag",reflectMapper:JE}],response:[{type:"Property",name:"data",reflectMapper:Sh(JE)}]},v2SignallingCancelInvite:{sid:18,cid:7,service:YE,params:[{type:"Property",name:"tag",reflectMapper:JE}],response:[{type:"Property",name:"data",reflectMapper:Sh(JE)}]},v2SignallingRejectInvite:{sid:18,cid:8,service:YE,params:[{type:"Property",name:"tag",reflectMapper:JE}]},v2SignallingAcceptInvite:{sid:18,cid:9,service:YE,params:[{type:"Property",name:"tag",reflectMapper:JE}]},v2SignallingSendControl:{sid:18,cid:10,service:YE,params:[{type:"Property",name:"tag",reflectMapper:JE}]},v2SignallingOnlineEvent:{sid:15,cid:11,service:YE,response:[{type:"Property",name:"data",reflectMapper:Sh(JE)}]},v2SignallingMultiClientEvent:{sid:15,cid:12,service:YE,response:[{type:"Property",name:"data",reflectMapper:Sh(JE)}]},v2SignallingOfflineEvent:{sid:15,cid:13,service:YE,response:[{type:"PropertyArray",name:"datas",reflectMapper:Sh(JE)}]},v2SignallingSyncChannels:{sid:15,cid:14,service:YE,response:[{type:"PropertyArray",name:"datas",reflectMapper:Sh(JE)}]},v2SignallingGetRoomInfo:{sid:18,cid:15,service:YE,params:[{type:"Property",name:"tag",reflectMapper:JE}],response:[{type:"Property",name:"data",reflectMapper:Sh(JE)}]},v2SignallingBatchMarkRead:{sid:4,cid:5,hasPacketResponse:!1,service:YE,params:[{type:"Byte",name:"sid"},{type:"Byte",name:"cid"},{type:"LongArray",name:"ids"}]}},XE={calleeAccountId:{type:"string",required:!0,allowEmpty:!1},requestId:{type:"string",required:!0,allowEmpty:!1},channelType:{type:"enum",values:[1,3,2]},channelName:{type:"string",required:!1,allowEmpty:!0},channelExtension:{type:"string",required:!1,allowEmpty:!0},serverExtension:{type:"string",required:!1,allowEmpty:!0},signallingConfig:{type:"object",required:!1,rules:{offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1},selfUid:{type:"number",required:!1}}},pushConfig:{type:"object",required:!1,rules:{pushEnabled:{type:"boolean",required:!1},pushTitle:{type:"string",required:!1,allowEmpty:!0},pushContent:{type:"string",required:!1,allowEmpty:!0},pushPayload:{type:"string",required:!1,allowEmpty:!0}}},rtcConfig:{type:"object",required:!1,rules:{rtcChannelName:{type:"string",required:!1,allowEmpty:!0},rtcTokenTtl:{type:"number",required:!1},rtcParams:{type:"string",required:!1,allowEmpty:!0}}}},$E={channelId:{type:"string",required:!0,allowEmpty:!1},callerAccountId:{type:"string",required:!0,allowEmpty:!1},requestId:{type:"string",required:!0,allowEmpty:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0},signallingConfig:{type:"object",required:!1,rules:{offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1},selfUid:{type:"number",required:!1}}},rtcConfig:{type:"object",required:!1,rules:{rtcChannelName:{type:"string",required:!1,allowEmpty:!0},rtcTokenTtl:{type:"number",required:!1},rtcParams:{type:"string",required:!1,allowEmpty:!0}}}},ZE={channelType:{type:"enum",values:[1,3,2]},channelName:{type:"string",required:!1,allowEmpty:!0},channelExtension:{type:"string",required:!1,allowEmpty:!0}},ew={channelId:{type:"string",required:!0,allowEmpty:!1},offlineEnabled:{type:"boolean",required:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0}},tw={channelId:{type:"string",required:!0,allowEmpty:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0},signallingConfig:{type:"object",required:!1,rules:{offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1},selfUid:{type:"number",required:!1}}},rtcConfig:{type:"object",required:!1,rules:{rtcChannelName:{type:"string",required:!1,allowEmpty:!0},rtcTokenTtl:{type:"number",required:!1},rtcParams:{type:"string",required:!1,allowEmpty:!0}}}},rw={channelId:{type:"string",required:!0,allowEmpty:!1},offlineEnabled:{type:"boolean",required:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0}},nw={channelId:{type:"string",required:!0,allowEmpty:!1},inviteeAccountId:{type:"string",required:!0,allowEmpty:!1},requestId:{type:"string",required:!0,allowEmpty:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0},signallingConfig:{type:"object",required:!1,rules:{offlineEnabled:{type:"boolean",required:!1},unreadEnabled:{type:"boolean",required:!1},selfUid:{type:"number",required:!1}}},pushConfig:{type:"object",required:!1,rules:{pushEnabled:{type:"boolean",required:!1},pushTitle:{type:"string",required:!1,allowEmpty:!0},pushContent:{type:"string",required:!1,allowEmpty:!0},pushPayload:{type:"string",required:!1,allowEmpty:!0}}}},iw={channelId:{type:"string",required:!0,allowEmpty:!1},inviteeAccountId:{type:"string",required:!0,allowEmpty:!1},requestId:{type:"string",required:!0,allowEmpty:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0},offlineEnabled:{type:"boolean",required:!1}},ow={channelId:{type:"string",allowEmpty:!1},receiverAccountId:{type:"string",required:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0}},aw={channelId:{type:"string",allowEmpty:!1},inviterAccountId:{type:"string",allowEmpty:!1},requestId:{type:"string",allowEmpty:!1},serverExtension:{type:"string",required:!1,allowEmpty:!0},offlineEnabled:{type:"boolean",required:!1}},sw=aw;function cw(e){var t,r=e.attach,n={eventType:r.type,channelInfo:e.channelInfo,operatorAccountId:e.fromAccid,time:e.time,serverExtension:e.serverExtension,requestId:e.requestId,pushConfig:e.pushConfig,unreadEnabled:null===(t=e.signallingConfig)||void 0===t?void 0:t.unreadEnabled},i=e.fromAccid,o=e.toAccid;switch(n.eventType){case 1:break;case 2:n.member={accountId:r.member[1],uid:Number(r.member[2]),joinTime:Number(r.member[3]),expireTime:Number(r.member[4]),deviceId:r.member[5]};break;case 3:case 4:n.operatorAccountId=i,n.inviteeAccountId=o,n.inviterAccountId=i;break;case 5:case 6:n.operatorAccountId=i,n.inviterAccountId=o,n.inviteeAccountId=i}return JSON.parse(_i(n))}var uw,dw=function(e){function t(t,r){var n;return void 0===r&&(r={}),(n=e.call(this,"V2NIMSignallingService",t)||this).config={compatibleWithV1:!0},n.channels={},n.timer=0,n.pollingInterval=12e4,"v2"!==n.core.options.apiVersion?ut(n):(Mh({cmdMap:KE,cmdConfig:zE}),n.setOptions(r),n)}nr(t,e);var r=t.prototype;return r.reset=function(){this.timer=0,this.channels={}},r.setOptions=function(e){var t;(null===(t=this.core.signaling)||void 0===t?void 0:t.name)?this.config.compatibleWithV1=!0:this.config.compatibleWithV1=!1,this.config=dr(this.config,e)},r.emit=function(t){for(var r,n,i,o,a=this.name+"::emit "+t.toString(),s=arguments.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=arguments[u];return(r=this.logger).log.apply(r,xs(n=[""+a]).call(n,c)),(i=e.prototype.emit).call.apply(i,xs(o=[this,t]).call(o,c))},r.call=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o,a;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),Pl(XE,e,"",!0),e.calleeAccountId!==this.core.account){r.next=4;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"You cannot call yourself"}});case 4:return n=void 0!==e.pushConfig&&void 0!==e.pushConfig.pushEnabled&&e.pushConfig.pushEnabled,r.next=7,this.core.sendCmd("v2SignallingCall",{tag:dr(dr({},e),{toAccid:e.calleeAccountId,offlineEnabled:void 0===(null===(t=e.signallingConfig)||void 0===t?void 0:t.offlineEnabled)||e.signallingConfig.offlineEnabled,pushConfig:dr(dr({},e.pushConfig||{}),{pushEnabled:n})})});case 7:return i=r.sent,o=i.content.data,this.channels[o.channelInfo.channelId]=VT(o.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(tr(a=this.aotoDelay).call(a,this),this.pollingInterval,-1)),r.abrupt("return",{callStatus:o.callStatus,rtcInfo:o.rtcInfo,roomInfo:{channelInfo:o.channelInfo,members:o.members}});case 12:case"end":return r.stop()}}),r,this)})))},r.callSetup=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),Pl($E,e,"",!0),e.callerAccountId!==this.core.account){r.next=4;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"callSetup: cannot be yourself"}});case 4:return r.next=6,this.core.sendCmd("v2SignallingCallSetup",{tag:dr(dr({},e),{toAccid:e.callerAccountId,offlineEnabled:void 0===(null===(t=e.signallingConfig)||void 0===t?void 0:t.offlineEnabled)||e.signallingConfig.offlineEnabled})});case 6:return n=r.sent,i=n.content.data,this.channels[i.channelInfo.channelId]=VT(i.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(tr(o=this.aotoDelay).call(o,this),this.pollingInterval,-1)),r.abrupt("return",{callStatus:i.callStatus,rtcInfo:i.rtcInfo,roomInfo:{channelInfo:i.channelInfo,members:i.members}});case 11:case"end":return r.stop()}}),r,this)})))},r.createRoom=function(e,t,r){return zl(this,void 0,void 0,Ql.mark((function n(){var i;return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Pl(ZE,{channelType:e,channelName:t,channelExtension:r},"",!0),n.next=4,this.core.sendCmd("v2SignallingCreateRoom",{tag:{channelType:e,channelName:t,channelExtension:r}});case 4:return i=n.sent,n.abrupt("return",i.content.data.channelInfo);case 6:case"end":return n.stop()}}),n,this)})))},r.delayRoom=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),t.next=3,this.core.sendCmd("v2SignallingDelayRoom",{tag:{channelId:e}});case 3:return r=t.sent,t.abrupt("return",{channelInfo:r.content.data.channelInfo,members:r.content.data.members});case 5:case"end":return t.stop()}}),t,this)})))},r.closeRoom=function(e,t,r){return zl(this,void 0,void 0,Ql.mark((function n(){return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Pl(ew,{channelId:e,offlineEnabled:t,serverExtension:r},"",!0),n.next=4,this.core.sendCmd("v2SignallingCloseRoom",{tag:{channelId:e,offlineEnabled:void 0!==t&&t,serverExtension:r}});case 4:case"end":return n.stop()}}),n,this)})))},r.joinRoom=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){var n,i,o;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this.checkV2(),Pl(tw,e,"",!0),r.next=4,this.core.sendCmd("v2SignallingJoinRoom",{tag:dr(dr({},e),{offlineEnabled:void 0===(null===(t=e.signallingConfig)||void 0===t?void 0:t.offlineEnabled)||e.signallingConfig.offlineEnabled})});case 4:return n=r.sent,i=n.content.data,this.channels[i.channelInfo.channelId]=VT(i.channelInfo),this.timer||(this.timer=this.core.timerManager.addTimer(tr(o=this.aotoDelay).call(o,this),this.pollingInterval,-1)),r.abrupt("return",{channelInfo:n.content.data.channelInfo,members:n.content.data.members});case 9:case"end":return r.stop()}}),r,this)})))},r.leaveRoom=function(e,t,r){return zl(this,void 0,void 0,Ql.mark((function n(){return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.checkV2(),Pl(rw,{channelId:e,offlineEnabled:t,serverExtension:r},"",!0),n.next=4,this.core.sendCmd("v2SignallingLeaveRoom",{tag:{channelId:e,offlineEnabled:void 0!==t&&t,serverExtension:r}});case 4:delete this.channels[e];case 5:case"end":return n.stop()}}),n,this)})))},r.invite=function(e){var t;return zl(this,void 0,void 0,Ql.mark((function r(){var n,i;return Ql.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.checkV2(),Pl(nw,e,"",!0),e.inviteeAccountId!==this.core.account){r.next=4;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"invite: cannot be yourself"}});case 4:return n=void 0!==e.pushConfig&&void 0!==e.pushConfig.pushEnabled&&e.pushConfig.pushEnabled,r.next=7,this.core.sendCmd("v2SignallingInvite",{tag:dr(dr({},e),{toAccid:e.inviteeAccountId,offlineEnabled:void 0===(null===(t=e.signallingConfig)||void 0===t?void 0:t.offlineEnabled)||e.signallingConfig.offlineEnabled,pushConfig:dr(dr({},e.pushConfig||{}),{pushEnabled:n})})});case 7:return i=r.sent,r.abrupt("return",i.content.data);case 9:case"end":return r.stop()}}),r,this)})))},r.cancelInvite=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkV2(),Pl(iw,e,"",!0),t.next=4,this.core.sendCmd("v2SignallingCancelInvite",{tag:dr(dr({},e),{toAccid:e.inviteeAccountId})});case 4:return r=t.sent,t.abrupt("return",r.content.data);case 6:case"end":return t.stop()}}),t,this)})))},r.rejectInvite=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Pl(aw,e,"",!0),e.inviterAccountId!==this.core.account){t.next=3;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"rejectInvite: cannot be yourself"}});case 3:return t.next=5,this.core.sendCmd("v2SignallingRejectInvite",{tag:dr(dr({},e),{toAccid:e.inviterAccountId})});case 5:case"end":return t.stop()}}),t,this)})))},r.acceptInvite=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Pl(sw,e,"",!0),e.inviterAccountId!==this.core.account){t.next=3;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"acceptInvite: cannot be yourself"}});case 3:return t.next=5,this.core.sendCmd("v2SignallingAcceptInvite",{tag:dr(dr({},e),{toAccid:e.inviterAccountId})});case 5:case"end":return t.stop()}}),t,this)})))},r.sendControl=function(e,t,r){return zl(this,void 0,void 0,Ql.mark((function n(){return Ql.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Pl(ow,{channelId:e,receiverAccountId:t,serverExtension:r},"",!0),n.next=3,this.core.sendCmd("v2SignallingSendControl",{tag:{channelId:e,toAccid:t,serverExtension:r}});case 3:case"end":return n.stop()}}),n,this)})))},r.getRoomInfoByChannelName=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Pl({channelName:{type:"string",allowEmpty:!1}},{channelName:e},"",!0),t.next=3,this.core.sendCmd("v2SignallingGetRoomInfo",{tag:{channelName:e}});case 3:return r=t.sent,n=r.content.data,i=n.members,o=n.channelInfo,t.abrupt("return",{channelInfo:o,members:i||[]});case 6:case"end":return t.stop()}}),t,this)})))},r.aotoDelay=function(){return zl(this,void 0,void 0,Ql.mark((function e(){var t,r,n,i;return Ql.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(t=fr(this.channels)).length){e.next=5;break}return this.timer&&this.core.timerManager.deleteTimer(this.timer),this.timer=0,e.abrupt("return");case 5:this.logger.log("v2Signlling:autoDelay",t),r=0;case 7:if(!(r<t.length)){e.next=23;break}return n=t[r],e.prev=9,e.next=12,this.core.sendCmd("v2SignallingDelayRoom",{tag:{channelId:n}});case 12:i=e.sent,this.channels[n]=i.content.data.channelInfo,e.next=20;break;case 16:e.prev=16,e.t0=e.catch(9),this.logger.warn("signling:autoDelay "+n+" failed",e.t0),delete this.channels[n];case 20:r++,e.next=7;break;case 23:case"end":return e.stop()}}),e,this,[[9,16]])})))},r.v2SignallingOnlineEventHandler=function(e){var t=e.content.data,r="number"==typeof Zp(e,"raw.r[0]")?""+e.raw.r[0]:"0";!this.config.compatibleWithV1&&r&&$p(r)&&this.core.sendCmd("v2SignallingBatchMarkRead",{sid:15,cid:11,ids:[r]}),this.emit("onOnlineEvent",cw(t))},r.v2SignallingMultiClientEventHandler=function(e){this.emit("onMultiClientEvent",cw(e.content.data))},r.v2SignallingOfflineEventHandler=function(e){var t;if(e.content.datas&&e.content.datas.length>0){if(!this.config.compatibleWithV1){var r,n=du(r=e.content.datas).call(r,(function(e){return e.msgId}));n.length>0&&this.core.sendCmd("v2SignallingBatchMarkRead",{sid:15,cid:11,ids:n})}var i=du(t=e.content.datas).call(t,(function(e){return cw(e)}));this.emit("onOfflineEvent",i)}},r.v2SignallingSyncChannelsHandler=function(e){var t=this;if(this.timer=0,this.channels={},e.content.datas&&e.content.datas.length>0){var r,n=e.content.datas;jn(n).call(n,(function(e){var r=e.channelInfo.channelId;t.channels[r]=VT(e.channelInfo)})),this.timer||(this.timer=this.core.timerManager.addTimer(tr(r=this.aotoDelay).call(r,this),this.pollingInterval,-1)),this.emit("onSyncRoomInfoList",n)}},t}(rf),lw={"19_1":"v2PublishEvent","14_2":"v2OnUserStatusChange","19_3":"v2SubscribeUserStatus","19_4":"v2UnsubscribeUserStatus","19_5":"v2UnsubscribeAllUserStatus","19_6":"v2QuerySubscribeEvent","19_7":"v2QueryAllSubscribeEvent","14_9":"v2OnMultiUserStatusChange"},pw="V2NIMSubscriptionService",mw={eventType:{id:1,retType:"number"},statusType:{id:2,retType:"number"},uniqueId:3,extension:4,duration:{id:5,retType:"number"},onlineOnly:{id:6,retType:"boolean",converter:function(e){return e?1:2}},multiSync:{id:7,retType:"boolean",converter:Th},publishTime:{id:10,retType:"number"},serverId:11,clientType:{id:12,retType:"number"},serverExtension:13,extensionReceived:14,accountId:103},hw={eventType:{id:1,retType:"number"},duration:{id:2,retType:"number"},immediateSync:{id:3,retType:"number",converter:Th},accountId:102,subscribeTime:{id:105,retType:"number"}},fw={v2PublishEvent:{sid:19,cid:1,service:pw,params:[{type:"Property",name:"tag",reflectMapper:mw}],response:[{type:"Property",name:"data",reflectMapper:Sh(mw)}]},v2OnUserStatusChange:{sid:14,cid:2,service:pw,response:[{type:"Property",name:"data",reflectMapper:Sh(mw)}]},v2SubscribeUserStatus:{sid:19,cid:3,service:pw,params:[{type:"Property",name:"tag",reflectMapper:hw},{type:"StrArray",name:"accountIds"}],response:[{type:"StrArray",name:"failedList"}]},v2UnsubscribeUserStatus:{sid:19,cid:4,service:pw,params:[{type:"Property",name:"tag",reflectMapper:hw},{type:"StrArray",name:"accountIds"}],response:[{type:"StrArray",name:"failedList"}]},v2UnsubscribeAllUserStatus:{sid:19,cid:5,service:pw,params:[{type:"Property",name:"tag",reflectMapper:hw}]},v2QuerySubscribeEvent:{sid:19,cid:6,service:pw,params:[{type:"Property",name:"tag",reflectMapper:hw},{type:"StrArray",name:"accountIds"}],response:[{type:"PropertyArray",name:"data",reflectMapper:Sh(hw)}]},v2QueryAllSubscribeEvent:{sid:19,cid:7,service:pw,params:[{type:"Property",name:"tag",reflectMapper:hw}],response:[{type:"PropertyArray",name:"data",reflectMapper:Sh(hw)}]},v2OnMultiUserStatusChange:{sid:14,cid:9,service:pw,response:[{type:"PropertyArray",name:"data",reflectMapper:Sh(mw)}]}},gw={accountIds:{type:"array",required:!0,itemType:"string",min:1,max:100},duration:{type:"number",required:!1,min:60,max:2592e3},immediateSync:{type:"boolean",required:!1}},vw={accountIds:{type:"array",required:!1,itemType:"string",max:100}},yw={statusType:{type:"number",required:!0,min:1e4,max:2147483647},duration:{type:"number",required:!1,min:60,max:604800},extension:{type:"jsonstr",required:!1},onlineOnly:{type:"boolean",required:!1},multiSync:{type:"boolean",required:!1}},Mw=function(e){function t(t){var r;return"v2"!==(r=e.call(this,"V2NIMSubscriptionService",t)||this).core.options.apiVersion?ut(r):(Mh({cmdMap:lw,cmdConfig:fw}),r)}nr(t,e);var r=t.prototype;return r.emit=function(t){for(var r,n,i,o,a=this.name+"::emit "+t.toString(),s=arguments.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=arguments[u];return(r=this.logger).log.apply(r,xs(n=[""+a]).call(n,c)),(i=e.prototype.emit).call.apply(i,xs(o=[this,t]).call(o,c))},r.subscribeUserStatus=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkLogin(),this.checkV2(),Pl(gw,e,"",!0),t.next=5,this.core.sendCmd("v2SubscribeUserStatus",{tag:{eventType:1,duration:e.duration||60,immediateSync:void 0!==e.immediateSync&&e.immediateSync},accountIds:e.accountIds});case 5:return r=t.sent,t.abrupt("return",r.content.failedList);case 7:case"end":return t.stop()}}),t,this)})))},r.unsubscribeUserStatus=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkLogin(),this.checkV2(),Pl(vw,e,"",!0),r=[],!(e.accountIds.length>0)){t.next=11;break}return t.next=7,this.core.sendCmd("v2UnsubscribeUserStatus",{tag:{eventType:1},accountIds:e.accountIds});case 7:n=t.sent,r=n.content.failedList,t.next=15;break;case 11:return t.next=14,this.core.sendCmd("v2UnsubscribeAllUserStatus",{tag:{eventType:1}});case 14:r=[];case 15:return t.abrupt("return",r);case 16:case"end":return t.stop()}}),t,this)})))},r.publishCustomUserStatus=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.checkLogin(),this.checkV2(),Pl(yw,e,"",!0),t.next=5,this.core.sendCmd("v2PublishEvent",{tag:dr(dr({},e),{eventType:1,uniqueId:Ep(),duration:e.duration||60,onlineOnly:void 0===e.onlineOnly||e.onlineOnly,multiSync:void 0!==e.multiSync&&e.multiSync})});case 5:return r=t.sent,t.abrupt("return",r.content.data);case 7:case"end":return t.stop()}}),t,this)})))},r.queryUserStatusSubscriptions=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r,n,i,o,a,s;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.checkLogin(),this.checkV2(),Pl({accountIds:{type:"array",required:!0,itemType:"string",max:3e3}},{accountIds:e},"",!0),r=[],!(e.length>0)){t.next=16;break}n=0;case 6:if(!(n<e.length)){t.next=14;break}return t.next=9,this.core.sendCmd("v2QuerySubscribeEvent",{tag:{eventType:1},accountIds:Wc(e).call(e,n,n+100)});case 9:o=t.sent,r=xs(r).call(r,du(i=o.content.data).call(i,(function(e){return{accountId:e.accountId,subscribeTime:e.subscribeTime,duration:e.duration}})));case 11:n+=100,t.next=6;break;case 14:t.next=20;break;case 16:return t.next=18,this.core.sendCmd("v2QueryAllSubscribeEvent",{tag:{eventType:1}});case 18:s=t.sent,r=xs(r).call(r,du(a=s.content.data).call(a,(function(e){return{accountId:e.accountId,subscribeTime:e.subscribeTime,duration:e.duration}})));case 20:return t.abrupt("return",r);case 21:case"end":return t.stop()}}),t,this)})))},r.v2OnUserStatusChangeHandler=function(e){var t=e.content.data,r=t.eventType,n=t.extensionReceived,i=Jl(t,["eventType","extensionReceived"]);1===r?this.emit("onUserStatusChanged",[dr(dr({},i),{extension:n})]):this.logger.log("v2OnUserStatusChangeHandler eventType = ",r,"msgEvent = ",t)},r.v2OnMultiUserStatusChangeHandler=function(e){var t,r=e.content.data,n=du(t=fu(r).call(r,(function(e){return 1===e.eventType}))).call(t,(function(e){e.eventType;var t=e.extensionReceived,r=Jl(e,["eventType","extensionReceived"]);return dr(dr({},r),{extension:t})}));n.length>0&&this.emit("onUserStatusChanged",n)},t}(rf);!function(e){e[e.V2NIM_PROXY_REQUEST_METHOD_GET=1]="V2NIM_PROXY_REQUEST_METHOD_GET",e[e.V2NIM_PROXY_REQUEST_METHOD_POST=2]="V2NIM_PROXY_REQUEST_METHOD_POST",e[e.V2NIM_PROXY_REQUEST_METHOD_PUT=3]="V2NIM_PROXY_REQUEST_METHOD_PUT",e[e.V2NIM_PROXY_REQUEST_METHOD_DELETE=4]="V2NIM_PROXY_REQUEST_METHOD_DELETE"}(uw||(uw={}));var Iw="V2NIMPassthroughService",Sw={"22_1":"v2ProxyRequest","22_2":"v2ProxyOnRequest"},Tw={zone:1,path:2,method:3,header:4,body:5},bw={v2ProxyRequest:{sid:22,cid:1,service:Iw,params:[{type:"Property",name:"tag",reflectMapper:Tw}],response:[{type:"Property",name:"data",reflectMapper:Sh(Tw)}]},v2ProxyOnRequest:{sid:22,cid:2,service:Iw,response:[{type:"Property",name:"data",reflectMapper:Sh({fromAccountId:1,body:2,time:{id:3,retType:"number"}})}]}},Cw={path:{type:"string",allowEmpty:!1},zone:{type:"string",required:!1},method:{type:"enum",values:[uw.V2NIM_PROXY_REQUEST_METHOD_DELETE,uw.V2NIM_PROXY_REQUEST_METHOD_GET,uw.V2NIM_PROXY_REQUEST_METHOD_POST,uw.V2NIM_PROXY_REQUEST_METHOD_PUT],required:!1},header:{type:"jsonstr",required:!1},body:{type:"string",required:!1}},_w=function(e){function t(t){var r;return r=e.call(this,"V2NIMPassthroughService",t)||this,Mh({cmdMap:Sw,cmdConfig:bw}),r}nr(t,e);var r=t.prototype;return r.emit=function(t){for(var r,n,i,o,a=this.name+"::emit "+t.toString(),s=arguments.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=arguments[u];return(r=this.logger).log.apply(r,xs(n=[""+a]).call(n,c)),(i=e.prototype.emit).call.apply(i,xs(o=[this,t]).call(o,c))},r.httpProxy=function(e){return zl(this,void 0,void 0,Ql.mark((function t(){var r;return Ql.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Pl(Cw,e,"",!0),!(e.method===uw.V2NIM_PROXY_REQUEST_METHOD_GET&&e.body||e.method===uw.V2NIM_PROXY_REQUEST_METHOD_POST&&!e.body||e.method===uw.V2NIM_PROXY_REQUEST_METHOD_PUT&&!e.body)){t.next=3;break}throw new _l({code:Tl.V2NIM_ERROR_CODE_INVALID_PARAMETER,detail:{reason:"method "+e.method+", incorrect body"}});case 3:return t.next=5,this.core.sendCmd("v2ProxyRequest",{tag:e});case 5:return r=t.sent,t.abrupt("return",r.content.data);case 7:case"end":return t.stop()}}),t,this)})))},r.v2ProxyOnRequestHandler=function(e){var t=e.content.data;this.emit("onProxyNotify",t)},t}(rf),Ew=n((function(e,t){e.exports=function(e){var t=function(e,t){return e+t&4294967295},r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function n(e,r,n,i,o,a){return r=t(t(r,e),t(i,a)),t(r<<o|r>>>32-o,n)}function i(e,t,r,i,o,a,s){return n(t&r|~t&i,e,t,o,a,s)}function o(e,t,r,i,o,a,s){return n(t&i|r&~i,e,t,o,a,s)}function a(e,t,r,i,o,a,s){return n(t^r^i,e,t,o,a,s)}function s(e,t,r,i,o,a,s){return n(r^(t|~i),e,t,o,a,s)}function c(e,r){var n=e[0],c=e[1],u=e[2],d=e[3];n=i(n,c,u,d,r[0],7,-680876936),d=i(d,n,c,u,r[1],12,-389564586),u=i(u,d,n,c,r[2],17,606105819),c=i(c,u,d,n,r[3],22,-1044525330),n=i(n,c,u,d,r[4],7,-176418897),d=i(d,n,c,u,r[5],12,1200080426),u=i(u,d,n,c,r[6],17,-1473231341),c=i(c,u,d,n,r[7],22,-45705983),n=i(n,c,u,d,r[8],7,1770035416),d=i(d,n,c,u,r[9],12,-1958414417),u=i(u,d,n,c,r[10],17,-42063),c=i(c,u,d,n,r[11],22,-1990404162),n=i(n,c,u,d,r[12],7,1804603682),d=i(d,n,c,u,r[13],12,-40341101),u=i(u,d,n,c,r[14],17,-1502002290),n=o(n,c=i(c,u,d,n,r[15],22,1236535329),u,d,r[1],5,-165796510),d=o(d,n,c,u,r[6],9,-1069501632),u=o(u,d,n,c,r[11],14,643717713),c=o(c,u,d,n,r[0],20,-373897302),n=o(n,c,u,d,r[5],5,-701558691),d=o(d,n,c,u,r[10],9,38016083),u=o(u,d,n,c,r[15],14,-660478335),c=o(c,u,d,n,r[4],20,-405537848),n=o(n,c,u,d,r[9],5,568446438),d=o(d,n,c,u,r[14],9,-1019803690),u=o(u,d,n,c,r[3],14,-187363961),c=o(c,u,d,n,r[8],20,1163531501),n=o(n,c,u,d,r[13],5,-1444681467),d=o(d,n,c,u,r[2],9,-51403784),u=o(u,d,n,c,r[7],14,1735328473),n=a(n,c=o(c,u,d,n,r[12],20,-1926607734),u,d,r[5],4,-378558),d=a(d,n,c,u,r[8],11,-2022574463),u=a(u,d,n,c,r[11],16,1839030562),c=a(c,u,d,n,r[14],23,-35309556),n=a(n,c,u,d,r[1],4,-1530992060),d=a(d,n,c,u,r[4],11,1272893353),u=a(u,d,n,c,r[7],16,-155497632),c=a(c,u,d,n,r[10],23,-1094730640),n=a(n,c,u,d,r[13],4,681279174),d=a(d,n,c,u,r[0],11,-358537222),u=a(u,d,n,c,r[3],16,-722521979),c=a(c,u,d,n,r[6],23,76029189),n=a(n,c,u,d,r[9],4,-640364487),d=a(d,n,c,u,r[12],11,-421815835),u=a(u,d,n,c,r[15],16,530742520),n=s(n,c=a(c,u,d,n,r[2],23,-995338651),u,d,r[0],6,-198630844),d=s(d,n,c,u,r[7],10,1126891415),u=s(u,d,n,c,r[14],15,-1416354905),c=s(c,u,d,n,r[5],21,-57434055),n=s(n,c,u,d,r[12],6,1700485571),d=s(d,n,c,u,r[3],10,-1894986606),u=s(u,d,n,c,r[10],15,-1051523),c=s(c,u,d,n,r[1],21,-2054922799),n=s(n,c,u,d,r[8],6,1873313359),d=s(d,n,c,u,r[15],10,-30611744),u=s(u,d,n,c,r[6],15,-1560198380),c=s(c,u,d,n,r[13],21,1309151649),n=s(n,c,u,d,r[4],6,-145523070),d=s(d,n,c,u,r[11],10,-1120210379),u=s(u,d,n,c,r[2],15,718787259),c=s(c,u,d,n,r[9],21,-343485551),e[0]=t(n,e[0]),e[1]=t(c,e[1]),e[2]=t(u,e[2]),e[3]=t(d,e[3])}function u(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}function d(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return r}function l(e){var t,r,n,i,o,a,s=e.length,d=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=s;t+=64)c(d,u(e.substring(t-64,t)));for(r=(e=e.substring(t-64)).length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<r;t+=1)n[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(n[t>>2]|=128<<(t%4<<3),t>55)for(c(d,n),t=0;t<16;t+=1)n[t]=0;return i=(i=8*s).toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(i[2],16),a=parseInt(i[1],16)||0,n[14]=o,n[15]=a,c(d,n),d}function p(e){var t,r,n,i,o,a,s=e.length,u=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=s;t+=64)c(u,d(e.subarray(t-64,t)));for(r=(e=t-64<s?e.subarray(t-64):new Uint8Array(0)).length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<r;t+=1)n[t>>2]|=e[t]<<(t%4<<3);if(n[t>>2]|=128<<(t%4<<3),t>55)for(c(u,n),t=0;t<16;t+=1)n[t]=0;return i=(i=8*s).toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(i[2],16),a=parseInt(i[1],16)||0,n[14]=o,n[15]=a,c(u,n),u}function m(e){var t,n="";for(t=0;t<4;t+=1)n+=r[e>>8*t+4&15]+r[e>>8*t&15];return n}function h(e){var t;for(t=0;t<e.length;t+=1)e[t]=m(e[t]);return e.join("")}function f(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function g(e,t){var r,n=e.length,i=new ArrayBuffer(n),o=new Uint8Array(i);for(r=0;r<n;r+=1)o[r]=e.charCodeAt(r);return t?o:i}function v(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function y(e,t,r){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e)),n.set(new Uint8Array(t),e.byteLength),r?n:n.buffer}function M(e){var t,r=[],n=e.length;for(t=0;t<n-1;t+=2)r.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,r)}function I(){this.reset()}return"5d41402abc4b2a76b9719d911017c592"!==h(l("hello"))&&(t=function(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(r,n){var i,o,a,s,c=this.byteLength,u=t(r,c),d=c;return n!==e&&(d=t(n,c)),u>d?new ArrayBuffer(0):(i=d-u,o=new ArrayBuffer(i),a=new Uint8Array(o),s=new Uint8Array(this,u,i),a.set(s),o)}}(),I.prototype.append=function(e){return this.appendBinary(f(e)),this},I.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,r=this._buff.length;for(t=64;t<=r;t+=64)c(this._hash,u(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},I.prototype.end=function(e){var t,r,n=this._buff,i=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=n.charCodeAt(t)<<(t%4<<3);return this._finish(o,i),r=h(this._hash),e&&(r=M(r)),this.reset(),r},I.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},I.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},I.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},I.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},I.prototype._finish=function(e,t){var r,n,i,o=t;if(e[o>>2]|=128<<(o%4<<3),o>55)for(c(this._hash,e),o=0;o<16;o+=1)e[o]=0;r=(r=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(r[2],16),i=parseInt(r[1],16)||0,e[14]=n,e[15]=i,c(this._hash,e)},I.hash=function(e,t){return I.hashBinary(f(e),t)},I.hashBinary=function(e,t){var r=h(l(e));return t?M(r):r},I.ArrayBuffer=function(){this.reset()},I.ArrayBuffer.prototype.append=function(e){var t,r=y(this._buff.buffer,e,!0),n=r.length;for(this._length+=e.byteLength,t=64;t<=n;t+=64)c(this._hash,d(r.subarray(t-64,t)));return this._buff=t-64<n?new Uint8Array(r.buffer.slice(t-64)):new Uint8Array(0),this},I.ArrayBuffer.prototype.end=function(e){var t,r,n=this._buff,i=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=n[t]<<(t%4<<3);return this._finish(o,i),r=h(this._hash),e&&(r=M(r)),this.reset(),r},I.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},I.ArrayBuffer.prototype.getState=function(){var e=I.prototype.getState.call(this);return e.buff=v(e.buff),e},I.ArrayBuffer.prototype.setState=function(e){return e.buff=g(e.buff,!0),I.prototype.setState.call(this,e)},I.ArrayBuffer.prototype.destroy=I.prototype.destroy,I.ArrayBuffer.prototype._finish=I.prototype._finish,I.ArrayBuffer.hash=function(e,t){var r=h(p(new Uint8Array(e)));return t?M(r):r},I}()})),ww=function(e){return e&&"object"==typeof e&&"default"in e?e.default:e}(Ew),Rw=class{md5(e,t,r){this.aborted=!1,this.progress=0;let n=0;const i=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,o=2097152,a=Math.ceil(e.size/o),s=new ww.ArrayBuffer,c=new FileReader;function u(){const t=n*o,r=t+o>=e.size?e.size:t+o;c.readAsArrayBuffer(i.call(e,t,r))}u(),c.onloadend=e=>{s.append(e.target.result),n++,this.progress=n/a,r&&"function"==typeof r&&r(this.progress),this.aborted?t("aborted"):n<a?u():t(null,s.end())}}abort(){this.aborted=!0}},kw=function(){function e(e){this.name="DataStructureConverter",this.core=e}var t=e.prototype;return t.messageConvertToV1=function(e){var t,r=yh(vh(e,Hg),mf(sT)),n=WS(r,this.core.account),i=null===(t=this.core.session)||void 0===t?void 0:t.getSessionWithUncomplete({id:n});return YS(r,i?{account:this.core.account,sessionAck:i.ack,msgReceiptTime:i.msgReceiptTime}:{account:this.core.account})},t.messageConvertToV2=function(e){var t=yh(vh(XS(e,e.from,e.fromDeviceId),sT),Wg);return(t=Og(this.core,t)).sendingState="sending"===e.status?3:"sendFailed"===e.status?2:1,t},e}(),Aw=function(){function e(e){this.name="V2NIMMessageConverter",this.core=e}var t=e.prototype;return t.messageSerialization=function(e){if(!e)return null;var t=vh(e,Hg);return _i(t)},t.messageDeserialization=function(e){var t,r,n,i,o,a,s,c,u,d,l,p,m,h,f,g,v,y,M,I,S,T,b;if(!e)return null;try{var C,_,E,w,R=yh(JSON.parse(e),Wg);return R.sendingState=0,1!==R.conversationType||R.senderId!==this.core.account&&R.receiverId!==this.core.account?2===R.conversationType?R.conversationId=this.core.V2NIMConversationIdUtil.teamConversationId(R.receiverId):3===R.conversationType&&(R.conversationId=this.core.V2NIMConversationIdUtil.superTeamConversationId(R.receiverId)):R.conversationId=this.core.V2NIMConversationIdUtil.p2pConversationId(R.senderId===this.core.account?R.receiverId:R.senderId),R.threadReply&&(R.threadReply.conversationType=R.conversationType,R.threadReply=Pg(this.core,R.threadReply)),R.threadRoot&&(R.threadRoot.conversationType=R.conversationType,R.threadRoot=Pg(this.core,R.threadRoot)),ou(C=[1,3,2,0]).call(C,R.conversationType)||this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid conversationType(enum): "+R.conversationType),R.senderId&&"string"!=typeof R.senderId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid senderId(string): "+R.senderId),R.receiverId&&"string"!=typeof R.receiverId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid receiverId(string): "+R.receiverId),"createTime"in R&&isNaN(R.createTime)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid createTime(number): "+R.createTime),ou(_=[2,7,12,100,6,1,-1,4,5,11,0,10,3]).call(_,R.messageType)||this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageType(enum): "+R.messageType),"subType"in R&&isNaN(R.subType)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid subType(number): "+R.subType),R.messageClientId&&"string"!=typeof R.messageClientId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageClientId(string): "+R.messageClientId),R.messageServerId&&"string"!=typeof R.messageServerId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageServerId(string): "+R.messageServerId),R.attachment&&"object"!=typeof R.attachment&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid attachment(object): "+R.attachment),R.text&&"string"!=typeof R.text&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid text(string): "+R.text),R.serverExtension&&"string"!=typeof R.serverExtension&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid serverExtension(string): "+R.serverExtension),R.callbackExtension&&"string"!=typeof R.callbackExtension&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid callbackExtension(string): "+R.callbackExtension),(null===(t=R.pushConfig)||void 0===t?void 0:t.pushContent)&&"string"!=typeof R.pushConfig.pushContent&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid pushContent(string): "+R.pushConfig.pushContent),(null===(r=R.pushConfig)||void 0===r?void 0:r.pushPayload)&&"string"!=typeof R.pushConfig.pushPayload&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid pushPayload(string): "+R.pushConfig.pushPayload),(null===(n=R.pushConfig)||void 0===n?void 0:n.forcePushContent)&&"string"!=typeof R.pushConfig.forcePushContent&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid forcePushContent(string): "+R.pushConfig.forcePushContent),(null===(i=R.pushConfig)||void 0===i?void 0:i.forcePushAccountIds)&&!Ei(R.pushConfig.forcePushAccountIds)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid forcePushAccountIds(array): "+R.pushConfig.forcePushAccountIds),(null===(o=R.routeConfig)||void 0===o?void 0:o.routeEnvironment)&&"string"!=typeof R.routeConfig.routeEnvironment&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid routeEnvironment(string): "+R.routeConfig.routeEnvironment),(null===(a=R.antispamConfig)||void 0===a?void 0:a.antispamBusinessId)&&"string"!=typeof R.antispamConfig.antispamBusinessId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid antispamBusinessId(string): "+R.antispamConfig.antispamBusinessId),(null===(s=R.antispamConfig)||void 0===s?void 0:s.antispamCustomMessage)&&"string"!=typeof R.antispamConfig.antispamCustomMessage&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid antispamCustomMessage(string): "+R.antispamConfig.antispamCustomMessage),(null===(c=R.antispamConfig)||void 0===c?void 0:c.antispamCheating)&&"string"!=typeof R.antispamConfig.antispamCheating&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid antispamCheating(string): "+R.antispamConfig.antispamCheating),(null===(u=R.antispamConfig)||void 0===u?void 0:u.antispamExtension)&&"string"!=typeof R.antispamConfig.antispamExtension&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid antispamExtension(string): "+R.antispamConfig.antispamExtension),(null===(d=R.robotConfig)||void 0===d?void 0:d.accountId)&&"string"!=typeof R.robotConfig.accountId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid accountId(string): "+R.robotConfig.accountId),(null===(l=R.robotConfig)||void 0===l?void 0:l.topic)&&"string"!=typeof R.robotConfig.topic&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid topic(string): "+R.robotConfig.topic),(null===(p=R.robotConfig)||void 0===p?void 0:p.function)&&"string"!=typeof R.robotConfig.function&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid function(string): "+R.robotConfig.function),(null===(m=R.robotConfig)||void 0===m?void 0:m.customContent)&&"string"!=typeof R.robotConfig.customContent&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid customContent(string): "+R.robotConfig.customContent),(null===(h=R.threadRoot)||void 0===h?void 0:h.senderId)&&"string"!=typeof R.threadRoot.senderId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid senderId(string): "+R.threadRoot.senderId),(null===(f=R.threadRoot)||void 0===f?void 0:f.receiverId)&&"string"!=typeof R.threadRoot.receiverId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid receiverId(string): "+R.threadRoot.receiverId),(null===(g=R.threadRoot)||void 0===g?void 0:g.messageClientId)&&"string"!=typeof R.threadRoot.messageClientId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageClientId(string): "+R.threadRoot.messageClientId),(null===(v=R.threadRoot)||void 0===v?void 0:v.messageServerId)&&"string"!=typeof R.threadRoot.messageServerId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageServerId(string): "+R.threadRoot.messageServerId),R.threadRoot&&"createTime"in R.threadRoot&&isNaN(R.threadRoot.createTime)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid createTime(number): "+R.threadRoot.createTime),R.threadRoot&&!ou(E=[1,3,2,0]).call(E,R.threadRoot.conversationType)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid conversationType(enum): "+R.threadRoot.conversationType),(null===(y=R.threadRoot)||void 0===y?void 0:y.conversationId)&&"string"!=typeof R.threadRoot.conversationId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid conversationId(string): "+R.threadRoot.conversationId),(null===(M=R.threadReply)||void 0===M?void 0:M.senderId)&&"string"!=typeof R.threadReply.senderId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid senderId(string): "+R.threadReply.senderId),(null===(I=R.threadReply)||void 0===I?void 0:I.receiverId)&&"string"!=typeof R.threadReply.receiverId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid receiverId(string): "+R.threadReply.receiverId),(null===(S=R.threadReply)||void 0===S?void 0:S.messageClientId)&&"string"!=typeof R.threadReply.messageClientId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageClientId(string): "+R.threadReply.messageClientId),(null===(T=R.threadReply)||void 0===T?void 0:T.messageServerId)&&"string"!=typeof R.threadReply.messageServerId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid messageServerId(string): "+R.threadReply.messageServerId),R.threadReply&&"createTime"in R.threadReply&&isNaN(R.threadReply.createTime)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid createTime(number): "+R.threadReply.createTime),R.threadReply&&!ou(w=[1,3,2,0]).call(w,R.threadReply.conversationType)&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid conversationType(enum): "+R.threadReply.conversationType),(null===(b=R.threadReply)||void 0===b?void 0:b.conversationId)&&"string"!=typeof R.threadReply.conversationId&&this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid conversationId(string): "+R.threadReply.conversationId),delete R.__clientExt,delete R.userUpdateTime,R}catch(t){return this.core.logger.error("V2NIMMessageConverterImpl.messageDeserialization: invalid message string: "+e),null}},e}();!function(e){$l(Zl,e())}((function(){return{setLogger:Hm,platform:"BROWSER",localStorage:window.localStorage,request:gm,WebSocket:window.WebSocket,uploadFile:Qm,getFileUploadInformation:Jm,getSystemInfo:Xm,net:eh,logStorage:uh}})),fm.registerService(lf,"V1NIMLoginService"),fm.registerService(gT,"msg"),fm.registerService(TT,"user"),fm.registerService(PT,"session"),fm.registerService(UT,"team"),fm.registerService(GT,"systemMessage"),fm.registerService(JT,"friend"),fm.registerService(rb,"event"),fm.registerService(ub,"msgExtend"),fm.registerService(Mb,"msgLog"),fm.registerService(Cb,"passThrough"),fm.registerService(eM,"cloudStorage"),fm.registerService(Xb,"superTeam"),fm.registerService(MT,"sync"),fm.registerService(eC,"plugin"),fm.registerService(cC,"cloudSession"),fm.registerService(EC,"signaling"),fm.registerService(cg,"V2NIMLoginService"),fm.registerService(bv,"V2NIMConversationService"),fm.registerService(pM,"V2NIMMessageService"),fm.registerService(VE,"V2NIMNotificationService"),fm.registerService(tM,"V2NIMStorageService"),fm.registerService(Ay,"V2NIMStorageUtil"),fm.registerService(Rv,"V2NIMConversationGroupService"),fm.registerService(rI,"V2NIMTeamService"),fm.registerService(MI,"V2NIMUserService"),fm.registerService(OI,"V2NIMFriendService"),fm.registerService(oS,"V2NIMSettingService"),fm.registerService(qE,"V2NIMSyncService"),fm.registerService(WE,"V2NIMAIService"),fm.registerService(kw,"DataStructureConverter"),fm.registerService(Aw,"V2NIMMessageConverter"),fm.registerService(yM,"V2NIMMessageLogUtil"),fm.registerService(kM,"V2NIMMessageExtendUtil"),fm.registerService(dw,"V2NIMSignallingService"),fm.registerService(Mw,"V2NIMSubscriptionService"),fm.registerService(_w,"V2NIMPassthroughService"),fm.registerService(uM,"YSFService"),fm.registerService(q_,"qchatChannel"),fm.registerService(Q_,"qchatMedia"),fm.registerService(AE,"qchatMsg"),fm.registerService(xE,"qchatRole"),fm.registerService(LE,"qchatServer"),fm.registerPlugin(Rw,"browser-md5-file"),fm.registerPrivateService((function(e){var t=this;this.bindEvents=function(){t.core.eventBus.on("forwardSend/msg/sendMsg",t.onV1SendMsg),t.core.eventBus.on("forwardSend/msg/recallMsg",t.onV1RecallMsg),t.core.eventBus.on("forwardSend/msg/deleteSelfMsgs",t.onV1DeleteSelfMsgs),t.core.eventBus.on("forwardSend/msgLog/clearHistoryMsgsFromServer",t.onV1ClearHistoryMessage),t.core.eventBus.on("forwardSend/V2NIMMessageService/sendMsg",t.onV2SendMsg),t.core.eventBus.on("forwardSend/V2NIMMessageService/modifyMsg",t.onV2ModifyMsg),t.core.eventBus.on("forwardSend/V2NIMMessageService/revokeMessage",t.onV2RevokeMessage),t.core.eventBus.on("forwardSend/V2NIMMessageService/deleteSelfMsgs",t.onV2DeleteSelfMsgs),t.core.eventBus.on("forwardSend/V2NIMMessageLogService/clearHistoryMessage",t.onV2ClearHistoryMessage),t.core.eventBus.on("forwardSend/team/created",t.onV1TeamCreated),t.core.eventBus.on("forwardSend/team/updateMyMemberInfo",t.onV1TeamMemberUpdate),t.core.eventBus.on("forwardSend/superTeam/updateMyMemberInfo",t.onV1SuperTeamMemberUpdate),t.core.eventBus.on("forwardSend/V2NIMTeamService/updateSelfTeamMemberInfo",t.onV2TeamMemberUpdate),t.core.eventBus.on("forwardSend/team/passTeamApply",(function(e,r){return t.onV1TeamApply(e,1,1,r)})),t.core.eventBus.on("forwardSend/superTeam/passSuperTeamApply",(function(e,r){t.onV1TeamApply(e,2,1,r)})),t.core.eventBus.on("forwardSend/team/rejectTeamApply",(function(e,r){t.onV1TeamApply(e,1,2,r)})),t.core.eventBus.on("forwardSend/superTeam/rejectSuperTeamApply",(function(e,r){t.onV1TeamApply(e,2,2,r)})),t.core.eventBus.on("forwardSend/team/acceptTeamInvite",(function(e,r){t.onV1TeamInvite(e,1,1,r)})),t.core.eventBus.on("forwardSend/superTeam/acceptSuperTeamInvite",(function(e,r){t.onV1TeamInvite(e,2,1,r)})),t.core.eventBus.on("forwardSend/team/rejectTeamInvite",(function(e,r){t.onV1TeamInvite(e,1,2,r)})),t.core.eventBus.on("forwardSend/superTeam/rejectSuperTeamInvite",(function(e,r){t.onV1TeamInvite(e,2,2,r)})),t.core.eventBus.on("forwardSend/user/updateBlackList",t.onV1UpdateBlackList),t.core.eventBus.on("forwardSend/user/updateUserInfo",t.onV1UpdateUserInfo),t.core.eventBus.on("forwardSend/user/setMute",t.onV1SetMute),t.core.eventBus.on("forwardSend/friend/addFriend",t.onV1AddFriend),t.core.eventBus.on("forwardSend/friend/deleteFriend",t.onV1DeleteFriend),t.core.eventBus.on("forwardSend/friend/updateFriend",t.onV1UpdateFriend),t.core.eventBus.on("forwardSend/friend/passFriendApply",t.onV1PassFriendApply),t.core.eventBus.on("forwardSend/friend/rejectFriendApply",t.onV1RejectFriendApply)},this.onV1TeamApply=function(e,r,n,i){if(i){if(!t.core.V2NIMTeamService.notification.checkIfExpired(i))return;n=3}t.core.eventBus.emit("forwardReceive/V2NIMTeamService/updateTeamActionStatus",{teamId:e.teamId,teamType:r,operatorAccountId:e.from,actionType:0},n)},this.onV1TeamInvite=function(e,r,n,i){if(i){if(!t.core.V2NIMTeamService.notification.checkIfExpired(i.code))return;n=3}t.core.eventBus.emit("forwardReceive/V2NIMTeamService/updateTeamActionStatus",{teamId:e.teamId,teamType:r,operatorAccountId:e.from,actionType:2},n)},this.onV1PassFriendApply=function(e,r){t.core.eventBus.emit("forwardReceive/V2NIMFriendService/acceptAddApplication",e,r)},this.onV1RejectFriendApply=function(e,r,n){t.core.eventBus.emit("forwardReceive/V2NIMFriendService/rejectAddApplication",{applicantAccountId:e,recipientAccountId:t.core.account,operatorAccountId:t.core.account,postscript:r||"",timestamp:t.core.timeOrigin.getNTPTime(),read:!0,status:3},n)},this.onV1SetMute=function(e,r){t.core.eventBus.emit("forwardReceive/v2NIMSettingService/setP2PMessageMuteMode",e,r?1:0)},this.onV1UpdateFriend=function(e){t.core.eventBus.emit("forwardReceive/V2NIMFriendService/setFriendInfo",e.account,dr(dr({},"alias"in e?{alias:e.alias}:{}),"ext"in e?{serverExtension:e.ext}:{}))},this.onV1AddFriend=function(e){t.core.eventBus.emit("forwardReceive/V2NIMFriendService/addFriend",e)},this.onV1DeleteFriend=function(e){t.core.eventBus.emit("forwardReceive/V2NIMFriendService/deleteFriend",e)},this.onV1UpdateUserInfo=function(e){var r=yh(vh(e,VS.user),Sh(oI));t.core.eventBus.emit("forwardReceive/V2NIMUserService/updateUserProfile",r)},this.onV1UpdateBlackList=function(e,r){t.core.eventBus.emit("forwardReceive/V2NIMUserService/updateBlockList",e,r)},this.onV1TeamCreated=function(e){var r=yh(vh(CS(e),xS.team),Sh(Cg));t.core.eventBus.emit("forwardReceive/V2NIMTeamService/created",r)},this.onV1TeamMemberUpdate=function(e){(e=dr({},e)).type&&(e.type={normal:0,owner:1,manager:2}[e.type]);var r=yh(vh(e,xS.teamMember),Sh(_g));r.teamType=1,t.core.eventBus.emit("forwardReceive/V2NIMTeamService/updateSelfTeamMemberInfo",r)},this.onV1SuperTeamMemberUpdate=function(e){(e=dr({},e)).type&&(e.type={normal:0,owner:1,manager:2}[e.type]);var r=yh(vh(e,Qb.superTeamMember),Sh(Eg));r.teamType=2,t.core.eventBus.emit("forwardReceive/V2NIMTeamService/updateSelfTeamMemberInfo",r)},this.onV2TeamMemberUpdate=function(e){var r=e.teamType,n=vh(e,_g);if(2===r){var i=yh(n,Sh(Qb.superTeamMember));t.core.eventBus.emit("forwardReceive/superTeam/updateMyMemberInfo",i)}else{var o=yh(n,Sh(xS.teamMember));t.core.eventBus.emit("forwardReceive/team/updateMyMemberInfo",o)}},this.onV1SendMsg=function(e){var r=yh(vh(e,sT),Wg);(r=Og(t.core,r)).sendingState="sending"===e.status?3:"sent"===e.status?1:2,t.core.eventBus.emit("forwardReceive/V2NIMMessageService/sendMsg",r)},this.onV2SendMsg=function(e){var r=yh(vh(e,Hg),mf(sT));r.status=3===e.sendingState?"sending":1===e.sendingState?"sent":"sendFailed",t.core.eventBus.emit("forwardReceive/msg/sendMsg",r)},this.onV2ModifyMsg=function(e){var r=yh(vh(e,Hg),mf(sT));t.core.eventBus.emit("forwardReceive/msg/modifyMsg",r)},this.onV1RecallMsg=function(e){e.deleteMsgCreatetime=e.time;var r=yh(vh(e,cT.recallMsgTag),Sh(Qg));t.core.eventBus.emit("forwardReceive/V2NIMMessageService/revokeMessages",[r])},this.onV2RevokeMessage=function(e){var r=yh(vh(e,Qg),uT.recallMsgTag);t.core.eventBus.emit("forwardReceive/msg/recallMsg",r)},this.onV1DeleteSelfMsgs=function(e){var r=du(e).call(e,(function(e){return yh(vh(e,cT.deleteSelfMsgTag),Sh(Kg))}));jn(r).call(r,(function(e){e.messageRefer=Lg(t.core,e.messageRefer)})),t.core.eventBus.emit("forwardReceive/V2NIMMessageService/deleteMessages",r)},this.onV2DeleteSelfMsgs=function(e){var r=du(e).call(e,(function(e){return yh(vh(e,Kg),uT.deleteSelfMsgTag)}));t.core.eventBus.emit("forwardReceive/msg/deleteSelfMsgs",r)},this.onV1ClearHistoryMessage=function(e){var r=yh(vh(e,pb.clearHistoryMsgsFromServerReqTag),Sh(fM));t.core.eventBus.emit("forwardReceive/V2NIMMessageLogService/clearHistoryMessage",r)},this.onV2ClearHistoryMessage=function(e){var r=yh(vh(e,fM),mb.clearHistoryMsgsFromServerReqTag);t.core.eventBus.emit("forwardReceive/msgLog/clearHistoryMsgsFromServer",r)},this.core=e,this.bindEvents()}),"eventForwardCenter"),e.V2NIMConst=Cl,e.default=fm,Object.defineProperty(e,"__esModule",{value:!0})}(t)})),Te=a(Se),be=function(e){return{code:0,data:e}},Ce=function(e){var t;return{code:null!==(t=e.code)&&void 0!==t?t:-1,errorDetails:e.desc+""||"",errorMsg:e.toString?e.toString():e}},_e=function(e){return t(t({},e),{attachment:e.attachment?t(t({},e.attachment),{nimCoreMessageType:e.messageType}):void 0,pushConfig:e.pushConfig?Ee(e.pushConfig):void 0})},Ee=function(e){return t(t({},e),{forcePushAccountIds:"string"==typeof e.forcePushAccountIds?[]:null==e?void 0:e.forcePushAccountIds})},we=function(e){return t(t({},e),{lastMessage:e.lastMessage?t(t({},e.lastMessage),{attachment:e.lastMessage.attachment?t(t({},e.lastMessage.attachment),{nimCoreMessageType:e.lastMessage.messageType}):void 0}):void 0})},Re=function(e){switch(e){case 0:return"system";case 1:return"user";case 2:return"assistant"}},ke=function(e,t,r){return Ie.log("emit: ",{serviceName:e,methodName:t,params:r}),window.__yx_emit__||(window.__yx_emit__=function(e,t,r){return{serviceName:e,methodName:t,params:r}}),window.__yx_emit__(e,t,r)},Ae=ve.createLoggerDecorator("InitializeService",Ie),Ne=function(){function e(e,t){this.rootService=e,this.nim=t}return e.prototype.initialize=function(e){var r,o,a;return n(this,void 0,void 0,(function(){var n;return i(this,(function(i){return this.initOptions=e,n=Te.getInstance(e.initializeOptions,t(t({},e.otherOptions),{cloudStorageConfig:t(t({},null===(r=e.otherOptions)||void 0===r?void 0:r.cloudStorageConfig),{s3:(null===(a=null===(o=e.otherOptions)||void 0===o?void 0:o.cloudStorageConfig)||void 0===a?void 0:a.s3)?window.s3:void 0})})),Object.assign(this.nim,n),e.initializeOptions.debugLevel&&"off"!==e.initializeOptions.debugLevel?Ie.setLevel(e.initializeOptions.debugLevel):Ie.setLevel("silent"),this.rootService.init(),[2,be()]}))}))},e.prototype.releaseDesktop=function(){return n(this,void 0,void 0,(function(){return i(this,(function(e){return this.rootService.destroy(),[2,be()]}))}))},e.prototype.destroy=function(){},r([Ae],e.prototype,"initialize",null),r([Ae],e.prototype,"releaseDesktop",null),e}(),xe={code:-1,errorDetails:"Not Implemented"},Oe="__yx_result__",Pe=ve.createLoggerDecorator("LoginService",Ie),Le=function(){function e(e,t){this.rootService=e,this.nim=t,this._onLoginStatus=this._onLoginStatus.bind(this),this._onLoginFailed=this._onLoginFailed.bind(this),this._onKickedOffline=this._onKickedOffline.bind(this),this._onLoginClientChanged=this._onLoginClientChanged.bind(this),this._onConnectStatus=this._onConnectStatus.bind(this),this._onDisconnected=this._onDisconnected.bind(this),this._onConnectFailed=this._onConnectFailed.bind(this),this._onDataSync=this._onDataSync.bind(this),t.V2NIMLoginService.on("onLoginStatus",this._onLoginStatus),t.V2NIMLoginService.on("onLoginFailed",this._onLoginFailed),t.V2NIMLoginService.on("onKickedOffline",this._onKickedOffline),t.V2NIMLoginService.on("onLoginClientChanged",this._onLoginClientChanged),t.V2NIMLoginService.on("onConnectStatus",this._onConnectStatus),t.V2NIMLoginService.on("onDisconnected",this._onDisconnected),t.V2NIMLoginService.on("onConnectFailed",this._onConnectFailed),t.V2NIMLoginService.on("onDataSync",this._onDataSync)}return e.prototype.login=function(e){return n(this,void 0,void 0,(function(){var r,o,a=this;return i(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),r=be,[4,this.nim.V2NIMLoginService.login(e.accountId,e.token,t(t({},e.option),{tokenProvider:function(e){return n(a,void 0,void 0,(function(){var t,r,n=this;return i(this,(function(i){return(r={accountId:e})[Oe]="",ke("LoginService","getToken",t=r),[2,new Promise((function(e){var r,i;setTimeout((function(){e(t[Oe])}),(null===(i=null===(r=n.rootService.InitializeService.initOptions)||void 0===r?void 0:r.initializeOptions)||void 0===i?void 0:i.tokenProviderDelay)||500)}))]}))}))},loginExtensionProvider:function(e){return n(a,void 0,void 0,(function(){var t,r,n=this;return i(this,(function(i){return(r={accountId:e})[Oe]="",ke("LoginService","getLoginExtension",t=r),[2,new Promise((function(e){var r,i;setTimeout((function(){e(t[Oe])}),(null===(i=null===(r=n.rootService.InitializeService.initOptions)||void 0===r?void 0:r.initializeOptions)||void 0===i?void 0:i.loginExtensionProviderDelay)||500)}))]}))}))}}))];case 1:return[2,r.apply(void 0,[s.sent()])];case 2:throw o=s.sent(),Ce(o);case 3:return[2]}}))}))},e.prototype.logout=function(){return n(this,void 0,void 0,(function(){var e,t;return i(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),e=be,[4,this.nim.V2NIMLoginService.logout()];case 1:return[2,e.apply(void 0,[r.sent()])];case 2:throw t=r.sent(),Ce(t);case 3:return[2]}}))}))},e.prototype.getLoginUser=function(){return n(this,void 0,void 0,(function(){return i(this,(function(e){return[2,be(this.nim.V2NIMLoginService.getLoginUser())]}))}))},e.prototype.getLoginStatus=function(){return n(this,void 0,void 0,(function(){return i(this,(function(e){return[2,be({status:this.nim.V2NIMLoginService.getLoginStatus()})]}))}))},e.prototype.getLoginClients=function(){return n(this,void 0,void 0,(function(){return i(this,(function(e){return[2,be({loginClient:this.nim.V2NIMLoginService.getLoginClients()})]}))}))},e.prototype.kickOffline=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMLoginService.kickOffline(e.client)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.getKickedOfflineDetail=function(){return n(this,void 0,void 0,(function(){return i(this,(function(e){return[2,be(this.nim.V2NIMLoginService.getKickedOfflineDetail())]}))}))},e.prototype.getConnectStatus=function(){return n(this,void 0,void 0,(function(){return i(this,(function(e){return[2,be({status:this.nim.V2NIMLoginService.getConnectStatus()})]}))}))},e.prototype.getDataSync=function(){return n(this,void 0,void 0,(function(){return i(this,(function(e){return[2,be({dataSync:this.nim.V2NIMLoginService.getDataSync()||[]})]}))}))},e.prototype.getChatroomLinkAddress=function(e){return n(this,void 0,void 0,(function(){var t,r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=be,n={},[4,this.nim.V2NIMLoginService.getChatroomLinkAddress(e.roomId,!1)];case 1:return[2,t.apply(void 0,[(n.linkAddress=i.sent(),n)])];case 2:throw r=i.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.setReconnectDelayProvider=function(){return n(this,void 0,void 0,(function(){var e=this;return i(this,(function(t){return[2,be(this.nim.V2NIMLoginService.setReconnectDelayProvider((function(t){return n(e,void 0,void 0,(function(){var e,r,n=this;return i(this,(function(i){return(r={delay:t})[Oe]=0,ke("LoginService","getReconnectDelay",e=r),[2,new Promise((function(t){var r,i;setTimeout((function(){t(e[Oe])}),(null===(i=null===(r=n.rootService.InitializeService.initOptions)||void 0===r?void 0:r.initializeOptions)||void 0===i?void 0:i.reconnectDelayProviderDelay)||500)}))]}))}))})))]}))}))},e.prototype.destroy=function(){this.nim.V2NIMLoginService.off("onLoginStatus",this._onLoginStatus),this.nim.V2NIMLoginService.off("onLoginFailed",this._onLoginFailed),this.nim.V2NIMLoginService.off("onKickedOffline",this._onKickedOffline),this.nim.V2NIMLoginService.off("onLoginClientChanged",this._onLoginClientChanged),this.nim.V2NIMLoginService.off("onConnectStatus",this._onConnectStatus),this.nim.V2NIMLoginService.off("onDisconnected",this._onDisconnected),this.nim.V2NIMLoginService.off("onConnectFailed",this._onConnectFailed),this.nim.V2NIMLoginService.off("onDataSync",this._onDataSync)},e.prototype._onLoginStatus=function(e){Ie.log("_onLoginStatus",e),ke("LoginService","onLoginStatus",{status:e})},e.prototype._onLoginFailed=function(e){Ie.log("_onLoginFailed",e),ke("LoginService","onLoginFailed",e)},e.prototype._onKickedOffline=function(e){Ie.log("_onKickedOffline",e),ke("LoginService","onKickedOffline",e)},e.prototype._onLoginClientChanged=function(e,t){Ie.log("_onLoginClientChanged",e,t),ke("LoginService","onLoginClientChanged",{change:e,clients:t})},e.prototype._onConnectStatus=function(e){Ie.log("_onConnectStatus",e),ke("LoginService","onConnectStatus",{status:e})},e.prototype._onDisconnected=function(e){Ie.log("_onDisconnected",e),ke("LoginService","onDisconnected",e)},e.prototype._onConnectFailed=function(e){Ie.log("_onConnectFailed",e),ke("LoginService","onConnectFailed",e)},e.prototype._onDataSync=function(e,t,r){Ie.log("_onDataSync",{type:e,state:t,error:r}),ke("LoginService","onDataSync",{type:e,state:t,error:r})},r([Pe],e.prototype,"login",null),r([Pe],e.prototype,"logout",null),r([Pe],e.prototype,"getLoginUser",null),r([Pe],e.prototype,"getLoginStatus",null),r([Pe],e.prototype,"getLoginClients",null),r([Pe],e.prototype,"kickOffline",null),r([Pe],e.prototype,"getKickedOfflineDetail",null),r([Pe],e.prototype,"getConnectStatus",null),r([Pe],e.prototype,"getDataSync",null),r([Pe],e.prototype,"getChatroomLinkAddress",null),r([Pe],e.prototype,"setReconnectDelayProvider",null),e}(),Ve=ve.createLoggerDecorator("SettingsService",Ie),Ue=function(){function e(e,t){this.rootService=e,this.nim=t,this._onP2PMessageMuteModeChanged=this._onP2PMessageMuteModeChanged.bind(this),this._onTeamMessageMuteModeChanged=this._onTeamMessageMuteModeChanged.bind(this),this.nim.V2NIMSettingService.on("onP2PMessageMuteModeChanged",this._onP2PMessageMuteModeChanged),this.nim.V2NIMSettingService.on("onTeamMessageMuteModeChanged",this._onTeamMessageMuteModeChanged)}return e.prototype.destroy=function(){this.nim.V2NIMSettingService.off("onP2PMessageMuteModeChanged",this._onP2PMessageMuteModeChanged),this.nim.V2NIMSettingService.off("onTeamMessageMuteModeChanged",this._onTeamMessageMuteModeChanged)},e.prototype.getDndConfig=function(){return n(this,void 0,void 0,(function(){return i(this,(function(e){throw xe}))}))},e.prototype.getConversationMuteStatus=function(e){return n(this,void 0,void 0,(function(){return i(this,(function(t){try{return[2,be(this.nim.V2NIMSettingService.getConversationMuteStatus(e.conversationId))]}catch(e){throw Ce(e)}return[2]}))}))},e.prototype.setTeamMessageMuteMode=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMSettingService.setTeamMessageMuteMode(e.teamId,e.teamType,e.muteMode)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.getTeamMessageMuteMode=function(e){return n(this,void 0,void 0,(function(){return i(this,(function(t){try{return[2,be({muteMode:this.nim.V2NIMSettingService.getTeamMessageMuteMode(e.teamId,e.teamType)})]}catch(e){throw Ce(e)}return[2]}))}))},e.prototype.setP2PMessageMuteMode=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMSettingService.setP2PMessageMuteMode(e.accountId,e.muteMode)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.getP2PMessageMuteMode=function(e){return n(this,void 0,void 0,(function(){return i(this,(function(t){try{return[2,be({muteMode:this.nim.V2NIMSettingService.getP2PMessageMuteMode(e.accountId)})]}catch(e){throw Ce(e)}return[2]}))}))},e.prototype.getP2PMessageMuteList=function(){return n(this,void 0,void 0,(function(){var e,t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),e=be,r={},[4,this.nim.V2NIMSettingService.getP2PMessageMuteList()];case 1:return[2,e.apply(void 0,[(r.muteList=n.sent(),r)])];case 2:throw t=n.sent(),Ce(t);case 3:return[2]}}))}))},e.prototype.setAppBackground=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMSettingService.setAppBackground(e.isBackground,e.badge)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.setPushMobileOnDesktopOnline=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMSettingService.setPushMobileOnDesktopOnline(e.need)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.setDndConfig=function(e){return n(this,void 0,void 0,(function(){return i(this,(function(e){throw xe}))}))},e.prototype.getApnsDndConfig=function(){return n(this,void 0,void 0,(function(){return i(this,(function(e){throw xe}))}))},e.prototype._onP2PMessageMuteModeChanged=function(e,t){Ie.info("_onP2PMessageMuteModeChanged",e,t),ke("SettingsService","onP2PMessageMuteModeChanged",{accountId:e,muteMode:t})},e.prototype._onTeamMessageMuteModeChanged=function(e,t,r){Ie.info("_onTeamMessageMuteModeChanged",e,t,r),ke("SettingsService","onTeamMessageMuteModeChanged",{teamId:e,teamType:t,muteMode:r})},r([Ve],e.prototype,"getDndConfig",null),r([Ve],e.prototype,"getConversationMuteStatus",null),r([Ve],e.prototype,"setTeamMessageMuteMode",null),r([Ve],e.prototype,"getTeamMessageMuteMode",null),r([Ve],e.prototype,"setP2PMessageMuteMode",null),r([Ve],e.prototype,"getP2PMessageMuteMode",null),r([Ve],e.prototype,"getP2PMessageMuteList",null),r([Ve],e.prototype,"setAppBackground",null),r([Ve],e.prototype,"setPushMobileOnDesktopOnline",null),r([Ve],e.prototype,"setDndConfig",null),r([Ve],e.prototype,"getApnsDndConfig",null),e}(),De=ve.createLoggerDecorator("MessageService",Ie),qe=function(){function e(e,t){this.rootService=e,this.nim=t,this._onReceiveMessages=this._onReceiveMessages.bind(this),this._onClearHistoryNotifications=this._onClearHistoryNotifications.bind(this),this._onMessageDeletedNotifications=this._onMessageDeletedNotifications.bind(this),this._onMessagePinNotification=this._onMessagePinNotification.bind(this),this._onMessageQuickCommentNotification=this._onMessageQuickCommentNotification.bind(this),this._onMessageRevokeNotifications=this._onMessageRevokeNotifications.bind(this),this._onReceiveP2PMessageReadReceipts=this._onReceiveP2PMessageReadReceipts.bind(this),this._onReceiveTeamMessageReadReceipts=this._onReceiveTeamMessageReadReceipts.bind(this),this._onSendMessage=this._onSendMessage.bind(this),t.V2NIMMessageService.on("onReceiveMessages",this._onReceiveMessages),t.V2NIMMessageService.on("onClearHistoryNotifications",this._onClearHistoryNotifications),t.V2NIMMessageService.on("onMessageDeletedNotifications",this._onMessageDeletedNotifications),t.V2NIMMessageService.on("onMessagePinNotification",this._onMessagePinNotification),t.V2NIMMessageService.on("onMessageQuickCommentNotification",this._onMessageQuickCommentNotification),t.V2NIMMessageService.on("onMessageRevokeNotifications",this._onMessageRevokeNotifications),t.V2NIMMessageService.on("onReceiveP2PMessageReadReceipts",this._onReceiveP2PMessageReadReceipts),t.V2NIMMessageService.on("onReceiveTeamMessageReadReceipts",this._onReceiveTeamMessageReadReceipts),t.V2NIMMessageService.on("onSendMessage",this._onSendMessage)}return e.prototype.destroy=function(){this.nim.V2NIMMessageService.off("onReceiveMessages",this._onReceiveMessages),this.nim.V2NIMMessageService.off("onClearHistoryNotifications",this._onClearHistoryNotifications),this.nim.V2NIMMessageService.off("onMessageDeletedNotifications",this._onMessageDeletedNotifications),this.nim.V2NIMMessageService.off("onMessagePinNotification",this._onMessagePinNotification),this.nim.V2NIMMessageService.off("onMessageQuickCommentNotification",this._onMessageQuickCommentNotification),this.nim.V2NIMMessageService.off("onMessageRevokeNotifications",this._onMessageRevokeNotifications),this.nim.V2NIMMessageService.off("onReceiveP2PMessageReadReceipts",this._onReceiveP2PMessageReadReceipts),this.nim.V2NIMMessageService.off("onReceiveTeamMessageReadReceipts",this._onReceiveTeamMessageReadReceipts),this.nim.V2NIMMessageService.off("onSendMessage",this._onSendMessage)},e.prototype.getMessageList=function(e){return n(this,void 0,void 0,(function(){var t,r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=be,n={},[4,this.nim.V2NIMMessageService.getMessageList(e.option)];case 1:return[2,t.apply(void 0,[(n.messages=i.sent().map((function(e){return _e(e)})),n)])];case 2:throw r=i.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.getMessageListByIds=function(e){return n(this,void 0,void 0,(function(){return i(this,(function(e){throw xe}))}))},e.prototype.getMessageListByRefers=function(e){return n(this,void 0,void 0,(function(){var t,r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=be,n={},[4,this.nim.V2NIMMessageService.getMessageListByRefers(e.messageRefers)];case 1:return[2,t.apply(void 0,[(n.messages=i.sent().map((function(e){return _e(e)})),n)])];case 2:throw r=i.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.searchCloudMessages=function(e){return n(this,void 0,void 0,(function(){var t,r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=be,n={},[4,this.nim.V2NIMMessageService.searchCloudMessages(e.params)];case 1:return[2,t.apply(void 0,[(n.messages=i.sent().map((function(e){return _e(e)})),n)])];case 2:throw r=i.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.getLocalThreadMessageList=function(e){return n(this,void 0,void 0,(function(){return i(this,(function(e){throw xe}))}))},e.prototype.getThreadMessageList=function(e){return n(this,void 0,void 0,(function(){var r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.nim.V2NIMMessageService.getThreadMessageList(e.option)];case 1:return r=i.sent(),[2,be(t(t({},r),{message:_e(r.message)}))];case 2:throw n=i.sent(),Ce(n);case 3:return[2]}}))}))},e.prototype.insertMessageToLocal=function(e){return n(this,void 0,void 0,(function(){return i(this,(function(e){throw xe}))}))},e.prototype.updateMessageLocalExtension=function(e){return n(this,void 0,void 0,(function(){return i(this,(function(e){throw xe}))}))},e.prototype.sendMessage=function(e){var r,o,a,s,c,u;return n(this,void 0,void 0,(function(){var n,d,l,p,m;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),n=e.message.messageClientId,d=null===(o=null===(r=this.rootService.MessageCreatorService)||void 0===r?void 0:r.msgMap)||void 0===o?void 0:o.get(n),l=t(t({},e.message),d),[4,this.nim.V2NIMMessageService.sendMessage(l,e.conversationId,t(t({},e.params),{aiConfig:(null===(a=e.params)||void 0===a?void 0:a.aiConfig)?t(t({},e.params.aiConfig),{messages:(null===(s=e.params.aiConfig.messages)||void 0===s?void 0:s.length)?e.params.aiConfig.messages.map((function(e){return t(t({},e),{role:Re(e.role)})})):void 0}):void 0}),(function(e){ke("MessageService","onSendMessageProgress",{messageClientId:n,progress:e})}))];case 1:return p=i.sent(),null===(u=null===(c=this.rootService.MessageCreatorService)||void 0===c?void 0:c.msgMap)||void 0===u||u.delete(n),[2,be(t(t({},p),{message:_e(p.message)}))];case 2:throw m=i.sent(),Ce(m);case 3:return[2]}}))}))},e.prototype.replyMessage=function(e){return n(this,void 0,void 0,(function(){var r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.nim.V2NIMMessageService.replyMessage(e.message,e.replyMessage,e.params,(function(t){ke("MessageService","onSendMessageProgress",{messageClientId:e.message.messageClientId,progress:t})}))];case 1:return r=i.sent(),[2,be(t(t({},r),{message:_e(r.message)}))];case 2:throw n=i.sent(),Ce(n);case 3:return[2]}}))}))},e.prototype.revokeMessage=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMMessageService.revokeMessage(e.message,e.revokeParams)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.pinMessage=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMMessageService.pinMessage(e.message,e.serverExtension)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.unpinMessage=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMMessageService.unpinMessage(e.messageRefer,e.serverExtension)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.updatePinMessage=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMMessageService.updatePinMessage(e.message,e.serverExtension)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.getPinnedMessageList=function(e){return n(this,void 0,void 0,(function(){var t,r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=be,n={},[4,this.nim.V2NIMMessageService.getPinnedMessageList(e.conversationId)];case 1:return[2,t.apply(void 0,[(n.pinMessages=i.sent(),n)])];case 2:throw r=i.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.addQuickComment=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMMessageService.addQuickComment(e.message,e.index,e.serverExtension,e.pushConfig)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.removeQuickComment=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMMessageService.removeQuickComment(e.messageRefer,e.index,e.serverExtension)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.getQuickCommentList=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMMessageService.getQuickCommentList(e.messages)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.deleteMessage=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMMessageService.deleteMessage(e.message,e.serverExtension)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.deleteMessages=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMMessageService.deleteMessages(e.messages,e.serverExtension)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.clearHistoryMessage=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMMessageService.clearHistoryMessage(e.option)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.sendP2PMessageReceipt=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMMessageService.sendP2PMessageReceipt(e.message)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.getP2PMessageReceipt=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMMessageService.getP2PMessageReceipt(e.conversationId)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.isPeerRead=function(e){return n(this,void 0,void 0,(function(){return i(this,(function(t){try{return[2,be(this.nim.V2NIMMessageService.isPeerRead(e.message))]}catch(e){throw Ce(e)}return[2]}))}))},e.prototype.sendTeamMessageReceipts=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMMessageService.sendTeamMessageReceipts(e.messages)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.getTeamMessageReceipts=function(e){return n(this,void 0,void 0,(function(){var t,r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=be,n={},[4,this.nim.V2NIMMessageService.getTeamMessageReceipts(e.messages)];case 1:return[2,t.apply(void 0,[(n.readReceipts=i.sent(),n)])];case 2:throw r=i.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.getTeamMessageReceiptDetail=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMMessageService.getTeamMessageReceiptDetail(e.message,e.memberAccountIds)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.addCollection=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMMessageService.addCollection(e.params)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.removeCollections=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMMessageService.removeCollections(e.collections)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.updateCollectionExtension=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMMessageService.updateCollectionExtension(e.collection,e.serverExtension)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.getCollectionListByOption=function(e){return n(this,void 0,void 0,(function(){var t,r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=be,n={},[4,this.nim.V2NIMMessageService.getCollectionListByOption(e.option)];case 1:return[2,t.apply(void 0,[(n.collections=i.sent(),n)])];case 2:throw r=i.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.voiceToText=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMMessageService.voiceToText(e.params)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.cancelMessageAttachmentUpload=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMMessageService.cancelMessageAttachmentUpload(e.message)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype._onReceiveMessages=function(e){Ie.log("_onReceiveMessages",e),ke("MessageService","onReceiveMessages",{messages:e.map((function(e){return _e(e)}))})},e.prototype._onClearHistoryNotifications=function(e){Ie.log("_onClearHistoryNotifications",e),ke("MessageService","onClearHistoryNotifications",{clearHistoryNotifications:e})},e.prototype._onMessageDeletedNotifications=function(e){Ie.log("_onMessageDeletedNotifications",e),ke("MessageService","onMessageDeletedNotifications",{deletedNotifications:e})},e.prototype._onMessagePinNotification=function(e){Ie.log("_onMessagePinNotification",e),ke("MessageService","onMessagePinNotification",e)},e.prototype._onMessageQuickCommentNotification=function(e){Ie.log("_onMessageQuickCommentNotification",e),ke("MessageService","onMessageQuickCommentNotification",e)},e.prototype._onMessageRevokeNotifications=function(e){Ie.log("_onMessageRevokeNotifications",e),ke("MessageService","onMessageRevokeNotifications",{revokeNotifications:e})},e.prototype._onReceiveP2PMessageReadReceipts=function(e){Ie.log("_onReceiveP2PMessageReadReceipts",e),ke("MessageService","onReceiveP2PMessageReadReceipts",{p2pMessageReadReceipts:e})},e.prototype._onReceiveTeamMessageReadReceipts=function(e){Ie.log("_onReceiveTeamMessageReadReceipts",e),ke("MessageService","onReceiveTeamMessageReadReceipts",{teamMessageReadReceipts:e})},e.prototype._onSendMessage=function(e){Ie.log("_onSendMessage",e),ke("MessageService","onSendMessage",_e(e))},r([De],e.prototype,"getMessageList",null),r([De],e.prototype,"getMessageListByIds",null),r([De],e.prototype,"getMessageListByRefers",null),r([De],e.prototype,"searchCloudMessages",null),r([De],e.prototype,"getLocalThreadMessageList",null),r([De],e.prototype,"getThreadMessageList",null),r([De],e.prototype,"insertMessageToLocal",null),r([De],e.prototype,"updateMessageLocalExtension",null),r([De],e.prototype,"sendMessage",null),r([De],e.prototype,"replyMessage",null),r([De],e.prototype,"revokeMessage",null),r([De],e.prototype,"pinMessage",null),r([De],e.prototype,"unpinMessage",null),r([De],e.prototype,"updatePinMessage",null),r([De],e.prototype,"getPinnedMessageList",null),r([De],e.prototype,"addQuickComment",null),r([De],e.prototype,"removeQuickComment",null),r([De],e.prototype,"getQuickCommentList",null),r([De],e.prototype,"deleteMessage",null),r([De],e.prototype,"deleteMessages",null),r([De],e.prototype,"clearHistoryMessage",null),r([De],e.prototype,"sendP2PMessageReceipt",null),r([De],e.prototype,"getP2PMessageReceipt",null),r([De],e.prototype,"isPeerRead",null),r([De],e.prototype,"sendTeamMessageReceipts",null),r([De],e.prototype,"getTeamMessageReceipts",null),r([De],e.prototype,"getTeamMessageReceiptDetail",null),r([De],e.prototype,"addCollection",null),r([De],e.prototype,"removeCollections",null),r([De],e.prototype,"updateCollectionExtension",null),r([De],e.prototype,"getCollectionListByOption",null),r([De],e.prototype,"voiceToText",null),r([De],e.prototype,"cancelMessageAttachmentUpload",null),e}(),Be=ve.createLoggerDecorator("UserService",Ie),Fe=function(){function e(e,t){this.rootService=e,this.nim=t,this._onBlockListAdded=this._onBlockListAdded.bind(this),this._onBlockListRemoved=this._onBlockListRemoved.bind(this),this._onUserProfileChanged=this._onUserProfileChanged.bind(this),t.V2NIMUserService.on("onBlockListAdded",this._onBlockListAdded),t.V2NIMUserService.on("onBlockListRemoved",this._onBlockListRemoved),t.V2NIMUserService.on("onUserProfileChanged",this._onUserProfileChanged)}return e.prototype.destroy=function(){this.nim.V2NIMUserService.off("onBlockListAdded",this._onBlockListAdded),this.nim.V2NIMUserService.off("onBlockListRemoved",this._onBlockListRemoved),this.nim.V2NIMUserService.off("onUserProfileChanged",this._onUserProfileChanged)},e.prototype.getUserList=function(e){return n(this,void 0,void 0,(function(){var t,r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=be,n={},[4,this.nim.V2NIMUserService.getUserList(e.userIdList)];case 1:return[2,t.apply(void 0,[(n.userInfoList=i.sent(),n)])];case 2:throw r=i.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.getUserListFromCloud=function(e){return n(this,void 0,void 0,(function(){var t,r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=be,n={},[4,this.nim.V2NIMUserService.getUserListFromCloud(e.userIdList)];case 1:return[2,t.apply(void 0,[(n.userInfoList=i.sent(),n)])];case 2:throw r=i.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.updateSelfUserProfile=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMUserService.updateSelfUserProfile(e.updateParam)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.addUserToBlockList=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMUserService.addUserToBlockList(e.userId)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.removeUserFromBlockList=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMUserService.removeUserFromBlockList(e.userId)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.getBlockList=function(){return n(this,void 0,void 0,(function(){var e,t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),e=be,r={},[4,this.nim.V2NIMUserService.getBlockList()];case 1:return[2,e.apply(void 0,[(r.userIdList=n.sent(),r)])];case 2:throw t=n.sent(),Ce(t);case 3:return[2]}}))}))},e.prototype.searchUserByOption=function(e){return n(this,void 0,void 0,(function(){var t,r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=be,n={},[4,this.nim.V2NIMUserService.searchUserByOption(e.userSearchOption)];case 1:return[2,t.apply(void 0,[(n.userInfoList=i.sent(),n)])];case 2:throw r=i.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype._onBlockListAdded=function(e){Ie.log("_onBlockListAdded",e),ke("UserService","onBlockListAdded",e)},e.prototype._onBlockListRemoved=function(e){Ie.log("_onBlockListRemoved",e),ke("UserService","onBlockListRemoved",{userId:e})},e.prototype._onUserProfileChanged=function(e){Ie.log("_onUserProfileChanged",e),ke("UserService","onUserProfileChanged",{userInfoList:e})},r([Be],e.prototype,"getUserList",null),r([Be],e.prototype,"getUserListFromCloud",null),r([Be],e.prototype,"updateSelfUserProfile",null),r([Be],e.prototype,"addUserToBlockList",null),r([Be],e.prototype,"removeUserFromBlockList",null),r([Be],e.prototype,"getBlockList",null),r([Be],e.prototype,"searchUserByOption",null),e}(),Ge=ve.createLoggerDecorator("FriendService",Ie),je=function(){function e(e,t){this.rootService=e,this.nim=t,this._onFriendAdded=this._onFriendAdded.bind(this),this._onFriendDeleted=this._onFriendDeleted.bind(this),this._onFriendAddApplication=this._onFriendAddApplication.bind(this),this._onFriendAddRejected=this._onFriendAddRejected.bind(this),this._onFriendInfoChanged=this._onFriendInfoChanged.bind(this),t.V2NIMFriendService.on("onFriendAdded",this._onFriendAdded),t.V2NIMFriendService.on("onFriendDeleted",this._onFriendDeleted),t.V2NIMFriendService.on("onFriendAddApplication",this._onFriendAddApplication),t.V2NIMFriendService.on("onFriendAddRejected",this._onFriendAddRejected),t.V2NIMFriendService.on("onFriendInfoChanged",this._onFriendInfoChanged)}return e.prototype.destroy=function(){this.nim.V2NIMFriendService.off("onFriendAdded",this._onFriendAdded),this.nim.V2NIMFriendService.off("onFriendDeleted",this._onFriendDeleted),this.nim.V2NIMFriendService.off("onFriendAddApplication",this._onFriendAddApplication),this.nim.V2NIMFriendService.off("onFriendAddRejected",this._onFriendAddRejected),this.nim.V2NIMFriendService.off("onFriendInfoChanged",this._onFriendInfoChanged)},e.prototype.addFriend=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMFriendService.addFriend(e.accountId,e.params||{addMode:1,postscript:""})];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.deleteFriend=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMFriendService.deleteFriend(e.accountId,e.params||{deleteAlias:!0})];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.acceptAddApplication=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMFriendService.acceptAddApplication(e.application)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.rejectAddApplication=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMFriendService.rejectAddApplication(e.application,e.postscript)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.setFriendInfo=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMFriendService.setFriendInfo(e.accountId,e.params)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.getFriendList=function(){return n(this,void 0,void 0,(function(){var e,t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),e=be,r={},[4,this.nim.V2NIMFriendService.getFriendList()];case 1:return[2,e.apply(void 0,[(r.friendList=n.sent(),r)])];case 2:throw t=n.sent(),Ce(t);case 3:return[2]}}))}))},e.prototype.getFriendByIds=function(e){return n(this,void 0,void 0,(function(){var t,r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=be,n={},[4,this.nim.V2NIMFriendService.getFriendByIds(e.accountIds)];case 1:return[2,t.apply(void 0,[(n.friendList=i.sent(),n)])];case 2:throw r=i.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.checkFriend=function(e){return n(this,void 0,void 0,(function(){var t,r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=be,n={},[4,this.nim.V2NIMFriendService.checkFriend(e.accountIds)];case 1:return[2,t.apply(void 0,[(n.result=i.sent(),n)])];case 2:throw r=i.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.getAddApplicationList=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMFriendService.getAddApplicationList(e.option)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.getAddApplicationUnreadCount=function(){return n(this,void 0,void 0,(function(){var e,t;return i(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),e=be,[4,this.nim.V2NIMFriendService.getAddApplicationUnreadCount()];case 1:return[2,e.apply(void 0,[r.sent()])];case 2:throw t=r.sent(),Ce(t);case 3:return[2]}}))}))},e.prototype.setAddApplicationRead=function(){return n(this,void 0,void 0,(function(){var e,t;return i(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),e=be,[4,this.nim.V2NIMFriendService.setAddApplicationRead()];case 1:return[2,e.apply(void 0,[r.sent()])];case 2:throw t=r.sent(),Ce(t);case 3:return[2]}}))}))},e.prototype.clearAllAddApplication=function(){return n(this,void 0,void 0,(function(){var e,t;return i(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),e=be,[4,this.nim.V2NIMFriendService.clearAllAddApplication()];case 1:return[2,e.apply(void 0,[r.sent()])];case 2:throw t=r.sent(),Ce(t);case 3:return[2]}}))}))},e.prototype.searchFriendByOption=function(e){return n(this,void 0,void 0,(function(){var t,r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=be,n={},[4,this.nim.V2NIMFriendService.searchFriendByOption(e.friendSearchOption)];case 1:return[2,t.apply(void 0,[(n.friendList=i.sent(),n)])];case 2:throw r=i.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype._onFriendAdded=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:if(Ie.log("_onFriendAdded",e),void 0!==e.userProfile&&null!==e.userProfile)return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.nim.V2NIMUserService.getUserList([e.accountId])];case 2:return(t=n.sent()).length>0&&(e.userProfile=t[0]),[3,4];case 3:return r=n.sent(),Ie.log("_onFriendAdded",r),[3,4];case 4:return ke("FriendService","onFriendAdded",e),[2]}}))}))},e.prototype._onFriendDeleted=function(e,t){Ie.log("_onFriendDeleted",e),ke("FriendService","onFriendDeleted",{accountId:e,deletionType:t})},e.prototype._onFriendAddApplication=function(e){Ie.log("_onFriendAddApplication",e),ke("FriendService","onFriendAddApplication",e)},e.prototype._onFriendAddRejected=function(e){Ie.log("_onFriendAddRejected",e),ke("FriendService","onFriendAddRejected",e)},e.prototype._onFriendInfoChanged=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:if(Ie.log("_onFriendInfoChanged",e),void 0!==e.userProfile&&null!==e.userProfile)return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.nim.V2NIMUserService.getUserList([e.accountId])];case 2:return(t=n.sent()).length>0&&(e.userProfile=t[0]),[3,4];case 3:return r=n.sent(),Ie.log("_onFriendInfoChanged",r),[3,4];case 4:return ke("FriendService","onFriendInfoChanged",e),[2]}}))}))},r([Ge],e.prototype,"addFriend",null),r([Ge],e.prototype,"deleteFriend",null),r([Ge],e.prototype,"acceptAddApplication",null),r([Ge],e.prototype,"rejectAddApplication",null),r([Ge],e.prototype,"setFriendInfo",null),r([Ge],e.prototype,"getFriendList",null),r([Ge],e.prototype,"getFriendByIds",null),r([Ge],e.prototype,"checkFriend",null),r([Ge],e.prototype,"getAddApplicationList",null),r([Ge],e.prototype,"getAddApplicationUnreadCount",null),r([Ge],e.prototype,"setAddApplicationRead",null),r([Ge],e.prototype,"clearAllAddApplication",null),r([Ge],e.prototype,"searchFriendByOption",null),e}(),He=ve.createLoggerDecorator("TeamService",Ie),We=function(){function e(e,t){this.rootService=e,this.nim=t,this._onReceiveTeamJoinActionInfo=this._onReceiveTeamJoinActionInfo.bind(this),this._onSyncFailed=this._onSyncFailed.bind(this),this._onSyncFinished=this._onSyncFinished.bind(this),this._onSyncStarted=this._onSyncStarted.bind(this),this._onTeamCreated=this._onTeamCreated.bind(this),this._onTeamDismissed=this._onTeamDismissed.bind(this),this._onTeamInfoUpdated=this._onTeamInfoUpdated.bind(this),this._onTeamJoined=this._onTeamJoined.bind(this),this._onTeamLeft=this._onTeamLeft.bind(this),this._onTeamMemberInfoUpdated=this._onTeamMemberInfoUpdated.bind(this),this._onTeamMemberJoined=this._onTeamMemberJoined.bind(this),this._onTeamMemberKicked=this._onTeamMemberKicked.bind(this),this._onTeamMemberLeft=this._onTeamMemberLeft.bind(this),t.V2NIMTeamService.on("onReceiveTeamJoinActionInfo",this._onReceiveTeamJoinActionInfo),t.V2NIMTeamService.on("onSyncFailed",this._onSyncFailed),t.V2NIMTeamService.on("onSyncFinished",this._onSyncFinished),t.V2NIMTeamService.on("onSyncStarted",this._onSyncStarted),t.V2NIMTeamService.on("onTeamCreated",this._onTeamCreated),t.V2NIMTeamService.on("onTeamDismissed",this._onTeamDismissed),t.V2NIMTeamService.on("onTeamInfoUpdated",this._onTeamInfoUpdated),t.V2NIMTeamService.on("onTeamJoined",this._onTeamJoined),t.V2NIMTeamService.on("onTeamLeft",this._onTeamLeft),t.V2NIMTeamService.on("onTeamMemberInfoUpdated",this._onTeamMemberInfoUpdated),t.V2NIMTeamService.on("onTeamMemberJoined",this._onTeamMemberJoined),t.V2NIMTeamService.on("onTeamMemberKicked",this._onTeamMemberKicked),t.V2NIMTeamService.on("onTeamMemberLeft",this._onTeamMemberLeft)}return e.prototype.destroy=function(){this.nim.V2NIMTeamService.off("onReceiveTeamJoinActionInfo",this._onReceiveTeamJoinActionInfo),this.nim.V2NIMTeamService.off("onSyncFailed",this._onSyncFailed),this.nim.V2NIMTeamService.off("onSyncFinished",this._onSyncFinished),this.nim.V2NIMTeamService.off("onSyncStarted",this._onSyncStarted),this.nim.V2NIMTeamService.off("onTeamCreated",this._onTeamCreated),this.nim.V2NIMTeamService.off("onTeamDismissed",this._onTeamDismissed),this.nim.V2NIMTeamService.off("onTeamInfoUpdated",this._onTeamInfoUpdated),this.nim.V2NIMTeamService.off("onTeamJoined",this._onTeamJoined),this.nim.V2NIMTeamService.off("onTeamLeft",this._onTeamLeft),this.nim.V2NIMTeamService.off("onTeamMemberInfoUpdated",this._onTeamMemberInfoUpdated),this.nim.V2NIMTeamService.off("onTeamMemberJoined",this._onTeamMemberJoined),this.nim.V2NIMTeamService.off("onTeamMemberKicked",this._onTeamMemberKicked),this.nim.V2NIMTeamService.off("onTeamMemberLeft",this._onTeamMemberLeft)},e.prototype.createTeam=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMTeamService.createTeam(e.createTeamParams,e.inviteeAccountIds,e.postscript,e.antispamConfig)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.updateTeamInfo=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMTeamService.updateTeamInfo(e.teamId,e.teamType,e.updateTeamInfoParams,e.antispamConfig)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.leaveTeam=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMTeamService.leaveTeam(e.teamId,e.teamType)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.getTeamInfo=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMTeamService.getTeamInfo(e.teamId,e.teamType)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.getTeamInfoByIds=function(e){return n(this,void 0,void 0,(function(){var t,r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=be,n={},[4,this.nim.V2NIMTeamService.getTeamInfoByIds(e.teamIds,e.teamType)];case 1:return[2,t.apply(void 0,[(n.teamList=i.sent(),n)])];case 2:throw r=i.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.dismissTeam=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMTeamService.dismissTeam(e.teamId,e.teamType)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.inviteMember=function(e){return n(this,void 0,void 0,(function(){var t,r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=be,n={},[4,this.nim.V2NIMTeamService.inviteMember(e.teamId,e.teamType,e.inviteeAccountIds,e.postscript)];case 1:return[2,t.apply(void 0,[(n.failedList=i.sent(),n)])];case 2:throw r=i.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.acceptInvitation=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMTeamService.acceptInvitation(e.invitationInfo)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.rejectInvitation=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMTeamService.rejectInvitation(e.invitationInfo,e.postscript)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.kickMember=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMTeamService.kickMember(e.teamId,e.teamType,e.memberAccountIds||[])];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.applyJoinTeam=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMTeamService.applyJoinTeam(e.teamId,e.teamType,e.postscript)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.acceptJoinApplication=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMTeamService.acceptJoinApplication(e.joinInfo)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.rejectJoinApplication=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMTeamService.rejectJoinApplication(e.joinInfo,e.postscript)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.updateTeamMemberRole=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMTeamService.updateTeamMemberRole(e.teamId,e.teamType,e.memberAccountIds,e.memberRole)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.transferTeamOwner=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMTeamService.transferTeamOwner(e.teamId,e.teamType,e.accountId,e.leave)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.updateSelfTeamMemberInfo=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMTeamService.updateSelfTeamMemberInfo(e.teamId,e.teamType,e.memberInfoParams)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.updateTeamMemberNick=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMTeamService.updateTeamMemberNick(e.teamId,e.teamType,e.accountId,e.teamNick)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.setTeamChatBannedMode=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMTeamService.setTeamChatBannedMode(e.teamId,e.teamType,e.chatBannedMode)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.setTeamMemberChatBannedStatus=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMTeamService.setTeamMemberChatBannedStatus(e.teamId,e.teamType,e.accountId,e.chatBanned)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.getJoinedTeamList=function(e){return n(this,void 0,void 0,(function(){var t,r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=be,n={},[4,this.nim.V2NIMTeamService.getJoinedTeamList(e.teamTypes)];case 1:return[2,t.apply(void 0,[(n.teamList=i.sent(),n)])];case 2:throw r=i.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.getJoinedTeamCount=function(e){return n(this,void 0,void 0,(function(){return i(this,(function(t){try{return[2,be(this.nim.V2NIMTeamService.getJoinedTeamCount(e.teamTypes))]}catch(e){throw Ce(e)}return[2]}))}))},e.prototype.getTeamMemberList=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMTeamService.getTeamMemberList(e.teamId,e.teamType,e.queryOption)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.getTeamMemberListByIds=function(e){return n(this,void 0,void 0,(function(){var t,r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=be,n={},[4,this.nim.V2NIMTeamService.getTeamMemberListByIds(e.teamId,e.teamType,e.accountIds)];case 1:return[2,t.apply(void 0,[(n.memberList=i.sent(),n)])];case 2:throw r=i.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.getTeamMemberInvitor=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMTeamService.getTeamMemberInvitor(e.teamId,e.teamType,e.accountIds)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.getTeamJoinActionInfoList=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMTeamService.getTeamJoinActionInfoList(e.queryOption)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.searchTeamByKeyword=function(e){return n(this,void 0,void 0,(function(){var t,r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=be,n={},[4,this.nim.V2NIMTeamService.searchTeamByKeyword(e.keyword)];case 1:return[2,t.apply(void 0,[(n.teamList=i.sent(),n)])];case 2:throw r=i.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.searchTeamMembers=function(e){return n(this,void 0,void 0,(function(){return i(this,(function(e){throw xe}))}))},e.prototype._onReceiveTeamJoinActionInfo=function(e){Ie.log("_onReceiveTeamJoinActionInfo: ",e),ke("TeamService","onReceiveTeamJoinActionInfo",e)},e.prototype._onSyncFailed=function(e){Ie.log("_onSyncFailed: ",e),ke("TeamService","onSyncFailed",Ce(e))},e.prototype._onSyncFinished=function(){return n(this,void 0,void 0,(function(){return i(this,(function(e){return Ie.log("_onSyncFinished"),ke("TeamService","onSyncFinished",{}),[2]}))}))},e.prototype._onSyncStarted=function(){Ie.log("_onSyncStarted"),ke("TeamService","onSyncStarted",{})},e.prototype._onTeamCreated=function(e){Ie.log("_onTeamCreated: ",e),ke("TeamService","onTeamCreated",e)},e.prototype._onTeamDismissed=function(e){Ie.log("_onTeamDismissed: ",e),ke("TeamService","onTeamDismissed",e)},e.prototype._onTeamInfoUpdated=function(e){Ie.log("_onTeamInfoUpdated: ",e),ke("TeamService","onTeamInfoUpdated",e)},e.prototype._onTeamJoined=function(e){Ie.log("_onTeamJoined: ",e),ke("TeamService","onTeamJoined",e)},e.prototype._onTeamLeft=function(e,t){return n(this,void 0,void 0,(function(){return i(this,(function(r){return Ie.log("_onTeamLeft: ",e,t),ke("TeamService","onTeamLeft",{team:e,isKicked:t}),[2]}))}))},e.prototype._onTeamMemberInfoUpdated=function(e){Ie.log("_onTeamMemberInfoUpdated: ",e),ke("TeamService","onTeamMemberInfoUpdated",{memberList:e})},e.prototype._onTeamMemberJoined=function(e){return n(this,void 0,void 0,(function(){return i(this,(function(t){return Ie.log("_onTeamMemberJoined: ",e),ke("TeamService","onTeamMemberJoined",{memberList:e}),[2]}))}))},e.prototype._onTeamMemberKicked=function(e,t){return n(this,void 0,void 0,(function(){return i(this,(function(r){return Ie.log("_onTeamMemberKicked: ",e,t),ke("TeamService","onTeamMemberKicked",{operatorAccountId:e,memberList:t}),[2]}))}))},e.prototype._onTeamMemberLeft=function(e){return n(this,void 0,void 0,(function(){return i(this,(function(t){return Ie.log("_onTeamMemberLeft: ",e),ke("TeamService","onTeamMemberLeft",{memberList:e}),[2]}))}))},r([He],e.prototype,"createTeam",null),r([He],e.prototype,"updateTeamInfo",null),r([He],e.prototype,"leaveTeam",null),r([He],e.prototype,"getTeamInfo",null),r([He],e.prototype,"getTeamInfoByIds",null),r([He],e.prototype,"dismissTeam",null),r([He],e.prototype,"inviteMember",null),r([He],e.prototype,"acceptInvitation",null),r([He],e.prototype,"rejectInvitation",null),r([He],e.prototype,"kickMember",null),r([He],e.prototype,"applyJoinTeam",null),r([He],e.prototype,"acceptJoinApplication",null),r([He],e.prototype,"rejectJoinApplication",null),r([He],e.prototype,"updateTeamMemberRole",null),r([He],e.prototype,"transferTeamOwner",null),r([He],e.prototype,"updateSelfTeamMemberInfo",null),r([He],e.prototype,"updateTeamMemberNick",null),r([He],e.prototype,"setTeamChatBannedMode",null),r([He],e.prototype,"setTeamMemberChatBannedStatus",null),r([He],e.prototype,"getJoinedTeamList",null),r([He],e.prototype,"getJoinedTeamCount",null),r([He],e.prototype,"getTeamMemberList",null),r([He],e.prototype,"getTeamMemberListByIds",null),r([He],e.prototype,"getTeamMemberInvitor",null),r([He],e.prototype,"getTeamJoinActionInfoList",null),r([He],e.prototype,"searchTeamByKeyword",null),r([He],e.prototype,"searchTeamMembers",null),e}(),Ke=ve.createLoggerDecorator("ConversationService",Ie),Ye=function(){function e(e,t){this.rootService=e,this.nim=t,this._onConversationChanged=this._onConversationChanged.bind(this),this._onConversationCreated=this._onConversationCreated.bind(this),this._onConversationDeleted=this._onConversationDeleted.bind(this),this._onConversationReadTimeUpdated=this._onConversationReadTimeUpdated.bind(this),this._onSyncFailed=this._onSyncFailed.bind(this),this._onSyncFinished=this._onSyncFinished.bind(this),this._onSyncStarted=this._onSyncStarted.bind(this),this._onTotalUnreadCountChanged=this._onTotalUnreadCountChanged.bind(this),this._onUnreadCountChangedByFilter=this._onUnreadCountChangedByFilter.bind(this),t.V2NIMConversationService.on("onConversationChanged",this._onConversationChanged),t.V2NIMConversationService.on("onConversationCreated",this._onConversationCreated),t.V2NIMConversationService.on("onConversationDeleted",this._onConversationDeleted),t.V2NIMConversationService.on("onConversationReadTimeUpdated",this._onConversationReadTimeUpdated),t.V2NIMConversationService.on("onSyncFailed",this._onSyncFailed),t.V2NIMConversationService.on("onSyncFinished",this._onSyncFinished),t.V2NIMConversationService.on("onSyncStarted",this._onSyncStarted),t.V2NIMConversationService.on("onTotalUnreadCountChanged",this._onTotalUnreadCountChanged),t.V2NIMConversationService.on("onUnreadCountChangedByFilter",this._onUnreadCountChangedByFilter)}return e.prototype.destroy=function(){this.nim.V2NIMConversationService.off("onConversationChanged",this._onConversationChanged),this.nim.V2NIMConversationService.off("onConversationCreated",this._onConversationCreated),this.nim.V2NIMConversationService.off("onConversationDeleted",this._onConversationDeleted),this.nim.V2NIMConversationService.off("onConversationReadTimeUpdated",this._onConversationReadTimeUpdated),this.nim.V2NIMConversationService.off("onSyncFailed",this._onSyncFailed),this.nim.V2NIMConversationService.off("onSyncFinished",this._onSyncFinished),this.nim.V2NIMConversationService.off("onSyncStarted",this._onSyncStarted),this.nim.V2NIMConversationService.off("onTotalUnreadCountChanged",this._onTotalUnreadCountChanged),this.nim.V2NIMConversationService.off("onUnreadCountChangedByFilter",this._onUnreadCountChangedByFilter)},e.prototype.getConversationList=function(e){return n(this,void 0,void 0,(function(){var r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.nim.V2NIMConversationService.getConversationList(e.offset,e.limit)];case 1:return r=i.sent(),[2,be(t(t({},r),{conversationList:r.conversationList.map((function(e){return we(e)}))}))];case 2:throw n=i.sent(),Ce(n);case 3:return[2]}}))}))},e.prototype.getConversationListByOption=function(e){return n(this,void 0,void 0,(function(){var r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.nim.V2NIMConversationService.getConversationListByOption(e.offset,e.limit,e.option)];case 1:return r=i.sent(),[2,be(t(t({},r),{conversationList:r.conversationList.map((function(e){return we(e)}))}))];case 2:throw n=i.sent(),Ce(n);case 3:return[2]}}))}))},e.prototype.getConversation=function(e){return n(this,void 0,void 0,(function(){var t,r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=be,r=we,[4,this.nim.V2NIMConversationService.getConversation(e.conversationId)];case 1:return[2,t.apply(void 0,[r.apply(void 0,[i.sent()])])];case 2:throw n=i.sent(),Ce(n);case 3:return[2]}}))}))},e.prototype.getConversationListByIds=function(e){return n(this,void 0,void 0,(function(){var t,r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=be,n={},[4,this.nim.V2NIMConversationService.getConversationListByIds(e.conversationIdList)];case 1:return[2,t.apply(void 0,[(n.conversationList=i.sent().map((function(e){return we(e)})),n)])];case 2:throw r=i.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.createConversation=function(e){return n(this,void 0,void 0,(function(){var t,r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=be,r=we,[4,this.nim.V2NIMConversationService.createConversation(e.conversationId)];case 1:return[2,t.apply(void 0,[r.apply(void 0,[i.sent()])])];case 2:throw n=i.sent(),Ce(n);case 3:return[2]}}))}))},e.prototype.deleteConversation=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMConversationService.deleteConversation(e.conversationId,e.clearMessage)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.deleteConversationListByIds=function(e){return n(this,void 0,void 0,(function(){var t,r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=be,n={},[4,this.nim.V2NIMConversationService.deleteConversationListByIds(e.conversationIdList,e.clearMessage)];case 1:return[2,t.apply(void 0,[(n.conversationOperationResult=i.sent(),n)])];case 2:throw r=i.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.stickTopConversation=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMConversationService.stickTopConversation(e.conversationId,e.stickTop)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.updateConversation=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMConversationService.updateConversation(e.conversationId,e.updateInfo)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.updateConversationLocalExtension=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMConversationService.updateConversationLocalExtension(e.conversationId,e.localExtension||"")];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.getTotalUnreadCount=function(){return n(this,void 0,void 0,(function(){return i(this,(function(e){try{return[2,be(this.nim.V2NIMConversationService.getTotalUnreadCount())]}catch(e){throw Ce(e)}return[2]}))}))},e.prototype.getUnreadCountByIds=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMConversationService.getUnreadCountByIds(e.conversationIdList)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.getUnreadCountByFilter=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMConversationService.getUnreadCountByFilter(e)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.clearTotalUnreadCount=function(){return n(this,void 0,void 0,(function(){var e,t;return i(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),e=be,[4,this.nim.V2NIMConversationService.clearTotalUnreadCount()];case 1:return[2,e.apply(void 0,[r.sent()])];case 2:throw t=r.sent(),Ce(t);case 3:return[2]}}))}))},e.prototype.clearUnreadCountByIds=function(e){return n(this,void 0,void 0,(function(){var t,r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=be,n={},[4,this.nim.V2NIMConversationService.clearUnreadCountByIds(e.conversationIdList)];case 1:return[2,t.apply(void 0,[(n.conversationOperationResult=i.sent(),n)])];case 2:throw r=i.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.clearUnreadCountByGroupId=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMConversationService.clearUnreadCountByGroupId(e.groupId)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.clearUnreadCountByTypes=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMConversationService.clearUnreadCountByTypes(e.conversationTypeList)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.subscribeUnreadCountByFilter=function(e){return n(this,void 0,void 0,(function(){return i(this,(function(t){try{return[2,be(this.nim.V2NIMConversationService.subscribeUnreadCountByFilter(e.filter))]}catch(e){throw Ce(e)}return[2]}))}))},e.prototype.unsubscribeUnreadCountByFilter=function(e){return n(this,void 0,void 0,(function(){return i(this,(function(t){try{return[2,be(this.nim.V2NIMConversationService.unsubscribeUnreadCountByFilter(e.filter))]}catch(e){throw Ce(e)}return[2]}))}))},e.prototype.getConversationReadTime=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMConversationService.getConversationReadTime(e.conversationId)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.markConversationRead=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMConversationService.markConversationRead(e.conversationId)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype._onConversationChanged=function(e){Ie.log("_onConversationChanged",e),ke("ConversationService","onConversationChanged",{conversationList:e.map((function(e){return we(e)}))})},e.prototype._onConversationCreated=function(e){Ie.log("_onConversationCreated",e),ke("ConversationService","onConversationCreated",we(e))},e.prototype._onConversationDeleted=function(e){Ie.log("_onConversationDeleted",e),ke("ConversationService","onConversationDeleted",{conversationIdList:e})},e.prototype._onConversationReadTimeUpdated=function(e,t){Ie.log("_onConversationReadTimeUpdated",e,t),ke("ConversationService","onConversationReadTimeUpdated",{conversationId:e,readTime:t})},e.prototype._onSyncFailed=function(e){Ie.log("_onSyncFailed",e),ke("ConversationService","onSyncFailed",{})},e.prototype._onSyncFinished=function(){Ie.log("_onSyncFinished"),ke("ConversationService","onSyncFinished",{})},e.prototype._onSyncStarted=function(){Ie.log("_onSyncStarted"),ke("ConversationService","onSyncStarted",{})},e.prototype._onTotalUnreadCountChanged=function(e){Ie.log("_onTotalUnreadCountChanged",e),ke("ConversationService","onTotalUnreadCountChanged",{unreadCount:e})},e.prototype._onUnreadCountChangedByFilter=function(e,t){Ie.log("_onUnreadCountChangedByFilter",t,e),ke("ConversationService","onUnreadCountChangedByFilter",{unreadCount:t,conversationFilter:e})},r([Ke],e.prototype,"getConversationList",null),r([Ke],e.prototype,"getConversationListByOption",null),r([Ke],e.prototype,"getConversation",null),r([Ke],e.prototype,"getConversationListByIds",null),r([Ke],e.prototype,"createConversation",null),r([Ke],e.prototype,"deleteConversation",null),r([Ke],e.prototype,"deleteConversationListByIds",null),r([Ke],e.prototype,"stickTopConversation",null),r([Ke],e.prototype,"updateConversation",null),r([Ke],e.prototype,"updateConversationLocalExtension",null),r([Ke],e.prototype,"getTotalUnreadCount",null),r([Ke],e.prototype,"getUnreadCountByIds",null),r([Ke],e.prototype,"getUnreadCountByFilter",null),r([Ke],e.prototype,"clearTotalUnreadCount",null),r([Ke],e.prototype,"clearUnreadCountByIds",null),r([Ke],e.prototype,"clearUnreadCountByGroupId",null),r([Ke],e.prototype,"clearUnreadCountByTypes",null),r([Ke],e.prototype,"subscribeUnreadCountByFilter",null),r([Ke],e.prototype,"unsubscribeUnreadCountByFilter",null),r([Ke],e.prototype,"getConversationReadTime",null),r([Ke],e.prototype,"markConversationRead",null),e}(),Qe=ve.createLoggerDecorator("StorageService",Ie),Je=function(){function e(e,t){this.rootService=e,this.nim=t}return e.prototype.destroy=function(){},e.prototype.addCustomStorageScene=function(e){return n(this,void 0,void 0,(function(){return i(this,(function(t){try{return[2,be(this.nim.V2NIMStorageService.addCustomStorageScene(e.sceneName,e.expireTime))]}catch(e){throw Ce(e)}return[2]}))}))},e.prototype.cancelUploadFile=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMStorageService.cancelUploadFile(e.fileTask)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.createUploadFileTask=function(e){return n(this,void 0,void 0,(function(){return i(this,(function(r){try{return[2,be(this.nim.V2NIMStorageService.createUploadFileTask(t(t({},e.fileParams),{fileObj:e.fileObj})))]}catch(e){throw Ce(e)}return[2]}))}))},e.prototype.downloadAttachment=function(){return n(this,void 0,void 0,(function(){return i(this,(function(e){throw xe}))}))},e.prototype.downloadFile=function(){return n(this,void 0,void 0,(function(){return i(this,(function(e){throw xe}))}))},e.prototype.getImageThumbUrl=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMStorageService.getImageThumbUrl(e.attachment,e.thumbSize)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.getStorageSceneList=function(){return n(this,void 0,void 0,(function(){return i(this,(function(e){try{return[2,be({sceneList:this.nim.V2NIMStorageService.getStorageSceneList()})]}catch(e){throw Ce(e)}return[2]}))}))},e.prototype.getVideoCoverUrl=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMStorageService.getVideoCoverUrl(e.attachment,e.thumbSize)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.shortUrlToLong=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMStorageService.shortUrlToLong(e.url)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.uploadFile=function(e){return n(this,void 0,void 0,(function(){var r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),r=be,[4,this.nim.V2NIMStorageService.uploadFile(t(t({},e.fileTask),{uploadParams:t(t({},e.fileTask.uploadParams),{fileObj:e.fileObj})}),(function(t){ke("StorageService","onFileUploadProgress",{taskId:e.fileTask.taskId,progress:t})}))];case 1:return[2,r.apply(void 0,[i.sent()])];case 2:throw n=i.sent(),Ce(n);case 3:return[2]}}))}))},e.prototype.imageThumbUrl=function(e){return n(this,void 0,void 0,(function(){return i(this,(function(e){throw xe}))}))},e.prototype.videoCoverUrl=function(e){return n(this,void 0,void 0,(function(){return i(this,(function(e){throw xe}))}))},r([Qe],e.prototype,"addCustomStorageScene",null),r([Qe],e.prototype,"cancelUploadFile",null),r([Qe],e.prototype,"createUploadFileTask",null),r([Qe],e.prototype,"downloadAttachment",null),r([Qe],e.prototype,"downloadFile",null),r([Qe],e.prototype,"getImageThumbUrl",null),r([Qe],e.prototype,"getStorageSceneList",null),r([Qe],e.prototype,"getVideoCoverUrl",null),r([Qe],e.prototype,"shortUrlToLong",null),r([Qe],e.prototype,"uploadFile",null),r([Qe],e.prototype,"imageThumbUrl",null),r([Qe],e.prototype,"videoCoverUrl",null),e}(),ze=ve.createLoggerDecorator("MessageCreatorService",Ie),Xe=function(){function e(e,t){this.rootService=e,this.nim=t,this.msgMap=new Map}return e.prototype.destroy=function(){this.msgMap.clear()},e.prototype.createTextMessage=function(e){return n(this,void 0,void 0,(function(){var t;return i(this,(function(r){try{return t=this.nim.V2NIMMessageCreator.createTextMessage(e.text),this.msgMap.set(t.messageClientId,t),[2,be(t)]}catch(e){throw Ce(e)}return[2]}))}))},e.prototype.createImageMessage=function(e){return n(this,void 0,void 0,(function(){var t;return i(this,(function(r){try{return t=this.nim.V2NIMMessageCreator.createImageMessage(e.imageObj,e.name,e.sceneName,e.width,e.height),this.msgMap.set(t.messageClientId,t),[2,be(t)]}catch(e){throw Ce(e)}return[2]}))}))},e.prototype.createAudioMessage=function(e){return n(this,void 0,void 0,(function(){var t;return i(this,(function(r){try{return t=this.nim.V2NIMMessageCreator.createAudioMessage(e.audioObj,e.name,e.sceneName,e.duration),this.msgMap.set(t.messageClientId,t),[2,be(t)]}catch(e){throw Ce(e)}return[2]}))}))},e.prototype.createVideoMessage=function(e){return n(this,void 0,void 0,(function(){var t;return i(this,(function(r){try{return t=this.nim.V2NIMMessageCreator.createVideoMessage(e.videoObj,e.name,e.sceneName,e.duration,e.width,e.height),this.msgMap.set(t.messageClientId,t),[2,be(t)]}catch(e){throw Ce(e)}return[2]}))}))},e.prototype.createFileMessage=function(e){return n(this,void 0,void 0,(function(){var t;return i(this,(function(r){try{return t=this.nim.V2NIMMessageCreator.createFileMessage(e.fileObj,e.name,e.sceneName),this.msgMap.set(t.messageClientId,t),[2,be(t)]}catch(e){throw Ce(e)}return[2]}))}))},e.prototype.createLocationMessage=function(e){return n(this,void 0,void 0,(function(){var t;return i(this,(function(r){try{return t=this.nim.V2NIMMessageCreator.createLocationMessage(e.latitude,e.longitude,e.address),this.msgMap.set(t.messageClientId,t),[2,be(t)]}catch(e){throw Ce(e)}return[2]}))}))},e.prototype.createCustomMessage=function(e){return n(this,void 0,void 0,(function(){var t;return i(this,(function(r){try{return t=this.nim.V2NIMMessageCreator.createCustomMessage(e.text,e.rawAttachment),this.msgMap.set(t.messageClientId,t),[2,be(t)]}catch(e){throw Ce(e)}return[2]}))}))},e.prototype.createTipsMessage=function(e){return n(this,void 0,void 0,(function(){var t;return i(this,(function(r){try{return t=this.nim.V2NIMMessageCreator.createTipsMessage(e.text),this.msgMap.set(t.messageClientId,t),[2,be(t)]}catch(e){throw Ce(e)}return[2]}))}))},e.prototype.createForwardMessage=function(e){return n(this,void 0,void 0,(function(){var t;return i(this,(function(r){if(t=this.nim.V2NIMMessageCreator.createForwardMessage(e.message))return this.msgMap.set(t.messageClientId,t),[2,be(t)];throw Ce({code:199001,message:"createForwardMessage failed",desc:"createForwardMessage failed",detail:{},name:""})}))}))},e.prototype.createCallMessage=function(e){return n(this,void 0,void 0,(function(){var t;return i(this,(function(r){try{return t=this.nim.V2NIMMessageCreator.createCallMessage(e.type,e.channelId,e.status,e.durations,e.text),this.msgMap.set(t.messageClientId,t),[2,be(t)]}catch(e){throw Ce(e)}return[2]}))}))},r([ze],e.prototype,"createTextMessage",null),r([ze],e.prototype,"createImageMessage",null),r([ze],e.prototype,"createAudioMessage",null),r([ze],e.prototype,"createVideoMessage",null),r([ze],e.prototype,"createFileMessage",null),r([ze],e.prototype,"createLocationMessage",null),r([ze],e.prototype,"createCustomMessage",null),r([ze],e.prototype,"createTipsMessage",null),r([ze],e.prototype,"createForwardMessage",null),r([ze],e.prototype,"createCallMessage",null),e}(),$e=ve.createLoggerDecorator("NotificationService",Ie),Ze=function(){function e(e,t){this.rootService=e,this.nim=t,this._onReceiveBroadcastNotifications=this._onReceiveBroadcastNotifications.bind(this),this._onReceiveCustomNotifications=this._onReceiveCustomNotifications.bind(this),t.V2NIMNotificationService.on("onReceiveBroadcastNotifications",this._onReceiveBroadcastNotifications),t.V2NIMNotificationService.on("onReceiveCustomNotifications",this._onReceiveCustomNotifications)}return e.prototype.destroy=function(){this.nim.V2NIMNotificationService.off("onReceiveBroadcastNotifications",this._onReceiveBroadcastNotifications),this.nim.V2NIMNotificationService.off("onReceiveCustomNotifications",this._onReceiveCustomNotifications)},e.prototype.sendCustomNotification=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMNotificationService.sendCustomNotification(e.conversationId,e.content,e.params)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype._onReceiveBroadcastNotifications=function(e){Ie.log("_onReceiveBroadcastNotifications",e),ke("NotificationService","onReceiveBroadcastNotifications",{broadcastNotifications:e})},e.prototype._onReceiveCustomNotifications=function(e){try{var t=e.map((function(e){var t,r;return"string"==typeof(null===(t=e.pushConfig)||void 0===t?void 0:t.forcePushAccountIds)&&(e.pushConfig.forcePushAccountIds=JSON.parse(null===(r=e.pushConfig)||void 0===r?void 0:r.forcePushAccountIds)),e}));Ie.log("_onReceiveCustomNotifications",t),ke("NotificationService","onReceiveCustomNotifications",{customNotifications:t})}catch(e){Ie.log("_onReceiveCustomNotifications error",e)}},r([$e],e.prototype,"sendCustomNotification",null),e}(),et=ve.createLoggerDecorator("ConversationUtil",Ie),rt=function(){function e(e,t){this.rootService=e,this.nim=t}return e.prototype.destroy=function(){},e.prototype.conversationId=function(e){return n(this,void 0,void 0,(function(){return i(this,(function(e){throw xe}))}))},e.prototype.p2pConversationId=function(e){return n(this,void 0,void 0,(function(){return i(this,(function(t){return[2,be(this.nim.V2NIMConversationIdUtil.p2pConversationId(e.accountId))]}))}))},e.prototype.teamConversationId=function(e){return n(this,void 0,void 0,(function(){return i(this,(function(t){return[2,be(this.nim.V2NIMConversationIdUtil.teamConversationId(e.teamId))]}))}))},e.prototype.superTeamConversationId=function(e){return n(this,void 0,void 0,(function(){return i(this,(function(t){return[2,be(this.nim.V2NIMConversationIdUtil.superTeamConversationId(e.superTeamId))]}))}))},e.prototype.conversationType=function(e){return n(this,void 0,void 0,(function(){return i(this,(function(t){return[2,be({conversationType:this.nim.V2NIMConversationIdUtil.parseConversationType(e.conversationId)})]}))}))},e.prototype.conversationTargetId=function(e){return n(this,void 0,void 0,(function(){return i(this,(function(t){return[2,be(this.nim.V2NIMConversationIdUtil.parseConversationTargetId(e.conversationId))]}))}))},e.prototype.isConversationIdValid=function(e){return n(this,void 0,void 0,(function(){return i(this,(function(e){throw xe}))}))},e.prototype.sessionTypeV1=function(e){return n(this,void 0,void 0,(function(){return i(this,(function(e){throw xe}))}))},r([et],e.prototype,"conversationId",null),r([et],e.prototype,"p2pConversationId",null),r([et],e.prototype,"teamConversationId",null),r([et],e.prototype,"superTeamConversationId",null),r([et],e.prototype,"conversationType",null),r([et],e.prototype,"conversationTargetId",null),r([et],e.prototype,"isConversationIdValid",null),r([et],e.prototype,"sessionTypeV1",null),e}(),nt=ve.createLoggerDecorator("AIService",Ie),it=function(){function e(e,t){this.rootService=e,this.nim=t,this._onProxyAIModelCall=this._onProxyAIModelCall.bind(this),t.V2NIMAIService.on("onProxyAIModelCall",this._onProxyAIModelCall)}return e.prototype.destroy=function(){this.nim.V2NIMAIService.off("onProxyAIModelCall",this._onProxyAIModelCall)},e.prototype.getAIUserList=function(){return n(this,void 0,void 0,(function(){var e,t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),e=be,r={},[4,this.nim.V2NIMAIService.getAIUserList()];case 1:return[2,e.apply(void 0,[(r.userList=n.sent(),r)])];case 2:throw t=n.sent(),Ce(t);case 3:return[2]}}))}))},e.prototype.proxyAIModelCall=function(e){var r;return n(this,void 0,void 0,(function(){var n,o;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),n=be,[4,this.nim.V2NIMAIService.proxyAIModelCall(t(t({},e.params),{messages:(null===(r=e.params.messages)||void 0===r?void 0:r.length)?e.params.messages.map((function(e){return t(t({},e),{role:Re(e.role)})})):void 0}))];case 1:return[2,n.apply(void 0,[i.sent()])];case 2:throw o=i.sent(),Ce(o);case 3:return[2]}}))}))},e.prototype._onProxyAIModelCall=function(e){Ie.log("_onProxyAIModelCall",e),ke("AIService","onProxyAIModelCall",e)},r([nt],e.prototype,"getAIUserList",null),r([nt],e.prototype,"proxyAIModelCall",null),e}(),ot=ve.createLoggerDecorator("SubscriptionService",Ie),at=function(){function e(e,t){this.rootService=e,this.nim=t,this._onUserStatusChanged=this._onUserStatusChanged.bind(this),t.V2NIMSubscriptionService.on("onUserStatusChanged",this._onUserStatusChanged)}return e.prototype.destroy=function(){this.nim.V2NIMSubscriptionService.off("onUserStatusChanged",this._onUserStatusChanged)},e.prototype.subscribeUserStatus=function(e){return n(this,void 0,void 0,(function(){var t,r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=be,n={},[4,this.nim.V2NIMSubscriptionService.subscribeUserStatus(e.option)];case 1:return[2,t.apply(void 0,[(n.accountIds=i.sent(),n)])];case 2:throw r=i.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.unsubscribeUserStatus=function(e){return n(this,void 0,void 0,(function(){var t,r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=be,n={},[4,this.nim.V2NIMSubscriptionService.unsubscribeUserStatus(e.option)];case 1:return[2,t.apply(void 0,[(n.accountIds=i.sent(),n)])];case 2:throw r=i.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.publishCustomUserStatus=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMSubscriptionService.publishCustomUserStatus(e.params)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.queryUserStatusSubscriptions=function(e){return n(this,void 0,void 0,(function(){var t,r,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=be,n={},[4,this.nim.V2NIMSubscriptionService.queryUserStatusSubscriptions(e.accountIds)];case 1:return[2,t.apply(void 0,[(n.subscribeResultList=i.sent(),n)])];case 2:throw r=i.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype._onUserStatusChanged=function(e){Ie.log("_onUserStatusChanged",e),ke("SubscriptionService","onUserStatusChanged",{userStatusList:e})},r([ot],e.prototype,"subscribeUserStatus",null),r([ot],e.prototype,"unsubscribeUserStatus",null),r([ot],e.prototype,"publishCustomUserStatus",null),r([ot],e.prototype,"queryUserStatusSubscriptions",null),e}(),st=ve.createLoggerDecorator("SignallingService",Ie),ct=function(){function e(e,t){this.rootService=e,this.nim=t,this._onOnlineEvent=this._onOnlineEvent.bind(this),this._onOfflineEvent=this._onOfflineEvent.bind(this),this._onMultiClientEvent=this._onMultiClientEvent.bind(this),this._onSyncRoomInfoList=this._onSyncRoomInfoList.bind(this),t.V2NIMSignallingService.on("onOnlineEvent",this._onOnlineEvent),t.V2NIMSignallingService.on("onOfflineEvent",this._onOfflineEvent),t.V2NIMSignallingService.on("onMultiClientEvent",this._onMultiClientEvent),t.V2NIMSignallingService.on("onSyncRoomInfoList",this._onSyncRoomInfoList)}return e.prototype.destroy=function(){this.nim.V2NIMSignallingService.off("onOnlineEvent",this._onOnlineEvent),this.nim.V2NIMSignallingService.off("onOfflineEvent",this._onOfflineEvent),this.nim.V2NIMSignallingService.off("onMultiClientEvent",this._onMultiClientEvent),this.nim.V2NIMSignallingService.off("onSyncRoomInfoList",this._onSyncRoomInfoList)},e.prototype.call=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMSignallingService.call(e.params)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.callSetup=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMSignallingService.callSetup(e.params)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.createRoom=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMSignallingService.createRoom(e.channelType,e.channelName,e.channelExtension)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.closeRoom=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMSignallingService.closeRoom(e.channelId,e.offlineEnabled,e.serverExtension)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.joinRoom=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMSignallingService.joinRoom(e.params)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.leaveRoom=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMSignallingService.leaveRoom(e.channelId,e.offlineEnabled,e.serverExtension)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.invite=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMSignallingService.invite(e.params)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.cancelInvite=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMSignallingService.cancelInvite(e.params)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.rejectInvite=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMSignallingService.rejectInvite(e.params)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.acceptInvite=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMSignallingService.acceptInvite(e.params)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.sendControl=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMSignallingService.sendControl(e.channelId,e.receiverAccountId,e.serverExtension)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype.getRoomInfoByChannelName=function(e){return n(this,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=be,[4,this.nim.V2NIMSignallingService.getRoomInfoByChannelName(e.channelName)];case 1:return[2,t.apply(void 0,[n.sent()])];case 2:throw r=n.sent(),Ce(r);case 3:return[2]}}))}))},e.prototype._onOnlineEvent=function(e){Ie.log("_onOnlineEvent"),ke("SignallingService","onOnlineEvent",e)},e.prototype._onOfflineEvent=function(e){Ie.log("onOfflineEvent"),ke("SignallingService","onOfflineEvent",{offlineEvents:e})},e.prototype._onMultiClientEvent=function(e){Ie.log("onMultiClientEvent"),ke("SignallingService","onMultiClientEvent",e)},e.prototype._onSyncRoomInfoList=function(e){Ie.log("onSyncRoomInfoList"),ke("SignallingService","onSyncRoomInfoList",{syncRoomInfoList:e})},r([st],e.prototype,"call",null),r([st],e.prototype,"callSetup",null),r([st],e.prototype,"createRoom",null),r([st],e.prototype,"closeRoom",null),r([st],e.prototype,"joinRoom",null),r([st],e.prototype,"leaveRoom",null),r([st],e.prototype,"invite",null),r([st],e.prototype,"cancelInvite",null),r([st],e.prototype,"rejectInvite",null),r([st],e.prototype,"acceptInvite",null),r([st],e.prototype,"sendControl",null),r([st],e.prototype,"getRoomInfoByChannelName",null),e}(),ut=function(){function e(){this.nim={},this.initializeService=new Ne(this,this.nim)}return e.prototype.init=function(){this.loginService=new Le(this,this.nim),this.settingsService=new Ue(this,this.nim),this.messageService=new qe(this,this.nim),this.userService=new Fe(this,this.nim),this.friendService=new je(this,this.nim),this.teamService=new We(this,this.nim),this.conversationService=new Ye(this,this.nim),this.storageService=new Je(this,this.nim),this.messageCreatorService=new Xe(this,this.nim),this.notificationService=new Ze(this,this.nim),this.conversationUtil=new rt(this,this.nim),this.aiService=new it(this,this.nim),this.subscriptionService=new at(this,this.nim),this.signallingService=new ct(this,this.nim)},e.prototype.destroy=function(){var e,t,r,n,i,o,a,s,c,u,d,l,p,m;this.initializeService.destroy(),null===(e=this.loginService)||void 0===e||e.destroy(),null===(t=this.settingsService)||void 0===t||t.destroy(),null===(r=this.messageService)||void 0===r||r.destroy(),null===(n=this.userService)||void 0===n||n.destroy(),null===(i=this.friendService)||void 0===i||i.destroy(),null===(o=this.teamService)||void 0===o||o.destroy(),null===(a=this.conversationService)||void 0===a||a.destroy(),null===(s=this.storageService)||void 0===s||s.destroy(),null===(c=this.messageCreatorService)||void 0===c||c.destroy(),null===(u=this.notificationService)||void 0===u||u.destroy(),null===(d=this.conversationUtil)||void 0===d||d.destroy(),null===(l=this.aiService)||void 0===l||l.destroy(),null===(p=this.subscriptionService)||void 0===p||p.destroy(),null===(m=this.signallingService)||void 0===m||m.destroy()},Object.defineProperty(e.prototype,"InitializeService",{get:function(){return this.initializeService},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"LoginService",{get:function(){return this.loginService},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"SettingsService",{get:function(){return this.settingsService},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"MessageService",{get:function(){return this.messageService},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"UserService",{get:function(){return this.userService},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"FriendService",{get:function(){return this.friendService},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"TeamService",{get:function(){return this.teamService},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ConversationService",{get:function(){return this.conversationService},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"StorageService",{get:function(){return this.storageService},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"MessageCreatorService",{get:function(){return this.messageCreatorService},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"NotificationService",{get:function(){return this.notificationService},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ConversationIdUtil",{get:function(){return this.conversationUtil},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"AIService",{get:function(){return this.aiService},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"SubscriptionService",{get:function(){return this.subscriptionService},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"SignallingService",{get:function(){return this.signallingService},enumerable:!1,configurable:!0}),e}();e.default=ut,Object.defineProperty(e,"__esModule",{value:!0})}));
